var Ev=Object.defineProperty;var kv=(i,t,e)=>t in i?Ev(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var F=(i,t,e)=>kv(i,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function e(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(n){if(n.ep)return;n.ep=!0;const r=e(n);fetch(n.href,r)}})();/**
* @vue/shared v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function nh(i){const t=Object.create(null);for(const e of i.split(","))t[e]=1;return e=>e in t}const kt={},Ii=[],xs=()=>{},Pv=()=>!1,Xa=i=>i.charCodeAt(0)===111&&i.charCodeAt(1)===110&&(i.charCodeAt(2)>122||i.charCodeAt(2)<97),ih=i=>i.startsWith("onUpdate:"),ye=Object.assign,rh=(i,t)=>{const e=i.indexOf(t);e>-1&&i.splice(e,1)},Av=Object.prototype.hasOwnProperty,St=(i,t)=>Av.call(i,t),lt=Array.isArray,Bi=i=>po(i)==="[object Map]",Ua=i=>po(i)==="[object Set]",hu=i=>po(i)==="[object Date]",ft=i=>typeof i=="function",qt=i=>typeof i=="string",$s=i=>typeof i=="symbol",Dt=i=>i!==null&&typeof i=="object",fd=i=>(Dt(i)||ft(i))&&ft(i.then)&&ft(i.catch),dd=Object.prototype.toString,po=i=>dd.call(i),Fv=i=>po(i).slice(8,-1),gd=i=>po(i)==="[object Object]",oh=i=>qt(i)&&i!=="NaN"&&i[0]!=="-"&&""+parseInt(i,10)===i,Pr=nh(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Ga=i=>{const t=Object.create(null);return e=>t[e]||(t[e]=i(e))},Dv=/-(\w)/g,ps=Ga(i=>i.replace(Dv,(t,e)=>e?e.toUpperCase():"")),Rv=/\B([A-Z])/g,xi=Ga(i=>i.replace(Rv,"-$1").toLowerCase()),$a=Ga(i=>i.charAt(0).toUpperCase()+i.slice(1)),wl=Ga(i=>i?`on${$a(i)}`:""),cn=(i,t)=>!Object.is(i,t),Jo=(i,...t)=>{for(let e=0;e<i.length;e++)i[e](...t)},pd=(i,t,e,s=!1)=>{Object.defineProperty(i,t,{configurable:!0,enumerable:!1,writable:s,value:e})},ca=i=>{const t=parseFloat(i);return isNaN(t)?i:t};let uu;const qa=()=>uu||(uu=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function cs(i){if(lt(i)){const t={};for(let e=0;e<i.length;e++){const s=i[e],n=qt(s)?Bv(s):cs(s);if(n)for(const r in n)t[r]=n[r]}return t}else if(qt(i)||Dt(i))return i}const Lv=/;(?![^(]*\))/g,jv=/:([^]+)/,Iv=/\/\*[^]*?\*\//g;function Bv(i){const t={};return i.replace(Iv,"").split(Lv).forEach(e=>{if(e){const s=e.split(jv);s.length>1&&(t[s[0].trim()]=s[1].trim())}}),t}function $e(i){let t="";if(qt(i))t=i;else if(lt(i))for(let e=0;e<i.length;e++){const s=$e(i[e]);s&&(t+=s+" ")}else if(Dt(i))for(const e in i)i[e]&&(t+=e+" ");return t.trim()}const Nv="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",Hv=nh(Nv);function md(i){return!!i||i===""}function zv(i,t){if(i.length!==t.length)return!1;let e=!0;for(let s=0;e&&s<i.length;s++)e=Ka(i[s],t[s]);return e}function Ka(i,t){if(i===t)return!0;let e=hu(i),s=hu(t);if(e||s)return e&&s?i.getTime()===t.getTime():!1;if(e=$s(i),s=$s(t),e||s)return i===t;if(e=lt(i),s=lt(t),e||s)return e&&s?zv(i,t):!1;if(e=Dt(i),s=Dt(t),e||s){if(!e||!s)return!1;const n=Object.keys(i).length,r=Object.keys(t).length;if(n!==r)return!1;for(const o in i){const a=i.hasOwnProperty(o),l=t.hasOwnProperty(o);if(a&&!l||!a&&l||!Ka(i[o],t[o]))return!1}}return String(i)===String(t)}function Vv(i,t){return i.findIndex(e=>Ka(e,t))}const vd=i=>!!(i&&i.__v_isRef===!0),Cs=i=>qt(i)?i:i==null?"":lt(i)||Dt(i)&&(i.toString===dd||!ft(i.toString))?vd(i)?Cs(i.value):JSON.stringify(i,_d,2):String(i),_d=(i,t)=>vd(t)?_d(i,t.value):Bi(t)?{[`Map(${t.size})`]:[...t.entries()].reduce((e,[s,n],r)=>(e[Tl(s,r)+" =>"]=n,e),{})}:Ua(t)?{[`Set(${t.size})`]:[...t.values()].map(e=>Tl(e))}:$s(t)?Tl(t):Dt(t)&&!lt(t)&&!gd(t)?String(t):t,Tl=(i,t="")=>{var e;return $s(i)?`Symbol(${(e=i.description)!=null?e:t})`:i};/**
* @vue/reactivity v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Ue;class Wv{constructor(t=!1){this.detached=t,this._active=!0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=Ue,!t&&Ue&&(this.index=(Ue.scopes||(Ue.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let t,e;if(this.scopes)for(t=0,e=this.scopes.length;t<e;t++)this.scopes[t].pause();for(t=0,e=this.effects.length;t<e;t++)this.effects[t].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let t,e;if(this.scopes)for(t=0,e=this.scopes.length;t<e;t++)this.scopes[t].resume();for(t=0,e=this.effects.length;t<e;t++)this.effects[t].resume()}}run(t){if(this._active){const e=Ue;try{return Ue=this,t()}finally{Ue=e}}}on(){Ue=this}off(){Ue=this.parent}stop(t){if(this._active){this._active=!1;let e,s;for(e=0,s=this.effects.length;e<s;e++)this.effects[e].stop();for(this.effects.length=0,e=0,s=this.cleanups.length;e<s;e++)this.cleanups[e]();if(this.cleanups.length=0,this.scopes){for(e=0,s=this.scopes.length;e<s;e++)this.scopes[e].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!t){const n=this.parent.scopes.pop();n&&n!==this&&(this.parent.scopes[this.index]=n,n.index=this.index)}this.parent=void 0}}}function Yv(){return Ue}let Ft;const Ol=new WeakSet;class yd{constructor(t){this.fn=t,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,Ue&&Ue.active&&Ue.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,Ol.has(this)&&(Ol.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||xd(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,fu(this),Cd(this);const t=Ft,e=Ss;Ft=this,Ss=!0;try{return this.fn()}finally{Sd(this),Ft=t,Ss=e,this.flags&=-3}}stop(){if(this.flags&1){for(let t=this.deps;t;t=t.nextDep)ch(t);this.deps=this.depsTail=void 0,fu(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?Ol.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){lc(this)&&this.run()}get dirty(){return lc(this)}}let bd=0,Ar,Fr;function xd(i,t=!1){if(i.flags|=8,t){i.next=Fr,Fr=i;return}i.next=Ar,Ar=i}function ah(){bd++}function lh(){if(--bd>0)return;if(Fr){let t=Fr;for(Fr=void 0;t;){const e=t.next;t.next=void 0,t.flags&=-9,t=e}}let i;for(;Ar;){let t=Ar;for(Ar=void 0;t;){const e=t.next;if(t.next=void 0,t.flags&=-9,t.flags&1)try{t.trigger()}catch(s){i||(i=s)}t=e}}if(i)throw i}function Cd(i){for(let t=i.deps;t;t=t.nextDep)t.version=-1,t.prevActiveLink=t.dep.activeLink,t.dep.activeLink=t}function Sd(i){let t,e=i.depsTail,s=e;for(;s;){const n=s.prevDep;s.version===-1?(s===e&&(e=n),ch(s),Xv(s)):t=s,s.dep.activeLink=s.prevActiveLink,s.prevActiveLink=void 0,s=n}i.deps=t,i.depsTail=e}function lc(i){for(let t=i.deps;t;t=t.nextDep)if(t.dep.version!==t.version||t.dep.computed&&(wd(t.dep.computed)||t.dep.version!==t.version))return!0;return!!i._dirty}function wd(i){if(i.flags&4&&!(i.flags&16)||(i.flags&=-17,i.globalVersion===qr))return;i.globalVersion=qr;const t=i.dep;if(i.flags|=2,t.version>0&&!i.isSSR&&i.deps&&!lc(i)){i.flags&=-3;return}const e=Ft,s=Ss;Ft=i,Ss=!0;try{Cd(i);const n=i.fn(i._value);(t.version===0||cn(n,i._value))&&(i._value=n,t.version++)}catch(n){throw t.version++,n}finally{Ft=e,Ss=s,Sd(i),i.flags&=-3}}function ch(i,t=!1){const{dep:e,prevSub:s,nextSub:n}=i;if(s&&(s.nextSub=n,i.prevSub=void 0),n&&(n.prevSub=s,i.nextSub=void 0),e.subs===i&&(e.subs=s,!s&&e.computed)){e.computed.flags&=-5;for(let r=e.computed.deps;r;r=r.nextDep)ch(r,!0)}!t&&!--e.sc&&e.map&&e.map.delete(e.key)}function Xv(i){const{prevDep:t,nextDep:e}=i;t&&(t.nextDep=e,i.prevDep=void 0),e&&(e.prevDep=t,i.nextDep=void 0)}let Ss=!0;const Td=[];function Vn(){Td.push(Ss),Ss=!1}function Wn(){const i=Td.pop();Ss=i===void 0?!0:i}function fu(i){const{cleanup:t}=i;if(i.cleanup=void 0,t){const e=Ft;Ft=void 0;try{t()}finally{Ft=e}}}let qr=0;class Uv{constructor(t,e){this.sub=t,this.dep=e,this.version=e.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class hh{constructor(t){this.computed=t,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0}track(t){if(!Ft||!Ss||Ft===this.computed)return;let e=this.activeLink;if(e===void 0||e.sub!==Ft)e=this.activeLink=new Uv(Ft,this),Ft.deps?(e.prevDep=Ft.depsTail,Ft.depsTail.nextDep=e,Ft.depsTail=e):Ft.deps=Ft.depsTail=e,Od(e);else if(e.version===-1&&(e.version=this.version,e.nextDep)){const s=e.nextDep;s.prevDep=e.prevDep,e.prevDep&&(e.prevDep.nextDep=s),e.prevDep=Ft.depsTail,e.nextDep=void 0,Ft.depsTail.nextDep=e,Ft.depsTail=e,Ft.deps===e&&(Ft.deps=s)}return e}trigger(t){this.version++,qr++,this.notify(t)}notify(t){ah();try{for(let e=this.subs;e;e=e.prevSub)e.sub.notify()&&e.sub.dep.notify()}finally{lh()}}}function Od(i){if(i.dep.sc++,i.sub.flags&4){const t=i.dep.computed;if(t&&!i.dep.subs){t.flags|=20;for(let s=t.deps;s;s=s.nextDep)Od(s)}const e=i.dep.subs;e!==i&&(i.prevSub=e,e&&(e.nextSub=i)),i.dep.subs=i}}const cc=new WeakMap,ai=Symbol(""),hc=Symbol(""),Kr=Symbol("");function fe(i,t,e){if(Ss&&Ft){let s=cc.get(i);s||cc.set(i,s=new Map);let n=s.get(e);n||(s.set(e,n=new hh),n.map=s,n.key=e),n.track()}}function on(i,t,e,s,n,r){const o=cc.get(i);if(!o){qr++;return}const a=l=>{l&&l.trigger()};if(ah(),t==="clear")o.forEach(a);else{const l=lt(i),c=l&&oh(e);if(l&&e==="length"){const h=Number(s);o.forEach((u,f)=>{(f==="length"||f===Kr||!$s(f)&&f>=h)&&a(u)})}else switch((e!==void 0||o.has(void 0))&&a(o.get(e)),c&&a(o.get(Kr)),t){case"add":l?c&&a(o.get("length")):(a(o.get(ai)),Bi(i)&&a(o.get(hc)));break;case"delete":l||(a(o.get(ai)),Bi(i)&&a(o.get(hc)));break;case"set":Bi(i)&&a(o.get(ai));break}}lh()}function Oi(i){const t=Ct(i);return t===i?t:(fe(t,"iterate",Kr),us(i)?t:t.map(de))}function Za(i){return fe(i=Ct(i),"iterate",Kr),i}const Gv={__proto__:null,[Symbol.iterator](){return Ml(this,Symbol.iterator,de)},concat(...i){return Oi(this).concat(...i.map(t=>lt(t)?Oi(t):t))},entries(){return Ml(this,"entries",i=>(i[1]=de(i[1]),i))},every(i,t){return Js(this,"every",i,t,void 0,arguments)},filter(i,t){return Js(this,"filter",i,t,e=>e.map(de),arguments)},find(i,t){return Js(this,"find",i,t,de,arguments)},findIndex(i,t){return Js(this,"findIndex",i,t,void 0,arguments)},findLast(i,t){return Js(this,"findLast",i,t,de,arguments)},findLastIndex(i,t){return Js(this,"findLastIndex",i,t,void 0,arguments)},forEach(i,t){return Js(this,"forEach",i,t,void 0,arguments)},includes(...i){return El(this,"includes",i)},indexOf(...i){return El(this,"indexOf",i)},join(i){return Oi(this).join(i)},lastIndexOf(...i){return El(this,"lastIndexOf",i)},map(i,t){return Js(this,"map",i,t,void 0,arguments)},pop(){return _r(this,"pop")},push(...i){return _r(this,"push",i)},reduce(i,...t){return du(this,"reduce",i,t)},reduceRight(i,...t){return du(this,"reduceRight",i,t)},shift(){return _r(this,"shift")},some(i,t){return Js(this,"some",i,t,void 0,arguments)},splice(...i){return _r(this,"splice",i)},toReversed(){return Oi(this).toReversed()},toSorted(i){return Oi(this).toSorted(i)},toSpliced(...i){return Oi(this).toSpliced(...i)},unshift(...i){return _r(this,"unshift",i)},values(){return Ml(this,"values",de)}};function Ml(i,t,e){const s=Za(i),n=s[t]();return s!==i&&!us(i)&&(n._next=n.next,n.next=()=>{const r=n._next();return r.value&&(r.value=e(r.value)),r}),n}const $v=Array.prototype;function Js(i,t,e,s,n,r){const o=Za(i),a=o!==i&&!us(i),l=o[t];if(l!==$v[t]){const u=l.apply(i,r);return a?de(u):u}let c=e;o!==i&&(a?c=function(u,f){return e.call(this,de(u),f,i)}:e.length>2&&(c=function(u,f){return e.call(this,u,f,i)}));const h=l.call(o,c,s);return a&&n?n(h):h}function du(i,t,e,s){const n=Za(i);let r=e;return n!==i&&(us(i)?e.length>3&&(r=function(o,a,l){return e.call(this,o,a,l,i)}):r=function(o,a,l){return e.call(this,o,de(a),l,i)}),n[t](r,...s)}function El(i,t,e){const s=Ct(i);fe(s,"iterate",Kr);const n=s[t](...e);return(n===-1||n===!1)&&dh(e[0])?(e[0]=Ct(e[0]),s[t](...e)):n}function _r(i,t,e=[]){Vn(),ah();const s=Ct(i)[t].apply(i,e);return lh(),Wn(),s}const qv=nh("__proto__,__v_isRef,__isVue"),Md=new Set(Object.getOwnPropertyNames(Symbol).filter(i=>i!=="arguments"&&i!=="caller").map(i=>Symbol[i]).filter($s));function Kv(i){$s(i)||(i=String(i));const t=Ct(this);return fe(t,"has",i),t.hasOwnProperty(i)}class Ed{constructor(t=!1,e=!1){this._isReadonly=t,this._isShallow=e}get(t,e,s){if(e==="__v_skip")return t.__v_skip;const n=this._isReadonly,r=this._isShallow;if(e==="__v_isReactive")return!n;if(e==="__v_isReadonly")return n;if(e==="__v_isShallow")return r;if(e==="__v_raw")return s===(n?r?o_:Fd:r?Ad:Pd).get(t)||Object.getPrototypeOf(t)===Object.getPrototypeOf(s)?t:void 0;const o=lt(t);if(!n){let l;if(o&&(l=Gv[e]))return l;if(e==="hasOwnProperty")return Kv}const a=Reflect.get(t,e,ve(t)?t:s);return($s(e)?Md.has(e):qv(e))||(n||fe(t,"get",e),r)?a:ve(a)?o&&oh(e)?a:a.value:Dt(a)?n?Rd(a):Ja(a):a}}class kd extends Ed{constructor(t=!1){super(!1,t)}set(t,e,s,n){let r=t[e];if(!this._isShallow){const l=gi(r);if(!us(s)&&!gi(s)&&(r=Ct(r),s=Ct(s)),!lt(t)&&ve(r)&&!ve(s))return l?!1:(r.value=s,!0)}const o=lt(t)&&oh(e)?Number(e)<t.length:St(t,e),a=Reflect.set(t,e,s,ve(t)?t:n);return t===Ct(n)&&(o?cn(s,r)&&on(t,"set",e,s):on(t,"add",e,s)),a}deleteProperty(t,e){const s=St(t,e);t[e];const n=Reflect.deleteProperty(t,e);return n&&s&&on(t,"delete",e,void 0),n}has(t,e){const s=Reflect.has(t,e);return(!$s(e)||!Md.has(e))&&fe(t,"has",e),s}ownKeys(t){return fe(t,"iterate",lt(t)?"length":ai),Reflect.ownKeys(t)}}class Zv extends Ed{constructor(t=!1){super(!0,t)}set(t,e){return!0}deleteProperty(t,e){return!0}}const Jv=new kd,Qv=new Zv,t_=new kd(!0);const uc=i=>i,So=i=>Reflect.getPrototypeOf(i);function e_(i,t,e){return function(...s){const n=this.__v_raw,r=Ct(n),o=Bi(r),a=i==="entries"||i===Symbol.iterator&&o,l=i==="keys"&&o,c=n[i](...s),h=e?uc:t?fc:de;return!t&&fe(r,"iterate",l?hc:ai),{next(){const{value:u,done:f}=c.next();return f?{value:u,done:f}:{value:a?[h(u[0]),h(u[1])]:h(u),done:f}},[Symbol.iterator](){return this}}}}function wo(i){return function(...t){return i==="delete"?!1:i==="clear"?void 0:this}}function s_(i,t){const e={get(n){const r=this.__v_raw,o=Ct(r),a=Ct(n);i||(cn(n,a)&&fe(o,"get",n),fe(o,"get",a));const{has:l}=So(o),c=t?uc:i?fc:de;if(l.call(o,n))return c(r.get(n));if(l.call(o,a))return c(r.get(a));r!==o&&r.get(n)},get size(){const n=this.__v_raw;return!i&&fe(Ct(n),"iterate",ai),Reflect.get(n,"size",n)},has(n){const r=this.__v_raw,o=Ct(r),a=Ct(n);return i||(cn(n,a)&&fe(o,"has",n),fe(o,"has",a)),n===a?r.has(n):r.has(n)||r.has(a)},forEach(n,r){const o=this,a=o.__v_raw,l=Ct(a),c=t?uc:i?fc:de;return!i&&fe(l,"iterate",ai),a.forEach((h,u)=>n.call(r,c(h),c(u),o))}};return ye(e,i?{add:wo("add"),set:wo("set"),delete:wo("delete"),clear:wo("clear")}:{add(n){!t&&!us(n)&&!gi(n)&&(n=Ct(n));const r=Ct(this);return So(r).has.call(r,n)||(r.add(n),on(r,"add",n,n)),this},set(n,r){!t&&!us(r)&&!gi(r)&&(r=Ct(r));const o=Ct(this),{has:a,get:l}=So(o);let c=a.call(o,n);c||(n=Ct(n),c=a.call(o,n));const h=l.call(o,n);return o.set(n,r),c?cn(r,h)&&on(o,"set",n,r):on(o,"add",n,r),this},delete(n){const r=Ct(this),{has:o,get:a}=So(r);let l=o.call(r,n);l||(n=Ct(n),l=o.call(r,n)),a&&a.call(r,n);const c=r.delete(n);return l&&on(r,"delete",n,void 0),c},clear(){const n=Ct(this),r=n.size!==0,o=n.clear();return r&&on(n,"clear",void 0,void 0),o}}),["keys","values","entries",Symbol.iterator].forEach(n=>{e[n]=e_(n,i,t)}),e}function uh(i,t){const e=s_(i,t);return(s,n,r)=>n==="__v_isReactive"?!i:n==="__v_isReadonly"?i:n==="__v_raw"?s:Reflect.get(St(e,n)&&n in s?e:s,n,r)}const n_={get:uh(!1,!1)},i_={get:uh(!1,!0)},r_={get:uh(!0,!1)};const Pd=new WeakMap,Ad=new WeakMap,Fd=new WeakMap,o_=new WeakMap;function a_(i){switch(i){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function l_(i){return i.__v_skip||!Object.isExtensible(i)?0:a_(Fv(i))}function Ja(i){return gi(i)?i:fh(i,!1,Jv,n_,Pd)}function Dd(i){return fh(i,!1,t_,i_,Ad)}function Rd(i){return fh(i,!0,Qv,r_,Fd)}function fh(i,t,e,s,n){if(!Dt(i)||i.__v_raw&&!(t&&i.__v_isReactive))return i;const r=n.get(i);if(r)return r;const o=l_(i);if(o===0)return i;const a=new Proxy(i,o===2?s:e);return n.set(i,a),a}function Ni(i){return gi(i)?Ni(i.__v_raw):!!(i&&i.__v_isReactive)}function gi(i){return!!(i&&i.__v_isReadonly)}function us(i){return!!(i&&i.__v_isShallow)}function dh(i){return i?!!i.__v_raw:!1}function Ct(i){const t=i&&i.__v_raw;return t?Ct(t):i}function Ld(i){return!St(i,"__v_skip")&&Object.isExtensible(i)&&pd(i,"__v_skip",!0),i}const de=i=>Dt(i)?Ja(i):i,fc=i=>Dt(i)?Rd(i):i;function ve(i){return i?i.__v_isRef===!0:!1}function nt(i){return jd(i,!1)}function gh(i){return jd(i,!0)}function jd(i,t){return ve(i)?i:new c_(i,t)}class c_{constructor(t,e){this.dep=new hh,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=e?t:Ct(t),this._value=e?t:de(t),this.__v_isShallow=e}get value(){return this.dep.track(),this._value}set value(t){const e=this._rawValue,s=this.__v_isShallow||us(t)||gi(t);t=s?t:Ct(t),cn(t,e)&&(this._rawValue=t,this._value=s?t:de(t),this.dep.trigger())}}function Je(i){return ve(i)?i.value:i}const h_={get:(i,t,e)=>t==="__v_raw"?i:Je(Reflect.get(i,t,e)),set:(i,t,e,s)=>{const n=i[t];return ve(n)&&!ve(e)?(n.value=e,!0):Reflect.set(i,t,e,s)}};function Id(i){return Ni(i)?i:new Proxy(i,h_)}class u_{constructor(t,e,s){this.fn=t,this.setter=e,this._value=void 0,this.dep=new hh(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=qr-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!e,this.isSSR=s}notify(){if(this.flags|=16,!(this.flags&8)&&Ft!==this)return xd(this,!0),!0}get value(){const t=this.dep.track();return wd(this),t&&(t.version=this.dep.version),this._value}set value(t){this.setter&&this.setter(t)}}function f_(i,t,e=!1){let s,n;return ft(i)?s=i:(s=i.get,n=i.set),new u_(s,n,e)}const To={},ha=new WeakMap;let Jn;function d_(i,t=!1,e=Jn){if(e){let s=ha.get(e);s||ha.set(e,s=[]),s.push(i)}}function g_(i,t,e=kt){const{immediate:s,deep:n,once:r,scheduler:o,augmentJob:a,call:l}=e,c=b=>n?b:us(b)||n===!1||n===0?an(b,1):an(b);let h,u,f,d,p=!1,g=!1;if(ve(i)?(u=()=>i.value,p=us(i)):Ni(i)?(u=()=>c(i),p=!0):lt(i)?(g=!0,p=i.some(b=>Ni(b)||us(b)),u=()=>i.map(b=>{if(ve(b))return b.value;if(Ni(b))return c(b);if(ft(b))return l?l(b,2):b()})):ft(i)?t?u=l?()=>l(i,2):i:u=()=>{if(f){Vn();try{f()}finally{Wn()}}const b=Jn;Jn=h;try{return l?l(i,3,[d]):i(d)}finally{Jn=b}}:u=xs,t&&n){const b=u,S=n===!0?1/0:n;u=()=>an(b(),S)}const m=Yv(),v=()=>{h.stop(),m&&m.active&&rh(m.effects,h)};if(r&&t){const b=t;t=(...S)=>{b(...S),v()}}let _=g?new Array(i.length).fill(To):To;const y=b=>{if(!(!(h.flags&1)||!h.dirty&&!b))if(t){const S=h.run();if(n||p||(g?S.some((P,O)=>cn(P,_[O])):cn(S,_))){f&&f();const P=Jn;Jn=h;try{const O=[S,_===To?void 0:g&&_[0]===To?[]:_,d];l?l(t,3,O):t(...O),_=S}finally{Jn=P}}}else h.run()};return a&&a(y),h=new yd(u),h.scheduler=o?()=>o(y,!1):y,d=b=>d_(b,!1,h),f=h.onStop=()=>{const b=ha.get(h);if(b){if(l)l(b,4);else for(const S of b)S();ha.delete(h)}},t?s?y(!0):_=h.run():o?o(y.bind(null,!0),!0):h.run(),v.pause=h.pause.bind(h),v.resume=h.resume.bind(h),v.stop=v,v}function an(i,t=1/0,e){if(t<=0||!Dt(i)||i.__v_skip||(e=e||new Set,e.has(i)))return i;if(e.add(i),t--,ve(i))an(i.value,t,e);else if(lt(i))for(let s=0;s<i.length;s++)an(i[s],t,e);else if(Ua(i)||Bi(i))i.forEach(s=>{an(s,t,e)});else if(gd(i)){for(const s in i)an(i[s],t,e);for(const s of Object.getOwnPropertySymbols(i))Object.prototype.propertyIsEnumerable.call(i,s)&&an(i[s],t,e)}return i}/**
* @vue/runtime-core v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function mo(i,t,e,s){try{return s?i(...s):i()}catch(n){Qa(n,t,e)}}function qs(i,t,e,s){if(ft(i)){const n=mo(i,t,e,s);return n&&fd(n)&&n.catch(r=>{Qa(r,t,e)}),n}if(lt(i)){const n=[];for(let r=0;r<i.length;r++)n.push(qs(i[r],t,e,s));return n}}function Qa(i,t,e,s=!0){const n=t?t.vnode:null,{errorHandler:r,throwUnhandledErrorInProduction:o}=t&&t.appContext.config||kt;if(t){let a=t.parent;const l=t.proxy,c=`https://vuejs.org/error-reference/#runtime-${e}`;for(;a;){const h=a.ec;if(h){for(let u=0;u<h.length;u++)if(h[u](i,l,c)===!1)return}a=a.parent}if(r){Vn(),mo(r,null,10,[i,l,c]),Wn();return}}p_(i,e,n,s,o)}function p_(i,t,e,s=!0,n=!1){if(n)throw i;console.error(i)}const we=[];let Ds=-1;const Hi=[];let Cn=null,Pi=0;const Bd=Promise.resolve();let ua=null;function pi(i){const t=ua||Bd;return i?t.then(this?i.bind(this):i):t}function m_(i){let t=Ds+1,e=we.length;for(;t<e;){const s=t+e>>>1,n=we[s],r=Zr(n);r<i||r===i&&n.flags&2?t=s+1:e=s}return t}function ph(i){if(!(i.flags&1)){const t=Zr(i),e=we[we.length-1];!e||!(i.flags&2)&&t>=Zr(e)?we.push(i):we.splice(m_(t),0,i),i.flags|=1,Nd()}}function Nd(){ua||(ua=Bd.then(Vd))}function Hd(i){lt(i)?Hi.push(...i):Cn&&i.id===-1?Cn.splice(Pi+1,0,i):i.flags&1||(Hi.push(i),i.flags|=1),Nd()}function gu(i,t,e=Ds+1){for(;e<we.length;e++){const s=we[e];if(s&&s.flags&2){if(i&&s.id!==i.uid)continue;we.splice(e,1),e--,s.flags&4&&(s.flags&=-2),s(),s.flags&4||(s.flags&=-2)}}}function zd(i){if(Hi.length){const t=[...new Set(Hi)].sort((e,s)=>Zr(e)-Zr(s));if(Hi.length=0,Cn){Cn.push(...t);return}for(Cn=t,Pi=0;Pi<Cn.length;Pi++){const e=Cn[Pi];e.flags&4&&(e.flags&=-2),e.flags&8||e(),e.flags&=-2}Cn=null,Pi=0}}const Zr=i=>i.id==null?i.flags&2?-1:1/0:i.id;function Vd(i){try{for(Ds=0;Ds<we.length;Ds++){const t=we[Ds];t&&!(t.flags&8)&&(t.flags&4&&(t.flags&=-2),mo(t,t.i,t.i?15:14),t.flags&4||(t.flags&=-2))}}finally{for(;Ds<we.length;Ds++){const t=we[Ds];t&&(t.flags&=-2)}Ds=-1,we.length=0,zd(),ua=null,(we.length||Hi.length)&&Vd()}}let Fe=null,Wd=null;function fa(i){const t=Fe;return Fe=i,Wd=i&&i.type.__scopeId||null,t}function mh(i,t=Fe,e){if(!t||i._n)return i;const s=(...n)=>{s._d&&wu(-1);const r=fa(t);let o;try{o=i(...n)}finally{fa(r),s._d&&wu(1)}return o};return s._n=!0,s._c=!0,s._d=!0,s}function mi(i,t){if(Fe===null)return i;const e=nl(Fe),s=i.dirs||(i.dirs=[]);for(let n=0;n<t.length;n++){let[r,o,a,l=kt]=t[n];r&&(ft(r)&&(r={mounted:r,updated:r}),r.deep&&an(o),s.push({dir:r,instance:e,value:o,oldValue:void 0,arg:a,modifiers:l}))}return i}function $n(i,t,e,s){const n=i.dirs,r=t&&t.dirs;for(let o=0;o<n.length;o++){const a=n[o];r&&(a.oldValue=r[o].value);let l=a.dir[s];l&&(Vn(),qs(l,e,8,[i.el,a,i,t]),Wn())}}const v_=Symbol("_vte"),__=i=>i.__isTeleport;function vh(i,t){i.shapeFlag&6&&i.component?(i.transition=t,vh(i.component.subTree,t)):i.shapeFlag&128?(i.ssContent.transition=t.clone(i.ssContent),i.ssFallback.transition=t.clone(i.ssFallback)):i.transition=t}/*! #__NO_SIDE_EFFECTS__ */function ze(i,t){return ft(i)?ye({name:i.name},t,{setup:i}):i}function Yd(i){i.ids=[i.ids[0]+i.ids[2]+++"-",0,0]}function da(i,t,e,s,n=!1){if(lt(i)){i.forEach((p,g)=>da(p,t&&(lt(t)?t[g]:t),e,s,n));return}if(Dr(s)&&!n){s.shapeFlag&512&&s.type.__asyncResolved&&s.component.subTree.component&&da(i,t,e,s.component.subTree);return}const r=s.shapeFlag&4?nl(s.component):s.el,o=n?null:r,{i:a,r:l}=i,c=t&&t.r,h=a.refs===kt?a.refs={}:a.refs,u=a.setupState,f=Ct(u),d=u===kt?()=>!1:p=>St(f,p);if(c!=null&&c!==l&&(qt(c)?(h[c]=null,d(c)&&(u[c]=null)):ve(c)&&(c.value=null)),ft(l))mo(l,a,12,[o,h]);else{const p=qt(l),g=ve(l);if(p||g){const m=()=>{if(i.f){const v=p?d(l)?u[l]:h[l]:l.value;n?lt(v)&&rh(v,r):lt(v)?v.includes(r)||v.push(r):p?(h[l]=[r],d(l)&&(u[l]=h[l])):(l.value=[r],i.k&&(h[i.k]=l.value))}else p?(h[l]=o,d(l)&&(u[l]=o)):g&&(l.value=o,i.k&&(h[i.k]=o))};o?(m.id=-1,Xe(m,e)):m()}}}qa().requestIdleCallback;qa().cancelIdleCallback;const Dr=i=>!!i.type.__asyncLoader,Xd=i=>i.type.__isKeepAlive;function y_(i,t){Ud(i,"a",t)}function b_(i,t){Ud(i,"da",t)}function Ud(i,t,e=oe){const s=i.__wdc||(i.__wdc=()=>{let n=e;for(;n;){if(n.isDeactivated)return;n=n.parent}return i()});if(tl(t,s,e),e){let n=e.parent;for(;n&&n.parent;)Xd(n.parent.vnode)&&x_(s,t,e,n),n=n.parent}}function x_(i,t,e,s){const n=tl(t,i,s,!0);mn(()=>{rh(s[t],n)},e)}function tl(i,t,e=oe,s=!1){if(e){const n=e[i]||(e[i]=[]),r=t.__weh||(t.__weh=(...o)=>{Vn();const a=vo(e),l=qs(t,e,i,o);return a(),Wn(),l});return s?n.unshift(r):n.push(r),r}}const pn=i=>(t,e=oe)=>{(!Jr||i==="sp")&&tl(i,(...s)=>t(...s),e)},C_=pn("bm"),ts=pn("m"),Gd=pn("bu"),S_=pn("u"),w_=pn("bum"),mn=pn("um"),T_=pn("sp"),O_=pn("rtg"),M_=pn("rtc");function E_(i,t=oe){tl("ec",i,t)}const $d="components";function qd(i,t){return Jd($d,i,!0,t)||i}const Kd=Symbol.for("v-ndc");function Zd(i){return qt(i)?Jd($d,i,!1)||i:i||Kd}function Jd(i,t,e=!0,s=!1){const n=Fe||oe;if(n){const r=n.type;{const a=p0(r,!1);if(a&&(a===t||a===ps(t)||a===$a(ps(t))))return r}const o=pu(n[i]||r[i],t)||pu(n.appContext[i],t);return!o&&s?r:o}}function pu(i,t){return i&&(i[t]||i[ps(t)]||i[$a(ps(t))])}function fs(i,t,e,s){let n;const r=e&&e[s],o=lt(i);if(o||qt(i)){const a=o&&Ni(i);let l=!1;a&&(l=!us(i),i=Za(i)),n=new Array(i.length);for(let c=0,h=i.length;c<h;c++)n[c]=t(l?de(i[c]):i[c],c,void 0,r&&r[c])}else if(typeof i=="number"){n=new Array(i);for(let a=0;a<i;a++)n[a]=t(a+1,a,void 0,r&&r[a])}else if(Dt(i))if(i[Symbol.iterator])n=Array.from(i,(a,l)=>t(a,l,void 0,r&&r[l]));else{const a=Object.keys(i);n=new Array(a.length);for(let l=0,c=a.length;l<c;l++){const h=a[l];n[l]=t(i[h],h,l,r&&r[l])}}else n=[];return e&&(e[s]=n),n}const dc=i=>i?yg(i)?nl(i):dc(i.parent):null,Rr=ye(Object.create(null),{$:i=>i,$el:i=>i.vnode.el,$data:i=>i.data,$props:i=>i.props,$attrs:i=>i.attrs,$slots:i=>i.slots,$refs:i=>i.refs,$parent:i=>dc(i.parent),$root:i=>dc(i.root),$host:i=>i.ce,$emit:i=>i.emit,$options:i=>tg(i),$forceUpdate:i=>i.f||(i.f=()=>{ph(i.update)}),$nextTick:i=>i.n||(i.n=pi.bind(i.proxy)),$watch:i=>q_.bind(i)}),kl=(i,t)=>i!==kt&&!i.__isScriptSetup&&St(i,t),k_={get({_:i},t){if(t==="__v_skip")return!0;const{ctx:e,setupState:s,data:n,props:r,accessCache:o,type:a,appContext:l}=i;let c;if(t[0]!=="$"){const d=o[t];if(d!==void 0)switch(d){case 1:return s[t];case 2:return n[t];case 4:return e[t];case 3:return r[t]}else{if(kl(s,t))return o[t]=1,s[t];if(n!==kt&&St(n,t))return o[t]=2,n[t];if((c=i.propsOptions[0])&&St(c,t))return o[t]=3,r[t];if(e!==kt&&St(e,t))return o[t]=4,e[t];gc&&(o[t]=0)}}const h=Rr[t];let u,f;if(h)return t==="$attrs"&&fe(i.attrs,"get",""),h(i);if((u=a.__cssModules)&&(u=u[t]))return u;if(e!==kt&&St(e,t))return o[t]=4,e[t];if(f=l.config.globalProperties,St(f,t))return f[t]},set({_:i},t,e){const{data:s,setupState:n,ctx:r}=i;return kl(n,t)?(n[t]=e,!0):s!==kt&&St(s,t)?(s[t]=e,!0):St(i.props,t)||t[0]==="$"&&t.slice(1)in i?!1:(r[t]=e,!0)},has({_:{data:i,setupState:t,accessCache:e,ctx:s,appContext:n,propsOptions:r}},o){let a;return!!e[o]||i!==kt&&St(i,o)||kl(t,o)||(a=r[0])&&St(a,o)||St(s,o)||St(Rr,o)||St(n.config.globalProperties,o)},defineProperty(i,t,e){return e.get!=null?i._.accessCache[t]=0:St(e,"value")&&this.set(i,t,e.value,null),Reflect.defineProperty(i,t,e)}};function mu(i){return lt(i)?i.reduce((t,e)=>(t[e]=null,t),{}):i}let gc=!0;function P_(i){const t=tg(i),e=i.proxy,s=i.ctx;gc=!1,t.beforeCreate&&vu(t.beforeCreate,i,"bc");const{data:n,computed:r,methods:o,watch:a,provide:l,inject:c,created:h,beforeMount:u,mounted:f,beforeUpdate:d,updated:p,activated:g,deactivated:m,beforeDestroy:v,beforeUnmount:_,destroyed:y,unmounted:b,render:S,renderTracked:P,renderTriggered:O,errorCaptured:k,serverPrefetch:D,expose:z,inheritAttrs:K,components:st,directives:G,filters:it}=t;if(c&&A_(c,s,null),o)for(const Z in o){const Y=o[Z];ft(Y)&&(s[Z]=Y.bind(e))}if(n){const Z=n.call(e,e);Dt(Z)&&(i.data=Ja(Z))}if(gc=!0,r)for(const Z in r){const Y=r[Z],pt=ft(Y)?Y.bind(e,e):ft(Y.get)?Y.get.bind(e,e):xs,Tt=!ft(Y)&&ft(Y.set)?Y.set.bind(e):xs,Pt=te({get:pt,set:Tt});Object.defineProperty(s,Z,{enumerable:!0,configurable:!0,get:()=>Pt.value,set:B=>Pt.value=B})}if(a)for(const Z in a)Qd(a[Z],s,e,Z);if(l){const Z=ft(l)?l.call(e):l;Reflect.ownKeys(Z).forEach(Y=>{Qo(Y,Z[Y])})}h&&vu(h,i,"c");function et(Z,Y){lt(Y)?Y.forEach(pt=>Z(pt.bind(e))):Y&&Z(Y.bind(e))}if(et(C_,u),et(ts,f),et(Gd,d),et(S_,p),et(y_,g),et(b_,m),et(E_,k),et(M_,P),et(O_,O),et(w_,_),et(mn,b),et(T_,D),lt(z))if(z.length){const Z=i.exposed||(i.exposed={});z.forEach(Y=>{Object.defineProperty(Z,Y,{get:()=>e[Y],set:pt=>e[Y]=pt})})}else i.exposed||(i.exposed={});S&&i.render===xs&&(i.render=S),K!=null&&(i.inheritAttrs=K),st&&(i.components=st),G&&(i.directives=G),D&&Yd(i)}function A_(i,t,e=xs){lt(i)&&(i=pc(i));for(const s in i){const n=i[s];let r;Dt(n)?"default"in n?r=Ws(n.from||s,n.default,!0):r=Ws(n.from||s):r=Ws(n),ve(r)?Object.defineProperty(t,s,{enumerable:!0,configurable:!0,get:()=>r.value,set:o=>r.value=o}):t[s]=r}}function vu(i,t,e){qs(lt(i)?i.map(s=>s.bind(t.proxy)):i.bind(t.proxy),t,e)}function Qd(i,t,e,s){let n=s.includes(".")?gg(e,s):()=>e[s];if(qt(i)){const r=t[i];ft(r)&&ds(n,r)}else if(ft(i))ds(n,i.bind(e));else if(Dt(i))if(lt(i))i.forEach(r=>Qd(r,t,e,s));else{const r=ft(i.handler)?i.handler.bind(e):t[i.handler];ft(r)&&ds(n,r,i)}}function tg(i){const t=i.type,{mixins:e,extends:s}=t,{mixins:n,optionsCache:r,config:{optionMergeStrategies:o}}=i.appContext,a=r.get(t);let l;return a?l=a:!n.length&&!e&&!s?l=t:(l={},n.length&&n.forEach(c=>ga(l,c,o,!0)),ga(l,t,o)),Dt(t)&&r.set(t,l),l}function ga(i,t,e,s=!1){const{mixins:n,extends:r}=t;r&&ga(i,r,e,!0),n&&n.forEach(o=>ga(i,o,e,!0));for(const o in t)if(!(s&&o==="expose")){const a=F_[o]||e&&e[o];i[o]=a?a(i[o],t[o]):t[o]}return i}const F_={data:_u,props:yu,emits:yu,methods:wr,computed:wr,beforeCreate:be,created:be,beforeMount:be,mounted:be,beforeUpdate:be,updated:be,beforeDestroy:be,beforeUnmount:be,destroyed:be,unmounted:be,activated:be,deactivated:be,errorCaptured:be,serverPrefetch:be,components:wr,directives:wr,watch:R_,provide:_u,inject:D_};function _u(i,t){return t?i?function(){return ye(ft(i)?i.call(this,this):i,ft(t)?t.call(this,this):t)}:t:i}function D_(i,t){return wr(pc(i),pc(t))}function pc(i){if(lt(i)){const t={};for(let e=0;e<i.length;e++)t[i[e]]=i[e];return t}return i}function be(i,t){return i?[...new Set([].concat(i,t))]:t}function wr(i,t){return i?ye(Object.create(null),i,t):t}function yu(i,t){return i?lt(i)&&lt(t)?[...new Set([...i,...t])]:ye(Object.create(null),mu(i),mu(t??{})):t}function R_(i,t){if(!i)return t;if(!t)return i;const e=ye(Object.create(null),i);for(const s in t)e[s]=be(i[s],t[s]);return e}function eg(){return{app:null,config:{isNativeTag:Pv,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let L_=0;function j_(i,t){return function(s,n=null){ft(s)||(s=ye({},s)),n!=null&&!Dt(n)&&(n=null);const r=eg(),o=new WeakSet,a=[];let l=!1;const c=r.app={_uid:L_++,_component:s,_props:n,_container:null,_context:r,_instance:null,version:_0,get config(){return r.config},set config(h){},use(h,...u){return o.has(h)||(h&&ft(h.install)?(o.add(h),h.install(c,...u)):ft(h)&&(o.add(h),h(c,...u))),c},mixin(h){return r.mixins.includes(h)||r.mixins.push(h),c},component(h,u){return u?(r.components[h]=u,c):r.components[h]},directive(h,u){return u?(r.directives[h]=u,c):r.directives[h]},mount(h,u,f){if(!l){const d=c._ceVNode||ae(s,n);return d.appContext=r,f===!0?f="svg":f===!1&&(f=void 0),i(d,h,f),l=!0,c._container=h,h.__vue_app__=c,nl(d.component)}},onUnmount(h){a.push(h)},unmount(){l&&(qs(a,c._instance,16),i(null,c._container),delete c._container.__vue_app__)},provide(h,u){return r.provides[h]=u,c},runWithContext(h){const u=zi;zi=c;try{return h()}finally{zi=u}}};return c}}let zi=null;function Qo(i,t){if(oe){let e=oe.provides;const s=oe.parent&&oe.parent.provides;s===e&&(e=oe.provides=Object.create(s)),e[i]=t}}function Ws(i,t,e=!1){const s=oe||Fe;if(s||zi){const n=zi?zi._context.provides:s?s.parent==null?s.vnode.appContext&&s.vnode.appContext.provides:s.parent.provides:void 0;if(n&&i in n)return n[i];if(arguments.length>1)return e&&ft(t)?t.call(s&&s.proxy):t}}const sg={},ng=()=>Object.create(sg),ig=i=>Object.getPrototypeOf(i)===sg;function I_(i,t,e,s=!1){const n={},r=ng();i.propsDefaults=Object.create(null),rg(i,t,n,r);for(const o in i.propsOptions[0])o in n||(n[o]=void 0);e?i.props=s?n:Dd(n):i.type.props?i.props=n:i.props=r,i.attrs=r}function B_(i,t,e,s){const{props:n,attrs:r,vnode:{patchFlag:o}}=i,a=Ct(n),[l]=i.propsOptions;let c=!1;if((s||o>0)&&!(o&16)){if(o&8){const h=i.vnode.dynamicProps;for(let u=0;u<h.length;u++){let f=h[u];if(el(i.emitsOptions,f))continue;const d=t[f];if(l)if(St(r,f))d!==r[f]&&(r[f]=d,c=!0);else{const p=ps(f);n[p]=mc(l,a,p,d,i,!1)}else d!==r[f]&&(r[f]=d,c=!0)}}}else{rg(i,t,n,r)&&(c=!0);let h;for(const u in a)(!t||!St(t,u)&&((h=xi(u))===u||!St(t,h)))&&(l?e&&(e[u]!==void 0||e[h]!==void 0)&&(n[u]=mc(l,a,u,void 0,i,!0)):delete n[u]);if(r!==a)for(const u in r)(!t||!St(t,u))&&(delete r[u],c=!0)}c&&on(i.attrs,"set","")}function rg(i,t,e,s){const[n,r]=i.propsOptions;let o=!1,a;if(t)for(let l in t){if(Pr(l))continue;const c=t[l];let h;n&&St(n,h=ps(l))?!r||!r.includes(h)?e[h]=c:(a||(a={}))[h]=c:el(i.emitsOptions,l)||(!(l in s)||c!==s[l])&&(s[l]=c,o=!0)}if(r){const l=Ct(e),c=a||kt;for(let h=0;h<r.length;h++){const u=r[h];e[u]=mc(n,l,u,c[u],i,!St(c,u))}}return o}function mc(i,t,e,s,n,r){const o=i[e];if(o!=null){const a=St(o,"default");if(a&&s===void 0){const l=o.default;if(o.type!==Function&&!o.skipFactory&&ft(l)){const{propsDefaults:c}=n;if(e in c)s=c[e];else{const h=vo(n);s=c[e]=l.call(null,t),h()}}else s=l;n.ce&&n.ce._setProp(e,s)}o[0]&&(r&&!a?s=!1:o[1]&&(s===""||s===xi(e))&&(s=!0))}return s}const N_=new WeakMap;function og(i,t,e=!1){const s=e?N_:t.propsCache,n=s.get(i);if(n)return n;const r=i.props,o={},a=[];let l=!1;if(!ft(i)){const h=u=>{l=!0;const[f,d]=og(u,t,!0);ye(o,f),d&&a.push(...d)};!e&&t.mixins.length&&t.mixins.forEach(h),i.extends&&h(i.extends),i.mixins&&i.mixins.forEach(h)}if(!r&&!l)return Dt(i)&&s.set(i,Ii),Ii;if(lt(r))for(let h=0;h<r.length;h++){const u=ps(r[h]);bu(u)&&(o[u]=kt)}else if(r)for(const h in r){const u=ps(h);if(bu(u)){const f=r[h],d=o[u]=lt(f)||ft(f)?{type:f}:ye({},f),p=d.type;let g=!1,m=!0;if(lt(p))for(let v=0;v<p.length;++v){const _=p[v],y=ft(_)&&_.name;if(y==="Boolean"){g=!0;break}else y==="String"&&(m=!1)}else g=ft(p)&&p.name==="Boolean";d[0]=g,d[1]=m,(g||St(d,"default"))&&a.push(u)}}const c=[o,a];return Dt(i)&&s.set(i,c),c}function bu(i){return i[0]!=="$"&&!Pr(i)}const ag=i=>i[0]==="_"||i==="$stable",_h=i=>lt(i)?i.map(Ls):[Ls(i)],H_=(i,t,e)=>{if(t._n)return t;const s=mh((...n)=>_h(t(...n)),e);return s._c=!1,s},lg=(i,t,e)=>{const s=i._ctx;for(const n in i){if(ag(n))continue;const r=i[n];if(ft(r))t[n]=H_(n,r,s);else if(r!=null){const o=_h(r);t[n]=()=>o}}},cg=(i,t)=>{const e=_h(t);i.slots.default=()=>e},hg=(i,t,e)=>{for(const s in t)(e||s!=="_")&&(i[s]=t[s])},z_=(i,t,e)=>{const s=i.slots=ng();if(i.vnode.shapeFlag&32){const n=t._;n?(hg(s,t,e),e&&pd(s,"_",n,!0)):lg(t,s)}else t&&cg(i,t)},V_=(i,t,e)=>{const{vnode:s,slots:n}=i;let r=!0,o=kt;if(s.shapeFlag&32){const a=t._;a?e&&a===1?r=!1:hg(n,t,e):(r=!t.$stable,lg(t,n)),o=t}else t&&(cg(i,t),o={default:1});if(r)for(const a in n)!ag(a)&&o[a]==null&&delete n[a]},Xe=s0;function W_(i){return Y_(i)}function Y_(i,t){const e=qa();e.__VUE__=!0;const{insert:s,remove:n,patchProp:r,createElement:o,createText:a,createComment:l,setText:c,setElementText:h,parentNode:u,nextSibling:f,setScopeId:d=xs,insertStaticContent:p}=i,g=(x,C,M,L=null,I=null,j=null,$=void 0,U=null,W=!!C.dynamicChildren)=>{if(x===C)return;x&&!yr(x,C)&&(L=R(x),B(x,I,j,!0),x=null),C.patchFlag===-2&&(W=!1,C.dynamicChildren=null);const{type:H,ref:at,shapeFlag:tt}=C;switch(H){case sl:m(x,C,M,L);break;case vi:v(x,C,M,L);break;case ta:x==null&&_(C,M,L,$);break;case Wt:st(x,C,M,L,I,j,$,U,W);break;default:tt&1?S(x,C,M,L,I,j,$,U,W):tt&6?G(x,C,M,L,I,j,$,U,W):(tt&64||tt&128)&&H.process(x,C,M,L,I,j,$,U,W,Q)}at!=null&&I&&da(at,x&&x.ref,j,C||x,!C)},m=(x,C,M,L)=>{if(x==null)s(C.el=a(C.children),M,L);else{const I=C.el=x.el;C.children!==x.children&&c(I,C.children)}},v=(x,C,M,L)=>{x==null?s(C.el=l(C.children||""),M,L):C.el=x.el},_=(x,C,M,L)=>{[x.el,x.anchor]=p(x.children,C,M,L,x.el,x.anchor)},y=({el:x,anchor:C},M,L)=>{let I;for(;x&&x!==C;)I=f(x),s(x,M,L),x=I;s(C,M,L)},b=({el:x,anchor:C})=>{let M;for(;x&&x!==C;)M=f(x),n(x),x=M;n(C)},S=(x,C,M,L,I,j,$,U,W)=>{C.type==="svg"?$="svg":C.type==="math"&&($="mathml"),x==null?P(C,M,L,I,j,$,U,W):D(x,C,I,j,$,U,W)},P=(x,C,M,L,I,j,$,U)=>{let W,H;const{props:at,shapeFlag:tt,transition:rt,dirs:ht}=x;if(W=x.el=o(x.type,j,at&&at.is,at),tt&8?h(W,x.children):tt&16&&k(x.children,W,null,L,I,Pl(x,j),$,U),ht&&$n(x,null,L,"created"),O(W,x,x.scopeId,$,L),at){for(const At in at)At!=="value"&&!Pr(At)&&r(W,At,null,at[At],j,L);"value"in at&&r(W,"value",null,at.value,j),(H=at.onVnodeBeforeMount)&&Fs(H,L,x)}ht&&$n(x,null,L,"beforeMount");const vt=X_(I,rt);vt&&rt.beforeEnter(W),s(W,C,M),((H=at&&at.onVnodeMounted)||vt||ht)&&Xe(()=>{H&&Fs(H,L,x),vt&&rt.enter(W),ht&&$n(x,null,L,"mounted")},I)},O=(x,C,M,L,I)=>{if(M&&d(x,M),L)for(let j=0;j<L.length;j++)d(x,L[j]);if(I){let j=I.subTree;if(C===j||mg(j.type)&&(j.ssContent===C||j.ssFallback===C)){const $=I.vnode;O(x,$,$.scopeId,$.slotScopeIds,I.parent)}}},k=(x,C,M,L,I,j,$,U,W=0)=>{for(let H=W;H<x.length;H++){const at=x[H]=U?Sn(x[H]):Ls(x[H]);g(null,at,C,M,L,I,j,$,U)}},D=(x,C,M,L,I,j,$)=>{const U=C.el=x.el;let{patchFlag:W,dynamicChildren:H,dirs:at}=C;W|=x.patchFlag&16;const tt=x.props||kt,rt=C.props||kt;let ht;if(M&&qn(M,!1),(ht=rt.onVnodeBeforeUpdate)&&Fs(ht,M,C,x),at&&$n(C,x,M,"beforeUpdate"),M&&qn(M,!0),(tt.innerHTML&&rt.innerHTML==null||tt.textContent&&rt.textContent==null)&&h(U,""),H?z(x.dynamicChildren,H,U,M,L,Pl(C,I),j):$||Y(x,C,U,null,M,L,Pl(C,I),j,!1),W>0){if(W&16)K(U,tt,rt,M,I);else if(W&2&&tt.class!==rt.class&&r(U,"class",null,rt.class,I),W&4&&r(U,"style",tt.style,rt.style,I),W&8){const vt=C.dynamicProps;for(let At=0;At<vt.length;At++){const Ot=vt[At],Ve=tt[Ot],Ae=rt[Ot];(Ae!==Ve||Ot==="value")&&r(U,Ot,Ve,Ae,I,M)}}W&1&&x.children!==C.children&&h(U,C.children)}else!$&&H==null&&K(U,tt,rt,M,I);((ht=rt.onVnodeUpdated)||at)&&Xe(()=>{ht&&Fs(ht,M,C,x),at&&$n(C,x,M,"updated")},L)},z=(x,C,M,L,I,j,$)=>{for(let U=0;U<C.length;U++){const W=x[U],H=C[U],at=W.el&&(W.type===Wt||!yr(W,H)||W.shapeFlag&70)?u(W.el):M;g(W,H,at,null,L,I,j,$,!0)}},K=(x,C,M,L,I)=>{if(C!==M){if(C!==kt)for(const j in C)!Pr(j)&&!(j in M)&&r(x,j,C[j],null,I,L);for(const j in M){if(Pr(j))continue;const $=M[j],U=C[j];$!==U&&j!=="value"&&r(x,j,U,$,I,L)}"value"in M&&r(x,"value",C.value,M.value,I)}},st=(x,C,M,L,I,j,$,U,W)=>{const H=C.el=x?x.el:a(""),at=C.anchor=x?x.anchor:a("");let{patchFlag:tt,dynamicChildren:rt,slotScopeIds:ht}=C;ht&&(U=U?U.concat(ht):ht),x==null?(s(H,M,L),s(at,M,L),k(C.children||[],M,at,I,j,$,U,W)):tt>0&&tt&64&&rt&&x.dynamicChildren?(z(x.dynamicChildren,rt,M,I,j,$,U),(C.key!=null||I&&C===I.subTree)&&ug(x,C,!0)):Y(x,C,M,at,I,j,$,U,W)},G=(x,C,M,L,I,j,$,U,W)=>{C.slotScopeIds=U,x==null?C.shapeFlag&512?I.ctx.activate(C,M,L,$,W):it(C,M,L,I,j,$,W):ct(x,C,W)},it=(x,C,M,L,I,j,$)=>{const U=x.component=c0(x,L,I);if(Xd(x)&&(U.ctx.renderer=Q),u0(U,!1,$),U.asyncDep){if(I&&I.registerDep(U,et,$),!x.el){const W=U.subTree=ae(vi);v(null,W,C,M)}}else et(U,x,C,M,I,j,$)},ct=(x,C,M)=>{const L=C.component=x.component;if(t0(x,C,M))if(L.asyncDep&&!L.asyncResolved){Z(L,C,M);return}else L.next=C,L.update();else C.el=x.el,L.vnode=C},et=(x,C,M,L,I,j,$)=>{const U=()=>{if(x.isMounted){let{next:tt,bu:rt,u:ht,parent:vt,vnode:At}=x;{const Ps=fg(x);if(Ps){tt&&(tt.el=At.el,Z(x,tt,$)),Ps.asyncDep.then(()=>{x.isUnmounted||U()});return}}let Ot=tt,Ve;qn(x,!1),tt?(tt.el=At.el,Z(x,tt,$)):tt=At,rt&&Jo(rt),(Ve=tt.props&&tt.props.onVnodeBeforeUpdate)&&Fs(Ve,vt,tt,At),qn(x,!0);const Ae=Cu(x),ks=x.subTree;x.subTree=Ae,g(ks,Ae,u(ks.el),R(ks),x,I,j),tt.el=Ae.el,Ot===null&&e0(x,Ae.el),ht&&Xe(ht,I),(Ve=tt.props&&tt.props.onVnodeUpdated)&&Xe(()=>Fs(Ve,vt,tt,At),I)}else{let tt;const{el:rt,props:ht}=C,{bm:vt,m:At,parent:Ot,root:Ve,type:Ae}=x,ks=Dr(C);qn(x,!1),vt&&Jo(vt),!ks&&(tt=ht&&ht.onVnodeBeforeMount)&&Fs(tt,Ot,C),qn(x,!0);{Ve.ce&&Ve.ce._injectChildStyle(Ae);const Ps=x.subTree=Cu(x);g(null,Ps,M,L,x,I,j),C.el=Ps.el}if(At&&Xe(At,I),!ks&&(tt=ht&&ht.onVnodeMounted)){const Ps=C;Xe(()=>Fs(tt,Ot,Ps),I)}(C.shapeFlag&256||Ot&&Dr(Ot.vnode)&&Ot.vnode.shapeFlag&256)&&x.a&&Xe(x.a,I),x.isMounted=!0,C=M=L=null}};x.scope.on();const W=x.effect=new yd(U);x.scope.off();const H=x.update=W.run.bind(W),at=x.job=W.runIfDirty.bind(W);at.i=x,at.id=x.uid,W.scheduler=()=>ph(at),qn(x,!0),H()},Z=(x,C,M)=>{C.component=x;const L=x.vnode.props;x.vnode=C,x.next=null,B_(x,C.props,L,M),V_(x,C.children,M),Vn(),gu(x),Wn()},Y=(x,C,M,L,I,j,$,U,W=!1)=>{const H=x&&x.children,at=x?x.shapeFlag:0,tt=C.children,{patchFlag:rt,shapeFlag:ht}=C;if(rt>0){if(rt&128){Tt(H,tt,M,L,I,j,$,U,W);return}else if(rt&256){pt(H,tt,M,L,I,j,$,U,W);return}}ht&8?(at&16&&Rt(H,I,j),tt!==H&&h(M,tt)):at&16?ht&16?Tt(H,tt,M,L,I,j,$,U,W):Rt(H,I,j,!0):(at&8&&h(M,""),ht&16&&k(tt,M,L,I,j,$,U,W))},pt=(x,C,M,L,I,j,$,U,W)=>{x=x||Ii,C=C||Ii;const H=x.length,at=C.length,tt=Math.min(H,at);let rt;for(rt=0;rt<tt;rt++){const ht=C[rt]=W?Sn(C[rt]):Ls(C[rt]);g(x[rt],ht,M,null,I,j,$,U,W)}H>at?Rt(x,I,j,!0,!1,tt):k(C,M,L,I,j,$,U,W,tt)},Tt=(x,C,M,L,I,j,$,U,W)=>{let H=0;const at=C.length;let tt=x.length-1,rt=at-1;for(;H<=tt&&H<=rt;){const ht=x[H],vt=C[H]=W?Sn(C[H]):Ls(C[H]);if(yr(ht,vt))g(ht,vt,M,null,I,j,$,U,W);else break;H++}for(;H<=tt&&H<=rt;){const ht=x[tt],vt=C[rt]=W?Sn(C[rt]):Ls(C[rt]);if(yr(ht,vt))g(ht,vt,M,null,I,j,$,U,W);else break;tt--,rt--}if(H>tt){if(H<=rt){const ht=rt+1,vt=ht<at?C[ht].el:L;for(;H<=rt;)g(null,C[H]=W?Sn(C[H]):Ls(C[H]),M,vt,I,j,$,U,W),H++}}else if(H>rt)for(;H<=tt;)B(x[H],I,j,!0),H++;else{const ht=H,vt=H,At=new Map;for(H=vt;H<=rt;H++){const We=C[H]=W?Sn(C[H]):Ls(C[H]);We.key!=null&&At.set(We.key,H)}let Ot,Ve=0;const Ae=rt-vt+1;let ks=!1,Ps=0;const vr=new Array(Ae);for(H=0;H<Ae;H++)vr[H]=0;for(H=ht;H<=tt;H++){const We=x[H];if(Ve>=Ae){B(We,I,j,!0);continue}let As;if(We.key!=null)As=At.get(We.key);else for(Ot=vt;Ot<=rt;Ot++)if(vr[Ot-vt]===0&&yr(We,C[Ot])){As=Ot;break}As===void 0?B(We,I,j,!0):(vr[As-vt]=H+1,As>=Ps?Ps=As:ks=!0,g(We,C[As],M,null,I,j,$,U,W),Ve++)}const lu=ks?U_(vr):Ii;for(Ot=lu.length-1,H=Ae-1;H>=0;H--){const We=vt+H,As=C[We],cu=We+1<at?C[We+1].el:L;vr[H]===0?g(null,As,M,cu,I,j,$,U,W):ks&&(Ot<0||H!==lu[Ot]?Pt(As,M,cu,2):Ot--)}}},Pt=(x,C,M,L,I=null)=>{const{el:j,type:$,transition:U,children:W,shapeFlag:H}=x;if(H&6){Pt(x.component.subTree,C,M,L);return}if(H&128){x.suspense.move(C,M,L);return}if(H&64){$.move(x,C,M,Q);return}if($===Wt){s(j,C,M);for(let tt=0;tt<W.length;tt++)Pt(W[tt],C,M,L);s(x.anchor,C,M);return}if($===ta){y(x,C,M);return}if(L!==2&&H&1&&U)if(L===0)U.beforeEnter(j),s(j,C,M),Xe(()=>U.enter(j),I);else{const{leave:tt,delayLeave:rt,afterLeave:ht}=U,vt=()=>s(j,C,M),At=()=>{tt(j,()=>{vt(),ht&&ht()})};rt?rt(j,vt,At):At()}else s(j,C,M)},B=(x,C,M,L=!1,I=!1)=>{const{type:j,props:$,ref:U,children:W,dynamicChildren:H,shapeFlag:at,patchFlag:tt,dirs:rt,cacheIndex:ht}=x;if(tt===-2&&(I=!1),U!=null&&da(U,null,M,x,!0),ht!=null&&(C.renderCache[ht]=void 0),at&256){C.ctx.deactivate(x);return}const vt=at&1&&rt,At=!Dr(x);let Ot;if(At&&(Ot=$&&$.onVnodeBeforeUnmount)&&Fs(Ot,C,x),at&6)Vt(x.component,M,L);else{if(at&128){x.suspense.unmount(M,L);return}vt&&$n(x,null,C,"beforeUnmount"),at&64?x.type.remove(x,C,M,Q,L):H&&!H.hasOnce&&(j!==Wt||tt>0&&tt&64)?Rt(H,C,M,!1,!0):(j===Wt&&tt&384||!I&&at&16)&&Rt(W,C,M),L&&N(x)}(At&&(Ot=$&&$.onVnodeUnmounted)||vt)&&Xe(()=>{Ot&&Fs(Ot,C,x),vt&&$n(x,null,C,"unmounted")},M)},N=x=>{const{type:C,el:M,anchor:L,transition:I}=x;if(C===Wt){X(M,L);return}if(C===ta){b(x);return}const j=()=>{n(M),I&&!I.persisted&&I.afterLeave&&I.afterLeave()};if(x.shapeFlag&1&&I&&!I.persisted){const{leave:$,delayLeave:U}=I,W=()=>$(M,j);U?U(x.el,j,W):W()}else j()},X=(x,C)=>{let M;for(;x!==C;)M=f(x),n(x),x=M;n(C)},Vt=(x,C,M)=>{const{bum:L,scope:I,job:j,subTree:$,um:U,m:W,a:H}=x;xu(W),xu(H),L&&Jo(L),I.stop(),j&&(j.flags|=8,B($,x,C,M)),U&&Xe(U,C),Xe(()=>{x.isUnmounted=!0},C),C&&C.pendingBranch&&!C.isUnmounted&&x.asyncDep&&!x.asyncResolved&&x.suspenseId===C.pendingId&&(C.deps--,C.deps===0&&C.resolve())},Rt=(x,C,M,L=!1,I=!1,j=0)=>{for(let $=j;$<x.length;$++)B(x[$],C,M,L,I)},R=x=>{if(x.shapeFlag&6)return R(x.component.subTree);if(x.shapeFlag&128)return x.suspense.next();const C=f(x.anchor||x.el),M=C&&C[v_];return M?f(M):C};let J=!1;const V=(x,C,M)=>{x==null?C._vnode&&B(C._vnode,null,null,!0):g(C._vnode||null,x,C,null,null,null,M),C._vnode=x,J||(J=!0,gu(),zd(),J=!1)},Q={p:g,um:B,m:Pt,r:N,mt:it,mc:k,pc:Y,pbc:z,n:R,o:i};return{render:V,hydrate:void 0,createApp:j_(V)}}function Pl({type:i,props:t},e){return e==="svg"&&i==="foreignObject"||e==="mathml"&&i==="annotation-xml"&&t&&t.encoding&&t.encoding.includes("html")?void 0:e}function qn({effect:i,job:t},e){e?(i.flags|=32,t.flags|=4):(i.flags&=-33,t.flags&=-5)}function X_(i,t){return(!i||i&&!i.pendingBranch)&&t&&!t.persisted}function ug(i,t,e=!1){const s=i.children,n=t.children;if(lt(s)&&lt(n))for(let r=0;r<s.length;r++){const o=s[r];let a=n[r];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=n[r]=Sn(n[r]),a.el=o.el),!e&&a.patchFlag!==-2&&ug(o,a)),a.type===sl&&(a.el=o.el)}}function U_(i){const t=i.slice(),e=[0];let s,n,r,o,a;const l=i.length;for(s=0;s<l;s++){const c=i[s];if(c!==0){if(n=e[e.length-1],i[n]<c){t[s]=n,e.push(s);continue}for(r=0,o=e.length-1;r<o;)a=r+o>>1,i[e[a]]<c?r=a+1:o=a;c<i[e[r]]&&(r>0&&(t[s]=e[r-1]),e[r]=s)}}for(r=e.length,o=e[r-1];r-- >0;)e[r]=o,o=t[o];return e}function fg(i){const t=i.subTree.component;if(t)return t.asyncDep&&!t.asyncResolved?t:fg(t)}function xu(i){if(i)for(let t=0;t<i.length;t++)i[t].flags|=8}const G_=Symbol.for("v-scx"),$_=()=>Ws(G_);function ds(i,t,e){return dg(i,t,e)}function dg(i,t,e=kt){const{immediate:s,deep:n,flush:r,once:o}=e,a=ye({},e),l=t&&s||!t&&r!=="post";let c;if(Jr){if(r==="sync"){const d=$_();c=d.__watcherHandles||(d.__watcherHandles=[])}else if(!l){const d=()=>{};return d.stop=xs,d.resume=xs,d.pause=xs,d}}const h=oe;a.call=(d,p,g)=>qs(d,h,p,g);let u=!1;r==="post"?a.scheduler=d=>{Xe(d,h&&h.suspense)}:r!=="sync"&&(u=!0,a.scheduler=(d,p)=>{p?d():ph(d)}),a.augmentJob=d=>{t&&(d.flags|=4),u&&(d.flags|=2,h&&(d.id=h.uid,d.i=h))};const f=g_(i,t,a);return Jr&&(c?c.push(f):l&&f()),f}function q_(i,t,e){const s=this.proxy,n=qt(i)?i.includes(".")?gg(s,i):()=>s[i]:i.bind(s,s);let r;ft(t)?r=t:(r=t.handler,e=t);const o=vo(this),a=dg(n,r.bind(s),e);return o(),a}function gg(i,t){const e=t.split(".");return()=>{let s=i;for(let n=0;n<e.length&&s;n++)s=s[e[n]];return s}}const K_=(i,t)=>t==="modelValue"||t==="model-value"?i.modelModifiers:i[`${t}Modifiers`]||i[`${ps(t)}Modifiers`]||i[`${xi(t)}Modifiers`];function Z_(i,t,...e){if(i.isUnmounted)return;const s=i.vnode.props||kt;let n=e;const r=t.startsWith("update:"),o=r&&K_(s,t.slice(7));o&&(o.trim&&(n=e.map(h=>qt(h)?h.trim():h)),o.number&&(n=e.map(ca)));let a,l=s[a=wl(t)]||s[a=wl(ps(t))];!l&&r&&(l=s[a=wl(xi(t))]),l&&qs(l,i,6,n);const c=s[a+"Once"];if(c){if(!i.emitted)i.emitted={};else if(i.emitted[a])return;i.emitted[a]=!0,qs(c,i,6,n)}}function pg(i,t,e=!1){const s=t.emitsCache,n=s.get(i);if(n!==void 0)return n;const r=i.emits;let o={},a=!1;if(!ft(i)){const l=c=>{const h=pg(c,t,!0);h&&(a=!0,ye(o,h))};!e&&t.mixins.length&&t.mixins.forEach(l),i.extends&&l(i.extends),i.mixins&&i.mixins.forEach(l)}return!r&&!a?(Dt(i)&&s.set(i,null),null):(lt(r)?r.forEach(l=>o[l]=null):ye(o,r),Dt(i)&&s.set(i,o),o)}function el(i,t){return!i||!Xa(t)?!1:(t=t.slice(2).replace(/Once$/,""),St(i,t[0].toLowerCase()+t.slice(1))||St(i,xi(t))||St(i,t))}function Cu(i){const{type:t,vnode:e,proxy:s,withProxy:n,propsOptions:[r],slots:o,attrs:a,emit:l,render:c,renderCache:h,props:u,data:f,setupState:d,ctx:p,inheritAttrs:g}=i,m=fa(i);let v,_;try{if(e.shapeFlag&4){const b=n||s,S=b;v=Ls(c.call(S,b,h,u,d,f,p)),_=a}else{const b=t;v=Ls(b.length>1?b(u,{attrs:a,slots:o,emit:l}):b(u,null)),_=t.props?a:J_(a)}}catch(b){Lr.length=0,Qa(b,i,1),v=ae(vi)}let y=v;if(_&&g!==!1){const b=Object.keys(_),{shapeFlag:S}=y;b.length&&S&7&&(r&&b.some(ih)&&(_=Q_(_,r)),y=Zi(y,_,!1,!0))}return e.dirs&&(y=Zi(y,null,!1,!0),y.dirs=y.dirs?y.dirs.concat(e.dirs):e.dirs),e.transition&&vh(y,e.transition),v=y,fa(m),v}const J_=i=>{let t;for(const e in i)(e==="class"||e==="style"||Xa(e))&&((t||(t={}))[e]=i[e]);return t},Q_=(i,t)=>{const e={};for(const s in i)(!ih(s)||!(s.slice(9)in t))&&(e[s]=i[s]);return e};function t0(i,t,e){const{props:s,children:n,component:r}=i,{props:o,children:a,patchFlag:l}=t,c=r.emitsOptions;if(t.dirs||t.transition)return!0;if(e&&l>=0){if(l&1024)return!0;if(l&16)return s?Su(s,o,c):!!o;if(l&8){const h=t.dynamicProps;for(let u=0;u<h.length;u++){const f=h[u];if(o[f]!==s[f]&&!el(c,f))return!0}}}else return(n||a)&&(!a||!a.$stable)?!0:s===o?!1:s?o?Su(s,o,c):!0:!!o;return!1}function Su(i,t,e){const s=Object.keys(t);if(s.length!==Object.keys(i).length)return!0;for(let n=0;n<s.length;n++){const r=s[n];if(t[r]!==i[r]&&!el(e,r))return!0}return!1}function e0({vnode:i,parent:t},e){for(;t;){const s=t.subTree;if(s.suspense&&s.suspense.activeBranch===i&&(s.el=i.el),s===i)(i=t.vnode).el=e,t=t.parent;else break}}const mg=i=>i.__isSuspense;function s0(i,t){t&&t.pendingBranch?lt(i)?t.effects.push(...i):t.effects.push(i):Hd(i)}const Wt=Symbol.for("v-fgt"),sl=Symbol.for("v-txt"),vi=Symbol.for("v-cmt"),ta=Symbol.for("v-stc"),Lr=[];let Me=null;function ot(i=!1){Lr.push(Me=i?null:[])}function n0(){Lr.pop(),Me=Lr[Lr.length-1]||null}let Ki=1;function wu(i,t=!1){Ki+=i,i<0&&Me&&t&&(Me.hasOnce=!0)}function vg(i){return i.dynamicChildren=Ki>0?Me||Ii:null,n0(),Ki>0&&Me&&Me.push(i),i}function dt(i,t,e,s,n,r){return vg(A(i,t,e,s,n,r,!0))}function hn(i,t,e,s,n){return vg(ae(i,t,e,s,n,!0))}function pa(i){return i?i.__v_isVNode===!0:!1}function yr(i,t){return i.type===t.type&&i.key===t.key}const _g=({key:i})=>i??null,ea=({ref:i,ref_key:t,ref_for:e})=>(typeof i=="number"&&(i=""+i),i!=null?qt(i)||ve(i)||ft(i)?{i:Fe,r:i,k:t,f:!!e}:i:null);function A(i,t=null,e=null,s=0,n=null,r=i===Wt?0:1,o=!1,a=!1){const l={__v_isVNode:!0,__v_skip:!0,type:i,props:t,key:t&&_g(t),ref:t&&ea(t),scopeId:Wd,slotScopeIds:null,children:e,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:r,patchFlag:s,dynamicProps:n,dynamicChildren:null,appContext:null,ctx:Fe};return a?(yh(l,e),r&128&&i.normalize(l)):e&&(l.shapeFlag|=qt(e)?8:16),Ki>0&&!o&&Me&&(l.patchFlag>0||r&6)&&l.patchFlag!==32&&Me.push(l),l}const ae=i0;function i0(i,t=null,e=null,s=0,n=null,r=!1){if((!i||i===Kd)&&(i=vi),pa(i)){const a=Zi(i,t,!0);return e&&yh(a,e),Ki>0&&!r&&Me&&(a.shapeFlag&6?Me[Me.indexOf(i)]=a:Me.push(a)),a.patchFlag=-2,a}if(m0(i)&&(i=i.__vccOpts),t){t=r0(t);let{class:a,style:l}=t;a&&!qt(a)&&(t.class=$e(a)),Dt(l)&&(dh(l)&&!lt(l)&&(l=ye({},l)),t.style=cs(l))}const o=qt(i)?1:mg(i)?128:__(i)?64:Dt(i)?4:ft(i)?2:0;return A(i,t,e,s,n,o,r,!0)}function r0(i){return i?dh(i)||ig(i)?ye({},i):i:null}function Zi(i,t,e=!1,s=!1){const{props:n,ref:r,patchFlag:o,children:a,transition:l}=i,c=t?o0(n||{},t):n,h={__v_isVNode:!0,__v_skip:!0,type:i.type,props:c,key:c&&_g(c),ref:t&&t.ref?e&&r?lt(r)?r.concat(ea(t)):[r,ea(t)]:ea(t):r,scopeId:i.scopeId,slotScopeIds:i.slotScopeIds,children:a,target:i.target,targetStart:i.targetStart,targetAnchor:i.targetAnchor,staticCount:i.staticCount,shapeFlag:i.shapeFlag,patchFlag:t&&i.type!==Wt?o===-1?16:o|16:o,dynamicProps:i.dynamicProps,dynamicChildren:i.dynamicChildren,appContext:i.appContext,dirs:i.dirs,transition:l,component:i.component,suspense:i.suspense,ssContent:i.ssContent&&Zi(i.ssContent),ssFallback:i.ssFallback&&Zi(i.ssFallback),el:i.el,anchor:i.anchor,ctx:i.ctx,ce:i.ce};return l&&s&&vh(h,l.clone(h)),h}function vc(i=" ",t=0){return ae(sl,null,i,t)}function pe(i="",t=!1){return t?(ot(),hn(vi,null,i)):ae(vi,null,i)}function Ls(i){return i==null||typeof i=="boolean"?ae(vi):lt(i)?ae(Wt,null,i.slice()):pa(i)?Sn(i):ae(sl,null,String(i))}function Sn(i){return i.el===null&&i.patchFlag!==-1||i.memo?i:Zi(i)}function yh(i,t){let e=0;const{shapeFlag:s}=i;if(t==null)t=null;else if(lt(t))e=16;else if(typeof t=="object")if(s&65){const n=t.default;n&&(n._c&&(n._d=!1),yh(i,n()),n._c&&(n._d=!0));return}else{e=32;const n=t._;!n&&!ig(t)?t._ctx=Fe:n===3&&Fe&&(Fe.slots._===1?t._=1:(t._=2,i.patchFlag|=1024))}else ft(t)?(t={default:t,_ctx:Fe},e=32):(t=String(t),s&64?(e=16,t=[vc(t)]):e=8);i.children=t,i.shapeFlag|=e}function o0(...i){const t={};for(let e=0;e<i.length;e++){const s=i[e];for(const n in s)if(n==="class")t.class!==s.class&&(t.class=$e([t.class,s.class]));else if(n==="style")t.style=cs([t.style,s.style]);else if(Xa(n)){const r=t[n],o=s[n];o&&r!==o&&!(lt(r)&&r.includes(o))&&(t[n]=r?[].concat(r,o):o)}else n!==""&&(t[n]=s[n])}return t}function Fs(i,t,e,s=null){qs(i,t,7,[e,s])}const a0=eg();let l0=0;function c0(i,t,e){const s=i.type,n=(t?t.appContext:i.appContext)||a0,r={uid:l0++,vnode:i,type:s,parent:t,appContext:n,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new Wv(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:t?t.provides:Object.create(n.provides),ids:t?t.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:og(s,n),emitsOptions:pg(s,n),emit:null,emitted:null,propsDefaults:kt,inheritAttrs:s.inheritAttrs,ctx:kt,data:kt,props:kt,attrs:kt,slots:kt,refs:kt,setupState:kt,setupContext:null,suspense:e,suspenseId:e?e.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return r.ctx={_:r},r.root=t?t.root:r,r.emit=Z_.bind(null,r),i.ce&&i.ce(r),r}let oe=null;const h0=()=>oe||Fe;let ma,_c;{const i=qa(),t=(e,s)=>{let n;return(n=i[e])||(n=i[e]=[]),n.push(s),r=>{n.length>1?n.forEach(o=>o(r)):n[0](r)}};ma=t("__VUE_INSTANCE_SETTERS__",e=>oe=e),_c=t("__VUE_SSR_SETTERS__",e=>Jr=e)}const vo=i=>{const t=oe;return ma(i),i.scope.on(),()=>{i.scope.off(),ma(t)}},Tu=()=>{oe&&oe.scope.off(),ma(null)};function yg(i){return i.vnode.shapeFlag&4}let Jr=!1;function u0(i,t=!1,e=!1){t&&_c(t);const{props:s,children:n}=i.vnode,r=yg(i);I_(i,s,r,t),z_(i,n,e);const o=r?f0(i,t):void 0;return t&&_c(!1),o}function f0(i,t){const e=i.type;i.accessCache=Object.create(null),i.proxy=new Proxy(i.ctx,k_);const{setup:s}=e;if(s){Vn();const n=i.setupContext=s.length>1?g0(i):null,r=vo(i),o=mo(s,i,0,[i.props,n]),a=fd(o);if(Wn(),r(),(a||i.sp)&&!Dr(i)&&Yd(i),a){if(o.then(Tu,Tu),t)return o.then(l=>{Ou(i,l)}).catch(l=>{Qa(l,i,0)});i.asyncDep=o}else Ou(i,o)}else bg(i)}function Ou(i,t,e){ft(t)?i.type.__ssrInlineRender?i.ssrRender=t:i.render=t:Dt(t)&&(i.setupState=Id(t)),bg(i)}function bg(i,t,e){const s=i.type;i.render||(i.render=s.render||xs);{const n=vo(i);Vn();try{P_(i)}finally{Wn(),n()}}}const d0={get(i,t){return fe(i,"get",""),i[t]}};function g0(i){const t=e=>{i.exposed=e||{}};return{attrs:new Proxy(i.attrs,d0),slots:i.slots,emit:i.emit,expose:t}}function nl(i){return i.exposed?i.exposeProxy||(i.exposeProxy=new Proxy(Id(Ld(i.exposed)),{get(t,e){if(e in t)return t[e];if(e in Rr)return Rr[e](i)},has(t,e){return e in t||e in Rr}})):i.proxy}function p0(i,t=!0){return ft(i)?i.displayName||i.name:i.name||t&&i.__name}function m0(i){return ft(i)&&"__vccOpts"in i}const te=(i,t)=>f_(i,t,Jr);function xg(i,t,e){const s=arguments.length;return s===2?Dt(t)&&!lt(t)?pa(t)?ae(i,null,[t]):ae(i,t):ae(i,null,t):(s>3?e=Array.prototype.slice.call(arguments,2):s===3&&pa(e)&&(e=[e]),ae(i,t,e))}function v0(i,t){const e=i.memo;if(e.length!=t.length)return!1;for(let s=0;s<e.length;s++)if(cn(e[s],t[s]))return!1;return Ki>0&&Me&&Me.push(i),!0}const _0="3.5.13";/**
* @vue/runtime-dom v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let yc;const Mu=typeof window<"u"&&window.trustedTypes;if(Mu)try{yc=Mu.createPolicy("vue",{createHTML:i=>i})}catch{}const Cg=yc?i=>yc.createHTML(i):i=>i,y0="http://www.w3.org/2000/svg",b0="http://www.w3.org/1998/Math/MathML",en=typeof document<"u"?document:null,Eu=en&&en.createElement("template"),x0={insert:(i,t,e)=>{t.insertBefore(i,e||null)},remove:i=>{const t=i.parentNode;t&&t.removeChild(i)},createElement:(i,t,e,s)=>{const n=t==="svg"?en.createElementNS(y0,i):t==="mathml"?en.createElementNS(b0,i):e?en.createElement(i,{is:e}):en.createElement(i);return i==="select"&&s&&s.multiple!=null&&n.setAttribute("multiple",s.multiple),n},createText:i=>en.createTextNode(i),createComment:i=>en.createComment(i),setText:(i,t)=>{i.nodeValue=t},setElementText:(i,t)=>{i.textContent=t},parentNode:i=>i.parentNode,nextSibling:i=>i.nextSibling,querySelector:i=>en.querySelector(i),setScopeId(i,t){i.setAttribute(t,"")},insertStaticContent(i,t,e,s,n,r){const o=e?e.previousSibling:t.lastChild;if(n&&(n===r||n.nextSibling))for(;t.insertBefore(n.cloneNode(!0),e),!(n===r||!(n=n.nextSibling)););else{Eu.innerHTML=Cg(s==="svg"?`<svg>${i}</svg>`:s==="mathml"?`<math>${i}</math>`:i);const a=Eu.content;if(s==="svg"||s==="mathml"){const l=a.firstChild;for(;l.firstChild;)a.appendChild(l.firstChild);a.removeChild(l)}t.insertBefore(a,e)}return[o?o.nextSibling:t.firstChild,e?e.previousSibling:t.lastChild]}},C0=Symbol("_vtc");function S0(i,t,e){const s=i[C0];s&&(t=(t?[t,...s]:[...s]).join(" ")),t==null?i.removeAttribute("class"):e?i.setAttribute("class",t):i.className=t}const va=Symbol("_vod"),Sg=Symbol("_vsh"),ku={beforeMount(i,{value:t},{transition:e}){i[va]=i.style.display==="none"?"":i.style.display,e&&t?e.beforeEnter(i):br(i,t)},mounted(i,{value:t},{transition:e}){e&&t&&e.enter(i)},updated(i,{value:t,oldValue:e},{transition:s}){!t!=!e&&(s?t?(s.beforeEnter(i),br(i,!0),s.enter(i)):s.leave(i,()=>{br(i,!1)}):br(i,t))},beforeUnmount(i,{value:t}){br(i,t)}};function br(i,t){i.style.display=t?i[va]:"none",i[Sg]=!t}const wg=Symbol("");function w0(i){const t=h0();if(!t)return;const e=t.ut=(n=i(t.proxy))=>{Array.from(document.querySelectorAll(`[data-v-owner="${t.uid}"]`)).forEach(r=>_a(r,n))},s=()=>{const n=i(t.proxy);t.ce?_a(t.ce,n):bc(t.subTree,n),e(n)};Gd(()=>{Hd(s)}),ts(()=>{ds(s,xs,{flush:"post"});const n=new MutationObserver(s);n.observe(t.subTree.el.parentNode,{childList:!0}),mn(()=>n.disconnect())})}function bc(i,t){if(i.shapeFlag&128){const e=i.suspense;i=e.activeBranch,e.pendingBranch&&!e.isHydrating&&e.effects.push(()=>{bc(e.activeBranch,t)})}for(;i.component;)i=i.component.subTree;if(i.shapeFlag&1&&i.el)_a(i.el,t);else if(i.type===Wt)i.children.forEach(e=>bc(e,t));else if(i.type===ta){let{el:e,anchor:s}=i;for(;e&&(_a(e,t),e!==s);)e=e.nextSibling}}function _a(i,t){if(i.nodeType===1){const e=i.style;let s="";for(const n in t)e.setProperty(`--${n}`,t[n]),s+=`--${n}: ${t[n]};`;e[wg]=s}}const T0=/(^|;)\s*display\s*:/;function O0(i,t,e){const s=i.style,n=qt(e);let r=!1;if(e&&!n){if(t)if(qt(t))for(const o of t.split(";")){const a=o.slice(0,o.indexOf(":")).trim();e[a]==null&&sa(s,a,"")}else for(const o in t)e[o]==null&&sa(s,o,"");for(const o in e)o==="display"&&(r=!0),sa(s,o,e[o])}else if(n){if(t!==e){const o=s[wg];o&&(e+=";"+o),s.cssText=e,r=T0.test(e)}}else t&&i.removeAttribute("style");va in i&&(i[va]=r?s.display:"",i[Sg]&&(s.display="none"))}const Pu=/\s*!important$/;function sa(i,t,e){if(lt(e))e.forEach(s=>sa(i,t,s));else if(e==null&&(e=""),t.startsWith("--"))i.setProperty(t,e);else{const s=M0(i,t);Pu.test(e)?i.setProperty(xi(s),e.replace(Pu,""),"important"):i[s]=e}}const Au=["Webkit","Moz","ms"],Al={};function M0(i,t){const e=Al[t];if(e)return e;let s=ps(t);if(s!=="filter"&&s in i)return Al[t]=s;s=$a(s);for(let n=0;n<Au.length;n++){const r=Au[n]+s;if(r in i)return Al[t]=r}return t}const Fu="http://www.w3.org/1999/xlink";function Du(i,t,e,s,n,r=Hv(t)){s&&t.startsWith("xlink:")?e==null?i.removeAttributeNS(Fu,t.slice(6,t.length)):i.setAttributeNS(Fu,t,e):e==null||r&&!md(e)?i.removeAttribute(t):i.setAttribute(t,r?"":$s(e)?String(e):e)}function Ru(i,t,e,s,n){if(t==="innerHTML"||t==="textContent"){e!=null&&(i[t]=t==="innerHTML"?Cg(e):e);return}const r=i.tagName;if(t==="value"&&r!=="PROGRESS"&&!r.includes("-")){const a=r==="OPTION"?i.getAttribute("value")||"":i.value,l=e==null?i.type==="checkbox"?"on":"":String(e);(a!==l||!("_value"in i))&&(i.value=l),e==null&&i.removeAttribute(t),i._value=e;return}let o=!1;if(e===""||e==null){const a=typeof i[t];a==="boolean"?e=md(e):e==null&&a==="string"?(e="",o=!0):a==="number"&&(e=0,o=!0)}try{i[t]=e}catch{}o&&i.removeAttribute(n||t)}function ti(i,t,e,s){i.addEventListener(t,e,s)}function E0(i,t,e,s){i.removeEventListener(t,e,s)}const Lu=Symbol("_vei");function k0(i,t,e,s,n=null){const r=i[Lu]||(i[Lu]={}),o=r[t];if(s&&o)o.value=s;else{const[a,l]=P0(t);if(s){const c=r[t]=D0(s,n);ti(i,a,c,l)}else o&&(E0(i,a,o,l),r[t]=void 0)}}const ju=/(?:Once|Passive|Capture)$/;function P0(i){let t;if(ju.test(i)){t={};let s;for(;s=i.match(ju);)i=i.slice(0,i.length-s[0].length),t[s[0].toLowerCase()]=!0}return[i[2]===":"?i.slice(3):xi(i.slice(2)),t]}let Fl=0;const A0=Promise.resolve(),F0=()=>Fl||(A0.then(()=>Fl=0),Fl=Date.now());function D0(i,t){const e=s=>{if(!s._vts)s._vts=Date.now();else if(s._vts<=e.attached)return;qs(R0(s,e.value),t,5,[s])};return e.value=i,e.attached=F0(),e}function R0(i,t){if(lt(t)){const e=i.stopImmediatePropagation;return i.stopImmediatePropagation=()=>{e.call(i),i._stopped=!0},t.map(s=>n=>!n._stopped&&s&&s(n))}else return t}const Iu=i=>i.charCodeAt(0)===111&&i.charCodeAt(1)===110&&i.charCodeAt(2)>96&&i.charCodeAt(2)<123,L0=(i,t,e,s,n,r)=>{const o=n==="svg";t==="class"?S0(i,s,o):t==="style"?O0(i,e,s):Xa(t)?ih(t)||k0(i,t,e,s,r):(t[0]==="."?(t=t.slice(1),!0):t[0]==="^"?(t=t.slice(1),!1):j0(i,t,s,o))?(Ru(i,t,s),!i.tagName.includes("-")&&(t==="value"||t==="checked"||t==="selected")&&Du(i,t,s,o,r,t!=="value")):i._isVueCE&&(/[A-Z]/.test(t)||!qt(s))?Ru(i,ps(t),s,r,t):(t==="true-value"?i._trueValue=s:t==="false-value"&&(i._falseValue=s),Du(i,t,s,o))};function j0(i,t,e,s){if(s)return!!(t==="innerHTML"||t==="textContent"||t in i&&Iu(t)&&ft(e));if(t==="spellcheck"||t==="draggable"||t==="translate"||t==="form"||t==="list"&&i.tagName==="INPUT"||t==="type"&&i.tagName==="TEXTAREA")return!1;if(t==="width"||t==="height"){const n=i.tagName;if(n==="IMG"||n==="VIDEO"||n==="CANVAS"||n==="SOURCE")return!1}return Iu(t)&&qt(e)?!1:t in i}const ya=i=>{const t=i.props["onUpdate:modelValue"]||!1;return lt(t)?e=>Jo(t,e):t};function I0(i){i.target.composing=!0}function Bu(i){const t=i.target;t.composing&&(t.composing=!1,t.dispatchEvent(new Event("input")))}const Vi=Symbol("_assign"),xc={created(i,{modifiers:{lazy:t,trim:e,number:s}},n){i[Vi]=ya(n);const r=s||n.props&&n.props.type==="number";ti(i,t?"change":"input",o=>{if(o.target.composing)return;let a=i.value;e&&(a=a.trim()),r&&(a=ca(a)),i[Vi](a)}),e&&ti(i,"change",()=>{i.value=i.value.trim()}),t||(ti(i,"compositionstart",I0),ti(i,"compositionend",Bu),ti(i,"change",Bu))},mounted(i,{value:t}){i.value=t??""},beforeUpdate(i,{value:t,oldValue:e,modifiers:{lazy:s,trim:n,number:r}},o){if(i[Vi]=ya(o),i.composing)return;const a=(r||i.type==="number")&&!/^0\d/.test(i.value)?ca(i.value):i.value,l=t??"";a!==l&&(document.activeElement===i&&i.type!=="range"&&(s&&t===e||n&&i.value.trim()===l)||(i.value=l))}},Nu={deep:!0,created(i,{value:t,modifiers:{number:e}},s){const n=Ua(t);ti(i,"change",()=>{const r=Array.prototype.filter.call(i.options,o=>o.selected).map(o=>e?ca(ba(o)):ba(o));i[Vi](i.multiple?n?new Set(r):r:r[0]),i._assigning=!0,pi(()=>{i._assigning=!1})}),i[Vi]=ya(s)},mounted(i,{value:t}){Hu(i,t)},beforeUpdate(i,t,e){i[Vi]=ya(e)},updated(i,{value:t}){i._assigning||Hu(i,t)}};function Hu(i,t){const e=i.multiple,s=lt(t);if(!(e&&!s&&!Ua(t))){for(let n=0,r=i.options.length;n<r;n++){const o=i.options[n],a=ba(o);if(e)if(s){const l=typeof a;l==="string"||l==="number"?o.selected=t.some(c=>String(c)===String(a)):o.selected=Vv(t,a)>-1}else o.selected=t.has(a);else if(Ka(ba(o),t)){i.selectedIndex!==n&&(i.selectedIndex=n);return}}!e&&i.selectedIndex!==-1&&(i.selectedIndex=-1)}}function ba(i){return"_value"in i?i._value:i.value}const B0=ye({patchProp:L0},x0);let zu;function N0(){return zu||(zu=W_(B0))}const H0=(...i)=>{const t=N0().createApp(...i),{mount:e}=t;return t.mount=s=>{const n=V0(s);if(!n)return;const r=t._component;!ft(r)&&!r.render&&!r.template&&(r.template=n.innerHTML),n.nodeType===1&&(n.textContent="");const o=e(n,!1,z0(n));return n instanceof Element&&(n.removeAttribute("v-cloak"),n.setAttribute("data-v-app","")),o},t};function z0(i){if(i instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&i instanceof MathMLElement)return"mathml"}function V0(i){return qt(i)?document.querySelector(i):i}const ut={CONTROL_PANEL:{OPEN:"open-control-panel",SHOW_TEXT_SETTING_TOOLBAR:"control-panel:show-text-toolbar",HIDE_TEXT_SETTING_TOOLBAR:"control-panel:hide-text-setting-toolbar"},PANEL_TYPE:{BACKGROUND_IMAGE:"background-image",BACKGROUND_COLOR:"background-color",INSERT_IMAGE:"insert-image"},CANVAS:{CANVAS_UPDATE:"canvas:update",BACKGROUND_COLOR_CHANGE:"canvas:background-color-change",BACKGROUND_IMAGE_CHANGE:"canvas:background-image-change"},FRAME:{FRAME_ADDED:"frame:added",FRAME_REMOVED:"frame:removed",FRAME_UPDATED:"frame:updated",FRAMES_REORDERED:"frames:reordered",FRAMES_CLEARED:"frames:cleared"}};class W0{constructor(){F(this,"events");this.events=new Map}on(t,e){this.events.has(t)||this.events.set(t,[]),this.events.get(t).push(e)}off(t,e){if(this.events.has(t))if(e){const s=this.events.get(t),n=s.indexOf(e);n!==-1&&s.splice(n,1),s.length===0&&this.events.delete(t)}else this.events.delete(t)}emit(t,e){this.events.has(t)&&this.events.get(t).forEach(s=>{s(e)})}}const yt=new W0,Y0=ze({__name:"App",setup(i){return(t,e)=>{const s=qd("router-view");return ot(),hn(s,null,{default:mh(({Component:n,route:r})=>[(ot(),hn(Zd(n)))]),_:1})}}}),vs=(i,t)=>{const e=i.__vccOpts||i;for(const[s,n]of t)e[s]=n;return e},X0=vs(Y0,[["__scopeId","data-v-9330136f"]]);/*!
  * vue-router v4.5.0
  * (c) 2024 Eduardo San Martin Morote
  * @license MIT
  */const Ai=typeof document<"u";function Tg(i){return typeof i=="object"||"displayName"in i||"props"in i||"__vccOpts"in i}function U0(i){return i.__esModule||i[Symbol.toStringTag]==="Module"||i.default&&Tg(i.default)}const xt=Object.assign;function Dl(i,t){const e={};for(const s in t){const n=t[s];e[s]=Ts(n)?n.map(i):i(n)}return e}const jr=()=>{},Ts=Array.isArray,Og=/#/g,G0=/&/g,$0=/\//g,q0=/=/g,K0=/\?/g,Mg=/\+/g,Z0=/%5B/g,J0=/%5D/g,Eg=/%5E/g,Q0=/%60/g,kg=/%7B/g,ty=/%7C/g,Pg=/%7D/g,ey=/%20/g;function bh(i){return encodeURI(""+i).replace(ty,"|").replace(Z0,"[").replace(J0,"]")}function sy(i){return bh(i).replace(kg,"{").replace(Pg,"}").replace(Eg,"^")}function Cc(i){return bh(i).replace(Mg,"%2B").replace(ey,"+").replace(Og,"%23").replace(G0,"%26").replace(Q0,"`").replace(kg,"{").replace(Pg,"}").replace(Eg,"^")}function ny(i){return Cc(i).replace(q0,"%3D")}function iy(i){return bh(i).replace(Og,"%23").replace(K0,"%3F")}function ry(i){return i==null?"":iy(i).replace($0,"%2F")}function Qr(i){try{return decodeURIComponent(""+i)}catch{}return""+i}const oy=/\/$/,ay=i=>i.replace(oy,"");function Rl(i,t,e="/"){let s,n={},r="",o="";const a=t.indexOf("#");let l=t.indexOf("?");return a<l&&a>=0&&(l=-1),l>-1&&(s=t.slice(0,l),r=t.slice(l+1,a>-1?a:t.length),n=i(r)),a>-1&&(s=s||t.slice(0,a),o=t.slice(a,t.length)),s=uy(s??t,e),{fullPath:s+(r&&"?")+r+o,path:s,query:n,hash:Qr(o)}}function ly(i,t){const e=t.query?i(t.query):"";return t.path+(e&&"?")+e+(t.hash||"")}function Vu(i,t){return!t||!i.toLowerCase().startsWith(t.toLowerCase())?i:i.slice(t.length)||"/"}function cy(i,t,e){const s=t.matched.length-1,n=e.matched.length-1;return s>-1&&s===n&&Ji(t.matched[s],e.matched[n])&&Ag(t.params,e.params)&&i(t.query)===i(e.query)&&t.hash===e.hash}function Ji(i,t){return(i.aliasOf||i)===(t.aliasOf||t)}function Ag(i,t){if(Object.keys(i).length!==Object.keys(t).length)return!1;for(const e in i)if(!hy(i[e],t[e]))return!1;return!0}function hy(i,t){return Ts(i)?Wu(i,t):Ts(t)?Wu(t,i):i===t}function Wu(i,t){return Ts(t)?i.length===t.length&&i.every((e,s)=>e===t[s]):i.length===1&&i[0]===t}function uy(i,t){if(i.startsWith("/"))return i;if(!i)return t;const e=t.split("/"),s=i.split("/"),n=s[s.length-1];(n===".."||n===".")&&s.push("");let r=e.length-1,o,a;for(o=0;o<s.length;o++)if(a=s[o],a!==".")if(a==="..")r>1&&r--;else break;return e.slice(0,r).join("/")+"/"+s.slice(o).join("/")}const yn={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var to;(function(i){i.pop="pop",i.push="push"})(to||(to={}));var Ir;(function(i){i.back="back",i.forward="forward",i.unknown=""})(Ir||(Ir={}));function fy(i){if(!i)if(Ai){const t=document.querySelector("base");i=t&&t.getAttribute("href")||"/",i=i.replace(/^\w+:\/\/[^\/]+/,"")}else i="/";return i[0]!=="/"&&i[0]!=="#"&&(i="/"+i),ay(i)}const dy=/^[^#]+#/;function gy(i,t){return i.replace(dy,"#")+t}function py(i,t){const e=document.documentElement.getBoundingClientRect(),s=i.getBoundingClientRect();return{behavior:t.behavior,left:s.left-e.left-(t.left||0),top:s.top-e.top-(t.top||0)}}const il=()=>({left:window.scrollX,top:window.scrollY});function my(i){let t;if("el"in i){const e=i.el,s=typeof e=="string"&&e.startsWith("#"),n=typeof e=="string"?s?document.getElementById(e.slice(1)):document.querySelector(e):e;if(!n)return;t=py(n,i)}else t=i;"scrollBehavior"in document.documentElement.style?window.scrollTo(t):window.scrollTo(t.left!=null?t.left:window.scrollX,t.top!=null?t.top:window.scrollY)}function Yu(i,t){return(history.state?history.state.position-t:-1)+i}const Sc=new Map;function vy(i,t){Sc.set(i,t)}function _y(i){const t=Sc.get(i);return Sc.delete(i),t}let yy=()=>location.protocol+"//"+location.host;function Fg(i,t){const{pathname:e,search:s,hash:n}=t,r=i.indexOf("#");if(r>-1){let a=n.includes(i.slice(r))?i.slice(r).length:1,l=n.slice(a);return l[0]!=="/"&&(l="/"+l),Vu(l,"")}return Vu(e,i)+s+n}function by(i,t,e,s){let n=[],r=[],o=null;const a=({state:f})=>{const d=Fg(i,location),p=e.value,g=t.value;let m=0;if(f){if(e.value=d,t.value=f,o&&o===p){o=null;return}m=g?f.position-g.position:0}else s(d);n.forEach(v=>{v(e.value,p,{delta:m,type:to.pop,direction:m?m>0?Ir.forward:Ir.back:Ir.unknown})})};function l(){o=e.value}function c(f){n.push(f);const d=()=>{const p=n.indexOf(f);p>-1&&n.splice(p,1)};return r.push(d),d}function h(){const{history:f}=window;f.state&&f.replaceState(xt({},f.state,{scroll:il()}),"")}function u(){for(const f of r)f();r=[],window.removeEventListener("popstate",a),window.removeEventListener("beforeunload",h)}return window.addEventListener("popstate",a),window.addEventListener("beforeunload",h,{passive:!0}),{pauseListeners:l,listen:c,destroy:u}}function Xu(i,t,e,s=!1,n=!1){return{back:i,current:t,forward:e,replaced:s,position:window.history.length,scroll:n?il():null}}function xy(i){const{history:t,location:e}=window,s={value:Fg(i,e)},n={value:t.state};n.value||r(s.value,{back:null,current:s.value,forward:null,position:t.length-1,replaced:!0,scroll:null},!0);function r(l,c,h){const u=i.indexOf("#"),f=u>-1?(e.host&&document.querySelector("base")?i:i.slice(u))+l:yy()+i+l;try{t[h?"replaceState":"pushState"](c,"",f),n.value=c}catch(d){console.error(d),e[h?"replace":"assign"](f)}}function o(l,c){const h=xt({},t.state,Xu(n.value.back,l,n.value.forward,!0),c,{position:n.value.position});r(l,h,!0),s.value=l}function a(l,c){const h=xt({},n.value,t.state,{forward:l,scroll:il()});r(h.current,h,!0);const u=xt({},Xu(s.value,l,null),{position:h.position+1},c);r(l,u,!1),s.value=l}return{location:s,state:n,push:a,replace:o}}function Cy(i){i=fy(i);const t=xy(i),e=by(i,t.state,t.location,t.replace);function s(r,o=!0){o||e.pauseListeners(),history.go(r)}const n=xt({location:"",base:i,go:s,createHref:gy.bind(null,i)},t,e);return Object.defineProperty(n,"location",{enumerable:!0,get:()=>t.location.value}),Object.defineProperty(n,"state",{enumerable:!0,get:()=>t.state.value}),n}function Sy(i){return i=location.host?i||location.pathname+location.search:"",i.includes("#")||(i+="#"),Cy(i)}function wy(i){return typeof i=="string"||i&&typeof i=="object"}function Dg(i){return typeof i=="string"||typeof i=="symbol"}const Rg=Symbol("");var Uu;(function(i){i[i.aborted=4]="aborted",i[i.cancelled=8]="cancelled",i[i.duplicated=16]="duplicated"})(Uu||(Uu={}));function Qi(i,t){return xt(new Error,{type:i,[Rg]:!0},t)}function Qs(i,t){return i instanceof Error&&Rg in i&&(t==null||!!(i.type&t))}const Gu="[^/]+?",Ty={sensitive:!1,strict:!1,start:!0,end:!0},Oy=/[.+*?^${}()[\]/\\]/g;function My(i,t){const e=xt({},Ty,t),s=[];let n=e.start?"^":"";const r=[];for(const c of i){const h=c.length?[]:[90];e.strict&&!c.length&&(n+="/");for(let u=0;u<c.length;u++){const f=c[u];let d=40+(e.sensitive?.25:0);if(f.type===0)u||(n+="/"),n+=f.value.replace(Oy,"\\$&"),d+=40;else if(f.type===1){const{value:p,repeatable:g,optional:m,regexp:v}=f;r.push({name:p,repeatable:g,optional:m});const _=v||Gu;if(_!==Gu){d+=10;try{new RegExp(`(${_})`)}catch(b){throw new Error(`Invalid custom RegExp for param "${p}" (${_}): `+b.message)}}let y=g?`((?:${_})(?:/(?:${_}))*)`:`(${_})`;u||(y=m&&c.length<2?`(?:/${y})`:"/"+y),m&&(y+="?"),n+=y,d+=20,m&&(d+=-8),g&&(d+=-20),_===".*"&&(d+=-50)}h.push(d)}s.push(h)}if(e.strict&&e.end){const c=s.length-1;s[c][s[c].length-1]+=.7000000000000001}e.strict||(n+="/?"),e.end?n+="$":e.strict&&!n.endsWith("/")&&(n+="(?:/|$)");const o=new RegExp(n,e.sensitive?"":"i");function a(c){const h=c.match(o),u={};if(!h)return null;for(let f=1;f<h.length;f++){const d=h[f]||"",p=r[f-1];u[p.name]=d&&p.repeatable?d.split("/"):d}return u}function l(c){let h="",u=!1;for(const f of i){(!u||!h.endsWith("/"))&&(h+="/"),u=!1;for(const d of f)if(d.type===0)h+=d.value;else if(d.type===1){const{value:p,repeatable:g,optional:m}=d,v=p in c?c[p]:"";if(Ts(v)&&!g)throw new Error(`Provided param "${p}" is an array but it is not repeatable (* or + modifiers)`);const _=Ts(v)?v.join("/"):v;if(!_)if(m)f.length<2&&(h.endsWith("/")?h=h.slice(0,-1):u=!0);else throw new Error(`Missing required param "${p}"`);h+=_}}return h||"/"}return{re:o,score:s,keys:r,parse:a,stringify:l}}function Ey(i,t){let e=0;for(;e<i.length&&e<t.length;){const s=t[e]-i[e];if(s)return s;e++}return i.length<t.length?i.length===1&&i[0]===80?-1:1:i.length>t.length?t.length===1&&t[0]===80?1:-1:0}function Lg(i,t){let e=0;const s=i.score,n=t.score;for(;e<s.length&&e<n.length;){const r=Ey(s[e],n[e]);if(r)return r;e++}if(Math.abs(n.length-s.length)===1){if($u(s))return 1;if($u(n))return-1}return n.length-s.length}function $u(i){const t=i[i.length-1];return i.length>0&&t[t.length-1]<0}const ky={type:0,value:""},Py=/[a-zA-Z0-9_]/;function Ay(i){if(!i)return[[]];if(i==="/")return[[ky]];if(!i.startsWith("/"))throw new Error(`Invalid path "${i}"`);function t(d){throw new Error(`ERR (${e})/"${c}": ${d}`)}let e=0,s=e;const n=[];let r;function o(){r&&n.push(r),r=[]}let a=0,l,c="",h="";function u(){c&&(e===0?r.push({type:0,value:c}):e===1||e===2||e===3?(r.length>1&&(l==="*"||l==="+")&&t(`A repeatable param (${c}) must be alone in its segment. eg: '/:ids+.`),r.push({type:1,value:c,regexp:h,repeatable:l==="*"||l==="+",optional:l==="*"||l==="?"})):t("Invalid state to consume buffer"),c="")}function f(){c+=l}for(;a<i.length;){if(l=i[a++],l==="\\"&&e!==2){s=e,e=4;continue}switch(e){case 0:l==="/"?(c&&u(),o()):l===":"?(u(),e=1):f();break;case 4:f(),e=s;break;case 1:l==="("?e=2:Py.test(l)?f():(u(),e=0,l!=="*"&&l!=="?"&&l!=="+"&&a--);break;case 2:l===")"?h[h.length-1]=="\\"?h=h.slice(0,-1)+l:e=3:h+=l;break;case 3:u(),e=0,l!=="*"&&l!=="?"&&l!=="+"&&a--,h="";break;default:t("Unknown state");break}}return e===2&&t(`Unfinished custom RegExp for param "${c}"`),u(),o(),n}function Fy(i,t,e){const s=My(Ay(i.path),e),n=xt(s,{record:i,parent:t,children:[],alias:[]});return t&&!n.record.aliasOf==!t.record.aliasOf&&t.children.push(n),n}function Dy(i,t){const e=[],s=new Map;t=Ju({strict:!1,end:!0,sensitive:!1},t);function n(u){return s.get(u)}function r(u,f,d){const p=!d,g=Ku(u);g.aliasOf=d&&d.record;const m=Ju(t,u),v=[g];if("alias"in u){const b=typeof u.alias=="string"?[u.alias]:u.alias;for(const S of b)v.push(Ku(xt({},g,{components:d?d.record.components:g.components,path:S,aliasOf:d?d.record:g})))}let _,y;for(const b of v){const{path:S}=b;if(f&&S[0]!=="/"){const P=f.record.path,O=P[P.length-1]==="/"?"":"/";b.path=f.record.path+(S&&O+S)}if(_=Fy(b,f,m),d?d.alias.push(_):(y=y||_,y!==_&&y.alias.push(_),p&&u.name&&!Zu(_)&&o(u.name)),jg(_)&&l(_),g.children){const P=g.children;for(let O=0;O<P.length;O++)r(P[O],_,d&&d.children[O])}d=d||_}return y?()=>{o(y)}:jr}function o(u){if(Dg(u)){const f=s.get(u);f&&(s.delete(u),e.splice(e.indexOf(f),1),f.children.forEach(o),f.alias.forEach(o))}else{const f=e.indexOf(u);f>-1&&(e.splice(f,1),u.record.name&&s.delete(u.record.name),u.children.forEach(o),u.alias.forEach(o))}}function a(){return e}function l(u){const f=jy(u,e);e.splice(f,0,u),u.record.name&&!Zu(u)&&s.set(u.record.name,u)}function c(u,f){let d,p={},g,m;if("name"in u&&u.name){if(d=s.get(u.name),!d)throw Qi(1,{location:u});m=d.record.name,p=xt(qu(f.params,d.keys.filter(y=>!y.optional).concat(d.parent?d.parent.keys.filter(y=>y.optional):[]).map(y=>y.name)),u.params&&qu(u.params,d.keys.map(y=>y.name))),g=d.stringify(p)}else if(u.path!=null)g=u.path,d=e.find(y=>y.re.test(g)),d&&(p=d.parse(g),m=d.record.name);else{if(d=f.name?s.get(f.name):e.find(y=>y.re.test(f.path)),!d)throw Qi(1,{location:u,currentLocation:f});m=d.record.name,p=xt({},f.params,u.params),g=d.stringify(p)}const v=[];let _=d;for(;_;)v.unshift(_.record),_=_.parent;return{name:m,path:g,params:p,matched:v,meta:Ly(v)}}i.forEach(u=>r(u));function h(){e.length=0,s.clear()}return{addRoute:r,resolve:c,removeRoute:o,clearRoutes:h,getRoutes:a,getRecordMatcher:n}}function qu(i,t){const e={};for(const s of t)s in i&&(e[s]=i[s]);return e}function Ku(i){const t={path:i.path,redirect:i.redirect,name:i.name,meta:i.meta||{},aliasOf:i.aliasOf,beforeEnter:i.beforeEnter,props:Ry(i),children:i.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in i?i.components||null:i.component&&{default:i.component}};return Object.defineProperty(t,"mods",{value:{}}),t}function Ry(i){const t={},e=i.props||!1;if("component"in i)t.default=e;else for(const s in i.components)t[s]=typeof e=="object"?e[s]:e;return t}function Zu(i){for(;i;){if(i.record.aliasOf)return!0;i=i.parent}return!1}function Ly(i){return i.reduce((t,e)=>xt(t,e.meta),{})}function Ju(i,t){const e={};for(const s in i)e[s]=s in t?t[s]:i[s];return e}function jy(i,t){let e=0,s=t.length;for(;e!==s;){const r=e+s>>1;Lg(i,t[r])<0?s=r:e=r+1}const n=Iy(i);return n&&(s=t.lastIndexOf(n,s-1)),s}function Iy(i){let t=i;for(;t=t.parent;)if(jg(t)&&Lg(i,t)===0)return t}function jg({record:i}){return!!(i.name||i.components&&Object.keys(i.components).length||i.redirect)}function By(i){const t={};if(i===""||i==="?")return t;const s=(i[0]==="?"?i.slice(1):i).split("&");for(let n=0;n<s.length;++n){const r=s[n].replace(Mg," "),o=r.indexOf("="),a=Qr(o<0?r:r.slice(0,o)),l=o<0?null:Qr(r.slice(o+1));if(a in t){let c=t[a];Ts(c)||(c=t[a]=[c]),c.push(l)}else t[a]=l}return t}function Qu(i){let t="";for(let e in i){const s=i[e];if(e=ny(e),s==null){s!==void 0&&(t+=(t.length?"&":"")+e);continue}(Ts(s)?s.map(r=>r&&Cc(r)):[s&&Cc(s)]).forEach(r=>{r!==void 0&&(t+=(t.length?"&":"")+e,r!=null&&(t+="="+r))})}return t}function Ny(i){const t={};for(const e in i){const s=i[e];s!==void 0&&(t[e]=Ts(s)?s.map(n=>n==null?null:""+n):s==null?s:""+s)}return t}const Hy=Symbol(""),tf=Symbol(""),rl=Symbol(""),Ig=Symbol(""),wc=Symbol("");function xr(){let i=[];function t(s){return i.push(s),()=>{const n=i.indexOf(s);n>-1&&i.splice(n,1)}}function e(){i=[]}return{add:t,list:()=>i.slice(),reset:e}}function wn(i,t,e,s,n,r=o=>o()){const o=s&&(s.enterCallbacks[n]=s.enterCallbacks[n]||[]);return()=>new Promise((a,l)=>{const c=f=>{f===!1?l(Qi(4,{from:e,to:t})):f instanceof Error?l(f):wy(f)?l(Qi(2,{from:t,to:f})):(o&&s.enterCallbacks[n]===o&&typeof f=="function"&&o.push(f),a())},h=r(()=>i.call(s&&s.instances[n],t,e,c));let u=Promise.resolve(h);i.length<3&&(u=u.then(c)),u.catch(f=>l(f))})}function Ll(i,t,e,s,n=r=>r()){const r=[];for(const o of i)for(const a in o.components){let l=o.components[a];if(!(t!=="beforeRouteEnter"&&!o.instances[a]))if(Tg(l)){const h=(l.__vccOpts||l)[t];h&&r.push(wn(h,e,s,o,a,n))}else{let c=l();r.push(()=>c.then(h=>{if(!h)throw new Error(`Couldn't resolve component "${a}" at "${o.path}"`);const u=U0(h)?h.default:h;o.mods[a]=h,o.components[a]=u;const d=(u.__vccOpts||u)[t];return d&&wn(d,e,s,o,a,n)()}))}}return r}function ef(i){const t=Ws(rl),e=Ws(Ig),s=te(()=>{const l=Je(i.to);return t.resolve(l)}),n=te(()=>{const{matched:l}=s.value,{length:c}=l,h=l[c-1],u=e.matched;if(!h||!u.length)return-1;const f=u.findIndex(Ji.bind(null,h));if(f>-1)return f;const d=sf(l[c-2]);return c>1&&sf(h)===d&&u[u.length-1].path!==d?u.findIndex(Ji.bind(null,l[c-2])):f}),r=te(()=>n.value>-1&&Xy(e.params,s.value.params)),o=te(()=>n.value>-1&&n.value===e.matched.length-1&&Ag(e.params,s.value.params));function a(l={}){if(Yy(l)){const c=t[Je(i.replace)?"replace":"push"](Je(i.to)).catch(jr);return i.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>c),c}return Promise.resolve()}return{route:s,href:te(()=>s.value.href),isActive:r,isExactActive:o,navigate:a}}function zy(i){return i.length===1?i[0]:i}const Vy=ze({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:ef,setup(i,{slots:t}){const e=Ja(ef(i)),{options:s}=Ws(rl),n=te(()=>({[nf(i.activeClass,s.linkActiveClass,"router-link-active")]:e.isActive,[nf(i.exactActiveClass,s.linkExactActiveClass,"router-link-exact-active")]:e.isExactActive}));return()=>{const r=t.default&&zy(t.default(e));return i.custom?r:xg("a",{"aria-current":e.isExactActive?i.ariaCurrentValue:null,href:e.href,onClick:e.navigate,class:n.value},r)}}}),Wy=Vy;function Yy(i){if(!(i.metaKey||i.altKey||i.ctrlKey||i.shiftKey)&&!i.defaultPrevented&&!(i.button!==void 0&&i.button!==0)){if(i.currentTarget&&i.currentTarget.getAttribute){const t=i.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(t))return}return i.preventDefault&&i.preventDefault(),!0}}function Xy(i,t){for(const e in t){const s=t[e],n=i[e];if(typeof s=="string"){if(s!==n)return!1}else if(!Ts(n)||n.length!==s.length||s.some((r,o)=>r!==n[o]))return!1}return!0}function sf(i){return i?i.aliasOf?i.aliasOf.path:i.path:""}const nf=(i,t,e)=>i??t??e,Uy=ze({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(i,{attrs:t,slots:e}){const s=Ws(wc),n=te(()=>i.route||s.value),r=Ws(tf,0),o=te(()=>{let c=Je(r);const{matched:h}=n.value;let u;for(;(u=h[c])&&!u.components;)c++;return c}),a=te(()=>n.value.matched[o.value]);Qo(tf,te(()=>o.value+1)),Qo(Hy,a),Qo(wc,n);const l=nt();return ds(()=>[l.value,a.value,i.name],([c,h,u],[f,d,p])=>{h&&(h.instances[u]=c,d&&d!==h&&c&&c===f&&(h.leaveGuards.size||(h.leaveGuards=d.leaveGuards),h.updateGuards.size||(h.updateGuards=d.updateGuards))),c&&h&&(!d||!Ji(h,d)||!f)&&(h.enterCallbacks[u]||[]).forEach(g=>g(c))},{flush:"post"}),()=>{const c=n.value,h=i.name,u=a.value,f=u&&u.components[h];if(!f)return rf(e.default,{Component:f,route:c});const d=u.props[h],p=d?d===!0?c.params:typeof d=="function"?d(c):d:null,m=xg(f,xt({},p,t,{onVnodeUnmounted:v=>{v.component.isUnmounted&&(u.instances[h]=null)},ref:l}));return rf(e.default,{Component:m,route:c})||m}}});function rf(i,t){if(!i)return null;const e=i(t);return e.length===1?e[0]:e}const Gy=Uy;function $y(i){const t=Dy(i.routes,i),e=i.parseQuery||By,s=i.stringifyQuery||Qu,n=i.history,r=xr(),o=xr(),a=xr(),l=gh(yn);let c=yn;Ai&&i.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const h=Dl.bind(null,R=>""+R),u=Dl.bind(null,ry),f=Dl.bind(null,Qr);function d(R,J){let V,Q;return Dg(R)?(V=t.getRecordMatcher(R),Q=J):Q=R,t.addRoute(Q,V)}function p(R){const J=t.getRecordMatcher(R);J&&t.removeRoute(J)}function g(){return t.getRoutes().map(R=>R.record)}function m(R){return!!t.getRecordMatcher(R)}function v(R,J){if(J=xt({},J||l.value),typeof R=="string"){const M=Rl(e,R,J.path),L=t.resolve({path:M.path},J),I=n.createHref(M.fullPath);return xt(M,L,{params:f(L.params),hash:Qr(M.hash),redirectedFrom:void 0,href:I})}let V;if(R.path!=null)V=xt({},R,{path:Rl(e,R.path,J.path).path});else{const M=xt({},R.params);for(const L in M)M[L]==null&&delete M[L];V=xt({},R,{params:u(M)}),J.params=u(J.params)}const Q=t.resolve(V,J),bt=R.hash||"";Q.params=h(f(Q.params));const x=ly(s,xt({},R,{hash:sy(bt),path:Q.path})),C=n.createHref(x);return xt({fullPath:x,hash:bt,query:s===Qu?Ny(R.query):R.query||{}},Q,{redirectedFrom:void 0,href:C})}function _(R){return typeof R=="string"?Rl(e,R,l.value.path):xt({},R)}function y(R,J){if(c!==R)return Qi(8,{from:J,to:R})}function b(R){return O(R)}function S(R){return b(xt(_(R),{replace:!0}))}function P(R){const J=R.matched[R.matched.length-1];if(J&&J.redirect){const{redirect:V}=J;let Q=typeof V=="function"?V(R):V;return typeof Q=="string"&&(Q=Q.includes("?")||Q.includes("#")?Q=_(Q):{path:Q},Q.params={}),xt({query:R.query,hash:R.hash,params:Q.path!=null?{}:R.params},Q)}}function O(R,J){const V=c=v(R),Q=l.value,bt=R.state,x=R.force,C=R.replace===!0,M=P(V);if(M)return O(xt(_(M),{state:typeof M=="object"?xt({},bt,M.state):bt,force:x,replace:C}),J||V);const L=V;L.redirectedFrom=J;let I;return!x&&cy(s,Q,V)&&(I=Qi(16,{to:L,from:Q}),Pt(Q,Q,!0,!1)),(I?Promise.resolve(I):z(L,Q)).catch(j=>Qs(j)?Qs(j,2)?j:Tt(j):Y(j,L,Q)).then(j=>{if(j){if(Qs(j,2))return O(xt({replace:C},_(j.to),{state:typeof j.to=="object"?xt({},bt,j.to.state):bt,force:x}),J||L)}else j=st(L,Q,!0,C,bt);return K(L,Q,j),j})}function k(R,J){const V=y(R,J);return V?Promise.reject(V):Promise.resolve()}function D(R){const J=X.values().next().value;return J&&typeof J.runWithContext=="function"?J.runWithContext(R):R()}function z(R,J){let V;const[Q,bt,x]=qy(R,J);V=Ll(Q.reverse(),"beforeRouteLeave",R,J);for(const M of Q)M.leaveGuards.forEach(L=>{V.push(wn(L,R,J))});const C=k.bind(null,R,J);return V.push(C),Rt(V).then(()=>{V=[];for(const M of r.list())V.push(wn(M,R,J));return V.push(C),Rt(V)}).then(()=>{V=Ll(bt,"beforeRouteUpdate",R,J);for(const M of bt)M.updateGuards.forEach(L=>{V.push(wn(L,R,J))});return V.push(C),Rt(V)}).then(()=>{V=[];for(const M of x)if(M.beforeEnter)if(Ts(M.beforeEnter))for(const L of M.beforeEnter)V.push(wn(L,R,J));else V.push(wn(M.beforeEnter,R,J));return V.push(C),Rt(V)}).then(()=>(R.matched.forEach(M=>M.enterCallbacks={}),V=Ll(x,"beforeRouteEnter",R,J,D),V.push(C),Rt(V))).then(()=>{V=[];for(const M of o.list())V.push(wn(M,R,J));return V.push(C),Rt(V)}).catch(M=>Qs(M,8)?M:Promise.reject(M))}function K(R,J,V){a.list().forEach(Q=>D(()=>Q(R,J,V)))}function st(R,J,V,Q,bt){const x=y(R,J);if(x)return x;const C=J===yn,M=Ai?history.state:{};V&&(Q||C?n.replace(R.fullPath,xt({scroll:C&&M&&M.scroll},bt)):n.push(R.fullPath,bt)),l.value=R,Pt(R,J,V,C),Tt()}let G;function it(){G||(G=n.listen((R,J,V)=>{if(!Vt.listening)return;const Q=v(R),bt=P(Q);if(bt){O(xt(bt,{replace:!0,force:!0}),Q).catch(jr);return}c=Q;const x=l.value;Ai&&vy(Yu(x.fullPath,V.delta),il()),z(Q,x).catch(C=>Qs(C,12)?C:Qs(C,2)?(O(xt(_(C.to),{force:!0}),Q).then(M=>{Qs(M,20)&&!V.delta&&V.type===to.pop&&n.go(-1,!1)}).catch(jr),Promise.reject()):(V.delta&&n.go(-V.delta,!1),Y(C,Q,x))).then(C=>{C=C||st(Q,x,!1),C&&(V.delta&&!Qs(C,8)?n.go(-V.delta,!1):V.type===to.pop&&Qs(C,20)&&n.go(-1,!1)),K(Q,x,C)}).catch(jr)}))}let ct=xr(),et=xr(),Z;function Y(R,J,V){Tt(R);const Q=et.list();return Q.length?Q.forEach(bt=>bt(R,J,V)):console.error(R),Promise.reject(R)}function pt(){return Z&&l.value!==yn?Promise.resolve():new Promise((R,J)=>{ct.add([R,J])})}function Tt(R){return Z||(Z=!R,it(),ct.list().forEach(([J,V])=>R?V(R):J()),ct.reset()),R}function Pt(R,J,V,Q){const{scrollBehavior:bt}=i;if(!Ai||!bt)return Promise.resolve();const x=!V&&_y(Yu(R.fullPath,0))||(Q||!V)&&history.state&&history.state.scroll||null;return pi().then(()=>bt(R,J,x)).then(C=>C&&my(C)).catch(C=>Y(C,R,J))}const B=R=>n.go(R);let N;const X=new Set,Vt={currentRoute:l,listening:!0,addRoute:d,removeRoute:p,clearRoutes:t.clearRoutes,hasRoute:m,getRoutes:g,resolve:v,options:i,push:b,replace:S,go:B,back:()=>B(-1),forward:()=>B(1),beforeEach:r.add,beforeResolve:o.add,afterEach:a.add,onError:et.add,isReady:pt,install(R){const J=this;R.component("RouterLink",Wy),R.component("RouterView",Gy),R.config.globalProperties.$router=J,Object.defineProperty(R.config.globalProperties,"$route",{enumerable:!0,get:()=>Je(l)}),Ai&&!N&&l.value===yn&&(N=!0,b(n.location).catch(bt=>{}));const V={};for(const bt in yn)Object.defineProperty(V,bt,{get:()=>l.value[bt],enumerable:!0});R.provide(rl,J),R.provide(Ig,Dd(V)),R.provide(wc,l);const Q=R.unmount;X.add(R),R.unmount=function(){X.delete(R),X.size<1&&(c=yn,G&&G(),G=null,l.value=yn,N=!1,Z=!1),Q()}}};function Rt(R){return R.reduce((J,V)=>J.then(()=>D(V)),Promise.resolve())}return Vt}function qy(i,t){const e=[],s=[],n=[],r=Math.max(t.matched.length,i.matched.length);for(let o=0;o<r;o++){const a=t.matched[o];a&&(i.matched.find(c=>Ji(c,a))?s.push(a):e.push(a));const l=i.matched[o];l&&(t.matched.find(c=>Ji(c,l))||n.push(l))}return[e,s,n]}function Ky(){return Ws(rl)}const Zy={class:"toolbar"},Jy={class:"toolbar-center"},Qy=["onClick"],tb=["onClick"],eb={class:"toolbar-right"},sb={class:"frame-selector-container"},nb=["onClick"],ib=ze({__name:"Toolbar",props:{canvasManager:{}},setup(i){const t=i,e=nt(null),s=nt(null),n=nt(!1),r=nt(!1),o=nt([]),a=()=>{var _;(_=t.canvasManager)==null||_.getModeManager().enterPresentMode()},l=()=>{t.canvasManager&&t.canvasManager.exportCanvasToJSON()},c=()=>{var _;(_=s.value)==null||_.click()},h=_=>{const y=_.target;if(y.files&&y.files[0]){const b=y.files[0],S=new FileReader;S.onload=P=>{var k;const O=(k=P.target)==null?void 0:k.result;O&&t.canvasManager&&t.canvasManager.importCanvasFromJSON(O),y.value=""},S.readAsText(b)}},u=()=>{window.open("/test-page","_blank")},f=()=>{if(!t.canvasManager)return;const _=t.canvasManager.getPageFrame(),y=t.canvasManager.getAllFrames(),b=[];_&&b.push(_),y&&y.length&&b.push(...y),o.value=b},d=_=>{t.canvasManager&&(t.canvasManager.navigateToFrame(_),r.value=!1)};ds(()=>t.canvasManager,_=>{_&&f()},{immediate:!0}),ts(()=>{t.canvasManager&&f()});const p=[{name:"正方形",type:"square",options:{width:100,height:100,fill:"#fff"}},{name:"矩形",type:"rect",options:{width:150,height:100,fill:"#fff"}},{name:"三角形",type:"triangle",options:{width:100,height:100,fill:"#fff"}},{name:"圆形",type:"circle",options:{radius:50,fill:"#fff"}},{name:"直线",type:"line",options:{width:100,stroke:"#fff",strokeWidth:2}},{name:"箭头",type:"arrow",options:{width:100,stroke:"#fff",strokeWidth:2}}],g=(_,y)=>{var b,S,P;console.log("addShape",(b=t.canvasManager)==null?void 0:b.getControlsManager()),(P=(S=t.canvasManager)==null?void 0:S.getControlsManager())==null||P.addShape(_,y),n.value=!1},m=_=>{var b,S;const y=_.target;if(y.files&&y.files[0]){const P=y.files[0],O=URL.createObjectURL(P);(S=(b=t.canvasManager)==null?void 0:b.getControlsManager())==null||S.addImage(O),y.value=""}},v=nt([{id:2,name:"文本",action:()=>{var _,y;(y=(_=t.canvasManager)==null?void 0:_.getControlsManager())==null||y.addText()}},{id:3,name:"媒体",action:()=>{var _;yt.emit(ut.CONTROL_PANEL.OPEN,{type:ut.PANEL_TYPE.INSERT_IMAGE,canvas:(_=t.canvasManager)==null?void 0:_.getMainCanvas(),canvasManager:t.canvasManager,target:null,position:null})}},{id:4,name:"形状",action:()=>{n.value=!n.value}},{id:1,name:"动画",action:()=>console.log("select")}]);return(_,y)=>(ot(),dt("div",Zy,[y[2]||(y[2]=A("div",{class:"toolbar-left"},[A("div",{class:"logo"},"Next Slides")],-1)),A("div",Jy,[(ot(!0),dt(Wt,null,fs(v.value,b=>(ot(),dt("div",{class:"tool-item",key:b.id},[A("button",{class:"tool-btn",onClick:b.action},Cs(b.name),9,Qy),b.id===4?mi((ot(),dt("div",{key:0,class:"shape-dropdown",onMouseleave:y[0]||(y[0]=S=>n.value=!1)},[(ot(),dt(Wt,null,fs(p,S=>A("div",{key:S.type,class:"shape-item",onClick:P=>g(S.type,S.options)},Cs(S.name),9,tb)),64))],544)),[[ku,n.value]]):pe("",!0)]))),128)),A("input",{type:"file",ref_key:"fileInput",ref:e,accept:".jpg,.jpeg,.png",style:{display:"none"},onChange:m},null,544)]),A("div",eb,[A("button",{class:"test-page-btn",onClick:u},"测试页面"),A("div",sb,[mi(A("div",{class:"frame-dropdown",onMouseleave:y[1]||(y[1]=b=>r.value=!1)},[(ot(!0),dt(Wt,null,fs(o.value,(b,S)=>(ot(),dt("div",{key:b.id,class:"frame-item",onClick:P=>d(b)},Cs(S===0?"概览":`页面 ${S}`),9,nb))),128))],544),[[ku,r.value]])]),A("button",{class:"save-btn",onClick:l},"导出"),A("button",{class:"import-btn",onClick:c},"导入"),A("button",{class:"preview-btn",onClick:a},"预览"),A("input",{type:"file",ref_key:"jsonFileInput",ref:s,accept:".json",style:{display:"none"},onChange:h},null,544)])]))}}),rb=vs(ib,[["__scopeId","data-v-23379791"]]);function T(i,t,e){return(t=function(s){var n=function(r,o){if(typeof r!="object"||!r)return r;var a=r[Symbol.toPrimitive];if(a!==void 0){var l=a.call(r,o);if(typeof l!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(r)}(s,"string");return typeof n=="symbol"?n:n+""}(t))in i?Object.defineProperty(i,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):i[t]=e,i}function of(i,t){var e=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);t&&(s=s.filter(function(n){return Object.getOwnPropertyDescriptor(i,n).enumerable})),e.push.apply(e,s)}return e}function w(i){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?of(Object(e),!0).forEach(function(s){T(i,s,e[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(e)):of(Object(e)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(e,s))})}return i}function It(i,t){if(i==null)return{};var e,s,n=function(o,a){if(o==null)return{};var l={};for(var c in o)if({}.hasOwnProperty.call(o,c)){if(a.indexOf(c)>=0)continue;l[c]=o[c]}return l}(i,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(i);for(s=0;s<r.length;s++)e=r[s],t.indexOf(e)>=0||{}.propertyIsEnumerable.call(i,e)&&(n[e]=i[e])}return n}function Yn(i,t){return t||(t=i.slice(0)),Object.freeze(Object.defineProperties(i,{raw:{value:Object.freeze(t)}}))}class af{constructor(){T(this,"browserShadowBlurConstant",1),T(this,"DPI",96),T(this,"devicePixelRatio",typeof window<"u"?window.devicePixelRatio:1),T(this,"perfLimitSizeTotal",2097152),T(this,"maxCacheSideLimit",4096),T(this,"minCacheSideLimit",256),T(this,"disableStyleCopyPaste",!1),T(this,"enableGLFiltering",!0),T(this,"textureSize",4096),T(this,"forceGLPutImageData",!1),T(this,"cachesBoundsOfCurve",!1),T(this,"fontPaths",{}),T(this,"NUM_FRACTION_DIGITS",4)}}const _t=new class extends af{constructor(i){super(),this.configure(i)}configure(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Object.assign(this,i)}addFonts(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.fontPaths=w(w({},this.fontPaths),i)}removeFonts(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(i=>{delete this.fontPaths[i]})}clearFonts(){this.fontPaths={}}restoreDefaults(i){const t=new af,e=(i==null?void 0:i.reduce((s,n)=>(s[n]=t[n],s),{}))||t;this.configure(e)}},jn=function(i){for(var t=arguments.length,e=new Array(t>1?t-1:0),s=1;s<t;s++)e[s-1]=arguments[s];return console[i]("fabric",...e)};class Ns extends Error{constructor(t,e){super("fabric: ".concat(t),e)}}class Bg extends Ns{constructor(t){super("".concat(t," 'options.signal' is in 'aborted' state"))}}class ob{}class ab extends ob{testPrecision(t,e){const s="precision ".concat(e,` float;
void main(){}`),n=t.createShader(t.FRAGMENT_SHADER);return!!n&&(t.shaderSource(n,s),t.compileShader(n),!!t.getShaderParameter(n,t.COMPILE_STATUS))}queryWebGL(t){const e=t.getContext("webgl");e&&(this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.GLPrecision=["highp","mediump","lowp"].find(s=>this.testPrecision(e,s)),e.getExtension("WEBGL_lose_context").loseContext(),jn("log","WebGL: max texture size ".concat(this.maxTextureSize)))}isSupported(t){return!!this.maxTextureSize&&this.maxTextureSize>=t}}const lb={};let lf;const Ks=()=>lf||(lf={document,window,isTouchSupported:"ontouchstart"in window||"ontouchstart"in document||window&&window.navigator&&window.navigator.maxTouchPoints>0,WebGLProbe:new ab,dispose(){},copyPasteData:lb}),ur=()=>Ks().document,ol=()=>Ks().window,Ng=()=>{var i;return Math.max((i=_t.devicePixelRatio)!==null&&i!==void 0?i:ol().devicePixelRatio,1)},Br=new class{constructor(){T(this,"charWidthsCache",{}),T(this,"boundsOfCurveCache",{})}getFontCache(i){let{fontFamily:t,fontStyle:e,fontWeight:s}=i;t=t.toLowerCase(),this.charWidthsCache[t]||(this.charWidthsCache[t]={});const n=this.charWidthsCache[t],r="".concat(e.toLowerCase(),"_").concat((s+"").toLowerCase());return n[r]||(n[r]={}),n[r]}clearFontCache(i){(i=(i||"").toLowerCase())?this.charWidthsCache[i]&&delete this.charWidthsCache[i]:this.charWidthsCache={}}limitDimsByArea(i){const{perfLimitSizeTotal:t}=_t,e=Math.sqrt(t*i);return[Math.floor(e),Math.floor(t/e)]}},Tc="6.6.1";function li(){}const In=Math.PI/2,fn=2*Math.PI,xh=Math.PI/180,ke=Object.freeze([1,0,0,1,0,0]),Ch=16,bn=.4477152502,gt="center",wt="left",De="top",Oc="bottom",$t="right",Re="none",Sh=/\r?\n/,Hg="moving",al="scaling",zg="rotating",wh="rotate",Vg="skewing",eo="resizing",Wg="modifyPoly",cb="modifyPath",xa="changed",ll="scale",Pe="scaleX",es="scaleY",fr="skewX",dr="skewY",ee="fill",Le="stroke",Ca="modified",Mi="json",jl="svg",q=new class{constructor(){this[Mi]=new Map,this[jl]=new Map}has(i){return this[Mi].has(i)}getClass(i){const t=this[Mi].get(i);if(!t)throw new Ns("No class registered for ".concat(i));return t}setClass(i,t){t?this[Mi].set(t,i):(this[Mi].set(i.type,i),this[Mi].set(i.type.toLowerCase(),i))}getSVGClass(i){return this[jl].get(i)}setSVGClass(i,t){this[jl].set(t??i.type.toLowerCase(),i)}},Sa=new class extends Array{remove(i){const t=this.indexOf(i);t>-1&&this.splice(t,1)}cancelAll(){const i=this.splice(0);return i.forEach(t=>t.abort()),i}cancelByCanvas(i){if(!i)return[];const t=this.filter(e=>{var s;return e.target===i||typeof e.target=="object"&&((s=e.target)===null||s===void 0?void 0:s.canvas)===i});return t.forEach(e=>e.abort()),t}cancelByTarget(i){if(!i)return[];const t=this.filter(e=>e.target===i);return t.forEach(e=>e.abort()),t}};class hb{constructor(){T(this,"__eventListeners",{})}on(t,e){if(this.__eventListeners||(this.__eventListeners={}),typeof t=="object")return Object.entries(t).forEach(s=>{let[n,r]=s;this.on(n,r)}),()=>this.off(t);if(e){const s=t;return this.__eventListeners[s]||(this.__eventListeners[s]=[]),this.__eventListeners[s].push(e),()=>this.off(s,e)}return()=>!1}once(t,e){if(typeof t=="object"){const s=[];return Object.entries(t).forEach(n=>{let[r,o]=n;s.push(this.once(r,o))}),()=>s.forEach(n=>n())}if(e){const s=this.on(t,function(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];e.call(this,...r),s()});return s}return()=>!1}_removeEventListener(t,e){if(this.__eventListeners[t])if(e){const s=this.__eventListeners[t],n=s.indexOf(e);n>-1&&s.splice(n,1)}else this.__eventListeners[t]=[]}off(t,e){if(this.__eventListeners)if(t===void 0)for(const s in this.__eventListeners)this._removeEventListener(s);else typeof t=="object"?Object.entries(t).forEach(s=>{let[n,r]=s;this._removeEventListener(n,r)}):this._removeEventListener(t,e)}fire(t,e){var s;if(!this.__eventListeners)return;const n=(s=this.__eventListeners[t])===null||s===void 0?void 0:s.concat();if(n)for(let r=0;r<n.length;r++)n[r].call(this,e||{})}}const ei=(i,t)=>{const e=i.indexOf(t);return e!==-1&&i.splice(e,1),i},Os=i=>{if(i===0)return 1;switch(Math.abs(i)/In){case 1:case 3:return 0;case 2:return-1}return Math.cos(i)},Ms=i=>{if(i===0)return 0;const t=i/In,e=Math.sign(i);switch(t){case 1:return e;case 2:return 0;case 3:return-e}return Math.sin(i)};class E{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;typeof t=="object"?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e)}add(t){return new E(this.x+t.x,this.y+t.y)}addEquals(t){return this.x+=t.x,this.y+=t.y,this}scalarAdd(t){return new E(this.x+t,this.y+t)}scalarAddEquals(t){return this.x+=t,this.y+=t,this}subtract(t){return new E(this.x-t.x,this.y-t.y)}subtractEquals(t){return this.x-=t.x,this.y-=t.y,this}scalarSubtract(t){return new E(this.x-t,this.y-t)}scalarSubtractEquals(t){return this.x-=t,this.y-=t,this}multiply(t){return new E(this.x*t.x,this.y*t.y)}scalarMultiply(t){return new E(this.x*t,this.y*t)}scalarMultiplyEquals(t){return this.x*=t,this.y*=t,this}divide(t){return new E(this.x/t.x,this.y/t.y)}scalarDivide(t){return new E(this.x/t,this.y/t)}scalarDivideEquals(t){return this.x/=t,this.y/=t,this}eq(t){return this.x===t.x&&this.y===t.y}lt(t){return this.x<t.x&&this.y<t.y}lte(t){return this.x<=t.x&&this.y<=t.y}gt(t){return this.x>t.x&&this.y>t.y}gte(t){return this.x>=t.x&&this.y>=t.y}lerp(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:.5;return e=Math.max(Math.min(1,e),0),new E(this.x+(t.x-this.x)*e,this.y+(t.y-this.y)*e)}distanceFrom(t){const e=this.x-t.x,s=this.y-t.y;return Math.sqrt(e*e+s*s)}midPointFrom(t){return this.lerp(t)}min(t){return new E(Math.min(this.x,t.x),Math.min(this.y,t.y))}max(t){return new E(Math.max(this.x,t.x),Math.max(this.y,t.y))}toString(){return"".concat(this.x,",").concat(this.y)}setXY(t,e){return this.x=t,this.y=e,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setFromPoint(t){return this.x=t.x,this.y=t.y,this}swap(t){const e=this.x,s=this.y;this.x=t.x,this.y=t.y,t.x=e,t.y=s}clone(){return new E(this.x,this.y)}rotate(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Th;const s=Ms(t),n=Os(t),r=this.subtract(e);return new E(r.x*n-r.y*s,r.x*s+r.y*n).add(e)}transform(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new E(t[0]*this.x+t[2]*this.y+(e?0:t[4]),t[1]*this.x+t[3]*this.y+(e?0:t[5]))}}const Th=new E(0,0),na=i=>!!i&&Array.isArray(i._objects);function Yg(i){class t extends i{constructor(){super(...arguments),T(this,"_objects",[])}_onObjectAdded(s){}_onObjectRemoved(s){}_onStackOrderChanged(s){}add(){for(var s=arguments.length,n=new Array(s),r=0;r<s;r++)n[r]=arguments[r];const o=this._objects.push(...n);return n.forEach(a=>this._onObjectAdded(a)),o}insertAt(s){for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return this._objects.splice(s,0,...r),r.forEach(a=>this._onObjectAdded(a)),this._objects.length}remove(){const s=this._objects,n=[];for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return o.forEach(l=>{const c=s.indexOf(l);c!==-1&&(s.splice(c,1),n.push(l),this._onObjectRemoved(l))}),n}forEachObject(s){this.getObjects().forEach((n,r,o)=>s(n,r,o))}getObjects(){for(var s=arguments.length,n=new Array(s),r=0;r<s;r++)n[r]=arguments[r];return n.length===0?[...this._objects]:this._objects.filter(o=>o.isType(...n))}item(s){return this._objects[s]}isEmpty(){return this._objects.length===0}size(){return this._objects.length}contains(s,n){return!!this._objects.includes(s)||!!n&&this._objects.some(r=>r instanceof t&&r.contains(s,!0))}complexity(){return this._objects.reduce((s,n)=>s+=n.complexity?n.complexity():0,0)}sendObjectToBack(s){return!(!s||s===this._objects[0])&&(ei(this._objects,s),this._objects.unshift(s),this._onStackOrderChanged(s),!0)}bringObjectToFront(s){return!(!s||s===this._objects[this._objects.length-1])&&(ei(this._objects,s),this._objects.push(s),this._onStackOrderChanged(s),!0)}sendObjectBackwards(s,n){if(!s)return!1;const r=this._objects.indexOf(s);if(r!==0){const o=this.findNewLowerIndex(s,r,n);return ei(this._objects,s),this._objects.splice(o,0,s),this._onStackOrderChanged(s),!0}return!1}bringObjectForward(s,n){if(!s)return!1;const r=this._objects.indexOf(s);if(r!==this._objects.length-1){const o=this.findNewUpperIndex(s,r,n);return ei(this._objects,s),this._objects.splice(o,0,s),this._onStackOrderChanged(s),!0}return!1}moveObjectTo(s,n){return s!==this._objects[n]&&(ei(this._objects,s),this._objects.splice(n,0,s),this._onStackOrderChanged(s),!0)}findNewLowerIndex(s,n,r){let o;if(r){o=n;for(let a=n-1;a>=0;--a)if(s.isOverlapping(this._objects[a])){o=a;break}}else o=n-1;return o}findNewUpperIndex(s,n,r){let o;if(r){o=n;for(let a=n+1;a<this._objects.length;++a)if(s.isOverlapping(this._objects[a])){o=a;break}}else o=n+1;return o}collectObjects(s){let{left:n,top:r,width:o,height:a}=s,{includeIntersecting:l=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const c=[],h=new E(n,r),u=h.add(new E(o,a));for(let f=this._objects.length-1;f>=0;f--){const d=this._objects[f];d.selectable&&d.visible&&(l&&d.intersectsWithRect(h,u)||d.isContainedWithinRect(h,u)||l&&d.containsPoint(h)||l&&d.containsPoint(u))&&c.push(d)}return c}}return t}class Xg extends hb{_setOptions(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};for(const e in t)this.set(e,t[e])}_setObject(t){for(const e in t)this._set(e,t[e])}set(t,e){return typeof t=="object"?this._setObject(t):this._set(t,e),this}_set(t,e){this[t]=e}toggle(t){const e=this.get(t);return typeof e=="boolean"&&this.set(t,!e),this}get(t){return this[t]}}function Nr(i){return ol().requestAnimationFrame(i)}function Ug(i){return ol().cancelAnimationFrame(i)}let ub=0;const Bn=()=>ub++,ms=()=>{const i=ur().createElement("canvas");if(!i||i.getContext===void 0)throw new Ns("Failed to create `canvas` element");return i},Gg=()=>ur().createElement("img"),Es=i=>{const t=ms();return t.width=i.width,t.height=i.height,t},Oh=(i,t,e)=>i.toDataURL("image/".concat(t),e),Mh=(i,t,e)=>new Promise((s,n)=>{i.toBlob(s,"image/".concat(t),e)}),Yt=i=>i*xh,Nn=i=>i/xh,$g=i=>i.every((t,e)=>t===ke[e]),ue=(i,t,e)=>new E(i).transform(t,e),Ke=i=>{const t=1/(i[0]*i[3]-i[1]*i[2]),e=[t*i[3],-t*i[1],-t*i[2],t*i[0],0,0],{x:s,y:n}=new E(i[4],i[5]).transform(e,!0);return e[4]=-s,e[5]=-n,e},Xt=(i,t,e)=>[i[0]*t[0]+i[2]*t[1],i[1]*t[0]+i[3]*t[1],i[0]*t[2]+i[2]*t[3],i[1]*t[2]+i[3]*t[3],e?0:i[0]*t[4]+i[2]*t[5]+i[4],e?0:i[1]*t[4]+i[3]*t[5]+i[5]],cl=(i,t)=>i.reduceRight((e,s)=>s&&e?Xt(s,e,t):s||e,void 0)||ke.concat(),qg=i=>{let[t,e]=i;return Math.atan2(e,t)},tr=i=>{const t=qg(i),e=Math.pow(i[0],2)+Math.pow(i[1],2),s=Math.sqrt(e),n=(i[0]*i[3]-i[2]*i[1])/s,r=Math.atan2(i[0]*i[2]+i[1]*i[3],e);return{angle:Nn(t),scaleX:s,scaleY:n,skewX:Nn(r),skewY:0,translateX:i[4]||0,translateY:i[5]||0}},gr=function(i){return[1,0,0,1,i,arguments.length>1&&arguments[1]!==void 0?arguments[1]:0]};function pr(){let{angle:i=0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{x:t=0,y:e=0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=Yt(i),n=Os(s),r=Ms(s);return[n,r,-r,n,t?t-(n*t-r*e):0,e?e-(r*t+n*e):0]}const hl=function(i){return[i,0,0,arguments.length>1&&arguments[1]!==void 0?arguments[1]:i,0,0]},Kg=i=>Math.tan(Yt(i)),Eh=i=>[1,0,Kg(i),1,0,0],kh=i=>[1,Kg(i),0,1,0,0],_o=i=>{let{scaleX:t=1,scaleY:e=1,flipX:s=!1,flipY:n=!1,skewX:r=0,skewY:o=0}=i,a=hl(s?-t:t,n?-e:e);return r&&(a=Xt(a,Eh(r),!0)),o&&(a=Xt(a,kh(o),!0)),a},Zg=i=>{const{translateX:t=0,translateY:e=0,angle:s=0}=i;let n=gr(t,e);s&&(n=Xt(n,pr({angle:s})));const r=_o(i);return $g(r)||(n=Xt(n,r)),n},Hr=function(i){let{signal:t,crossOrigin:e=null}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new Promise(function(s,n){if(t&&t.aborted)return n(new Bg("loadImage"));const r=Gg();let o;t&&(o=function(l){r.src="",n(l)},t.addEventListener("abort",o,{once:!0}));const a=function(){r.onload=r.onerror=null,o&&(t==null||t.removeEventListener("abort",o)),s(r)};i?(r.onload=a,r.onerror=function(){o&&(t==null||t.removeEventListener("abort",o)),n(new Ns("Error loading ".concat(r.src)))},e&&(r.crossOrigin=e),r.src=i):a()})},er=function(i){let{signal:t,reviver:e=li}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new Promise((s,n)=>{const r=[];t&&t.addEventListener("abort",n,{once:!0}),Promise.all(i.map(o=>q.getClass(o.type).fromObject(o,{signal:t}).then(a=>(e(o,a),r.push(a),a)))).then(s).catch(o=>{r.forEach(a=>{a.dispose&&a.dispose()}),n(o)}).finally(()=>{t&&t.removeEventListener("abort",n)})})},yo=function(i){let{signal:t}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new Promise((e,s)=>{const n=[];t&&t.addEventListener("abort",s,{once:!0});const r=Object.values(i).map(a=>a&&a.type&&q.has(a.type)?er([a],{signal:t}).then(l=>{let[c]=l;return n.push(c),c}):a),o=Object.keys(i);Promise.all(r).then(a=>a.reduce((l,c,h)=>(l[o[h]]=c,l),{})).then(e).catch(a=>{n.forEach(l=>{l.dispose&&l.dispose()}),s(a)}).finally(()=>{t&&t.removeEventListener("abort",s)})})},Ci=function(i){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:[]).reduce((t,e)=>(e in i&&(t[e]=i[e]),t),{})},Ph=(i,t)=>Object.keys(i).reduce((e,s)=>(t(i[s],s,i)&&(e[s]=i[s]),e),{}),cf={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#0FF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000",blanchedalmond:"#FFEBCD",blue:"#00F",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#0FF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#F0F",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#789",lightslategrey:"#789",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#0F0",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#F0F",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#639",red:"#F00",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFF",whitesmoke:"#F5F5F5",yellow:"#FF0",yellowgreen:"#9ACD32"},Il=(i,t,e)=>(e<0&&(e+=1),e>1&&(e-=1),e<1/6?i+6*(t-i)*e:e<.5?t:e<2/3?i+(t-i)*(2/3-e)*6:i),hf=(i,t,e,s)=>{i/=255,t/=255,e/=255;const n=Math.max(i,t,e),r=Math.min(i,t,e);let o,a;const l=(n+r)/2;if(n===r)o=a=0;else{const c=n-r;switch(a=l>.5?c/(2-n-r):c/(n+r),n){case i:o=(t-e)/c+(t<e?6:0);break;case t:o=(e-i)/c+2;break;case e:o=(i-t)/c+4}o/=6}return[Math.round(360*o),Math.round(100*a),Math.round(100*l),s]},uf=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"1";return parseFloat(i)/(i.endsWith("%")?100:1)},Oo=i=>Math.min(Math.round(i),255).toString(16).toUpperCase().padStart(2,"0"),ff=i=>{let[t,e,s,n=1]=i;const r=Math.round(.3*t+.59*e+.11*s);return[r,r,r,n]};class Mt{constructor(t){if(T(this,"isUnrecognised",!1),t)if(t instanceof Mt)this.setSource([...t._source]);else if(Array.isArray(t)){const[e,s,n,r=1]=t;this.setSource([e,s,n,r])}else this.setSource(this._tryParsingColor(t));else this.setSource([0,0,0,1])}_tryParsingColor(t){return(t=t.toLowerCase())in cf&&(t=cf[t]),t==="transparent"?[255,255,255,0]:Mt.sourceFromHex(t)||Mt.sourceFromRgb(t)||Mt.sourceFromHsl(t)||(this.isUnrecognised=!0)&&[0,0,0,1]}getSource(){return this._source}setSource(t){this._source=t}toRgb(){const[t,e,s]=this.getSource();return"rgb(".concat(t,",").concat(e,",").concat(s,")")}toRgba(){return"rgba(".concat(this.getSource().join(","),")")}toHsl(){const[t,e,s]=hf(...this.getSource());return"hsl(".concat(t,",").concat(e,"%,").concat(s,"%)")}toHsla(){const[t,e,s,n]=hf(...this.getSource());return"hsla(".concat(t,",").concat(e,"%,").concat(s,"%,").concat(n,")")}toHex(){return this.toHexa().slice(0,6)}toHexa(){const[t,e,s,n]=this.getSource();return"".concat(Oo(t)).concat(Oo(e)).concat(Oo(s)).concat(Oo(Math.round(255*n)))}getAlpha(){return this.getSource()[3]}setAlpha(t){return this._source[3]=t,this}toGrayscale(){return this.setSource(ff(this.getSource())),this}toBlackWhite(t){const[e,,,s]=ff(this.getSource()),n=e<(t||127)?0:255;return this.setSource([n,n,n,s]),this}overlayWith(t){t instanceof Mt||(t=new Mt(t));const e=this.getSource(),s=t.getSource(),[n,r,o]=e.map((a,l)=>Math.round(.5*a+.5*s[l]));return this.setSource([n,r,o,e[3]]),this}static fromRgb(t){return Mt.fromRgba(t)}static fromRgba(t){return new Mt(Mt.sourceFromRgb(t))}static sourceFromRgb(t){const e=t.match(/^rgba?\(\s*(\d{0,3}(?:\.\d+)?%?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*(?:\s*[,/]\s*(\d{0,3}(?:\.\d+)?%?)\s*)?\)$/i);if(e){const[s,n,r]=e.slice(1,4).map(o=>{const a=parseFloat(o);return o.endsWith("%")?Math.round(2.55*a):a});return[s,n,r,uf(e[4])]}}static fromHsl(t){return Mt.fromHsla(t)}static fromHsla(t){return new Mt(Mt.sourceFromHsl(t))}static sourceFromHsl(t){const e=t.match(/^hsla?\(\s*([+-]?\d{0,3}(?:\.\d+)?(?:deg|turn|rad)?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*(?:\s*[,/]\s*(\d*(?:\.\d+)?%?)\s*)?\)$/i);if(!e)return;const s=(Mt.parseAngletoDegrees(e[1])%360+360)%360/360,n=parseFloat(e[2])/100,r=parseFloat(e[3])/100;let o,a,l;if(n===0)o=a=l=r;else{const c=r<=.5?r*(n+1):r+n-r*n,h=2*r-c;o=Il(h,c,s+1/3),a=Il(h,c,s),l=Il(h,c,s-1/3)}return[Math.round(255*o),Math.round(255*a),Math.round(255*l),uf(e[4])]}static fromHex(t){return new Mt(Mt.sourceFromHex(t))}static sourceFromHex(t){if(t.match(/^#?(([0-9a-f]){3,4}|([0-9a-f]{2}){3,4})$/i)){const e=t.slice(t.indexOf("#")+1);let s;s=e.length<=4?e.split("").map(l=>l+l):e.match(/.{2}/g);const[n,r,o,a=255]=s.map(l=>parseInt(l,16));return[n,r,o,a/255]}}static parseAngletoDegrees(t){const e=t.toLowerCase(),s=parseFloat(e);return e.includes("rad")?Nn(s):e.includes("turn")?360*s:s}}const jt=(i,t)=>parseFloat(Number(i).toFixed(t)),ci=function(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ch;const e=/\D{0,2}$/.exec(i),s=parseFloat(i),n=_t.DPI;switch(e==null?void 0:e[0]){case"mm":return s*n/25.4;case"cm":return s*n/2.54;case"in":return s*n;case"pt":return s*n/72;case"pc":return s*n/72*12;case"em":return s*t;default:return s}},Jg=i=>{const[t,e]=i.trim().split(" "),[s,n]=(r=t)&&r!==Re?[r.slice(1,4),r.slice(5,8)]:r===Re?[r,r]:["Mid","Mid"];var r;return{meetOrSlice:e||"meet",alignX:s,alignY:n}},so=i=>"matrix("+i.map(t=>jt(t,_t.NUM_FRACTION_DIGITS)).join(" ")+")",no=function(i,t){let e,s,n=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2];if(t)if(t.toLive)e="url(#SVGID_".concat(t.id,")");else{const r=new Mt(t),o=r.getAlpha();e=r.toRgb(),o!==1&&(s=o.toString())}else e="none";return n?"".concat(i,": ").concat(e,"; ").concat(s?"".concat(i,"-opacity: ").concat(s,"; "):""):"".concat(i,'="').concat(e,'" ').concat(s?"".concat(i,'-opacity="').concat(s,'" '):"")},ls=i=>!!i&&i.toLive!==void 0,df=i=>!!i&&typeof i.toObject=="function",gf=i=>!!i&&i.offsetX!==void 0&&"source"in i,si=i=>!!i&&"multiSelectionStacking"in i;function Qg(i){const t=i&&ys(i);let e=0,s=0;if(!i||!t)return{left:e,top:s};let n=i;const r=t.documentElement,o=t.body||{scrollLeft:0,scrollTop:0};for(;n&&(n.parentNode||n.host)&&(n=n.parentNode||n.host,n===t?(e=o.scrollLeft||r.scrollLeft||0,s=o.scrollTop||r.scrollTop||0):(e+=n.scrollLeft||0,s+=n.scrollTop||0),n.nodeType!==1||n.style.position!=="fixed"););return{left:e,top:s}}const ys=i=>i.ownerDocument||null,tp=i=>{var t;return((t=i.ownerDocument)===null||t===void 0?void 0:t.defaultView)||null},ep=function(i,t,e){let{width:s,height:n}=e,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;i.width=s,i.height=n,r>1&&(i.setAttribute("width",(s*r).toString()),i.setAttribute("height",(n*r).toString()),t.scale(r,r))},Mc=(i,t)=>{let{width:e,height:s}=t;e&&(i.style.width=typeof e=="number"?"".concat(e,"px"):e),s&&(i.style.height=typeof s=="number"?"".concat(s,"px"):s)};function pf(i){return i.onselectstart!==void 0&&(i.onselectstart=()=>!1),i.style.userSelect=Re,i}class sp{constructor(t){T(this,"_originalCanvasStyle",void 0),T(this,"lower",void 0);const e=this.createLowerCanvas(t);this.lower={el:e,ctx:e.getContext("2d")}}createLowerCanvas(t){const e=(s=t)&&s.getContext!==void 0?t:t&&ur().getElementById(t)||ms();var s;if(e.hasAttribute("data-fabric"))throw new Ns("Trying to initialize a canvas that has already been initialized. Did you forget to dispose the canvas?");return this._originalCanvasStyle=e.style.cssText,e.setAttribute("data-fabric","main"),e.classList.add("lower-canvas"),e}cleanupDOM(t){let{width:e,height:s}=t;const{el:n}=this.lower;n.classList.remove("lower-canvas"),n.removeAttribute("data-fabric"),n.setAttribute("width","".concat(e)),n.setAttribute("height","".concat(s)),n.style.cssText=this._originalCanvasStyle||"",this._originalCanvasStyle=void 0}setDimensions(t,e){const{el:s,ctx:n}=this.lower;ep(s,n,t,e)}setCSSDimensions(t){Mc(this.lower.el,t)}calcOffset(){return function(t){var e;const s=t&&ys(t),n={left:0,top:0};if(!s)return n;const r=((e=tp(t))===null||e===void 0?void 0:e.getComputedStyle(t,null))||{};n.left+=parseInt(r.borderLeftWidth,10)||0,n.top+=parseInt(r.borderTopWidth,10)||0,n.left+=parseInt(r.paddingLeft,10)||0,n.top+=parseInt(r.paddingTop,10)||0;let o={left:0,top:0};const a=s.documentElement;t.getBoundingClientRect!==void 0&&(o=t.getBoundingClientRect());const l=Qg(t);return{left:o.left+l.left-(a.clientLeft||0)+n.left,top:o.top+l.top-(a.clientTop||0)+n.top}}(this.lower.el)}dispose(){Ks().dispose(this.lower.el),delete this.lower}}const fb={backgroundVpt:!0,backgroundColor:"",overlayVpt:!0,overlayColor:"",includeDefaultValues:!0,svgViewportTransformation:!0,renderOnAddRemove:!0,skipOffscreen:!0,enableRetinaScaling:!0,imageSmoothingEnabled:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,viewportTransform:[...ke]};class bo extends Yg(Xg){get lowerCanvasEl(){var t;return(t=this.elements.lower)===null||t===void 0?void 0:t.el}get contextContainer(){var t;return(t=this.elements.lower)===null||t===void 0?void 0:t.ctx}static getDefaults(){return bo.ownDefaults}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Object.assign(this,this.constructor.getDefaults()),this.set(e),this.initElements(t),this._setDimensionsImpl({width:this.width||this.elements.lower.el.width||0,height:this.height||this.elements.lower.el.height||0}),this.skipControlsDrawing=!1,this.viewportTransform=[...this.viewportTransform],this.calcViewportBoundaries()}initElements(t){this.elements=new sp(t)}add(){const t=super.add(...arguments);return arguments.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),t}insertAt(t){for(var e=arguments.length,s=new Array(e>1?e-1:0),n=1;n<e;n++)s[n-1]=arguments[n];const r=super.insertAt(t,...s);return s.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),r}remove(){const t=super.remove(...arguments);return t.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),t}_onObjectAdded(t){t.canvas&&t.canvas!==this&&(jn("warn",`Canvas is trying to add an object that belongs to a different canvas.
Resulting to default behavior: removing object from previous canvas and adding to new canvas`),t.canvas.remove(t)),t._set("canvas",this),t.setCoords(),this.fire("object:added",{target:t}),t.fire("added",{target:this})}_onObjectRemoved(t){t._set("canvas",void 0),this.fire("object:removed",{target:t}),t.fire("removed",{target:this})}_onStackOrderChanged(){this.renderOnAddRemove&&this.requestRenderAll()}getRetinaScaling(){return this.enableRetinaScaling?Ng():1}calcOffset(){return this._offset=this.elements.calcOffset()}getWidth(){return this.width}getHeight(){return this.height}setWidth(t,e){return this.setDimensions({width:t},e)}setHeight(t,e){return this.setDimensions({height:t},e)}_setDimensionsImpl(t){let{cssOnly:e=!1,backstoreOnly:s=!1}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!e){const n=w({width:this.width,height:this.height},t);this.elements.setDimensions(n,this.getRetinaScaling()),this.hasLostContext=!0,this.width=n.width,this.height=n.height}s||this.elements.setCSSDimensions(t),this.calcOffset()}setDimensions(t,e){this._setDimensionsImpl(t,e),e&&e.cssOnly||this.requestRenderAll()}getZoom(){return this.viewportTransform[0]}setViewportTransform(t){this.viewportTransform=t,this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll()}zoomToPoint(t,e){const s=t,n=[...this.viewportTransform],r=ue(t,Ke(n));n[0]=e,n[3]=e;const o=ue(r,n);n[4]+=s.x-o.x,n[5]+=s.y-o.y,this.setViewportTransform(n)}setZoom(t){this.zoomToPoint(new E(0,0),t)}absolutePan(t){const e=[...this.viewportTransform];return e[4]=-t.x,e[5]=-t.y,this.setViewportTransform(e)}relativePan(t){return this.absolutePan(new E(-t.x-this.viewportTransform[4],-t.y-this.viewportTransform[5]))}getElement(){return this.elements.lower.el}clearContext(t){t.clearRect(0,0,this.width,this.height)}getContext(){return this.elements.lower.ctx}clear(){this.remove(...this.getObjects()),this.backgroundImage=void 0,this.overlayImage=void 0,this.backgroundColor="",this.overlayColor="",this.clearContext(this.getContext()),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll()}renderAll(){this.cancelRequestedRender(),this.destroyed||this.renderCanvas(this.getContext(),this._objects)}renderAndReset(){this.nextRenderHandle=0,this.renderAll()}requestRenderAll(){this.nextRenderHandle||this.disposed||this.destroyed||(this.nextRenderHandle=Nr(()=>this.renderAndReset()))}calcViewportBoundaries(){const t=this.width,e=this.height,s=Ke(this.viewportTransform),n=ue({x:0,y:0},s),r=ue({x:t,y:e},s),o=n.min(r),a=n.max(r);return this.vptCoords={tl:o,tr:new E(a.x,o.y),bl:new E(o.x,a.y),br:a}}cancelRequestedRender(){this.nextRenderHandle&&(Ug(this.nextRenderHandle),this.nextRenderHandle=0)}drawControls(t){}renderCanvas(t,e){if(this.destroyed)return;const s=this.viewportTransform,n=this.clipPath;this.calcViewportBoundaries(),this.clearContext(t),t.imageSmoothingEnabled=this.imageSmoothingEnabled,t.patternQuality="best",this.fire("before:render",{ctx:t}),this._renderBackground(t),t.save(),t.transform(s[0],s[1],s[2],s[3],s[4],s[5]),this._renderObjects(t,e),t.restore(),this.controlsAboveOverlay||this.skipControlsDrawing||this.drawControls(t),n&&(n._set("canvas",this),n.shouldCache(),n._transformDone=!0,n.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(t,n)),this._renderOverlay(t),this.controlsAboveOverlay&&!this.skipControlsDrawing&&this.drawControls(t),this.fire("after:render",{ctx:t}),this.__cleanupTask&&(this.__cleanupTask(),this.__cleanupTask=void 0)}drawClipPathOnCanvas(t,e){const s=this.viewportTransform;t.save(),t.transform(...s),t.globalCompositeOperation="destination-in",e.transform(t),t.scale(1/e.zoomX,1/e.zoomY),t.drawImage(e._cacheCanvas,-e.cacheTranslationX,-e.cacheTranslationY),t.restore()}_renderObjects(t,e){for(let s=0,n=e.length;s<n;++s)e[s]&&e[s].render(t)}_renderBackgroundOrOverlay(t,e){const s=this["".concat(e,"Color")],n=this["".concat(e,"Image")],r=this.viewportTransform,o=this["".concat(e,"Vpt")];if(!s&&!n)return;const a=ls(s);if(s){if(t.save(),t.beginPath(),t.moveTo(0,0),t.lineTo(this.width,0),t.lineTo(this.width,this.height),t.lineTo(0,this.height),t.closePath(),t.fillStyle=a?s.toLive(t):s,o&&t.transform(...r),a){t.transform(1,0,0,1,s.offsetX||0,s.offsetY||0);const l=s.gradientTransform||s.patternTransform;l&&t.transform(...l)}t.fill(),t.restore()}if(n){t.save();const{skipOffscreen:l}=this;this.skipOffscreen=o,o&&t.transform(...r),n.render(t),this.skipOffscreen=l,t.restore()}}_renderBackground(t){this._renderBackgroundOrOverlay(t,"background")}_renderOverlay(t){this._renderBackgroundOrOverlay(t,"overlay")}getCenter(){return{top:this.height/2,left:this.width/2}}getCenterPoint(){return new E(this.width/2,this.height/2)}centerObjectH(t){return this._centerObject(t,new E(this.getCenterPoint().x,t.getCenterPoint().y))}centerObjectV(t){return this._centerObject(t,new E(t.getCenterPoint().x,this.getCenterPoint().y))}centerObject(t){return this._centerObject(t,this.getCenterPoint())}viewportCenterObject(t){return this._centerObject(t,this.getVpCenter())}viewportCenterObjectH(t){return this._centerObject(t,new E(this.getVpCenter().x,t.getCenterPoint().y))}viewportCenterObjectV(t){return this._centerObject(t,new E(t.getCenterPoint().x,this.getVpCenter().y))}getVpCenter(){return ue(this.getCenterPoint(),Ke(this.viewportTransform))}_centerObject(t,e){t.setXY(e,gt,gt),t.setCoords(),this.renderOnAddRemove&&this.requestRenderAll()}toDatalessJSON(t){return this.toDatalessObject(t)}toObject(t){return this._toObjectMethod("toObject",t)}toJSON(){return this.toObject()}toDatalessObject(t){return this._toObjectMethod("toDatalessObject",t)}_toObjectMethod(t,e){const s=this.clipPath,n=s&&!s.excludeFromExport?this._toObject(s,t,e):null;return w(w(w({version:Tc},Ci(this,e)),{},{objects:this._objects.filter(r=>!r.excludeFromExport).map(r=>this._toObject(r,t,e))},this.__serializeBgOverlay(t,e)),n?{clipPath:n}:null)}_toObject(t,e,s){let n;this.includeDefaultValues||(n=t.includeDefaultValues,t.includeDefaultValues=!1);const r=t[e](s);return this.includeDefaultValues||(t.includeDefaultValues=!!n),r}__serializeBgOverlay(t,e){const s={},n=this.backgroundImage,r=this.overlayImage,o=this.backgroundColor,a=this.overlayColor;return ls(o)?o.excludeFromExport||(s.background=o.toObject(e)):o&&(s.background=o),ls(a)?a.excludeFromExport||(s.overlay=a.toObject(e)):a&&(s.overlay=a),n&&!n.excludeFromExport&&(s.backgroundImage=this._toObject(n,t,e)),r&&!r.excludeFromExport&&(s.overlayImage=this._toObject(r,t,e)),s}toSVG(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0;t.reviver=e;const s=[];return this._setSVGPreamble(s,t),this._setSVGHeader(s,t),this.clipPath&&s.push('<g clip-path="url(#'.concat(this.clipPath.clipPathId,`)" >
`)),this._setSVGBgOverlayColor(s,"background"),this._setSVGBgOverlayImage(s,"backgroundImage",e),this._setSVGObjects(s,e),this.clipPath&&s.push(`</g>
`),this._setSVGBgOverlayColor(s,"overlay"),this._setSVGBgOverlayImage(s,"overlayImage",e),s.push("</svg>"),s.join("")}_setSVGPreamble(t,e){e.suppressPreamble||t.push('<?xml version="1.0" encoding="',e.encoding||"UTF-8",`" standalone="no" ?>
`,'<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ',`"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
`)}_setSVGHeader(t,e){const s=e.width||"".concat(this.width),n=e.height||"".concat(this.height),r=_t.NUM_FRACTION_DIGITS,o=e.viewBox;let a;if(o)a='viewBox="'.concat(o.x," ").concat(o.y," ").concat(o.width," ").concat(o.height,'" ');else if(this.svgViewportTransformation){const l=this.viewportTransform;a='viewBox="'.concat(jt(-l[4]/l[0],r)," ").concat(jt(-l[5]/l[3],r)," ").concat(jt(this.width/l[0],r)," ").concat(jt(this.height/l[3],r),'" ')}else a='viewBox="0 0 '.concat(this.width," ").concat(this.height,'" ');t.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',s,'" ','height="',n,'" ',a,`xml:space="preserve">
`,"<desc>Created with Fabric.js ",Tc,`</desc>
`,`<defs>
`,this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(e),`</defs>
`)}createSVGClipPathMarkup(t){const e=this.clipPath;return e?(e.clipPathId="CLIPPATH_".concat(Bn()),'<clipPath id="'.concat(e.clipPathId,`" >
`).concat(e.toClipPathSVG(t.reviver),`</clipPath>
`)):""}createSVGRefElementsMarkup(){return["background","overlay"].map(t=>{const e=this["".concat(t,"Color")];if(ls(e)){const s=this["".concat(t,"Vpt")],n=this.viewportTransform,r={isType:()=>!1,width:this.width/(s?n[0]:1),height:this.height/(s?n[3]:1)};return e.toSVG(r,{additionalTransform:s?so(n):""})}}).join("")}createSVGFontFacesMarkup(){const t=[],e={},s=_t.fontPaths;this._objects.forEach(function r(o){t.push(o),na(o)&&o._objects.forEach(r)}),t.forEach(r=>{if(!(o=r)||typeof o._renderText!="function")return;var o;const{styles:a,fontFamily:l}=r;!e[l]&&s[l]&&(e[l]=!0,a&&Object.values(a).forEach(c=>{Object.values(c).forEach(h=>{let{fontFamily:u=""}=h;!e[u]&&s[u]&&(e[u]=!0)})}))});const n=Object.keys(e).map(r=>`		@font-face {
			font-family: '`.concat(r,`';
			src: url('`).concat(s[r],`');
		}
`)).join("");return n?`	<style type="text/css"><![CDATA[
`.concat(n,`]]></style>
`):""}_setSVGObjects(t,e){this.forEachObject(s=>{s.excludeFromExport||this._setSVGObject(t,s,e)})}_setSVGObject(t,e,s){t.push(e.toSVG(s))}_setSVGBgOverlayImage(t,e,s){const n=this[e];n&&!n.excludeFromExport&&n.toSVG&&t.push(n.toSVG(s))}_setSVGBgOverlayColor(t,e){const s=this["".concat(e,"Color")];if(s)if(ls(s)){const n=s.repeat||"",r=this.width,o=this.height,a=this["".concat(e,"Vpt")]?so(Ke(this.viewportTransform)):"";t.push('<rect transform="'.concat(a," translate(").concat(r/2,",").concat(o/2,')" x="').concat(s.offsetX-r/2,'" y="').concat(s.offsetY-o/2,'" width="').concat(n!=="repeat-y"&&n!=="no-repeat"||!gf(s)?r:s.source.width,'" height="').concat(n!=="repeat-x"&&n!=="no-repeat"||!gf(s)?o:s.source.height,'" fill="url(#SVGID_').concat(s.id,`)"></rect>
`))}else t.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',s,'"',`></rect>
`)}loadFromJSON(t,e){let{signal:s}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(!t)return Promise.reject(new Ns("`json` is undefined"));const n=typeof t=="string"?JSON.parse(t):t,{objects:r=[],backgroundImage:o,background:a,overlayImage:l,overlay:c,clipPath:h}=n,u=this.renderOnAddRemove;return this.renderOnAddRemove=!1,Promise.all([er(r,{reviver:e,signal:s}),yo({backgroundImage:o,backgroundColor:a,overlayImage:l,overlayColor:c,clipPath:h},{signal:s})]).then(f=>{let[d,p]=f;return this.clear(),this.add(...d),this.set(n),this.set(p),this.renderOnAddRemove=u,this})}clone(t){const e=this.toObject(t);return this.cloneWithoutData().loadFromJSON(e)}cloneWithoutData(){const t=Es(this);return new this.constructor(t)}toDataURL(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{format:e="png",quality:s=1,multiplier:n=1,enableRetinaScaling:r=!1}=t,o=n*(r?this.getRetinaScaling():1);return Oh(this.toCanvasElement(o,t),e,s)}toBlob(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{format:e="png",quality:s=1,multiplier:n=1,enableRetinaScaling:r=!1}=t,o=n*(r?this.getRetinaScaling():1);return Mh(this.toCanvasElement(o,t),e,s)}toCanvasElement(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1,{width:e,height:s,left:n,top:r,filter:o}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const a=(e||this.width)*t,l=(s||this.height)*t,c=this.getZoom(),h=this.width,u=this.height,f=this.skipControlsDrawing,d=c*t,p=this.viewportTransform,g=[d,0,0,d,(p[4]-(n||0))*t,(p[5]-(r||0))*t],m=this.enableRetinaScaling,v=Es({width:a,height:l}),_=o?this._objects.filter(y=>o(y)):this._objects;return this.enableRetinaScaling=!1,this.viewportTransform=g,this.width=a,this.height=l,this.skipControlsDrawing=!0,this.calcViewportBoundaries(),this.renderCanvas(v.getContext("2d"),_),this.viewportTransform=p,this.width=h,this.height=u,this.calcViewportBoundaries(),this.enableRetinaScaling=m,this.skipControlsDrawing=f,v}dispose(){return!this.disposed&&this.elements.cleanupDOM({width:this.width,height:this.height}),Sa.cancelByCanvas(this),this.disposed=!0,new Promise((t,e)=>{const s=()=>{this.destroy(),t(!0)};s.kill=e,this.__cleanupTask&&this.__cleanupTask.kill("aborted"),this.destroyed?t(!1):this.nextRenderHandle?this.__cleanupTask=s:s()})}destroy(){this.destroyed=!0,this.cancelRequestedRender(),this.forEachObject(t=>t.dispose()),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose(),this.backgroundImage=void 0,this.overlayImage&&this.overlayImage.dispose(),this.overlayImage=void 0,this.elements.dispose()}toString(){return"#<Canvas (".concat(this.complexity(),"): { objects: ").concat(this._objects.length," }>")}}T(bo,"ownDefaults",fb);const db=["touchstart","touchmove","touchend"],np=i=>{const t=Qg(i.target),e=function(s){const n=s.changedTouches;return n&&n[0]?n[0]:s}(i);return new E(e.clientX+t.left,e.clientY+t.top)},wa=i=>db.includes(i.type)||i.pointerType==="touch",Ec=i=>{i.preventDefault(),i.stopPropagation()},Ys=i=>{let t=0,e=0,s=0,n=0;for(let r=0,o=i.length;r<o;r++){const{x:a,y:l}=i[r];(a>s||!r)&&(s=a),(a<t||!r)&&(t=a),(l>n||!r)&&(n=l),(l<e||!r)&&(e=l)}return{left:t,top:e,width:s-t,height:n-e}},gb=["translateX","translateY","scaleX","scaleY"],ip=(i,t)=>sr(i,Xt(t,i.calcOwnMatrix())),sr=(i,t)=>{const e=tr(t),{translateX:s,translateY:n,scaleX:r,scaleY:o}=e,a=It(e,gb),l=new E(s,n);i.flipX=!1,i.flipY=!1,Object.assign(i,a),i.set({scaleX:r,scaleY:o}),i.setPositionByOrigin(l,gt,gt)},rp=i=>{i.scaleX=1,i.scaleY=1,i.skewX=0,i.skewY=0,i.flipX=!1,i.flipY=!1,i.rotate(0)},Ah=i=>({scaleX:i.scaleX,scaleY:i.scaleY,skewX:i.skewX,skewY:i.skewY,angle:i.angle,left:i.left,flipX:i.flipX,flipY:i.flipY,top:i.top}),ul=(i,t,e)=>{const s=i/2,n=t/2,r=[new E(-s,-n),new E(s,-n),new E(-s,n),new E(s,n)].map(a=>a.transform(e)),o=Ys(r);return new E(o.width,o.height)},xo=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:ke;return Xt(Ke(arguments.length>1&&arguments[1]!==void 0?arguments[1]:ke),i)},un=function(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ke,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:ke;return i.transform(xo(t,e))},op=function(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ke,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:ke;return i.transform(xo(t,e),!0)},kc=(i,t,e)=>{const s=xo(t,e);return sr(i,Xt(s,i.calcOwnMatrix())),s},Fh=(i,t)=>{var e;const{transform:{target:s}}=t;(e=s.canvas)===null||e===void 0||e.fire("object:".concat(i),w(w({},t),{},{target:s})),s.fire(i,t)},pb={left:-.5,top:-.5,center:0,bottom:.5,right:.5},Jt=i=>typeof i=="string"?pb[i]:i-.5,Ta="not-allowed";function ap(i){return Jt(i.originX)===Jt(gt)&&Jt(i.originY)===Jt(gt)}function mf(i){return .5-Jt(i)}const ws=(i,t)=>i[t],Dh=(i,t,e,s)=>({e:i,transform:t,pointer:new E(e,s)});function lp(i,t){const e=i.getTotalAngle()+Nn(Math.atan2(t.y,t.x))+360;return Math.round(e%360/45)}function fl(i,t,e,s,n){var r;let{target:o,corner:a}=i;const l=o.controls[a],c=((r=o.canvas)===null||r===void 0?void 0:r.getZoom())||1,h=o.padding/c,u=function(f,d,p,g){const m=f.getRelativeCenterPoint(),v=p!==void 0&&g!==void 0?f.translateToGivenOrigin(m,gt,gt,p,g):new E(f.left,f.top);return(f.angle?d.rotate(-Yt(f.angle),m):d).subtract(v)}(o,new E(s,n),t,e);return u.x>=h&&(u.x-=h),u.x<=-h&&(u.x+=h),u.y>=h&&(u.y-=h),u.y<=h&&(u.y+=h),u.x-=l.offsetX,u.y-=l.offsetY,u}const cp=(i,t,e,s)=>{const{target:n,offsetX:r,offsetY:o}=t,a=e-r,l=s-o,c=!ws(n,"lockMovementX")&&n.left!==a,h=!ws(n,"lockMovementY")&&n.top!==l;return c&&n.set(wt,a),h&&n.set(De,l),(c||h)&&Fh(Hg,Dh(i,t,e,s)),c||h};class hp{getSvgStyles(t){const e=this.fillRule?this.fillRule:"nonzero",s=this.strokeWidth?this.strokeWidth:"0",n=this.strokeDashArray?this.strokeDashArray.join(" "):Re,r=this.strokeDashOffset?this.strokeDashOffset:"0",o=this.strokeLineCap?this.strokeLineCap:"butt",a=this.strokeLineJoin?this.strokeLineJoin:"miter",l=this.strokeMiterLimit?this.strokeMiterLimit:"4",c=this.opacity!==void 0?this.opacity:"1",h=this.visible?"":" visibility: hidden;",u=t?"":this.getSvgFilter(),f=no(ee,this.fill);return[no(Le,this.stroke),"stroke-width: ",s,"; ","stroke-dasharray: ",n,"; ","stroke-linecap: ",o,"; ","stroke-dashoffset: ",r,"; ","stroke-linejoin: ",a,"; ","stroke-miterlimit: ",l,"; ",f,"fill-rule: ",e,"; ","opacity: ",c,";",u,h].join("")}getSvgFilter(){return this.shadow?"filter: url(#SVGID_".concat(this.shadow.id,");"):""}getSvgCommons(){return[this.id?'id="'.concat(this.id,'" '):"",this.clipPath?'clip-path="url(#'.concat(this.clipPath.clipPathId,')" '):""].join("")}getSvgTransform(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const s=t?this.calcTransformMatrix():this.calcOwnMatrix(),n='transform="'.concat(so(s));return"".concat(n).concat(e,'" ')}_toSVG(t){return[""]}toSVG(t){return this._createBaseSVGMarkup(this._toSVG(t),{reviver:t})}toClipPathSVG(t){return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(t),{reviver:t})}_createBaseClipPathSVGMarkup(t){let{reviver:e,additionalTransform:s=""}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=[this.getSvgTransform(!0,s),this.getSvgCommons()].join(""),r=t.indexOf("COMMON_PARTS");return t[r]=n,e?e(t.join("")):t.join("")}_createBaseSVGMarkup(t){let{noStyle:e,reviver:s,withShadow:n,additionalTransform:r}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const o=e?"":'style="'.concat(this.getSvgStyles(),'" '),a=n?'style="'.concat(this.getSvgFilter(),'" '):"",l=this.clipPath,c=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",h=l&&l.absolutePositioned,u=this.stroke,f=this.fill,d=this.shadow,p=[],g=t.indexOf("COMMON_PARTS");let m;l&&(l.clipPathId="CLIPPATH_".concat(Bn()),m='<clipPath id="'.concat(l.clipPathId,`" >
`).concat(l.toClipPathSVG(s),`</clipPath>
`)),h&&p.push("<g ",a,this.getSvgCommons(),` >
`),p.push("<g ",this.getSvgTransform(!1),h?"":a+this.getSvgCommons(),` >
`);const v=[o,c,e?"":this.addPaintOrder()," ",r?'transform="'.concat(r,'" '):""].join("");return t[g]=v,ls(f)&&p.push(f.toSVG(this)),ls(u)&&p.push(u.toSVG(this)),d&&p.push(d.toSVG(this)),l&&p.push(m),p.push(t.join("")),p.push(`</g>
`),h&&p.push(`</g>
`),s?s(p.join("")):p.join("")}addPaintOrder(){return this.paintFirst!==ee?' paint-order="'.concat(this.paintFirst,'" '):""}}function dl(i){return new RegExp("^("+i.join("|")+")\\b","i")}var vf;const _i=String.raw(vf||(vf=Yn(["(?:[-+]?(?:d*.d+|d+.?)(?:[eE][-+]?d+)?)"],["(?:[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?)"]))),mb=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+_i+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+_i+"))?\\s+(.*)"),vb={cx:wt,x:wt,r:"radius",cy:De,y:De,display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing"},Bl="font-size",Nl="clip-path";dl(["path","circle","polygon","polyline","ellipse","rect","line","image","text"]);dl(["symbol","image","marker","pattern","view","svg"]);const _f=dl(["symbol","g","a","svg","clipPath","defs"]),_b=new E(1,0),up=new E,Rh=(i,t)=>i.rotate(t),Oa=(i,t)=>new E(t).subtract(i),Ma=i=>i.distanceFrom(up),Ea=(i,t)=>Math.atan2(Wi(i,t),dp(i,t)),fp=i=>Ea(_b,i),gl=i=>i.eq(up)?i:i.scalarDivide(Ma(i)),Lh=function(i){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return gl(new E(-i.y,i.x).scalarMultiply(t?1:-1))},Wi=(i,t)=>i.x*t.y-i.y*t.x,dp=(i,t)=>i.x*t.x+i.y*t.y,Pc=(i,t,e)=>{if(i.eq(t)||i.eq(e))return!0;const s=Wi(t,e),n=Wi(t,i),r=Wi(e,i);return s>=0?n>=0&&r<=0:!(n<=0&&r>=0)},yf="(-?\\d+(?:\\.\\d*)?(?:px)?(?:\\s?|$))?",bf=new RegExp("(?:\\s|^)"+yf+yf+"("+_i+"?(?:px)?)?(?:\\s?|$)(?:$|\\s)");class Xs{constructor(t){const e=typeof t=="string"?Xs.parseShadow(t):t;Object.assign(this,Xs.ownDefaults,e),this.id=Bn()}static parseShadow(t){const e=t.trim(),[,s=0,n=0,r=0]=(bf.exec(e)||[]).map(o=>parseFloat(o)||0);return{color:(e.replace(bf,"")||"rgb(0,0,0)").trim(),offsetX:s,offsetY:n,blur:r}}toString(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")}toSVG(t){const e=Rh(new E(this.offsetX,this.offsetY),Yt(-t.angle)),s=new Mt(this.color);let n=40,r=40;return t.width&&t.height&&(n=100*jt((Math.abs(e.x)+this.blur)/t.width,_t.NUM_FRACTION_DIGITS)+20,r=100*jt((Math.abs(e.y)+this.blur)/t.height,_t.NUM_FRACTION_DIGITS)+20),t.flipX&&(e.x*=-1),t.flipY&&(e.y*=-1),'<filter id="SVGID_'.concat(this.id,'" y="-').concat(r,'%" height="').concat(100+2*r,'%" x="-').concat(n,'%" width="').concat(100+2*n,`%" >
	<feGaussianBlur in="SourceAlpha" stdDeviation="`).concat(jt(this.blur?this.blur/2:0,_t.NUM_FRACTION_DIGITS),`"></feGaussianBlur>
	<feOffset dx="`).concat(jt(e.x,_t.NUM_FRACTION_DIGITS),'" dy="').concat(jt(e.y,_t.NUM_FRACTION_DIGITS),`" result="oBlur" ></feOffset>
	<feFlood flood-color="`).concat(s.toRgb(),'" flood-opacity="').concat(s.getAlpha(),`"/>
	<feComposite in2="oBlur" operator="in" />
	<feMerge>
		<feMergeNode></feMergeNode>
		<feMergeNode in="SourceGraphic"></feMergeNode>
	</feMerge>
</filter>
`)}toObject(){const t={color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling,type:this.constructor.type},e=Xs.ownDefaults;return this.includeDefaultValues?t:Ph(t,(s,n)=>s!==e[n])}static async fromObject(t){return new this(t)}}T(Xs,"ownDefaults",{color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1}),T(Xs,"type","shadow"),q.setClass(Xs,"shadow");const yi=(i,t,e)=>Math.max(i,Math.min(t,e)),yb=[De,wt,Pe,es,"flipX","flipY","originX","originY","angle","opacity","globalCompositeOperation","shadow","visible",fr,dr],vn=[ee,Le,"strokeWidth","strokeDashArray","width","height","paintFirst","strokeUniform","strokeLineCap","strokeDashOffset","strokeLineJoin","strokeMiterLimit","backgroundColor","clipPath"],bb={top:0,left:0,width:0,height:0,angle:0,flipX:!1,flipY:!1,scaleX:1,scaleY:1,minScaleLimit:0,skewX:0,skewY:0,originX:wt,originY:De,strokeWidth:1,strokeUniform:!1,padding:0,opacity:1,paintFirst:ee,fill:"rgb(0,0,0)",fillRule:"nonzero",stroke:null,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,globalCompositeOperation:"source-over",backgroundColor:"",shadow:null,visible:!0,includeDefaultValues:!0,excludeFromExport:!1,objectCaching:!0,clipPath:void 0,inverted:!1,absolutePositioned:!1,centeredRotation:!0,centeredScaling:!1,dirty:!0},Hl=(i,t,e,s)=>(i<Math.abs(t)?(i=t,s=e/4):s=t===0&&i===0?e/fn*Math.asin(1):e/fn*Math.asin(t/i),{a:i,c:t,p:e,s}),xf=(i,t,e,s,n)=>i*Math.pow(2,10*(s-=1))*Math.sin((s*n-t)*fn/e),gp=(i,t,e,s)=>-e*Math.cos(i/s*In)+e+t,Ac=(i,t,e,s)=>(i/=s)<1/2.75?e*(7.5625*i*i)+t:i<2/2.75?e*(7.5625*(i-=1.5/2.75)*i+.75)+t:i<2.5/2.75?e*(7.5625*(i-=2.25/2.75)*i+.9375)+t:e*(7.5625*(i-=2.625/2.75)*i+.984375)+t,Cf=(i,t,e,s)=>e-Ac(s-i,0,e,s)+t;var xb=Object.freeze({__proto__:null,defaultEasing:gp,easeInBack:function(i,t,e,s){let n=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1.70158;return e*(i/=s)*i*((n+1)*i-n)+t},easeInBounce:Cf,easeInCirc:(i,t,e,s)=>-e*(Math.sqrt(1-(i/=s)*i)-1)+t,easeInCubic:(i,t,e,s)=>e*(i/s)**3+t,easeInElastic:(i,t,e,s)=>{const n=e;let r=0;if(i===0)return t;if((i/=s)===1)return t+e;r||(r=.3*s);const{a:o,s:a,p:l}=Hl(n,e,r,1.70158);return-xf(o,a,l,i,s)+t},easeInExpo:(i,t,e,s)=>i===0?t:e*2**(10*(i/s-1))+t,easeInOutBack:function(i,t,e,s){let n=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1.70158;return(i/=s/2)<1?e/2*(i*i*((1+(n*=1.525))*i-n))+t:e/2*((i-=2)*i*((1+(n*=1.525))*i+n)+2)+t},easeInOutBounce:(i,t,e,s)=>i<s/2?.5*Cf(2*i,0,e,s)+t:.5*Ac(2*i-s,0,e,s)+.5*e+t,easeInOutCirc:(i,t,e,s)=>(i/=s/2)<1?-e/2*(Math.sqrt(1-i**2)-1)+t:e/2*(Math.sqrt(1-(i-=2)*i)+1)+t,easeInOutCubic:(i,t,e,s)=>(i/=s/2)<1?e/2*i**3+t:e/2*((i-2)**3+2)+t,easeInOutElastic:(i,t,e,s)=>{const n=e;let r=0;if(i===0)return t;if((i/=s/2)===2)return t+e;r||(r=s*(.3*1.5));const{a:o,s:a,p:l,c}=Hl(n,e,r,1.70158);return i<1?-.5*xf(o,a,l,i,s)+t:o*Math.pow(2,-10*(i-=1))*Math.sin((i*s-a)*fn/l)*.5+c+t},easeInOutExpo:(i,t,e,s)=>i===0?t:i===s?t+e:(i/=s/2)<1?e/2*2**(10*(i-1))+t:e/2*-(2**(-10*--i)+2)+t,easeInOutQuad:(i,t,e,s)=>(i/=s/2)<1?e/2*i**2+t:-e/2*(--i*(i-2)-1)+t,easeInOutQuart:(i,t,e,s)=>(i/=s/2)<1?e/2*i**4+t:-e/2*((i-=2)*i**3-2)+t,easeInOutQuint:(i,t,e,s)=>(i/=s/2)<1?e/2*i**5+t:e/2*((i-2)**5+2)+t,easeInOutSine:(i,t,e,s)=>-e/2*(Math.cos(Math.PI*i/s)-1)+t,easeInQuad:(i,t,e,s)=>e*(i/=s)*i+t,easeInQuart:(i,t,e,s)=>e*(i/=s)*i**3+t,easeInQuint:(i,t,e,s)=>e*(i/s)**5+t,easeInSine:(i,t,e,s)=>-e*Math.cos(i/s*In)+e+t,easeOutBack:function(i,t,e,s){let n=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1.70158;return e*((i=i/s-1)*i*((n+1)*i+n)+1)+t},easeOutBounce:Ac,easeOutCirc:(i,t,e,s)=>e*Math.sqrt(1-(i=i/s-1)*i)+t,easeOutCubic:(i,t,e,s)=>e*((i/s-1)**3+1)+t,easeOutElastic:(i,t,e,s)=>{const n=e;let r=0;if(i===0)return t;if((i/=s)===1)return t+e;r||(r=.3*s);const{a:o,s:a,p:l,c}=Hl(n,e,r,1.70158);return o*2**(-10*i)*Math.sin((i*s-a)*fn/l)+c+t},easeOutExpo:(i,t,e,s)=>i===s?t+e:e*-(2**(-10*i/s)+1)+t,easeOutQuad:(i,t,e,s)=>-e*(i/=s)*(i-2)+t,easeOutQuart:(i,t,e,s)=>-e*((i=i/s-1)*i**3-1)+t,easeOutQuint:(i,t,e,s)=>e*((i/s-1)**5+1)+t,easeOutSine:(i,t,e,s)=>e*Math.sin(i/s*In)+t});const Cb=()=>!1;class jh{constructor(t){let{startValue:e,byValue:s,duration:n=500,delay:r=0,easing:o=gp,onStart:a=li,onChange:l=li,onComplete:c=li,abort:h=Cb,target:u}=t;T(this,"_state","pending"),T(this,"durationProgress",0),T(this,"valueProgress",0),this.tick=this.tick.bind(this),this.duration=n,this.delay=r,this.easing=o,this._onStart=a,this._onChange=l,this._onComplete=c,this._abort=h,this.target=u,this.startValue=e,this.byValue=s,this.value=this.startValue,this.endValue=Object.freeze(this.calculate(this.duration).value)}get state(){return this._state}isDone(){return this._state==="aborted"||this._state==="completed"}start(){const t=e=>{this._state==="pending"&&(this.startTime=e||+new Date,this._state="running",this._onStart(),this.tick(this.startTime))};this.register(),this.delay>0?setTimeout(()=>Nr(t),this.delay):Nr(t)}tick(t){const e=(t||+new Date)-this.startTime,s=Math.min(e,this.duration);this.durationProgress=s/this.duration;const{value:n,valueProgress:r}=this.calculate(s);this.value=Object.freeze(n),this.valueProgress=r,this._state!=="aborted"&&(this._abort(this.value,this.valueProgress,this.durationProgress)?(this._state="aborted",this.unregister()):e>=this.duration?(this.durationProgress=this.valueProgress=1,this._onChange(this.endValue,this.valueProgress,this.durationProgress),this._state="completed",this._onComplete(this.endValue,this.valueProgress,this.durationProgress),this.unregister()):(this._onChange(this.value,this.valueProgress,this.durationProgress),Nr(this.tick)))}register(){Sa.push(this)}unregister(){Sa.remove(this)}abort(){this._state="aborted",this.unregister()}}const Sb=["startValue","endValue"];class wb extends jh{constructor(t){let{startValue:e=0,endValue:s=100}=t;super(w(w({},It(t,Sb)),{},{startValue:e,byValue:s-e}))}calculate(t){const e=this.easing(t,this.startValue,this.byValue,this.duration);return{value:e,valueProgress:Math.abs((e-this.startValue)/this.byValue)}}}const Tb=["startValue","endValue"];class Ob extends jh{constructor(t){let{startValue:e=[0],endValue:s=[100]}=t;super(w(w({},It(t,Tb)),{},{startValue:e,byValue:s.map((n,r)=>n-e[r])}))}calculate(t){const e=this.startValue.map((s,n)=>this.easing(t,s,this.byValue[n],this.duration,n));return{value:e,valueProgress:Math.abs((e[0]-this.startValue[0])/this.byValue[0])}}}const Mb=["startValue","endValue","easing","onChange","onComplete","abort"],Eb=(i,t,e,s)=>t+e*(1-Math.cos(i/s*In)),zl=i=>i&&((t,e,s)=>i(new Mt(t).toRgba(),e,s));class kb extends jh{constructor(t){let{startValue:e,endValue:s,easing:n=Eb,onChange:r,onComplete:o,abort:a}=t,l=It(t,Mb);const c=new Mt(e).getSource(),h=new Mt(s).getSource();super(w(w({},l),{},{startValue:c,byValue:h.map((u,f)=>u-c[f]),easing:n,onChange:zl(r),onComplete:zl(o),abort:zl(a)}))}calculate(t){const[e,s,n,r]=this.startValue.map((a,l)=>this.easing(t,a,this.byValue[l],this.duration,l)),o=[...[e,s,n].map(Math.round),yi(0,r,1)];return{value:o,valueProgress:o.map((a,l)=>this.byValue[l]!==0?Math.abs((a-this.startValue[l])/this.byValue[l]):0).find(a=>a!==0)||0}}}function Ih(i){const t=(e=>Array.isArray(e.startValue)||Array.isArray(e.endValue))(i)?new Ob(i):new wb(i);return t.start(),t}function pp(i){const t=new kb(i);return t.start(),t}class Bt{constructor(t){this.status=t,this.points=[]}includes(t){return this.points.some(e=>e.eq(t))}append(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];return this.points=this.points.concat(e.filter(n=>!this.includes(n))),this}static isPointContained(t,e,s){let n=arguments.length>3&&arguments[3]!==void 0&&arguments[3];if(e.eq(s))return t.eq(e);if(e.x===s.x)return t.x===e.x&&(n||t.y>=Math.min(e.y,s.y)&&t.y<=Math.max(e.y,s.y));if(e.y===s.y)return t.y===e.y&&(n||t.x>=Math.min(e.x,s.x)&&t.x<=Math.max(e.x,s.x));{const r=Oa(e,s),o=Oa(e,t).divide(r);return n?Math.abs(o.x)===Math.abs(o.y):o.x===o.y&&o.x>=0&&o.x<=1}}static isPointInPolygon(t,e){const s=new E(t).setX(Math.min(t.x-1,...e.map(r=>r.x)));let n=0;for(let r=0;r<e.length;r++){const o=this.intersectSegmentSegment(e[r],e[(r+1)%e.length],t,s);if(o.includes(t))return!0;n+=+(o.status==="Intersection")}return n%2==1}static intersectLineLine(t,e,s,n){let r=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4],o=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5];const a=e.x-t.x,l=e.y-t.y,c=n.x-s.x,h=n.y-s.y,u=t.x-s.x,f=t.y-s.y,d=c*f-h*u,p=a*f-l*u,g=h*a-c*l;if(g!==0){const m=d/g,v=p/g;return(r||0<=m&&m<=1)&&(o||0<=v&&v<=1)?new Bt("Intersection").append(new E(t.x+m*a,t.y+m*l)):new Bt}if(d===0||p===0){const m=r||o||Bt.isPointContained(t,s,n)||Bt.isPointContained(e,s,n)||Bt.isPointContained(s,t,e)||Bt.isPointContained(n,t,e);return new Bt(m?"Coincident":void 0)}return new Bt("Parallel")}static intersectSegmentLine(t,e,s,n){return Bt.intersectLineLine(t,e,s,n,!1,!0)}static intersectSegmentSegment(t,e,s,n){return Bt.intersectLineLine(t,e,s,n,!1,!1)}static intersectLinePolygon(t,e,s){let n=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];const r=new Bt,o=s.length;for(let a,l,c,h=0;h<o;h++){if(a=s[h],l=s[(h+1)%o],c=Bt.intersectLineLine(t,e,a,l,n,!1),c.status==="Coincident")return c;r.append(...c.points)}return r.points.length>0&&(r.status="Intersection"),r}static intersectSegmentPolygon(t,e,s){return Bt.intersectLinePolygon(t,e,s,!1)}static intersectPolygonPolygon(t,e){const s=new Bt,n=t.length,r=[];for(let o=0;o<n;o++){const a=t[o],l=t[(o+1)%n],c=Bt.intersectSegmentPolygon(a,l,e);c.status==="Coincident"?(r.push(c),s.append(a,l)):s.append(...c.points)}return r.length>0&&r.length===t.length?new Bt("Coincident"):(s.points.length>0&&(s.status="Intersection"),s)}static intersectPolygonRectangle(t,e,s){const n=e.min(s),r=e.max(s),o=new E(r.x,n.y),a=new E(n.x,r.y);return Bt.intersectPolygonPolygon(t,[n,o,r,a])}}class Pb extends Xg{getX(){return this.getXY().x}setX(t){this.setXY(this.getXY().setX(t))}getY(){return this.getXY().y}setY(t){this.setXY(this.getXY().setY(t))}getRelativeX(){return this.left}setRelativeX(t){this.left=t}getRelativeY(){return this.top}setRelativeY(t){this.top=t}getXY(){const t=this.getRelativeXY();return this.group?ue(t,this.group.calcTransformMatrix()):t}setXY(t,e,s){this.group&&(t=ue(t,Ke(this.group.calcTransformMatrix()))),this.setRelativeXY(t,e,s)}getRelativeXY(){return new E(this.left,this.top)}setRelativeXY(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.originX,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.originY;this.setPositionByOrigin(t,e,s)}isStrokeAccountedForInDimensions(){return!1}getCoords(){const{tl:t,tr:e,br:s,bl:n}=this.aCoords||(this.aCoords=this.calcACoords()),r=[t,e,s,n];if(this.group){const o=this.group.calcTransformMatrix();return r.map(a=>ue(a,o))}return r}intersectsWithRect(t,e){return Bt.intersectPolygonRectangle(this.getCoords(),t,e).status==="Intersection"}intersectsWithObject(t){const e=Bt.intersectPolygonPolygon(this.getCoords(),t.getCoords());return e.status==="Intersection"||e.status==="Coincident"||t.isContainedWithinObject(this)||this.isContainedWithinObject(t)}isContainedWithinObject(t){return this.getCoords().every(e=>t.containsPoint(e))}isContainedWithinRect(t,e){const{left:s,top:n,width:r,height:o}=this.getBoundingRect();return s>=t.x&&s+r<=e.x&&n>=t.y&&n+o<=e.y}isOverlapping(t){return this.intersectsWithObject(t)||this.isContainedWithinObject(t)||t.isContainedWithinObject(this)}containsPoint(t){return Bt.isPointInPolygon(t,this.getCoords())}isOnScreen(){if(!this.canvas)return!1;const{tl:t,br:e}=this.canvas.vptCoords;return!!this.getCoords().some(s=>s.x<=e.x&&s.x>=t.x&&s.y<=e.y&&s.y>=t.y)||!!this.intersectsWithRect(t,e)||this.containsPoint(t.midPointFrom(e))}isPartiallyOnScreen(){if(!this.canvas)return!1;const{tl:t,br:e}=this.canvas.vptCoords;return this.intersectsWithRect(t,e)?!0:this.getCoords().every(s=>(s.x>=e.x||s.x<=t.x)&&(s.y>=e.y||s.y<=t.y))&&this.containsPoint(t.midPointFrom(e))}getBoundingRect(){return Ys(this.getCoords())}getScaledWidth(){return this._getTransformedDimensions().x}getScaledHeight(){return this._getTransformedDimensions().y}scale(t){this._set(Pe,t),this._set(es,t),this.setCoords()}scaleToWidth(t){const e=this.getBoundingRect().width/this.getScaledWidth();return this.scale(t/this.width/e)}scaleToHeight(t){const e=this.getBoundingRect().height/this.getScaledHeight();return this.scale(t/this.height/e)}getCanvasRetinaScaling(){var t;return((t=this.canvas)===null||t===void 0?void 0:t.getRetinaScaling())||1}getTotalAngle(){return this.group?Nn(qg(this.calcTransformMatrix())):this.angle}getViewportTransform(){var t;return((t=this.canvas)===null||t===void 0?void 0:t.viewportTransform)||ke.concat()}calcACoords(){const t=pr({angle:this.angle}),{x:e,y:s}=this.getRelativeCenterPoint(),n=gr(e,s),r=Xt(n,t),o=this._getTransformedDimensions(),a=o.x/2,l=o.y/2;return{tl:ue({x:-a,y:-l},r),tr:ue({x:a,y:-l},r),bl:ue({x:-a,y:l},r),br:ue({x:a,y:l},r)}}setCoords(){this.aCoords=this.calcACoords()}transformMatrixKey(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],e=[];return!t&&this.group&&(e=this.group.transformMatrixKey(t)),e.push(this.top,this.left,this.width,this.height,this.scaleX,this.scaleY,this.angle,this.strokeWidth,this.skewX,this.skewY,+this.flipX,+this.flipY,Jt(this.originX),Jt(this.originY)),e}calcTransformMatrix(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],e=this.calcOwnMatrix();if(t||!this.group)return e;const s=this.transformMatrixKey(t),n=this.matrixCache;return n&&n.key.every((r,o)=>r===s[o])?n.value:(this.group&&(e=Xt(this.group.calcTransformMatrix(!1),e)),this.matrixCache={key:s,value:e},e)}calcOwnMatrix(){const t=this.transformMatrixKey(!0),e=this.ownMatrixCache;if(e&&e.key===t)return e.value;const s=this.getRelativeCenterPoint(),n={angle:this.angle,translateX:s.x,translateY:s.y,scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY},r=Zg(n);return this.ownMatrixCache={key:t,value:r},r}_getNonTransformedDimensions(){return new E(this.width,this.height).scalarAdd(this.strokeWidth)}_calculateCurrentDimensions(t){return this._getTransformedDimensions(t).transform(this.getViewportTransform(),!0).scalarAdd(2*this.padding)}_getTransformedDimensions(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=w({scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,width:this.width,height:this.height,strokeWidth:this.strokeWidth},t),s=e.strokeWidth;let n=s,r=0;this.strokeUniform&&(n=0,r=s);const o=e.width+n,a=e.height+n;let l;return l=e.skewX===0&&e.skewY===0?new E(o*e.scaleX,a*e.scaleY):ul(o,a,_o(e)),l.scalarAdd(r)}translateToGivenOrigin(t,e,s,n,r){let o=t.x,a=t.y;const l=Jt(n)-Jt(e),c=Jt(r)-Jt(s);if(l||c){const h=this._getTransformedDimensions();o+=l*h.x,a+=c*h.y}return new E(o,a)}translateToCenterPoint(t,e,s){if(e===gt&&s===gt)return t;const n=this.translateToGivenOrigin(t,e,s,gt,gt);return this.angle?n.rotate(Yt(this.angle),t):n}translateToOriginPoint(t,e,s){const n=this.translateToGivenOrigin(t,gt,gt,e,s);return this.angle?n.rotate(Yt(this.angle),t):n}getCenterPoint(){const t=this.getRelativeCenterPoint();return this.group?ue(t,this.group.calcTransformMatrix()):t}getRelativeCenterPoint(){return this.translateToCenterPoint(new E(this.left,this.top),this.originX,this.originY)}getPointByOrigin(t,e){return this.translateToOriginPoint(this.getRelativeCenterPoint(),t,e)}setPositionByOrigin(t,e,s){const n=this.translateToCenterPoint(t,e,s),r=this.translateToOriginPoint(n,this.originX,this.originY);this.set({left:r.x,top:r.y})}_getLeftTopCoords(){return this.translateToOriginPoint(this.getRelativeCenterPoint(),wt,De)}}const Ab=["type"],Fb=["extraParam"];let tn=class ia extends Pb{static getDefaults(){return ia.ownDefaults}get type(){const t=this.constructor.type;return t==="FabricObject"?"object":t.toLowerCase()}set type(t){jn("warn","Setting type has no effect",t)}constructor(t){super(),T(this,"_cacheContext",null),Object.assign(this,ia.ownDefaults),this.setOptions(t)}_createCacheCanvas(){this._cacheCanvas=ms(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0}_limitCacheSize(t){const e=t.width,s=t.height,n=_t.maxCacheSideLimit,r=_t.minCacheSideLimit;if(e<=n&&s<=n&&e*s<=_t.perfLimitSizeTotal)return e<r&&(t.width=r),s<r&&(t.height=r),t;const o=e/s,[a,l]=Br.limitDimsByArea(o),c=yi(r,a,n),h=yi(r,l,n);return e>c&&(t.zoomX/=e/c,t.width=c,t.capped=!0),s>h&&(t.zoomY/=s/h,t.height=h,t.capped=!0),t}_getCacheCanvasDimensions(){const t=this.getTotalObjectScaling(),e=this._getTransformedDimensions({skewX:0,skewY:0}),s=e.x*t.x/this.scaleX,n=e.y*t.y/this.scaleY;return{width:Math.ceil(s+2),height:Math.ceil(n+2),zoomX:t.x,zoomY:t.y,x:s,y:n}}_updateCacheCanvas(){const t=this._cacheCanvas,e=this._cacheContext,{width:s,height:n,zoomX:r,zoomY:o,x:a,y:l}=this._limitCacheSize(this._getCacheCanvasDimensions()),c=s!==t.width||n!==t.height,h=this.zoomX!==r||this.zoomY!==o;if(!t||!e)return!1;if(c||h){s!==t.width||n!==t.height?(t.width=s,t.height=n):(e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,t.width,t.height));const u=a/2,f=l/2;return this.cacheTranslationX=Math.round(t.width/2-u)+u,this.cacheTranslationY=Math.round(t.height/2-f)+f,e.translate(this.cacheTranslationX,this.cacheTranslationY),e.scale(r,o),this.zoomX=r,this.zoomY=o,!0}return!1}setOptions(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setOptions(t)}transform(t){const e=this.group&&!this.group._transformDone||this.group&&this.canvas&&t===this.canvas.contextTop,s=this.calcTransformMatrix(!e);t.transform(s[0],s[1],s[2],s[3],s[4],s[5])}getObjectScaling(){if(!this.group)return new E(Math.abs(this.scaleX),Math.abs(this.scaleY));const t=tr(this.calcTransformMatrix());return new E(Math.abs(t.scaleX),Math.abs(t.scaleY))}getTotalObjectScaling(){const t=this.getObjectScaling();if(this.canvas){const e=this.canvas.getZoom(),s=this.getCanvasRetinaScaling();return t.scalarMultiply(e*s)}return t}getObjectOpacity(){let t=this.opacity;return this.group&&(t*=this.group.getObjectOpacity()),t}_constrainScale(t){return Math.abs(t)<this.minScaleLimit?t<0?-this.minScaleLimit:this.minScaleLimit:t===0?1e-4:t}_set(t,e){t!==Pe&&t!==es||(e=this._constrainScale(e)),t===Pe&&e<0?(this.flipX=!this.flipX,e*=-1):t==="scaleY"&&e<0?(this.flipY=!this.flipY,e*=-1):t!=="shadow"||!e||e instanceof Xs||(e=new Xs(e));const s=this[t]!==e;return this[t]=e,s&&this.constructor.cacheProperties.includes(t)&&(this.dirty=!0),this.parent&&(this.dirty||s&&this.constructor.stateProperties.includes(t))&&this.parent._set("dirty",!0),this}isNotVisible(){return this.opacity===0||!this.width&&!this.height&&this.strokeWidth===0||!this.visible}render(t){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(t.save(),this._setupCompositeOperation(t),this.drawSelectionBackground(t),this.transform(t),this._setOpacity(t),this._setShadow(t),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(t)):(this._removeCacheCanvas(),this.drawObject(t,!1,{}),this.dirty=!1),t.restore())}drawSelectionBackground(t){}renderCache(t){if(t=t||{},this._cacheCanvas&&this._cacheContext||this._createCacheCanvas(),this.isCacheDirty()&&this._cacheContext){const{zoomX:e,zoomY:s,cacheTranslationX:n,cacheTranslationY:r}=this,{width:o,height:a}=this._cacheCanvas;this.drawObject(this._cacheContext,t.forClipping,{zoomX:e,zoomY:s,cacheTranslationX:n,cacheTranslationY:r,width:o,height:a,parentClipPaths:[]}),this.dirty=!1}}_removeCacheCanvas(){this._cacheCanvas=void 0,this._cacheContext=null}hasStroke(){return this.stroke&&this.stroke!=="transparent"&&this.strokeWidth!==0}hasFill(){return this.fill&&this.fill!=="transparent"}needsItsOwnCache(){return!!(this.paintFirst===Le&&this.hasFill()&&this.hasStroke()&&this.shadow)||!!this.clipPath}shouldCache(){return this.ownCaching=this.objectCaching&&(!this.parent||!this.parent.isOnACache())||this.needsItsOwnCache(),this.ownCaching}willDrawShadow(){return!!this.shadow&&(this.shadow.offsetX!==0||this.shadow.offsetY!==0)}drawClipPathOnCache(t,e,s){t.save(),e.inverted?t.globalCompositeOperation="destination-out":t.globalCompositeOperation="destination-in",t.setTransform(1,0,0,1,0,0),t.drawImage(s,0,0),t.restore()}drawObject(t,e,s){const n=this.fill,r=this.stroke;e?(this.fill="black",this.stroke="",this._setClippingProperties(t)):this._renderBackground(t),this._render(t),this._drawClipPath(t,this.clipPath,s),this.fill=n,this.stroke=r}createClipPathLayer(t,e){const s=Es(e),n=s.getContext("2d");if(n.translate(e.cacheTranslationX,e.cacheTranslationY),n.scale(e.zoomX,e.zoomY),t._cacheCanvas=s,e.parentClipPaths.forEach(r=>{r.transform(n)}),e.parentClipPaths.push(t),t.absolutePositioned){const r=Ke(this.calcTransformMatrix());n.transform(r[0],r[1],r[2],r[3],r[4],r[5])}return t.transform(n),t.drawObject(n,!0,e),s}_drawClipPath(t,e,s){if(!e)return;e._transformDone=!0;const n=this.createClipPathLayer(e,s);this.drawClipPathOnCache(t,e,n)}drawCacheOnCanvas(t){t.scale(1/this.zoomX,1/this.zoomY),t.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)}isCacheDirty(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];if(this.isNotVisible())return!1;const e=this._cacheCanvas,s=this._cacheContext;return!(!e||!s||t||!this._updateCacheCanvas())||!!(this.dirty||this.clipPath&&this.clipPath.absolutePositioned)&&(e&&s&&!t&&(s.save(),s.setTransform(1,0,0,1,0,0),s.clearRect(0,0,e.width,e.height),s.restore()),!0)}_renderBackground(t){if(!this.backgroundColor)return;const e=this._getNonTransformedDimensions();t.fillStyle=this.backgroundColor,t.fillRect(-e.x/2,-e.y/2,e.x,e.y),this._removeShadow(t)}_setOpacity(t){this.group&&!this.group._transformDone?t.globalAlpha=this.getObjectOpacity():t.globalAlpha*=this.opacity}_setStrokeStyles(t,e){const s=e.stroke;s&&(t.lineWidth=e.strokeWidth,t.lineCap=e.strokeLineCap,t.lineDashOffset=e.strokeDashOffset,t.lineJoin=e.strokeLineJoin,t.miterLimit=e.strokeMiterLimit,ls(s)?s.gradientUnits==="percentage"||s.gradientTransform||s.patternTransform?this._applyPatternForTransformedGradient(t,s):(t.strokeStyle=s.toLive(t),this._applyPatternGradientTransform(t,s)):t.strokeStyle=e.stroke)}_setFillStyles(t,e){let{fill:s}=e;s&&(ls(s)?(t.fillStyle=s.toLive(t),this._applyPatternGradientTransform(t,s)):t.fillStyle=s)}_setClippingProperties(t){t.globalAlpha=1,t.strokeStyle="transparent",t.fillStyle="#000000"}_setLineDash(t,e){e&&e.length!==0&&t.setLineDash(e)}_setShadow(t){if(!this.shadow)return;const e=this.shadow,s=this.canvas,n=this.getCanvasRetinaScaling(),[r,,,o]=(s==null?void 0:s.viewportTransform)||ke,a=r*n,l=o*n,c=e.nonScaling?new E(1,1):this.getObjectScaling();t.shadowColor=e.color,t.shadowBlur=e.blur*_t.browserShadowBlurConstant*(a+l)*(c.x+c.y)/4,t.shadowOffsetX=e.offsetX*a*c.x,t.shadowOffsetY=e.offsetY*l*c.y}_removeShadow(t){this.shadow&&(t.shadowColor="",t.shadowBlur=t.shadowOffsetX=t.shadowOffsetY=0)}_applyPatternGradientTransform(t,e){if(!ls(e))return{offsetX:0,offsetY:0};const s=e.gradientTransform||e.patternTransform,n=-this.width/2+e.offsetX||0,r=-this.height/2+e.offsetY||0;return e.gradientUnits==="percentage"?t.transform(this.width,0,0,this.height,n,r):t.transform(1,0,0,1,n,r),s&&t.transform(s[0],s[1],s[2],s[3],s[4],s[5]),{offsetX:n,offsetY:r}}_renderPaintInOrder(t){this.paintFirst===Le?(this._renderStroke(t),this._renderFill(t)):(this._renderFill(t),this._renderStroke(t))}_render(t){}_renderFill(t){this.fill&&(t.save(),this._setFillStyles(t,this),this.fillRule==="evenodd"?t.fill("evenodd"):t.fill(),t.restore())}_renderStroke(t){if(this.stroke&&this.strokeWidth!==0){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(t),t.save(),this.strokeUniform){const e=this.getObjectScaling();t.scale(1/e.x,1/e.y)}this._setLineDash(t,this.strokeDashArray),this._setStrokeStyles(t,this),t.stroke(),t.restore()}}_applyPatternForTransformedGradient(t,e){var s;const n=this._limitCacheSize(this._getCacheCanvasDimensions()),r=this.getCanvasRetinaScaling(),o=n.x/this.scaleX/r,a=n.y/this.scaleY/r,l=Es({width:Math.ceil(o),height:Math.ceil(a)}),c=l.getContext("2d");c&&(c.beginPath(),c.moveTo(0,0),c.lineTo(o,0),c.lineTo(o,a),c.lineTo(0,a),c.closePath(),c.translate(o/2,a/2),c.scale(n.zoomX/this.scaleX/r,n.zoomY/this.scaleY/r),this._applyPatternGradientTransform(c,e),c.fillStyle=e.toLive(t),c.fill(),t.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),t.scale(r*this.scaleX/n.zoomX,r*this.scaleY/n.zoomY),t.strokeStyle=(s=c.createPattern(l,"no-repeat"))!==null&&s!==void 0?s:"")}_findCenterFromElement(){return new E(this.left+this.width/2,this.top+this.height/2)}clone(t){const e=this.toObject(t);return this.constructor.fromObject(e)}cloneAsImage(t){const e=this.toCanvasElement(t);return new(q.getClass("image"))(e)}toCanvasElement(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=Ah(this),s=this.group,n=this.shadow,r=Math.abs,o=t.enableRetinaScaling?Ng():1,a=(t.multiplier||1)*o,l=t.canvasProvider||(_=>new bo(_,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1}));delete this.group,t.withoutTransform&&rp(this),t.withoutShadow&&(this.shadow=null),t.viewportTransform&&kc(this,this.getViewportTransform()),this.setCoords();const c=ms(),h=this.getBoundingRect(),u=this.shadow,f=new E;if(u){const _=u.blur,y=u.nonScaling?new E(1,1):this.getObjectScaling();f.x=2*Math.round(r(u.offsetX)+_)*r(y.x),f.y=2*Math.round(r(u.offsetY)+_)*r(y.y)}const d=h.width+f.x,p=h.height+f.y;c.width=Math.ceil(d),c.height=Math.ceil(p);const g=l(c);t.format==="jpeg"&&(g.backgroundColor="#fff"),this.setPositionByOrigin(new E(g.width/2,g.height/2),gt,gt);const m=this.canvas;g._objects=[this],this.set("canvas",g),this.setCoords();const v=g.toCanvasElement(a||1,t);return this.set("canvas",m),this.shadow=n,s&&(this.group=s),this.set(e),this.setCoords(),g._objects=[],g.destroy(),v}toDataURL(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Oh(this.toCanvasElement(t),t.format||"png",t.quality||1)}toBlob(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Mh(this.toCanvasElement(t),t.format||"png",t.quality||1)}isType(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];return e.includes(this.constructor.type)||e.includes(this.type)}complexity(){return 1}toJSON(){return this.toObject()}rotate(t){const{centeredRotation:e,originX:s,originY:n}=this;if(e){const{x:r,y:o}=this.getRelativeCenterPoint();this.originX=gt,this.originY=gt,this.left=r,this.top=o}if(this.set("angle",t),e){const{x:r,y:o}=this.translateToOriginPoint(this.getRelativeCenterPoint(),s,n);this.left=r,this.top=o,this.originX=s,this.originY=n}}setOnGroup(){}_setupCompositeOperation(t){this.globalCompositeOperation&&(t.globalCompositeOperation=this.globalCompositeOperation)}dispose(){Sa.cancelByTarget(this),this.off(),this._set("canvas",void 0),this._cacheCanvas&&Ks().dispose(this._cacheCanvas),this._cacheCanvas=void 0,this._cacheContext=null}animate(t,e){return Object.entries(t).reduce((s,n)=>{let[r,o]=n;return s[r]=this._animate(r,o,e),s},{})}_animate(t,e){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const n=t.split("."),r=this.constructor.colorProperties.includes(n[n.length-1]),{abort:o,startValue:a,onChange:l,onComplete:c}=s,h=w(w({},s),{},{target:this,startValue:a??n.reduce((u,f)=>u[f],this),endValue:e,abort:o==null?void 0:o.bind(this),onChange:(u,f,d)=>{n.reduce((p,g,m)=>(m===n.length-1&&(p[g]=u),p[g]),this),l&&l(u,f,d)},onComplete:(u,f,d)=>{this.setCoords(),c&&c(u,f,d)}});return r?pp(h):Ih(h)}isDescendantOf(t){const{parent:e,group:s}=this;return e===t||s===t||!!e&&e.isDescendantOf(t)||!!s&&s!==e&&s.isDescendantOf(t)}getAncestors(){const t=[];let e=this;do e=e.parent,e&&t.push(e);while(e);return t}findCommonAncestors(t){if(this===t)return{fork:[],otherFork:[],common:[this,...this.getAncestors()]};const e=this.getAncestors(),s=t.getAncestors();if(e.length===0&&s.length>0&&this===s[s.length-1])return{fork:[],otherFork:[t,...s.slice(0,s.length-1)],common:[this]};for(let n,r=0;r<e.length;r++){if(n=e[r],n===t)return{fork:[this,...e.slice(0,r)],otherFork:[],common:e.slice(r)};for(let o=0;o<s.length;o++){if(this===s[o])return{fork:[],otherFork:[t,...s.slice(0,o)],common:[this,...e]};if(n===s[o])return{fork:[this,...e.slice(0,r)],otherFork:[t,...s.slice(0,o)],common:e.slice(r)}}}return{fork:[this,...e],otherFork:[t,...s],common:[]}}hasCommonAncestors(t){const e=this.findCommonAncestors(t);return e&&!!e.common.length}isInFrontOf(t){if(this===t)return;const e=this.findCommonAncestors(t);if(e.fork.includes(t))return!0;if(e.otherFork.includes(this))return!1;const s=e.common[0]||this.canvas;if(!s)return;const n=e.fork.pop(),r=e.otherFork.pop(),o=s._objects.indexOf(n),a=s._objects.indexOf(r);return o>-1&&o>a}toObject(){const t=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).concat(ia.customProperties,this.constructor.customProperties||[]);let e;const s=_t.NUM_FRACTION_DIGITS,{clipPath:n,fill:r,stroke:o,shadow:a,strokeDashArray:l,left:c,top:h,originX:u,originY:f,width:d,height:p,strokeWidth:g,strokeLineCap:m,strokeDashOffset:v,strokeLineJoin:_,strokeUniform:y,strokeMiterLimit:b,scaleX:S,scaleY:P,angle:O,flipX:k,flipY:D,opacity:z,visible:K,backgroundColor:st,fillRule:G,paintFirst:it,globalCompositeOperation:ct,skewX:et,skewY:Z}=this;n&&!n.excludeFromExport&&(e=n.toObject(t.concat("inverted","absolutePositioned")));const Y=Tt=>jt(Tt,s),pt=w(w({},Ci(this,t)),{},{type:this.constructor.type,version:Tc,originX:u,originY:f,left:Y(c),top:Y(h),width:Y(d),height:Y(p),fill:df(r)?r.toObject():r,stroke:df(o)?o.toObject():o,strokeWidth:Y(g),strokeDashArray:l&&l.concat(),strokeLineCap:m,strokeDashOffset:v,strokeLineJoin:_,strokeUniform:y,strokeMiterLimit:Y(b),scaleX:Y(S),scaleY:Y(P),angle:Y(O),flipX:k,flipY:D,opacity:Y(z),shadow:a&&a.toObject(),visible:K,backgroundColor:st,fillRule:G,paintFirst:it,globalCompositeOperation:ct,skewX:Y(et),skewY:Y(Z)},e?{clipPath:e}:null);return this.includeDefaultValues?pt:this._removeDefaultValues(pt)}toDatalessObject(t){return this.toObject(t)}_removeDefaultValues(t){const e=this.constructor.getDefaults(),s=Object.keys(e).length>0?e:Object.getPrototypeOf(this);return Ph(t,(n,r)=>{if(r===wt||r===De||r==="type")return!0;const o=s[r];return n!==o&&!(Array.isArray(n)&&Array.isArray(o)&&n.length===0&&o.length===0)})}toString(){return"#<".concat(this.constructor.type,">")}static _fromObject(t){let e=It(t,Ab),s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{extraParam:n}=s,r=It(s,Fb);return yo(e,r).then(o=>n?(delete o[n],new this(e[n],o)):new this(o))}static fromObject(t,e){return this._fromObject(t,e)}};T(tn,"stateProperties",yb),T(tn,"cacheProperties",vn),T(tn,"ownDefaults",bb),T(tn,"type","FabricObject"),T(tn,"colorProperties",[ee,Le,"backgroundColor"]),T(tn,"customProperties",[]),q.setClass(tn),q.setClass(tn,"object");const Xn=(i,t,e)=>(s,n,r,o)=>{const a=t(s,n,r,o);return a&&Fh(i,w(w({},Dh(s,n,r,o)),e)),a};function Si(i){return(t,e,s,n)=>{const{target:r,originX:o,originY:a}=e,l=r.getRelativeCenterPoint(),c=r.translateToOriginPoint(l,o,a),h=i(t,e,s,n);return r.setPositionByOrigin(c,e.originX,e.originY),h}}const Fc=Xn(eo,Si((i,t,e,s)=>{const n=fl(t,t.originX,t.originY,e,s);if(Jt(t.originX)===Jt(gt)||Jt(t.originX)===Jt($t)&&n.x<0||Jt(t.originX)===Jt(wt)&&n.x>0){const{target:r}=t,o=r.strokeWidth/(r.strokeUniform?r.scaleX:1),a=ap(t)?2:1,l=r.width,c=Math.abs(n.x*a/r.scaleX)-o;return r.set("width",Math.max(c,1)),l!==r.width}return!1}));function mp(i,t,e,s,n){s=s||{};const r=this.sizeX||s.cornerSize||n.cornerSize,o=this.sizeY||s.cornerSize||n.cornerSize,a=s.transparentCorners!==void 0?s.transparentCorners:n.transparentCorners,l=a?Le:ee,c=!a&&(s.cornerStrokeColor||n.cornerStrokeColor);let h,u=t,f=e;i.save(),i.fillStyle=s.cornerColor||n.cornerColor||"",i.strokeStyle=s.cornerStrokeColor||n.cornerStrokeColor||"",r>o?(h=r,i.scale(1,o/r),f=e*r/o):o>r?(h=o,i.scale(r/o,1),u=t*o/r):h=r,i.beginPath(),i.arc(u,f,h/2,0,fn,!1),i[l](),c&&i.stroke(),i.restore()}function vp(i,t,e,s,n){s=s||{};const r=this.sizeX||s.cornerSize||n.cornerSize,o=this.sizeY||s.cornerSize||n.cornerSize,a=s.transparentCorners!==void 0?s.transparentCorners:n.transparentCorners,l=a?Le:ee,c=!a&&(s.cornerStrokeColor||n.cornerStrokeColor),h=r/2,u=o/2;i.save(),i.fillStyle=s.cornerColor||n.cornerColor||"",i.strokeStyle=s.cornerStrokeColor||n.cornerStrokeColor||"",i.translate(t,e);const f=n.getTotalAngle();i.rotate(Yt(f)),i["".concat(l,"Rect")](-h,-u,r,o),c&&i.strokeRect(-h,-u,r,o),i.restore()}class Ce{constructor(t){T(this,"visible",!0),T(this,"actionName",ll),T(this,"angle",0),T(this,"x",0),T(this,"y",0),T(this,"offsetX",0),T(this,"offsetY",0),T(this,"sizeX",0),T(this,"sizeY",0),T(this,"touchSizeX",0),T(this,"touchSizeY",0),T(this,"cursorStyle","crosshair"),T(this,"withConnection",!1),Object.assign(this,t)}shouldActivate(t,e,s,n){var r;let{tl:o,tr:a,br:l,bl:c}=n;return((r=e.canvas)===null||r===void 0?void 0:r.getActiveObject())===e&&e.isControlVisible(t)&&Bt.isPointInPolygon(s,[o,a,l,c])}getActionHandler(t,e,s){return this.actionHandler}getMouseDownHandler(t,e,s){return this.mouseDownHandler}getMouseUpHandler(t,e,s){return this.mouseUpHandler}cursorStyleHandler(t,e,s){return e.cursorStyle}getActionName(t,e,s){return e.actionName}getVisibility(t,e){var s,n;return(s=(n=t._controlsVisibility)===null||n===void 0?void 0:n[e])!==null&&s!==void 0?s:this.visible}setVisibility(t,e,s){this.visible=t}positionHandler(t,e,s,n){return new E(this.x*t.x+this.offsetX,this.y*t.y+this.offsetY).transform(e)}calcCornerCoords(t,e,s,n,r,o){const a=cl([gr(s,n),pr({angle:t}),hl((r?this.touchSizeX:this.sizeX)||e,(r?this.touchSizeY:this.sizeY)||e)]);return{tl:new E(-.5,-.5).transform(a),tr:new E(.5,-.5).transform(a),br:new E(.5,.5).transform(a),bl:new E(-.5,.5).transform(a)}}render(t,e,s,n,r){((n=n||{}).cornerStyle||r.cornerStyle)==="circle"?mp.call(this,t,e,s,n,r):vp.call(this,t,e,s,n,r)}}const _p=(i,t,e)=>e.lockRotation?Ta:t.cursorStyle,yp=Xn(zg,Si((i,t,e,s)=>{let{target:n,ex:r,ey:o,theta:a,originX:l,originY:c}=t;const h=n.translateToOriginPoint(n.getRelativeCenterPoint(),l,c);if(ws(n,"lockRotation"))return!1;const u=Math.atan2(o-h.y,r-h.x),f=Math.atan2(s-h.y,e-h.x);let d=Nn(f-u+a);if(n.snapAngle&&n.snapAngle>0){const g=n.snapAngle,m=n.snapThreshold||g,v=Math.ceil(d/g)*g,_=Math.floor(d/g)*g;Math.abs(d-_)<m?d=_:Math.abs(d-v)<m&&(d=v)}d<0&&(d=360+d),d%=360;const p=n.angle!==d;return n.angle=d,p}));function bp(i,t){const e=t.canvas,s=i[e.uniScaleKey];return e.uniformScaling&&!s||!e.uniformScaling&&s}function xp(i,t,e){const s=ws(i,"lockScalingX"),n=ws(i,"lockScalingY");if(s&&n||!t&&(s||n)&&e||s&&t==="x"||n&&t==="y")return!0;const{width:r,height:o,strokeWidth:a}=i;return r===0&&a===0&&t!=="y"||o===0&&a===0&&t!=="x"}const Db=["e","se","s","sw","w","nw","n","ne","e"],Fi=(i,t,e)=>{const s=bp(i,e);if(xp(e,t.x!==0&&t.y===0?"x":t.x===0&&t.y!==0?"y":"",s))return Ta;const n=lp(e,t);return"".concat(Db[n],"-resize")};function Bh(i,t,e,s){let n=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};const r=t.target,o=n.by,a=bp(i,r);let l,c,h,u,f,d;if(xp(r,o,a))return!1;if(t.gestureScale)c=t.scaleX*t.gestureScale,h=t.scaleY*t.gestureScale;else{if(l=fl(t,t.originX,t.originY,e,s),f=o!=="y"?Math.sign(l.x||t.signX||1):1,d=o!=="x"?Math.sign(l.y||t.signY||1):1,t.signX||(t.signX=f),t.signY||(t.signY=d),ws(r,"lockScalingFlip")&&(t.signX!==f||t.signY!==d))return!1;if(u=r._getTransformedDimensions(),a&&!o){const m=Math.abs(l.x)+Math.abs(l.y),{original:v}=t,_=m/(Math.abs(u.x*v.scaleX/r.scaleX)+Math.abs(u.y*v.scaleY/r.scaleY));c=v.scaleX*_,h=v.scaleY*_}else c=Math.abs(l.x*r.scaleX/u.x),h=Math.abs(l.y*r.scaleY/u.y);ap(t)&&(c*=2,h*=2),t.signX!==f&&o!=="y"&&(t.originX=mf(t.originX),c*=-1,t.signX=f),t.signY!==d&&o!=="x"&&(t.originY=mf(t.originY),h*=-1,t.signY=d)}const p=r.scaleX,g=r.scaleY;return o?(o==="x"&&r.set(Pe,c),o==="y"&&r.set(es,h)):(!ws(r,"lockScalingX")&&r.set(Pe,c),!ws(r,"lockScalingY")&&r.set(es,h)),p!==r.scaleX||g!==r.scaleY}const Tr=Xn(al,Si((i,t,e,s)=>Bh(i,t,e,s))),Cp=Xn(al,Si((i,t,e,s)=>Bh(i,t,e,s,{by:"x"}))),Sp=Xn(al,Si((i,t,e,s)=>Bh(i,t,e,s,{by:"y"}))),Rb=["target","ex","ey","skewingSide"],Vl={x:{counterAxis:"y",scale:Pe,skew:fr,lockSkewing:"lockSkewingX",origin:"originX",flip:"flipX"},y:{counterAxis:"x",scale:es,skew:dr,lockSkewing:"lockSkewingY",origin:"originY",flip:"flipY"}},Lb=["ns","nesw","ew","nwse"],wp=(i,t,e)=>{if(t.x!==0&&ws(e,"lockSkewingY")||t.y!==0&&ws(e,"lockSkewingX"))return Ta;const s=lp(e,t)%4;return"".concat(Lb[s],"-resize")};function Tp(i,t,e,s,n){const{target:r}=e,{counterAxis:o,origin:a,lockSkewing:l,skew:c,flip:h}=Vl[i];if(ws(r,l))return!1;const{origin:u,flip:f}=Vl[o],d=Jt(e[u])*(r[f]?-1:1),p=-Math.sign(d)*(r[h]?-1:1),g=.5*-((r[c]===0&&fl(e,gt,gt,s,n)[i]>0||r[c]>0?1:-1)*p)+.5;return Xn(Vg,Si((v,_,y,b)=>function(S,P,O){let{target:k,ex:D,ey:z,skewingSide:K}=P,st=It(P,Rb);const{skew:G}=Vl[S],it=O.subtract(new E(D,z)).divide(new E(k.scaleX,k.scaleY))[S],ct=k[G],et=st[G],Z=Math.tan(Yt(et)),Y=S==="y"?k._getTransformedDimensions({scaleX:1,scaleY:1,skewX:0}).x:k._getTransformedDimensions({scaleX:1,scaleY:1}).y,pt=2*it*K/Math.max(Y,1)+Z,Tt=Nn(Math.atan(pt));k.set(G,Tt);const Pt=ct!==k[G];if(Pt&&S==="y"){const{skewX:B,scaleX:N}=k,X=k._getTransformedDimensions({skewY:ct}),Vt=k._getTransformedDimensions(),Rt=B!==0?X.x/Vt.x:1;Rt!==1&&k.set(Pe,Rt*N)}return Pt}(i,_,new E(y,b))))(t,w(w({},e),{},{[a]:g,skewingSide:p}),s,n)}const Op=(i,t,e,s)=>Tp("x",i,t,e,s),Mp=(i,t,e,s)=>Tp("y",i,t,e,s);function pl(i,t){return i[t.canvas.altActionKey]}const Or=(i,t,e)=>{const s=pl(i,e);return t.x===0?s?fr:es:t.y===0?s?dr:Pe:""},ri=(i,t,e)=>pl(i,e)?wp(0,t,e):Fi(i,t,e),Dc=(i,t,e,s)=>pl(i,t.target)?Mp(i,t,e,s):Cp(i,t,e,s),Rc=(i,t,e,s)=>pl(i,t.target)?Op(i,t,e,s):Sp(i,t,e,s),Nh=()=>({ml:new Ce({x:-.5,y:0,cursorStyleHandler:ri,actionHandler:Dc,getActionName:Or}),mr:new Ce({x:.5,y:0,cursorStyleHandler:ri,actionHandler:Dc,getActionName:Or}),mb:new Ce({x:0,y:.5,cursorStyleHandler:ri,actionHandler:Rc,getActionName:Or}),mt:new Ce({x:0,y:-.5,cursorStyleHandler:ri,actionHandler:Rc,getActionName:Or}),tl:new Ce({x:-.5,y:-.5,cursorStyleHandler:Fi,actionHandler:Tr}),tr:new Ce({x:.5,y:-.5,cursorStyleHandler:Fi,actionHandler:Tr}),bl:new Ce({x:-.5,y:.5,cursorStyleHandler:Fi,actionHandler:Tr}),br:new Ce({x:.5,y:.5,cursorStyleHandler:Fi,actionHandler:Tr}),mtr:new Ce({x:0,y:-.5,actionHandler:yp,cursorStyleHandler:_p,offsetY:-40,withConnection:!0,actionName:wh})}),Ep=()=>({mr:new Ce({x:.5,y:0,actionHandler:Fc,cursorStyleHandler:ri,actionName:eo}),ml:new Ce({x:-.5,y:0,actionHandler:Fc,cursorStyleHandler:ri,actionName:eo})}),kp=()=>w(w({},Nh()),Ep());class Fn extends tn{static getDefaults(){return w(w({},super.getDefaults()),Fn.ownDefaults)}constructor(t){super(),Object.assign(this,this.constructor.createControls(),Fn.ownDefaults),this.setOptions(t)}static createControls(){return{controls:Nh()}}_updateCacheCanvas(){const t=this.canvas;if(this.noScaleCache&&t&&t._currentTransform){const e=t._currentTransform,s=e.target,n=e.action;if(this===s&&n&&n.startsWith(ll))return!1}return super._updateCacheCanvas()}getActiveControl(){const t=this.__corner;return t?{key:t,control:this.controls[t],coord:this.oCoords[t]}:void 0}findControl(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!this.hasControls||!this.canvas)return;this.__corner=void 0;const s=Object.entries(this.oCoords);for(let n=s.length-1;n>=0;n--){const[r,o]=s[n],a=this.controls[r];if(a.shouldActivate(r,this,t,e?o.touchCorner:o.corner))return this.__corner=r,{key:r,control:a,coord:this.oCoords[r]}}}calcOCoords(){const t=this.getViewportTransform(),e=this.getCenterPoint(),s=gr(e.x,e.y),n=pr({angle:this.getTotalAngle()-(this.group&&this.flipX?180:0)}),r=Xt(s,n),o=Xt(t,r),a=Xt(o,[1/t[0],0,0,1/t[3],0,0]),l=this.group?tr(this.calcTransformMatrix()):void 0;l&&(l.scaleX=Math.abs(l.scaleX),l.scaleY=Math.abs(l.scaleY));const c=this._calculateCurrentDimensions(l),h={};return this.forEachControl((u,f)=>{const d=u.positionHandler(c,a,this,u);h[f]=Object.assign(d,this._calcCornerCoords(u,d))}),h}_calcCornerCoords(t,e){const s=this.getTotalAngle();return{corner:t.calcCornerCoords(s,this.cornerSize,e.x,e.y,!1,this),touchCorner:t.calcCornerCoords(s,this.touchCornerSize,e.x,e.y,!0,this)}}setCoords(){super.setCoords(),this.canvas&&(this.oCoords=this.calcOCoords())}forEachControl(t){for(const e in this.controls)t(this.controls[e],e,this)}drawSelectionBackground(t){if(!this.selectionBackgroundColor||this.canvas&&this.canvas._activeObject!==this)return;t.save();const e=this.getRelativeCenterPoint(),s=this._calculateCurrentDimensions(),n=this.getViewportTransform();t.translate(e.x,e.y),t.scale(1/n[0],1/n[3]),t.rotate(Yt(this.angle)),t.fillStyle=this.selectionBackgroundColor,t.fillRect(-s.x/2,-s.y/2,s.x,s.y),t.restore()}strokeBorders(t,e){t.strokeRect(-e.x/2,-e.y/2,e.x,e.y)}_drawBorders(t,e){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const n=w({hasControls:this.hasControls,borderColor:this.borderColor,borderDashArray:this.borderDashArray},s);t.save(),t.strokeStyle=n.borderColor,this._setLineDash(t,n.borderDashArray),this.strokeBorders(t,e),n.hasControls&&this.drawControlsConnectingLines(t,e),t.restore()}_renderControls(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{hasBorders:s,hasControls:n}=this,r=w({hasBorders:s,hasControls:n},e),o=this.getViewportTransform(),a=r.hasBorders,l=r.hasControls,c=Xt(o,this.calcTransformMatrix()),h=tr(c);t.save(),t.translate(h.translateX,h.translateY),t.lineWidth=this.borderScaleFactor,this.group===this.parent&&(t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(h.angle-=180),t.rotate(Yt(this.group?h.angle:this.angle)),a&&this.drawBorders(t,h,e),l&&this.drawControls(t,e),t.restore()}drawBorders(t,e,s){let n;if(s&&s.forActiveSelection||this.group){const r=ul(this.width,this.height,_o(e)),o=this.isStrokeAccountedForInDimensions()?Th:(this.strokeUniform?new E().scalarAdd(this.canvas?this.canvas.getZoom():1):new E(e.scaleX,e.scaleY)).scalarMultiply(this.strokeWidth);n=r.add(o).scalarAdd(this.borderScaleFactor).scalarAdd(2*this.padding)}else n=this._calculateCurrentDimensions().scalarAdd(this.borderScaleFactor);this._drawBorders(t,n,s)}drawControlsConnectingLines(t,e){let s=!1;t.beginPath(),this.forEachControl((n,r)=>{n.withConnection&&n.getVisibility(this,r)&&(s=!0,t.moveTo(n.x*e.x,n.y*e.y),t.lineTo(n.x*e.x+n.offsetX,n.y*e.y+n.offsetY))}),s&&t.stroke()}drawControls(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};t.save();const s=this.getCanvasRetinaScaling(),{cornerStrokeColor:n,cornerDashArray:r,cornerColor:o}=this,a=w({cornerStrokeColor:n,cornerDashArray:r,cornerColor:o},e);t.setTransform(s,0,0,s,0,0),t.strokeStyle=t.fillStyle=a.cornerColor,this.transparentCorners||(t.strokeStyle=a.cornerStrokeColor),this._setLineDash(t,a.cornerDashArray),this.forEachControl((l,c)=>{if(l.getVisibility(this,c)){const h=this.oCoords[c];l.render(t,h.x,h.y,a,this)}}),t.restore()}isControlVisible(t){return this.controls[t]&&this.controls[t].getVisibility(this,t)}setControlVisible(t,e){this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[t]=e}setControlsVisibility(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Object.entries(t).forEach(e=>{let[s,n]=e;return this.setControlVisible(s,n)})}clearContextTop(t){if(!this.canvas)return;const e=this.canvas.contextTop;if(!e)return;const s=this.canvas.viewportTransform;e.save(),e.transform(s[0],s[1],s[2],s[3],s[4],s[5]),this.transform(e);const n=this.width+4,r=this.height+4;return e.clearRect(-n/2,-r/2,n,r),t||e.restore(),e}onDeselect(t){return!1}onSelect(t){return!1}shouldStartDragging(t){return!1}onDragStart(t){return!1}canDrop(t){return!1}renderDragSourceEffect(t){}renderDropTargetEffect(t){}}function Pp(i,t){return t.forEach(e=>{Object.getOwnPropertyNames(e.prototype).forEach(s=>{s!=="constructor"&&Object.defineProperty(i.prototype,s,Object.getOwnPropertyDescriptor(e.prototype,s)||Object.create(null))})}),i}T(Fn,"ownDefaults",{noScaleCache:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,cornerSize:13,touchCornerSize:24,transparentCorners:!0,cornerColor:"rgb(178,204,255)",cornerStrokeColor:"",cornerStyle:"rect",cornerDashArray:null,hasControls:!0,borderColor:"rgb(178,204,255)",borderDashArray:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,hasBorders:!0,selectionBackgroundColor:"",selectable:!0,evented:!0,perPixelTargetFind:!1,activeOn:"down",hoverCursor:null,moveCursor:null});class ne extends Fn{}Pp(ne,[hp]),q.setClass(ne),q.setClass(ne,"object");const Ap=(i,t,e,s)=>{const n=2*(s=Math.round(s))+1,{data:r}=i.getImageData(t-s,e-s,n,n);for(let o=3;o<r.length;o+=4)if(r[o]>0)return!1;return!0};class Fp{constructor(t){this.options=t,this.strokeProjectionMagnitude=this.options.strokeWidth/2,this.scale=new E(this.options.scaleX,this.options.scaleY),this.strokeUniformScalar=this.options.strokeUniform?new E(1/this.options.scaleX,1/this.options.scaleY):new E(1,1)}createSideVector(t,e){const s=Oa(t,e);return this.options.strokeUniform?s.multiply(this.scale):s}projectOrthogonally(t,e,s){return this.applySkew(t.add(this.calcOrthogonalProjection(t,e,s)))}isSkewed(){return this.options.skewX!==0||this.options.skewY!==0}applySkew(t){const e=new E(t);return e.y+=e.x*Math.tan(Yt(this.options.skewY)),e.x+=e.y*Math.tan(Yt(this.options.skewX)),e}scaleUnitVector(t,e){return t.multiply(this.strokeUniformScalar).scalarMultiply(e)}}const jb=new E;class Yi extends Fp{static getOrthogonalRotationFactor(t,e){const s=e?Ea(t,e):fp(t);return Math.abs(s)<In?-1:1}constructor(t,e,s,n){super(n),T(this,"AB",void 0),T(this,"AC",void 0),T(this,"alpha",void 0),T(this,"bisector",void 0),this.A=new E(t),this.B=new E(e),this.C=new E(s),this.AB=this.createSideVector(this.A,this.B),this.AC=this.createSideVector(this.A,this.C),this.alpha=Ea(this.AB,this.AC),this.bisector=gl(Rh(this.AB.eq(jb)?this.AC:this.AB,this.alpha/2))}calcOrthogonalProjection(t,e){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.strokeProjectionMagnitude;const n=this.createSideVector(t,e),r=Lh(n),o=Yi.getOrthogonalRotationFactor(r,this.bisector);return this.scaleUnitVector(r,s*o)}projectBevel(){const t=[];return(this.alpha%fn==0?[this.B]:[this.B,this.C]).forEach(e=>{t.push(this.projectOrthogonally(this.A,e)),t.push(this.projectOrthogonally(this.A,e,-this.strokeProjectionMagnitude))}),t}projectMiter(){const t=[],e=Math.abs(this.alpha),s=1/Math.sin(e/2),n=this.scaleUnitVector(this.bisector,-this.strokeProjectionMagnitude*s),r=this.options.strokeUniform?Ma(this.scaleUnitVector(this.bisector,this.options.strokeMiterLimit)):this.options.strokeMiterLimit;return Ma(n)/this.strokeProjectionMagnitude<=r&&t.push(this.applySkew(this.A.add(n))),t.push(...this.projectBevel()),t}projectRoundNoSkew(t,e){const s=[],n=new E(Yi.getOrthogonalRotationFactor(this.bisector),Yi.getOrthogonalRotationFactor(new E(this.bisector.y,this.bisector.x)));return[new E(1,0).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar).multiply(n),new E(0,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar).multiply(n)].forEach(r=>{Pc(r,t,e)&&s.push(this.A.add(r))}),s}projectRoundWithSkew(t,e){const s=[],{skewX:n,skewY:r,scaleX:o,scaleY:a,strokeUniform:l}=this.options,c=new E(Math.tan(Yt(n)),Math.tan(Yt(r))),h=this.strokeProjectionMagnitude,u=l?h/a/Math.sqrt(1/a**2+1/o**2*c.y**2):h/Math.sqrt(1+c.y**2),f=new E(Math.sqrt(Math.max(h**2-u**2,0)),u),d=l?h/Math.sqrt(1+c.x**2*(1/a)**2/(1/o+1/o*c.x*c.y)**2):h/Math.sqrt(1+c.x**2/(1+c.x*c.y)**2),p=new E(d,Math.sqrt(Math.max(h**2-d**2,0)));return[p,p.scalarMultiply(-1),f,f.scalarMultiply(-1)].map(g=>this.applySkew(l?g.multiply(this.strokeUniformScalar):g)).forEach(g=>{Pc(g,t,e)&&s.push(this.applySkew(this.A).add(g))}),s}projectRound(){const t=[];t.push(...this.projectBevel());const e=this.alpha%fn==0,s=this.applySkew(this.A),n=t[e?0:2].subtract(s),r=t[e?1:0].subtract(s),o=e?this.applySkew(this.AB.scalarMultiply(-1)):this.applySkew(this.bisector.multiply(this.strokeUniformScalar).scalarMultiply(-1)),a=Wi(n,o)>0,l=a?n:r,c=a?r:n;return this.isSkewed()?t.push(...this.projectRoundWithSkew(l,c)):t.push(...this.projectRoundNoSkew(l,c)),t}projectPoints(){switch(this.options.strokeLineJoin){case"miter":return this.projectMiter();case"round":return this.projectRound();default:return this.projectBevel()}}project(){return this.projectPoints().map(t=>({originPoint:this.A,projectedPoint:t,angle:this.alpha,bisector:this.bisector}))}}class Sf extends Fp{constructor(t,e,s){super(s),this.A=new E(t),this.T=new E(e)}calcOrthogonalProjection(t,e){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.strokeProjectionMagnitude;const n=this.createSideVector(t,e);return this.scaleUnitVector(Lh(n),s)}projectButt(){return[this.projectOrthogonally(this.A,this.T,this.strokeProjectionMagnitude),this.projectOrthogonally(this.A,this.T,-this.strokeProjectionMagnitude)]}projectRound(){const t=[];if(!this.isSkewed()&&this.A.eq(this.T)){const e=new E(1,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar);t.push(this.applySkew(this.A.add(e)),this.applySkew(this.A.subtract(e)))}else t.push(...new Yi(this.A,this.T,this.T,this.options).projectRound());return t}projectSquare(){const t=[];if(this.A.eq(this.T)){const e=new E(1,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar);t.push(this.A.add(e),this.A.subtract(e))}else{const e=this.calcOrthogonalProjection(this.A,this.T,this.strokeProjectionMagnitude),s=this.scaleUnitVector(gl(this.createSideVector(this.A,this.T)),-this.strokeProjectionMagnitude),n=this.A.add(s);t.push(n.add(e),n.subtract(e))}return t.map(e=>this.applySkew(e))}projectPoints(){switch(this.options.strokeLineCap){case"round":return this.projectRound();case"square":return this.projectSquare();default:return this.projectButt()}}project(){return this.projectPoints().map(t=>({originPoint:this.A,projectedPoint:t}))}}const Dp=function(i,t){let e=arguments.length>2&&arguments[2]!==void 0&&arguments[2];const s=[];if(i.length===0)return s;const n=i.reduce((r,o)=>(r[r.length-1].eq(o)||r.push(new E(o)),r),[new E(i[0])]);if(n.length===1)e=!0;else if(!e){const r=n[0],o=((a,l)=>{for(let c=a.length-1;c>=0;c--)if(l(a[c],c,a))return c;return-1})(n,a=>!a.eq(r));n.splice(o+1)}return n.forEach((r,o,a)=>{let l,c;o===0?(c=a[1],l=e?r:a[a.length-1]):o===a.length-1?(l=a[o-1],c=e?r:a[0]):(l=a[o-1],c=a[o+1]),e&&a.length===1?s.push(...new Sf(r,r,t).project()):!e||o!==0&&o!==a.length-1?s.push(...new Yi(r,l,c,t).project()):s.push(...new Sf(r,o===0?c:l,t).project())}),s},Hh=i=>{const t={};return Object.keys(i).forEach(e=>{t[e]={},Object.keys(i[e]).forEach(s=>{t[e][s]=w({},i[e][s])})}),t},Rp=i=>i.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),ml=i=>{const t=[];for(let e,s=0;s<i.length;s++)(e=Ib(i,s))!==!1&&t.push(e);return t},Ib=(i,t)=>{const e=i.charCodeAt(t);if(isNaN(e))return"";if(e<55296||e>57343)return i.charAt(t);if(55296<=e&&e<=56319){if(i.length<=t+1)throw"High surrogate without following low surrogate";const n=i.charCodeAt(t+1);if(56320>n||n>57343)throw"High surrogate without following low surrogate";return i.charAt(t)+i.charAt(t+1)}if(t===0)throw"Low surrogate without preceding high surrogate";const s=i.charCodeAt(t-1);if(55296>s||s>56319)throw"Low surrogate without preceding high surrogate";return!1};var Bb=Object.freeze({__proto__:null,capitalize:function(i){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return"".concat(i.charAt(0).toUpperCase()).concat(t?i.slice(1):i.slice(1).toLowerCase())},escapeXml:Rp,graphemeSplit:ml});const vl=function(i,t){let e=arguments.length>2&&arguments[2]!==void 0&&arguments[2];return i.fill!==t.fill||i.stroke!==t.stroke||i.strokeWidth!==t.strokeWidth||i.fontSize!==t.fontSize||i.fontFamily!==t.fontFamily||i.fontWeight!==t.fontWeight||i.fontStyle!==t.fontStyle||i.textBackgroundColor!==t.textBackgroundColor||i.deltaY!==t.deltaY||e&&(i.overline!==t.overline||i.underline!==t.underline||i.linethrough!==t.linethrough)},Lp=(i,t)=>{const e=t.split(`
`),s=[];let n=-1,r={};i=Hh(i);for(let o=0;o<e.length;o++){const a=ml(e[o]);if(i[o])for(let l=0;l<a.length;l++){n++;const c=i[o][l];c&&Object.keys(c).length>0&&(vl(r,c,!0)?s.push({start:n,end:n+1,style:c}):s[s.length-1].end++),r=c||{}}else n+=a.length,r={}}return s},jp=(i,t)=>{if(!Array.isArray(i))return Hh(i);const e=t.split(Sh),s={};let n=-1,r=0;for(let o=0;o<e.length;o++){const a=ml(e[o]);for(let l=0;l<a.length;l++)n++,i[r]&&i[r].start<=n&&n<i[r].end&&(s[o]=s[o]||{},s[o][l]=w({},i[r].style),n===i[r].end-1&&r++)}return s},Un=["display","transform",ee,"fill-opacity","fill-rule","opacity",Le,"stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"];function wf(i,t){const e=i.nodeName,s=i.getAttribute("class"),n=i.getAttribute("id"),r="(?![a-zA-Z\\-]+)";let o;if(o=new RegExp("^"+e,"i"),t=t.replace(o,""),n&&t.length&&(o=new RegExp("#"+n+r,"i"),t=t.replace(o,"")),s&&t.length){const a=s.split(" ");for(let l=a.length;l--;)o=new RegExp("\\."+a[l]+r,"i"),t=t.replace(o,"")}return t.length===0}function Nb(i,t){let e=!0;const s=wf(i,t.pop());return s&&t.length&&(e=function(n,r){let o,a=!0;for(;n.parentElement&&n.parentElement.nodeType===1&&r.length;)a&&(o=r.pop()),a=wf(n=n.parentElement,o);return r.length===0}(i,t)),s&&e&&t.length===0}const Hb=i=>{var t;return(t=vb[i])!==null&&t!==void 0?t:i},zb=new RegExp("(".concat(_i,")"),"gi"),Vb=i=>i.replace(zb," $1 ").replace(/,/gi," ").replace(/\s+/gi," ");var Tf,Of,Mf,Ef,kf,Pf,Af;const Te="(".concat(_i,")"),Wb=String.raw(Tf||(Tf=Yn(["(skewX)(",")"],["(skewX)\\(","\\)"])),Te),Yb=String.raw(Of||(Of=Yn(["(skewY)(",")"],["(skewY)\\(","\\)"])),Te),Xb=String.raw(Mf||(Mf=Yn(["(rotate)(","(?: "," ",")?)"],["(rotate)\\(","(?: "," ",")?\\)"])),Te,Te,Te),Ub=String.raw(Ef||(Ef=Yn(["(scale)(","(?: ",")?)"],["(scale)\\(","(?: ",")?\\)"])),Te,Te),Gb=String.raw(kf||(kf=Yn(["(translate)(","(?: ",")?)"],["(translate)\\(","(?: ",")?\\)"])),Te,Te),$b=String.raw(Pf||(Pf=Yn(["(matrix)("," "," "," "," "," ",")"],["(matrix)\\("," "," "," "," "," ","\\)"])),Te,Te,Te,Te,Te,Te),zh="(?:".concat($b,"|").concat(Gb,"|").concat(Xb,"|").concat(Ub,"|").concat(Wb,"|").concat(Yb,")"),qb="(?:".concat(zh,"*)"),Kb=String.raw(Af||(Af=Yn(["^s*(?:","?)s*$"],["^\\s*(?:","?)\\s*$"])),qb),Zb=new RegExp(Kb),Jb=new RegExp(zh),Qb=new RegExp(zh,"g");function Lc(i){const t=[];if(!(i=Vb(i).replace(/\s*([()])\s*/gi,"$1"))||i&&!Zb.test(i))return[...ke];for(const e of i.matchAll(Qb)){const s=Jb.exec(e[0]);if(!s)continue;let n=ke;const r=s.filter(p=>!!p),[,o,...a]=r,[l,c,h,u,f,d]=a.map(p=>parseFloat(p));switch(o){case"translate":n=gr(l,c);break;case wh:n=pr({angle:l},{x:c,y:h});break;case ll:n=hl(l,c);break;case fr:n=Eh(l);break;case dr:n=kh(l);break;case"matrix":n=[l,c,h,u,f,d]}t.push(n)}return cl(t)}function tx(i,t,e,s){const n=Array.isArray(t);let r,o=t;if(i!==ee&&i!==Le||t!==Re){if(i==="strokeUniform")return t==="non-scaling-stroke";if(i==="strokeDashArray")o=t===Re?null:t.replace(/,/g," ").split(/\s+/).map(parseFloat);else if(i==="transformMatrix")o=e&&e.transformMatrix?Xt(e.transformMatrix,Lc(t)):Lc(t);else if(i==="visible")o=t!==Re&&t!=="hidden",e&&e.visible===!1&&(o=!1);else if(i==="opacity")o=parseFloat(t),e&&e.opacity!==void 0&&(o*=e.opacity);else if(i==="textAnchor")o=t==="start"?wt:t==="end"?$t:gt;else if(i==="charSpacing")r=ci(t,s)/s*1e3;else if(i==="paintFirst"){const a=t.indexOf(ee),l=t.indexOf(Le);o=ee,(a>-1&&l>-1&&l<a||a===-1&&l>-1)&&(o=Le)}else{if(i==="href"||i==="xlink:href"||i==="font"||i==="id")return t;if(i==="imageSmoothing")return t==="optimizeQuality";r=n?t.map(ci):ci(t,s)}}else o="";return!n&&isNaN(r)?o:r}function ex(i,t){const e=i.match(mb);if(!e)return;const s=e[1],n=e[3],r=e[4],o=e[5],a=e[6];s&&(t.fontStyle=s),n&&(t.fontWeight=isNaN(parseFloat(n))?n:parseFloat(n)),r&&(t.fontSize=ci(r)),a&&(t.fontFamily=a),o&&(t.lineHeight=o==="normal"?1:o)}function sx(i,t){i.replace(/;\s*$/,"").split(";").forEach(e=>{if(!e)return;const[s,n]=e.split(":");t[s.trim().toLowerCase()]=n.trim()})}function nx(i){const t={},e=i.getAttribute("style");return e&&(typeof e=="string"?sx(e,t):function(s,n){Object.entries(s).forEach(r=>{let[o,a]=r;a!==void 0&&(n[o.toLowerCase()]=a)})}(e,t)),t}const ix={stroke:"strokeOpacity",fill:"fillOpacity"};function _n(i,t,e){if(!i)return{};let s,n={},r=Ch;i.parentNode&&_f.test(i.parentNode.nodeName)&&(n=_n(i.parentElement,t,e),n.fontSize&&(s=r=ci(n.fontSize)));const o=w(w(w({},t.reduce((c,h)=>{const u=i.getAttribute(h);return u&&(c[h]=u),c},{})),function(c){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},u={};for(const f in h)Nb(c,f.split(" "))&&(u=w(w({},u),h[f]));return u}(i,e)),nx(i));o[Nl]&&i.setAttribute(Nl,o[Nl]),o[Bl]&&(s=ci(o[Bl],r),o[Bl]="".concat(s));const a={};for(const c in o){const h=Hb(c),u=tx(h,o[c],n,s);a[h]=u}a&&a.font&&ex(a.font,a);const l=w(w({},n),a);return _f.test(i.nodeName)?l:function(c){const h=ne.getDefaults();return Object.entries(ix).forEach(u=>{let[f,d]=u;if(c[d]===void 0||c[f]==="")return;if(c[f]===void 0){if(!h[f])return;c[f]=h[f]}if(c[f].indexOf("url(")===0)return;const p=new Mt(c[f]);c[f]=p.setAlpha(jt(p.getAlpha()*c[d],2)).toRgba()}),c}(l)}const rx=["left","top","width","height","visible"],Ip=["rx","ry"];class as extends ne{static getDefaults(){return w(w({},super.getDefaults()),as.ownDefaults)}constructor(t){super(),Object.assign(this,as.ownDefaults),this.setOptions(t),this._initRxRy()}_initRxRy(){const{rx:t,ry:e}=this;t&&!e?this.ry=t:e&&!t&&(this.rx=e)}_render(t){const{width:e,height:s}=this,n=-e/2,r=-s/2,o=this.rx?Math.min(this.rx,e/2):0,a=this.ry?Math.min(this.ry,s/2):0,l=o!==0||a!==0;t.beginPath(),t.moveTo(n+o,r),t.lineTo(n+e-o,r),l&&t.bezierCurveTo(n+e-bn*o,r,n+e,r+bn*a,n+e,r+a),t.lineTo(n+e,r+s-a),l&&t.bezierCurveTo(n+e,r+s-bn*a,n+e-bn*o,r+s,n+e-o,r+s),t.lineTo(n+o,r+s),l&&t.bezierCurveTo(n+bn*o,r+s,n,r+s-bn*a,n,r+s-a),t.lineTo(n,r+a),l&&t.bezierCurveTo(n,r+bn*a,n+bn*o,r,n+o,r),t.closePath(),this._renderPaintInOrder(t)}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return super.toObject([...Ip,...t])}_toSVG(){const{width:t,height:e,rx:s,ry:n}=this;return["<rect ","COMMON_PARTS",'x="'.concat(-t/2,'" y="').concat(-e/2,'" rx="').concat(s,'" ry="').concat(n,'" width="').concat(t,'" height="').concat(e,`" />
`)]}static async fromElement(t,e,s){const n=_n(t,this.ATTRIBUTE_NAMES,s),{left:r=0,top:o=0,width:a=0,height:l=0,visible:c=!0}=n,h=It(n,rx);return new this(w(w(w({},e),h),{},{left:r,top:o,width:a,height:l,visible:!!(c&&a&&l)}))}}T(as,"type","Rect"),T(as,"cacheProperties",[...vn,...Ip]),T(as,"ownDefaults",{rx:0,ry:0}),T(as,"ATTRIBUTE_NAMES",[...Un,"x","y","rx","ry","width","height"]),q.setClass(as),q.setSVGClass(as);const ln="initialization",ka="added",Vh="removed",Pa="imperative",Bp=(i,t)=>{const{strokeUniform:e,strokeWidth:s,width:n,height:r,group:o}=t,a=o&&o!==i?xo(o.calcTransformMatrix(),i.calcTransformMatrix()):null,l=a?t.getRelativeCenterPoint().transform(a):t.getRelativeCenterPoint(),c=!t.isStrokeAccountedForInDimensions(),h=e&&c?op(new E(s,s),void 0,i.calcTransformMatrix()):Th,u=!e&&c?s:0,f=ul(n+u,r+u,cl([a,t.calcOwnMatrix()],!0)).add(h).scalarDivide(2);return[l.subtract(f),l.add(f)]};class _l{calcLayoutResult(t,e){if(this.shouldPerformLayout(t))return this.calcBoundingBox(e,t)}shouldPerformLayout(t){let{type:e,prevStrategy:s,strategy:n}=t;return e===ln||e===Pa||!!s&&n!==s}shouldLayoutClipPath(t){let{type:e,target:{clipPath:s}}=t;return e!==ln&&s&&!s.absolutePositioned}getInitialSize(t,e){return e.size}calcBoundingBox(t,e){const{type:s,target:n}=e;if(s===Pa&&e.overrides)return e.overrides;if(t.length===0)return;const{left:r,top:o,width:a,height:l}=Ys(t.map(u=>Bp(n,u)).reduce((u,f)=>u.concat(f),[])),c=new E(a,l),h=new E(r,o).add(c.scalarDivide(2));if(s===ln){const u=this.getInitialSize(e,{size:c,center:h});return{center:h,relativeCorrection:new E(0,0),size:u}}return{center:h.transform(n.calcOwnMatrix()),size:c}}}T(_l,"type","strategy");class jc extends _l{shouldPerformLayout(t){return!0}}T(jc,"type","fit-content"),q.setClass(jc);const ox=["strategy"],ax=["target","strategy","bubbles","prevStrategy"],Np="layoutManager";class io{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:new jc;T(this,"strategy",void 0),this.strategy=t,this._subscriptions=new Map}performLayout(t){const e=w(w({bubbles:!0,strategy:this.strategy},t),{},{prevStrategy:this._prevLayoutStrategy,stopPropagation(){this.bubbles=!1}});this.onBeforeLayout(e);const s=this.getLayoutResult(e);s&&this.commitLayout(e,s),this.onAfterLayout(e,s),this._prevLayoutStrategy=e.strategy}attachHandlers(t,e){const{target:s}=e;return[Ca,Hg,eo,zg,al,Vg,xa,Wg,cb].map(n=>t.on(n,r=>this.performLayout(n===Ca?{type:"object_modified",trigger:n,e:r,target:s}:{type:"object_modifying",trigger:n,e:r,target:s})))}subscribe(t,e){this.unsubscribe(t,e);const s=this.attachHandlers(t,e);this._subscriptions.set(t,s)}unsubscribe(t,e){(this._subscriptions.get(t)||[]).forEach(s=>s()),this._subscriptions.delete(t)}unsubscribeTargets(t){t.targets.forEach(e=>this.unsubscribe(e,t))}subscribeTargets(t){t.targets.forEach(e=>this.subscribe(e,t))}onBeforeLayout(t){const{target:e,type:s}=t,{canvas:n}=e;if(s===ln||s===ka?this.subscribeTargets(t):s===Vh&&this.unsubscribeTargets(t),e.fire("layout:before",{context:t}),n&&n.fire("object:layout:before",{target:e,context:t}),s===Pa&&t.deep){const r=It(t,ox);e.forEachObject(o=>o.layoutManager&&o.layoutManager.performLayout(w(w({},r),{},{bubbles:!1,target:o})))}}getLayoutResult(t){const{target:e,strategy:s,type:n}=t,r=s.calcLayoutResult(t,e.getObjects());if(!r)return;const o=n===ln?new E:e.getRelativeCenterPoint(),{center:a,correction:l=new E,relativeCorrection:c=new E}=r,h=o.subtract(a).add(l).transform(n===ln?ke:Ke(e.calcOwnMatrix()),!0).add(c);return{result:r,prevCenter:o,nextCenter:a,offset:h}}commitLayout(t,e){const{target:s}=t,{result:{size:n},nextCenter:r}=e;var o,a;s.set({width:n.x,height:n.y}),this.layoutObjects(t,e),t.type===ln?s.set({left:(o=t.x)!==null&&o!==void 0?o:r.x+n.x*Jt(s.originX),top:(a=t.y)!==null&&a!==void 0?a:r.y+n.y*Jt(s.originY)}):(s.setPositionByOrigin(r,gt,gt),s.setCoords(),s.set("dirty",!0))}layoutObjects(t,e){const{target:s}=t;s.forEachObject(n=>{n.group===s&&this.layoutObject(t,e,n)}),t.strategy.shouldLayoutClipPath(t)&&this.layoutObject(t,e,s.clipPath)}layoutObject(t,e,s){let{offset:n}=e;s.set({left:s.left+n.x,top:s.top+n.y})}onAfterLayout(t,e){const{target:s,strategy:n,bubbles:r,prevStrategy:o}=t,a=It(t,ax),{canvas:l}=s;s.fire("layout:after",{context:t,result:e}),l&&l.fire("object:layout:after",{context:t,result:e,target:s});const c=s.parent;r&&c!=null&&c.layoutManager&&((a.path||(a.path=[])).push(s),c.layoutManager.performLayout(w(w({},a),{},{target:c}))),s.set("dirty",!0)}dispose(){const{_subscriptions:t}=this;t.forEach(e=>e.forEach(s=>s())),t.clear()}toObject(){return{type:Np,strategy:this.strategy.constructor.type}}toJSON(){return this.toObject()}}q.setClass(io,Np);const lx=["type","objects","layoutManager"];class cx extends io{performLayout(){}}class gs extends Yg(ne){static getDefaults(){return w(w({},super.getDefaults()),gs.ownDefaults)}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),T(this,"_activeObjects",[]),T(this,"__objectSelectionTracker",void 0),T(this,"__objectSelectionDisposer",void 0),Object.assign(this,gs.ownDefaults),this.setOptions(e),this.groupInit(t,e)}groupInit(t,e){var s;this._objects=[...t],this.__objectSelectionTracker=this.__objectSelectionMonitor.bind(this,!0),this.__objectSelectionDisposer=this.__objectSelectionMonitor.bind(this,!1),this.forEachObject(n=>{this.enterGroup(n,!1)}),this.layoutManager=(s=e.layoutManager)!==null&&s!==void 0?s:new io,this.layoutManager.performLayout({type:ln,target:this,targets:[...t],x:e.left,y:e.top})}canEnterGroup(t){return t===this||this.isDescendantOf(t)?(jn("error","Group: circular object trees are not supported, this call has no effect"),!1):this._objects.indexOf(t)===-1||(jn("error","Group: duplicate objects are not supported inside group, this call has no effect"),!1)}_filterObjectsBeforeEnteringGroup(t){return t.filter((e,s,n)=>this.canEnterGroup(e)&&n.indexOf(e)===s)}add(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];const n=this._filterObjectsBeforeEnteringGroup(e),r=super.add(...n);return this._onAfterObjectsChange(ka,n),r}insertAt(t){for(var e=arguments.length,s=new Array(e>1?e-1:0),n=1;n<e;n++)s[n-1]=arguments[n];const r=this._filterObjectsBeforeEnteringGroup(s),o=super.insertAt(t,...r);return this._onAfterObjectsChange(ka,r),o}remove(){const t=super.remove(...arguments);return this._onAfterObjectsChange(Vh,t),t}_onObjectAdded(t){this.enterGroup(t,!0),this.fire("object:added",{target:t}),t.fire("added",{target:this})}_onObjectRemoved(t,e){this.exitGroup(t,e),this.fire("object:removed",{target:t}),t.fire("removed",{target:this})}_onAfterObjectsChange(t,e){this.layoutManager.performLayout({type:t,targets:e,target:this})}_onStackOrderChanged(){this._set("dirty",!0)}_set(t,e){const s=this[t];return super._set(t,e),t==="canvas"&&s!==e&&(this._objects||[]).forEach(n=>{n._set(t,e)}),this}_shouldSetNestedCoords(){return this.subTargetCheck}removeAll(){return this._activeObjects=[],this.remove(...this._objects)}__objectSelectionMonitor(t,e){let{target:s}=e;const n=this._activeObjects;if(t)n.push(s),this._set("dirty",!0);else if(n.length>0){const r=n.indexOf(s);r>-1&&(n.splice(r,1),this._set("dirty",!0))}}_watchObject(t,e){t&&this._watchObject(!1,e),t?(e.on("selected",this.__objectSelectionTracker),e.on("deselected",this.__objectSelectionDisposer)):(e.off("selected",this.__objectSelectionTracker),e.off("deselected",this.__objectSelectionDisposer))}enterGroup(t,e){t.group&&t.group.remove(t),t._set("parent",this),this._enterGroup(t,e)}_enterGroup(t,e){e&&sr(t,Xt(Ke(this.calcTransformMatrix()),t.calcTransformMatrix())),this._shouldSetNestedCoords()&&t.setCoords(),t._set("group",this),t._set("canvas",this.canvas),this._watchObject(!0,t);const s=this.canvas&&this.canvas.getActiveObject&&this.canvas.getActiveObject();s&&(s===t||t.isDescendantOf(s))&&this._activeObjects.push(t)}exitGroup(t,e){this._exitGroup(t,e),t._set("parent",void 0),t._set("canvas",void 0)}_exitGroup(t,e){t._set("group",void 0),e||(sr(t,Xt(this.calcTransformMatrix(),t.calcTransformMatrix())),t.setCoords()),this._watchObject(!1,t);const s=this._activeObjects.length>0?this._activeObjects.indexOf(t):-1;s>-1&&this._activeObjects.splice(s,1)}shouldCache(){const t=ne.prototype.shouldCache.call(this);if(t){for(let e=0;e<this._objects.length;e++)if(this._objects[e].willDrawShadow())return this.ownCaching=!1,!1}return t}willDrawShadow(){if(super.willDrawShadow())return!0;for(let t=0;t<this._objects.length;t++)if(this._objects[t].willDrawShadow())return!0;return!1}isOnACache(){return this.ownCaching||!!this.parent&&this.parent.isOnACache()}drawObject(t,e,s){this._renderBackground(t);for(let r=0;r<this._objects.length;r++){var n;const o=this._objects[r];(n=this.canvas)!==null&&n!==void 0&&n.preserveObjectStacking&&o.group!==this?(t.save(),t.transform(...Ke(this.calcTransformMatrix())),o.render(t),t.restore()):o.group===this&&o.render(t)}this._drawClipPath(t,this.clipPath,s)}setCoords(){super.setCoords(),this._shouldSetNestedCoords()&&this.forEachObject(t=>t.setCoords())}triggerLayout(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.layoutManager.performLayout(w({target:this,type:Pa},t))}render(t){this._transformDone=!0,super.render(t),this._transformDone=!1}__serializeObjects(t,e){const s=this.includeDefaultValues;return this._objects.filter(function(n){return!n.excludeFromExport}).map(function(n){const r=n.includeDefaultValues;n.includeDefaultValues=s;const o=n[t||"toObject"](e);return n.includeDefaultValues=r,o})}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const e=this.layoutManager.toObject();return w(w(w({},super.toObject(["subTargetCheck","interactive",...t])),e.strategy!=="fit-content"||this.includeDefaultValues?{layoutManager:e}:{}),{},{objects:this.__serializeObjects("toObject",t)})}toString(){return"#<Group: (".concat(this.complexity(),")>")}dispose(){this.layoutManager.unsubscribeTargets({targets:this.getObjects(),target:this}),this._activeObjects=[],this.forEachObject(t=>{this._watchObject(!1,t),t.dispose()}),super.dispose()}_createSVGBgRect(t){if(!this.backgroundColor)return"";const e=as.prototype._toSVG.call(this),s=e.indexOf("COMMON_PARTS");e[s]='for="group" ';const n=e.join("");return t?t(n):n}_toSVG(t){const e=["<g ","COMMON_PARTS",` >
`],s=this._createSVGBgRect(t);s&&e.push("		",s);for(let n=0;n<this._objects.length;n++)e.push("		",this._objects[n].toSVG(t));return e.push(`</g>
`),e}getSvgStyles(){const t=this.opacity!==void 0&&this.opacity!==1?"opacity: ".concat(this.opacity,";"):"",e=this.visible?"":" visibility: hidden;";return[t,this.getSvgFilter(),e].join("")}toClipPathSVG(t){const e=[],s=this._createSVGBgRect(t);s&&e.push("	",s);for(let n=0;n<this._objects.length;n++)e.push("	",this._objects[n].toClipPathSVG(t));return this._createBaseClipPathSVGMarkup(e,{reviver:t})}static fromObject(t,e){let{type:s,objects:n=[],layoutManager:r}=t,o=It(t,lx);return Promise.all([er(n,e),yo(o,e)]).then(a=>{let[l,c]=a;const h=new this(l,w(w(w({},o),c),{},{layoutManager:new cx}));if(r){const u=q.getClass(r.type),f=q.getClass(r.strategy);h.layoutManager=new u(new f)}else h.layoutManager=new io;return h.layoutManager.subscribeTargets({type:ln,target:h,targets:h.getObjects()}),h.setCoords(),h})}}T(gs,"type","Group"),T(gs,"ownDefaults",{strokeWidth:0,subTargetCheck:!1,interactive:!1}),q.setClass(gs);const Hp=(i,t)=>Math.min(t.width/i.width,t.height/i.height),zp=(i,t)=>Math.max(t.width/i.width,t.height/i.height),Ic="\\s*,?\\s*",Cr="".concat(Ic,"(").concat(_i,")"),hx="".concat(Cr).concat(Cr).concat(Cr).concat(Ic,"([01])").concat(Ic,"([01])").concat(Cr).concat(Cr),ux={m:"l",M:"L"},fx=(i,t,e,s,n,r,o,a,l,c,h)=>{const u=Os(i),f=Ms(i),d=Os(t),p=Ms(t),g=e*n*d-s*r*p+o,m=s*n*d+e*r*p+a;return["C",c+l*(-e*n*f-s*r*u),h+l*(-s*n*f+e*r*u),g+l*(e*n*p+s*r*d),m+l*(s*n*p-e*r*d),g,m]},Ff=(i,t,e,s)=>{const n=Math.atan2(t,i),r=Math.atan2(s,e);return r>=n?r-n:2*Math.PI-(n-r)};function Bc(i,t,e,s,n,r,o,a){let l;if(_t.cachesBoundsOfCurve&&(l=[...arguments].join(),Br.boundsOfCurveCache[l]))return Br.boundsOfCurveCache[l];const c=Math.sqrt,h=Math.abs,u=[],f=[[0,0],[0,0]];let d=6*i-12*e+6*n,p=-3*i+9*e-9*n+3*o,g=3*e-3*i;for(let b=0;b<2;++b){if(b>0&&(d=6*t-12*s+6*r,p=-3*t+9*s-9*r+3*a,g=3*s-3*t),h(p)<1e-12){if(h(d)<1e-12)continue;const D=-g/d;0<D&&D<1&&u.push(D);continue}const S=d*d-4*g*p;if(S<0)continue;const P=c(S),O=(-d+P)/(2*p);0<O&&O<1&&u.push(O);const k=(-d-P)/(2*p);0<k&&k<1&&u.push(k)}let m=u.length;const v=m,_=Wp(i,t,e,s,n,r,o,a);for(;m--;){const{x:b,y:S}=_(u[m]);f[0][m]=b,f[1][m]=S}f[0][v]=i,f[1][v]=t,f[0][v+1]=o,f[1][v+1]=a;const y=[new E(Math.min(...f[0]),Math.min(...f[1])),new E(Math.max(...f[0]),Math.max(...f[1]))];return _t.cachesBoundsOfCurve&&(Br.boundsOfCurveCache[l]=y),y}const dx=(i,t,e)=>{let[s,n,r,o,a,l,c,h]=e;const u=((f,d,p,g,m,v,_)=>{if(p===0||g===0)return[];let y=0,b=0,S=0;const P=Math.PI,O=_*xh,k=Ms(O),D=Os(O),z=.5*(-D*f-k*d),K=.5*(-D*d+k*f),st=p**2,G=g**2,it=K**2,ct=z**2,et=st*G-st*it-G*ct;let Z=Math.abs(p),Y=Math.abs(g);if(et<0){const Q=Math.sqrt(1-et/(st*G));Z*=Q,Y*=Q}else S=(m===v?-1:1)*Math.sqrt(et/(st*it+G*ct));const pt=S*Z*K/Y,Tt=-S*Y*z/Z,Pt=D*pt-k*Tt+.5*f,B=k*pt+D*Tt+.5*d;let N=Ff(1,0,(z-pt)/Z,(K-Tt)/Y),X=Ff((z-pt)/Z,(K-Tt)/Y,(-z-pt)/Z,(-K-Tt)/Y);v===0&&X>0?X-=2*P:v===1&&X<0&&(X+=2*P);const Vt=Math.ceil(Math.abs(X/P*2)),Rt=[],R=X/Vt,J=8/3*Math.sin(R/4)*Math.sin(R/4)/Math.sin(R/2);let V=N+R;for(let Q=0;Q<Vt;Q++)Rt[Q]=fx(N,V,D,k,Z,Y,Pt,B,J,y,b),y=Rt[Q][5],b=Rt[Q][6],N=V,V+=R;return Rt})(c-i,h-t,n,r,a,l,o);for(let f=0,d=u.length;f<d;f++)u[f][1]+=i,u[f][2]+=t,u[f][3]+=i,u[f][4]+=t,u[f][5]+=i,u[f][6]+=t;return u},Vp=i=>{let t=0,e=0,s=0,n=0;const r=[];let o,a=0,l=0;for(const c of i){const h=[...c];let u;switch(h[0]){case"l":h[1]+=t,h[2]+=e;case"L":t=h[1],e=h[2],u=["L",t,e];break;case"h":h[1]+=t;case"H":t=h[1],u=["L",t,e];break;case"v":h[1]+=e;case"V":e=h[1],u=["L",t,e];break;case"m":h[1]+=t,h[2]+=e;case"M":t=h[1],e=h[2],s=h[1],n=h[2],u=["M",t,e];break;case"c":h[1]+=t,h[2]+=e,h[3]+=t,h[4]+=e,h[5]+=t,h[6]+=e;case"C":a=h[3],l=h[4],t=h[5],e=h[6],u=["C",h[1],h[2],a,l,t,e];break;case"s":h[1]+=t,h[2]+=e,h[3]+=t,h[4]+=e;case"S":o==="C"?(a=2*t-a,l=2*e-l):(a=t,l=e),t=h[3],e=h[4],u=["C",a,l,h[1],h[2],t,e],a=u[3],l=u[4];break;case"q":h[1]+=t,h[2]+=e,h[3]+=t,h[4]+=e;case"Q":a=h[1],l=h[2],t=h[3],e=h[4],u=["Q",a,l,t,e];break;case"t":h[1]+=t,h[2]+=e;case"T":o==="Q"?(a=2*t-a,l=2*e-l):(a=t,l=e),t=h[1],e=h[2],u=["Q",a,l,t,e];break;case"a":h[6]+=t,h[7]+=e;case"A":dx(t,e,h).forEach(f=>r.push(f)),t=h[6],e=h[7];break;case"z":case"Z":t=s,e=n,u=["Z"]}u?(r.push(u),o=u[0]):o=""}return r},Aa=(i,t,e,s)=>Math.sqrt((e-i)**2+(s-t)**2),Wp=(i,t,e,s,n,r,o,a)=>l=>{const c=l**3,h=(d=>3*d**2*(1-d))(l),u=(d=>3*d*(1-d)**2)(l),f=(d=>(1-d)**3)(l);return new E(o*c+n*h+e*u+i*f,a*c+r*h+s*u+t*f)},Yp=i=>i**2,Xp=i=>2*i*(1-i),Up=i=>(1-i)**2,gx=(i,t,e,s,n,r,o,a)=>l=>{const c=Yp(l),h=Xp(l),u=Up(l),f=3*(u*(e-i)+h*(n-e)+c*(o-n)),d=3*(u*(s-t)+h*(r-s)+c*(a-r));return Math.atan2(d,f)},px=(i,t,e,s,n,r)=>o=>{const a=Yp(o),l=Xp(o),c=Up(o);return new E(n*a+e*l+i*c,r*a+s*l+t*c)},mx=(i,t,e,s,n,r)=>o=>{const a=1-o,l=2*(a*(e-i)+o*(n-e)),c=2*(a*(s-t)+o*(r-s));return Math.atan2(c,l)},Df=(i,t,e)=>{let s=new E(t,e),n=0;for(let r=1;r<=100;r+=1){const o=i(r/100);n+=Aa(s.x,s.y,o.x,o.y),s=o}return n},vx=(i,t)=>{let e,s=0,n=0,r={x:i.x,y:i.y},o=w({},r),a=.01,l=0;const c=i.iterator,h=i.angleFinder;for(;n<t&&a>1e-4;)o=c(s),l=s,e=Aa(r.x,r.y,o.x,o.y),e+n>t?(s-=a,a/=2):(r=o,s+=a,n+=e);return w(w({},o),{},{angle:h(l)})},Wh=i=>{let t,e,s=0,n=0,r=0,o=0,a=0;const l=[];for(const c of i){const h={x:n,y:r,command:c[0],length:0};switch(c[0]){case"M":e=h,e.x=o=n=c[1],e.y=a=r=c[2];break;case"L":e=h,e.length=Aa(n,r,c[1],c[2]),n=c[1],r=c[2];break;case"C":t=Wp(n,r,c[1],c[2],c[3],c[4],c[5],c[6]),e=h,e.iterator=t,e.angleFinder=gx(n,r,c[1],c[2],c[3],c[4],c[5],c[6]),e.length=Df(t,n,r),n=c[5],r=c[6];break;case"Q":t=px(n,r,c[1],c[2],c[3],c[4]),e=h,e.iterator=t,e.angleFinder=mx(n,r,c[1],c[2],c[3],c[4]),e.length=Df(t,n,r),n=c[3],r=c[4];break;case"Z":e=h,e.destX=o,e.destY=a,e.length=Aa(n,r,o,a),n=o,r=a}s+=e.length,l.push(e)}return l.push({length:s,x:n,y:r}),l},Gp=function(i,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Wh(i),s=0;for(;t-e[s].length>0&&s<e.length-2;)t-=e[s].length,s++;const n=e[s],r=t/n.length,o=i[s];switch(n.command){case"M":return{x:n.x,y:n.y,angle:0};case"Z":return w(w({},new E(n.x,n.y).lerp(new E(n.destX,n.destY),r)),{},{angle:Math.atan2(n.destY-n.y,n.destX-n.x)});case"L":return w(w({},new E(n.x,n.y).lerp(new E(o[1],o[2]),r)),{},{angle:Math.atan2(o[2]-n.y,o[1]-n.x)});case"C":case"Q":return vx(n,t)}},_x=new RegExp("[mzlhvcsqta][^mzlhvcsqta]*","gi"),Rf=new RegExp(hx,"g"),yx=new RegExp(_i,"gi"),bx={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},$p=i=>{var t;const e=[],s=(t=i.match(_x))!==null&&t!==void 0?t:[];for(const n of s){const r=n[0];if(r==="z"||r==="Z"){e.push([r]);continue}const o=bx[r.toLowerCase()];let a=[];if(r==="a"||r==="A"){Rf.lastIndex=0;for(let l=null;l=Rf.exec(n);)a.push(...l.slice(1))}else a=n.match(yx)||[];for(let l=0;l<a.length;l+=o){const c=new Array(o),h=ux[r];c[0]=l>0&&h?h:r;for(let u=0;u<o;u++)c[u+1]=parseFloat(a[l+u]);e.push(c)}}return e},xx=function(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e=new E(i[0]),s=new E(i[1]),n=1,r=0;const o=[],a=i.length,l=a>2;let c;for(l&&(n=i[2].x<s.x?-1:i[2].x===s.x?0:1,r=i[2].y<s.y?-1:i[2].y===s.y?0:1),o.push(["M",e.x-n*t,e.y-r*t]),c=1;c<a;c++){if(!e.eq(s)){const h=e.midPointFrom(s);o.push(["Q",e.x,e.y,h.x,h.y])}e=i[c],c+1<i.length&&(s=i[c+1])}return l&&(n=e.x>i[c-2].x?1:e.x===i[c-2].x?0:-1,r=e.y>i[c-2].y?1:e.y===i[c-2].y?0:-1),o.push(["L",e.x+n*t,e.y+r*t]),o},qp=(i,t)=>i.map(e=>e.map((s,n)=>n===0||t===void 0?s:jt(s,t)).join(" ")).join(" ");function Fa(i,t){const e=i.style;e&&t&&(typeof t=="string"?e.cssText+=";"+t:Object.entries(t).forEach(s=>{let[n,r]=s;return e.setProperty(n,r)}))}const Cx=(i,t)=>Math.floor(Math.random()*(t-i+1))+i;function Sx(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const e=t.onComplete||li,s=new(ol()).XMLHttpRequest,n=t.signal,r=function(){s.abort()},o=function(){n&&n.removeEventListener("abort",r),s.onerror=s.ontimeout=li};if(n&&n.aborted)throw new Bg("request");return n&&n.addEventListener("abort",r,{once:!0}),s.onreadystatechange=function(){s.readyState===4&&(o(),e(s),s.onreadystatechange=li)},s.onerror=s.ontimeout=o,s.open("get",i,!0),s.send(),s}const wx=(i,t)=>{let e=i._findCenterFromElement();i.transformMatrix&&((s=>{if(s.transformMatrix){const{scaleX:n,scaleY:r,angle:o,skewX:a}=tr(s.transformMatrix);s.flipX=!1,s.flipY=!1,s.set(Pe,n),s.set(es,r),s.angle=o,s.skewX=a,s.skewY=0}})(i),e=e.transform(i.transformMatrix)),delete i.transformMatrix,t&&(i.scaleX*=t.scaleX,i.scaleY*=t.scaleY,i.cropX=t.cropX,i.cropY=t.cropY,e.x+=t.offsetLeft,e.y+=t.offsetTop,i.width=t.width,i.height=t.height),i.setPositionByOrigin(e,gt,gt)};var Dn=Object.freeze({__proto__:null,addTransformToObject:ip,animate:Ih,animateColor:pp,applyTransformToObject:sr,calcAngleBetweenVectors:Ea,calcDimensionsMatrix:_o,calcPlaneChangeMatrix:xo,calcVectorRotation:fp,cancelAnimFrame:Ug,capValue:yi,composeMatrix:Zg,copyCanvasElement:i=>{var t;const e=Es(i);return(t=e.getContext("2d"))===null||t===void 0||t.drawImage(i,0,0),e},cos:Os,createCanvasElement:ms,createImage:Gg,createRotateMatrix:pr,createScaleMatrix:hl,createSkewXMatrix:Eh,createSkewYMatrix:kh,createTranslateMatrix:gr,createVector:Oa,crossProduct:Wi,degreesToRadians:Yt,dotProduct:dp,ease:xb,enlivenObjectEnlivables:yo,enlivenObjects:er,findScaleToCover:zp,findScaleToFit:Hp,getBoundsOfCurve:Bc,getOrthonormalVector:Lh,getPathSegmentsInfo:Wh,getPointOnPath:Gp,getPointer:np,getRandomInt:Cx,getRegularPolygonPath:(i,t)=>{const e=2*Math.PI/i;let s=-In;i%2==0&&(s+=e/2);const n=new Array(i+1);for(let r=0;r<i;r++){const o=r*e+s,{x:a,y:l}=new E(Os(o),Ms(o)).scalarMultiply(t);n[r]=[r===0?"M":"L",a,l]}return n[i]=["Z"],n},getSmoothPathFromPoints:xx,getSvgAttributes:i=>{const t=["instantiated_by_use","style","id","class"];switch(i){case"linearGradient":return t.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);case"radialGradient":return t.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);case"stop":return t.concat(["offset","stop-color","stop-opacity"])}return t},getUnitVector:gl,groupSVGElements:(i,t)=>i&&i.length===1?i[0]:new gs(i,t),hasStyleChanged:vl,invertTransform:Ke,isBetweenVectors:Pc,isIdentityMatrix:$g,isTouchEvent:wa,isTransparent:Ap,joinPath:qp,loadImage:Hr,magnitude:Ma,makeBoundingBoxFromPoints:Ys,makePathSimpler:Vp,matrixToSVG:so,mergeClipPaths:(i,t)=>{var e;let s=i,n=t;s.inverted&&!n.inverted&&(s=t,n=i),kc(n,(e=n.group)===null||e===void 0?void 0:e.calcTransformMatrix(),s.calcTransformMatrix());const r=s.inverted&&n.inverted;return r&&(s.inverted=n.inverted=!1),new gs([s],{clipPath:n,inverted:r})},multiplyTransformMatrices:Xt,multiplyTransformMatrixArray:cl,parsePath:$p,parsePreserveAspectRatioAttribute:Jg,parseUnit:ci,pick:Ci,projectStrokeOnPoints:Dp,qrDecompose:tr,radiansToDegrees:Nn,removeFromArray:ei,removeTransformFromObject:(i,t)=>{const e=Ke(t),s=Xt(e,i.calcOwnMatrix());sr(i,s)},removeTransformMatrixForSvgParsing:wx,request:Sx,requestAnimFrame:Nr,resetObjectTransform:rp,rotatePoint:(i,t,e)=>i.rotate(e,t),rotateVector:Rh,saveObjectTransform:Ah,sendObjectToPlane:kc,sendPointToPlane:un,sendVectorToPlane:op,setStyle:Fa,sin:Ms,sizeAfterTransform:ul,string:Bb,stylesFromArray:jp,stylesToArray:Lp,toBlob:Mh,toDataURL:Oh,toFixed:jt,transformPath:(i,t,e)=>(e&&(t=Xt(t,[1,0,0,1,-e.x,-e.y])),i.map(s=>{const n=[...s];for(let r=1;r<s.length-1;r+=2){const{x:o,y:a}=ue({x:s[r],y:s[r+1]},t);n[r]=o,n[r+1]=a}return n})),transformPoint:ue});class Tx extends sp{constructor(t){let{allowTouchScrolling:e=!1,containerClass:s=""}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t),T(this,"upper",void 0),T(this,"container",void 0);const{el:n}=this.lower,r=this.createUpperCanvas();this.upper={el:r,ctx:r.getContext("2d")},this.applyCanvasStyle(n,{allowTouchScrolling:e}),this.applyCanvasStyle(r,{allowTouchScrolling:e,styles:{position:"absolute",left:"0",top:"0"}});const o=this.createContainerElement();o.classList.add(s),n.parentNode&&n.parentNode.replaceChild(o,n),o.append(n,r),this.container=o}createUpperCanvas(){const{el:t}=this.lower,e=ms();return e.className=t.className,e.classList.remove("lower-canvas"),e.classList.add("upper-canvas"),e.setAttribute("data-fabric","top"),e.style.cssText=t.style.cssText,e.setAttribute("draggable","true"),e}createContainerElement(){const t=ur().createElement("div");return t.setAttribute("data-fabric","wrapper"),Fa(t,{position:"relative"}),pf(t),t}applyCanvasStyle(t,e){const{styles:s,allowTouchScrolling:n}=e;Fa(t,w(w({},s),{},{"touch-action":n?"manipulation":Re})),pf(t)}setDimensions(t,e){super.setDimensions(t,e);const{el:s,ctx:n}=this.upper;ep(s,n,t,e)}setCSSDimensions(t){super.setCSSDimensions(t),Mc(this.upper.el,t),Mc(this.container,t)}cleanupDOM(t){const e=this.container,{el:s}=this.lower,{el:n}=this.upper;super.cleanupDOM(t),e.removeChild(n),e.removeChild(s),e.parentNode&&e.parentNode.replaceChild(s,e)}dispose(){super.dispose(),Ks().dispose(this.upper.el),delete this.upper,delete this.container}}class yl extends bo{constructor(){super(...arguments),T(this,"targets",[]),T(this,"_hoveredTargets",[]),T(this,"_objectsToRender",void 0),T(this,"_currentTransform",null),T(this,"_groupSelector",null),T(this,"contextTopDirty",!1)}static getDefaults(){return w(w({},super.getDefaults()),yl.ownDefaults)}get upperCanvasEl(){var t;return(t=this.elements.upper)===null||t===void 0?void 0:t.el}get contextTop(){var t;return(t=this.elements.upper)===null||t===void 0?void 0:t.ctx}get wrapperEl(){return this.elements.container}initElements(t){this.elements=new Tx(t,{allowTouchScrolling:this.allowTouchScrolling,containerClass:this.containerClass}),this._createCacheCanvas()}_onObjectAdded(t){this._objectsToRender=void 0,super._onObjectAdded(t)}_onObjectRemoved(t){this._objectsToRender=void 0,t===this._activeObject&&(this.fire("before:selection:cleared",{deselected:[t]}),this._discardActiveObject(),this.fire("selection:cleared",{deselected:[t]}),t.fire("deselected",{target:t})),t===this._hoveredTarget&&(this._hoveredTarget=void 0,this._hoveredTargets=[]),super._onObjectRemoved(t)}_onStackOrderChanged(){this._objectsToRender=void 0,super._onStackOrderChanged()}_chooseObjectsToRender(){const t=this._activeObject;return!this.preserveObjectStacking&&t?this._objects.filter(e=>!e.group&&e!==t).concat(t):this._objects}renderAll(){this.cancelRequestedRender(),this.destroyed||(!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1),!this._objectsToRender&&(this._objectsToRender=this._chooseObjectsToRender()),this.renderCanvas(this.getContext(),this._objectsToRender))}renderTopLayer(t){t.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(t),this.contextTopDirty=!0),t.restore()}renderTop(){const t=this.contextTop;this.clearContext(t),this.renderTopLayer(t),this.fire("after:render",{ctx:t})}setTargetFindTolerance(t){t=Math.round(t),this.targetFindTolerance=t;const e=this.getRetinaScaling(),s=Math.ceil((2*t+1)*e);this.pixelFindCanvasEl.width=this.pixelFindCanvasEl.height=s,this.pixelFindContext.scale(e,e)}isTargetTransparent(t,e,s){const n=this.targetFindTolerance,r=this.pixelFindContext;this.clearContext(r),r.save(),r.translate(-e+n,-s+n),r.transform(...this.viewportTransform);const o=t.selectionBackgroundColor;t.selectionBackgroundColor="",t.render(r),t.selectionBackgroundColor=o,r.restore();const a=Math.round(n*this.getRetinaScaling());return Ap(r,a,a,a)}_isSelectionKeyPressed(t){const e=this.selectionKey;return!!e&&(Array.isArray(e)?!!e.find(s=>!!s&&t[s]===!0):t[e])}_shouldClearSelection(t,e){const s=this.getActiveObjects(),n=this._activeObject;return!!(!e||e&&n&&s.length>1&&s.indexOf(e)===-1&&n!==e&&!this._isSelectionKeyPressed(t)||e&&!e.evented||e&&!e.selectable&&n&&n!==e)}_shouldCenterTransform(t,e,s){if(!t)return;let n;return e===ll||e===Pe||e===es||e===eo?n=this.centeredScaling||t.centeredScaling:e===wh&&(n=this.centeredRotation||t.centeredRotation),n?!s:s}_getOriginFromCorner(t,e){const s={x:t.originX,y:t.originY};return e&&(["ml","tl","bl"].includes(e)?s.x=$t:["mr","tr","br"].includes(e)&&(s.x=wt),["tl","mt","tr"].includes(e)?s.y=Oc:["bl","mb","br"].includes(e)&&(s.y=De)),s}_setupCurrentTransform(t,e,s){var n;const r=e.group?un(this.getScenePoint(t),void 0,e.group.calcTransformMatrix()):this.getScenePoint(t),{key:o="",control:a}=e.getActiveControl()||{},l=s&&a?(n=a.getActionHandler(t,e,a))===null||n===void 0?void 0:n.bind(a):cp,c=((d,p,g,m)=>{if(!p||!d)return"drag";const v=m.controls[p];return v.getActionName(g,v,m)})(s,o,t,e),h=t[this.centeredKey],u=this._shouldCenterTransform(e,c,h)?{x:gt,y:gt}:this._getOriginFromCorner(e,o),f={target:e,action:c,actionHandler:l,actionPerformed:!1,corner:o,scaleX:e.scaleX,scaleY:e.scaleY,skewX:e.skewX,skewY:e.skewY,offsetX:r.x-e.left,offsetY:r.y-e.top,originX:u.x,originY:u.y,ex:r.x,ey:r.y,lastX:r.x,lastY:r.y,theta:Yt(e.angle),width:e.width,height:e.height,shiftKey:t.shiftKey,altKey:h,original:w(w({},Ah(e)),{},{originX:u.x,originY:u.y})};this._currentTransform=f,this.fire("before:transform",{e:t,transform:f})}setCursor(t){this.upperCanvasEl.style.cursor=t}_drawSelection(t){const{x:e,y:s,deltaX:n,deltaY:r}=this._groupSelector,o=new E(e,s).transform(this.viewportTransform),a=new E(e+n,s+r).transform(this.viewportTransform),l=this.selectionLineWidth/2;let c=Math.min(o.x,a.x),h=Math.min(o.y,a.y),u=Math.max(o.x,a.x),f=Math.max(o.y,a.y);this.selectionColor&&(t.fillStyle=this.selectionColor,t.fillRect(c,h,u-c,f-h)),this.selectionLineWidth&&this.selectionBorderColor&&(t.lineWidth=this.selectionLineWidth,t.strokeStyle=this.selectionBorderColor,c+=l,h+=l,u-=l,f-=l,ne.prototype._setLineDash.call(this,t,this.selectionDashArray),t.strokeRect(c,h,u-c,f-h))}findTarget(t){if(this.skipTargetFind)return;const e=this.getViewportPoint(t),s=this._activeObject,n=this.getActiveObjects();if(this.targets=[],s&&n.length>=1){if(s.findControl(e,wa(t))||n.length>1&&this.searchPossibleTargets([s],e))return s;if(s===this.searchPossibleTargets([s],e)){if(this.preserveObjectStacking){const r=this.targets;this.targets=[];const o=this.searchPossibleTargets(this._objects,e);return t[this.altSelectionKey]&&o&&o!==s?(this.targets=r,s):o}return s}}return this.searchPossibleTargets(this._objects,e)}_pointIsInObjectSelectionArea(t,e){let s=t.getCoords();const n=this.getZoom(),r=t.padding/n;if(r){const[o,a,l,c]=s,h=Math.atan2(a.y-o.y,a.x-o.x),u=Os(h)*r,f=Ms(h)*r,d=u+f,p=u-f;s=[new E(o.x-p,o.y-d),new E(a.x+d,a.y-p),new E(l.x+p,l.y+d),new E(c.x-d,c.y+p)]}return Bt.isPointInPolygon(e,s)}_checkTarget(t,e){return!!(t&&t.visible&&t.evented&&this._pointIsInObjectSelectionArea(t,un(e,void 0,this.viewportTransform))&&(!this.perPixelTargetFind&&!t.perPixelTargetFind||t.isEditing||!this.isTargetTransparent(t,e.x,e.y)))}_searchPossibleTargets(t,e){let s=t.length;for(;s--;){const n=t[s];if(this._checkTarget(n,e)){if(na(n)&&n.subTargetCheck){const r=this._searchPossibleTargets(n._objects,e);r&&this.targets.push(r)}return n}}}searchPossibleTargets(t,e){const s=this._searchPossibleTargets(t,e);if(s&&na(s)&&s.interactive&&this.targets[0]){const n=this.targets;for(let r=n.length-1;r>0;r--){const o=n[r];if(!na(o)||!o.interactive)return o}return n[0]}return s}getViewportPoint(t){return this._pointer?this._pointer:this.getPointer(t,!0)}getScenePoint(t){return this._absolutePointer?this._absolutePointer:this.getPointer(t)}getPointer(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=this.upperCanvasEl,n=s.getBoundingClientRect();let r=np(t),o=n.width||0,a=n.height||0;o&&a||(De in n&&Oc in n&&(a=Math.abs(n.top-n.bottom)),$t in n&&wt in n&&(o=Math.abs(n.right-n.left))),this.calcOffset(),r.x=r.x-this._offset.left,r.y=r.y-this._offset.top,e||(r=un(r,void 0,this.viewportTransform));const l=this.getRetinaScaling();l!==1&&(r.x/=l,r.y/=l);const c=o===0||a===0?new E(1,1):new E(s.width/o,s.height/a);return r.multiply(c)}_setDimensionsImpl(t,e){this._resetTransformEventData(),super._setDimensionsImpl(t,e),this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop)}_createCacheCanvas(){this.pixelFindCanvasEl=ms(),this.pixelFindContext=this.pixelFindCanvasEl.getContext("2d",{willReadFrequently:!0}),this.setTargetFindTolerance(this.targetFindTolerance)}getTopContext(){return this.elements.upper.ctx}getSelectionContext(){return this.elements.upper.ctx}getSelectionElement(){return this.elements.upper.el}getActiveObject(){return this._activeObject}getActiveObjects(){const t=this._activeObject;return si(t)?t.getObjects():t?[t]:[]}_fireSelectionEvents(t,e){let s=!1,n=!1;const r=this.getActiveObjects(),o=[],a=[];t.forEach(l=>{r.includes(l)||(s=!0,l.fire("deselected",{e,target:l}),a.push(l))}),r.forEach(l=>{t.includes(l)||(s=!0,l.fire("selected",{e,target:l}),o.push(l))}),t.length>0&&r.length>0?(n=!0,s&&this.fire("selection:updated",{e,selected:o,deselected:a})):r.length>0?(n=!0,this.fire("selection:created",{e,selected:o})):t.length>0&&(n=!0,this.fire("selection:cleared",{e,deselected:a})),n&&(this._objectsToRender=void 0)}setActiveObject(t,e){const s=this.getActiveObjects(),n=this._setActiveObject(t,e);return this._fireSelectionEvents(s,e),n}_setActiveObject(t,e){const s=this._activeObject;return s!==t&&!(!this._discardActiveObject(e,t)&&this._activeObject)&&!t.onSelect({e})&&(this._activeObject=t,si(t)&&s!==t&&t.set("canvas",this),t.setCoords(),!0)}_discardActiveObject(t,e){const s=this._activeObject;return!!s&&!s.onDeselect({e:t,object:e})&&(this._currentTransform&&this._currentTransform.target===s&&this.endCurrentTransform(t),si(s)&&s===this._hoveredTarget&&(this._hoveredTarget=void 0),this._activeObject=void 0,!0)}discardActiveObject(t){const e=this.getActiveObjects(),s=this.getActiveObject();e.length&&this.fire("before:selection:cleared",{e:t,deselected:[s]});const n=this._discardActiveObject(t);return this._fireSelectionEvents(e,t),n}endCurrentTransform(t){const e=this._currentTransform;this._finalizeCurrentTransform(t),e&&e.target&&(e.target.isMoving=!1),this._currentTransform=null}_finalizeCurrentTransform(t){const e=this._currentTransform,s=e.target,n={e:t,target:s,transform:e,action:e.action};s._scaling&&(s._scaling=!1),s.setCoords(),e.actionPerformed&&(this.fire("object:modified",n),s.fire(Ca,n))}setViewportTransform(t){super.setViewportTransform(t);const e=this._activeObject;e&&e.setCoords()}destroy(){const t=this._activeObject;si(t)&&(t.removeAll(),t.dispose()),delete this._activeObject,super.destroy(),this.pixelFindContext=null,this.pixelFindCanvasEl=void 0}clear(){this.discardActiveObject(),this._activeObject=void 0,this.clearContext(this.contextTop),super.clear()}drawControls(t){const e=this._activeObject;e&&e._renderControls(t)}_toObject(t,e,s){const n=this._realizeGroupTransformOnObject(t),r=super._toObject(t,e,s);return t.set(n),r}_realizeGroupTransformOnObject(t){const{group:e}=t;if(e&&si(e)&&this._activeObject===e){const s=Ci(t,["angle","flipX","flipY",wt,Pe,es,fr,dr,De]);return ip(t,e.calcOwnMatrix()),s}return{}}_setSVGObject(t,e,s){const n=this._realizeGroupTransformOnObject(e);super._setSVGObject(t,e,s),e.set(n)}}T(yl,"ownDefaults",{uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",selection:!0,selectionKey:"shiftKey",selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,enablePointerEvents:!1,containerClass:"canvas-container",preserveObjectStacking:!1});class Ox{constructor(t){T(this,"targets",[]),T(this,"__disposer",void 0);const e=()=>{const{hiddenTextarea:n}=t.getActiveObject()||{};n&&n.focus()},s=t.upperCanvasEl;s.addEventListener("click",e),this.__disposer=()=>s.removeEventListener("click",e)}exitTextEditing(){this.target=void 0,this.targets.forEach(t=>{t.isEditing&&t.exitEditing()})}add(t){this.targets.push(t)}remove(t){this.unregister(t),ei(this.targets,t)}register(t){this.target=t}unregister(t){t===this.target&&(this.target=void 0)}onMouseMove(t){var e;!((e=this.target)===null||e===void 0)&&e.isEditing&&this.target.updateSelectionOnMouseMove(t)}clear(){this.targets=[],this.target=void 0}dispose(){this.clear(),this.__disposer(),delete this.__disposer}}const Mx=["target","oldTarget","fireCanvas","e"],Ye={passive:!1},Ei=(i,t)=>{const e=i.getViewportPoint(t),s=i.getScenePoint(t);return{viewportPoint:e,scenePoint:s,pointer:e,absolutePointer:s}},xn=function(i){for(var t=arguments.length,e=new Array(t>1?t-1:0),s=1;s<t;s++)e[s-1]=arguments[s];return i.addEventListener(...e)},is=function(i){for(var t=arguments.length,e=new Array(t>1?t-1:0),s=1;s<t;s++)e[s-1]=arguments[s];return i.removeEventListener(...e)},Ex={mouse:{in:"over",out:"out",targetIn:"mouseover",targetOut:"mouseout",canvasIn:"mouse:over",canvasOut:"mouse:out"},drag:{in:"enter",out:"leave",targetIn:"dragenter",targetOut:"dragleave",canvasIn:"drag:enter",canvasOut:"drag:leave"}};class ro extends yl{constructor(t){super(t,arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}),T(this,"_isClick",void 0),T(this,"textEditingManager",new Ox(this)),["_onMouseDown","_onTouchStart","_onMouseMove","_onMouseUp","_onTouchEnd","_onResize","_onMouseWheel","_onMouseOut","_onMouseEnter","_onContextMenu","_onDoubleClick","_onDragStart","_onDragEnd","_onDragProgress","_onDragOver","_onDragEnter","_onDragLeave","_onDrop"].forEach(e=>{this[e]=this[e].bind(this)}),this.addOrRemove(xn,"add")}_getEventPrefix(){return this.enablePointerEvents?"pointer":"mouse"}addOrRemove(t,e){const s=this.upperCanvasEl,n=this._getEventPrefix();t(tp(s),"resize",this._onResize),t(s,n+"down",this._onMouseDown),t(s,"".concat(n,"move"),this._onMouseMove,Ye),t(s,"".concat(n,"out"),this._onMouseOut),t(s,"".concat(n,"enter"),this._onMouseEnter),t(s,"wheel",this._onMouseWheel),t(s,"contextmenu",this._onContextMenu),t(s,"dblclick",this._onDoubleClick),t(s,"dragstart",this._onDragStart),t(s,"dragend",this._onDragEnd),t(s,"dragover",this._onDragOver),t(s,"dragenter",this._onDragEnter),t(s,"dragleave",this._onDragLeave),t(s,"drop",this._onDrop),this.enablePointerEvents||t(s,"touchstart",this._onTouchStart,Ye)}removeListeners(){this.addOrRemove(is,"remove");const t=this._getEventPrefix(),e=ys(this.upperCanvasEl);is(e,"".concat(t,"up"),this._onMouseUp),is(e,"touchend",this._onTouchEnd,Ye),is(e,"".concat(t,"move"),this._onMouseMove,Ye),is(e,"touchmove",this._onMouseMove,Ye),clearTimeout(this._willAddMouseDown)}_onMouseWheel(t){this.__onMouseWheel(t)}_onMouseOut(t){const e=this._hoveredTarget,s=w({e:t},Ei(this,t));this.fire("mouse:out",w(w({},s),{},{target:e})),this._hoveredTarget=void 0,e&&e.fire("mouseout",w({},s)),this._hoveredTargets.forEach(n=>{this.fire("mouse:out",w(w({},s),{},{target:n})),n&&n.fire("mouseout",w({},s))}),this._hoveredTargets=[]}_onMouseEnter(t){this._currentTransform||this.findTarget(t)||(this.fire("mouse:over",w({e:t},Ei(this,t))),this._hoveredTarget=void 0,this._hoveredTargets=[])}_onDragStart(t){this._isClick=!1;const e=this.getActiveObject();if(e&&e.onDragStart(t)){this._dragSource=e;const s={e:t,target:e};return this.fire("dragstart",s),e.fire("dragstart",s),void xn(this.upperCanvasEl,"drag",this._onDragProgress)}Ec(t)}_renderDragEffects(t,e,s){let n=!1;const r=this._dropTarget;r&&r!==e&&r!==s&&(r.clearContextTop(),n=!0),e==null||e.clearContextTop(),s!==e&&(s==null||s.clearContextTop());const o=this.contextTop;o.save(),o.transform(...this.viewportTransform),e&&(o.save(),e.transform(o),e.renderDragSourceEffect(t),o.restore(),n=!0),s&&(o.save(),s.transform(o),s.renderDropTargetEffect(t),o.restore(),n=!0),o.restore(),n&&(this.contextTopDirty=!0)}_onDragEnd(t){const e=!!t.dataTransfer&&t.dataTransfer.dropEffect!==Re,s=e?this._activeObject:void 0,n={e:t,target:this._dragSource,subTargets:this.targets,dragSource:this._dragSource,didDrop:e,dropTarget:s};is(this.upperCanvasEl,"drag",this._onDragProgress),this.fire("dragend",n),this._dragSource&&this._dragSource.fire("dragend",n),delete this._dragSource,this._onMouseUp(t)}_onDragProgress(t){const e={e:t,target:this._dragSource,dragSource:this._dragSource,dropTarget:this._draggedoverTarget};this.fire("drag",e),this._dragSource&&this._dragSource.fire("drag",e)}findDragTargets(t){return this.targets=[],{target:this._searchPossibleTargets(this._objects,this.getViewportPoint(t)),targets:[...this.targets]}}_onDragOver(t){const e="dragover",{target:s,targets:n}=this.findDragTargets(t),r=this._dragSource,o={e:t,target:s,subTargets:n,dragSource:r,canDrop:!1,dropTarget:void 0};let a;this.fire(e,o),this._fireEnterLeaveEvents(s,o),s&&(s.canDrop(t)&&(a=s),s.fire(e,o));for(let l=0;l<n.length;l++){const c=n[l];c.canDrop(t)&&(a=c),c.fire(e,o)}this._renderDragEffects(t,r,a),this._dropTarget=a}_onDragEnter(t){const{target:e,targets:s}=this.findDragTargets(t),n={e:t,target:e,subTargets:s,dragSource:this._dragSource};this.fire("dragenter",n),this._fireEnterLeaveEvents(e,n)}_onDragLeave(t){const e={e:t,target:this._draggedoverTarget,subTargets:this.targets,dragSource:this._dragSource};this.fire("dragleave",e),this._fireEnterLeaveEvents(void 0,e),this._renderDragEffects(t,this._dragSource),this._dropTarget=void 0,this.targets=[],this._hoveredTargets=[]}_onDrop(t){const{target:e,targets:s}=this.findDragTargets(t),n=this._basicEventHandler("drop:before",w({e:t,target:e,subTargets:s,dragSource:this._dragSource},Ei(this,t)));n.didDrop=!1,n.dropTarget=void 0,this._basicEventHandler("drop",n),this.fire("drop:after",n)}_onContextMenu(t){const e=this.findTarget(t),s=this.targets||[],n=this._basicEventHandler("contextmenu:before",{e:t,target:e,subTargets:s});return this.stopContextMenu&&Ec(t),this._basicEventHandler("contextmenu",n),!1}_onDoubleClick(t){this._cacheTransformEventData(t),this._handleEvent(t,"dblclick"),this._resetTransformEventData()}getPointerId(t){const e=t.changedTouches;return e?e[0]&&e[0].identifier:this.enablePointerEvents?t.pointerId:-1}_isMainEvent(t){return t.isPrimary===!0||t.isPrimary!==!1&&(t.type==="touchend"&&t.touches.length===0||!t.changedTouches||t.changedTouches[0].identifier===this.mainTouchId)}_onTouchStart(t){let e=!this.allowTouchScrolling;const s=this._activeObject;this.mainTouchId===void 0&&(this.mainTouchId=this.getPointerId(t)),this.__onMouseDown(t),(this.isDrawingMode||s&&this._target===s)&&(e=!0),e&&t.preventDefault(),this._resetTransformEventData();const n=this.upperCanvasEl,r=this._getEventPrefix(),o=ys(n);xn(o,"touchend",this._onTouchEnd,Ye),e&&xn(o,"touchmove",this._onMouseMove,Ye),is(n,"".concat(r,"down"),this._onMouseDown)}_onMouseDown(t){this.__onMouseDown(t),this._resetTransformEventData();const e=this.upperCanvasEl,s=this._getEventPrefix();is(e,"".concat(s,"move"),this._onMouseMove,Ye);const n=ys(e);xn(n,"".concat(s,"up"),this._onMouseUp),xn(n,"".concat(s,"move"),this._onMouseMove,Ye)}_onTouchEnd(t){if(t.touches.length>0)return;this.__onMouseUp(t),this._resetTransformEventData(),delete this.mainTouchId;const e=this._getEventPrefix(),s=ys(this.upperCanvasEl);is(s,"touchend",this._onTouchEnd,Ye),is(s,"touchmove",this._onMouseMove,Ye),this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(()=>{xn(this.upperCanvasEl,"".concat(e,"down"),this._onMouseDown),this._willAddMouseDown=0},400)}_onMouseUp(t){this.__onMouseUp(t),this._resetTransformEventData();const e=this.upperCanvasEl,s=this._getEventPrefix();if(this._isMainEvent(t)){const n=ys(this.upperCanvasEl);is(n,"".concat(s,"up"),this._onMouseUp),is(n,"".concat(s,"move"),this._onMouseMove,Ye),xn(e,"".concat(s,"move"),this._onMouseMove,Ye)}}_onMouseMove(t){const e=this.getActiveObject();!this.allowTouchScrolling&&(!e||!e.shouldStartDragging(t))&&t.preventDefault&&t.preventDefault(),this.__onMouseMove(t)}_onResize(){this.calcOffset(),this._resetTransformEventData()}_shouldRender(t){const e=this.getActiveObject();return!!e!=!!t||e&&t&&e!==t}__onMouseUp(t){var e;this._cacheTransformEventData(t),this._handleEvent(t,"up:before");const s=this._currentTransform,n=this._isClick,r=this._target,{button:o}=t;if(o)return(this.fireMiddleClick&&o===1||this.fireRightClick&&o===2)&&this._handleEvent(t,"up"),void this._resetTransformEventData();if(this.isDrawingMode&&this._isCurrentlyDrawing)return void this._onMouseUpInDrawingMode(t);if(!this._isMainEvent(t))return;let a,l,c=!1;if(s&&(this._finalizeCurrentTransform(t),c=s.actionPerformed),!n){const h=r===this._activeObject;this.handleSelection(t),c||(c=this._shouldRender(r)||!h&&r===this._activeObject)}if(r){const h=r.findControl(this.getViewportPoint(t),wa(t)),{key:u,control:f}=h||{};if(l=u,r.selectable&&r!==this._activeObject&&r.activeOn==="up")this.setActiveObject(r,t),c=!0;else if(f){const d=f.getMouseUpHandler(t,r,f);d&&(a=this.getScenePoint(t),d.call(f,t,s,a.x,a.y))}r.isMoving=!1}if(s&&(s.target!==r||s.corner!==l)){const h=s.target&&s.target.controls[s.corner],u=h&&h.getMouseUpHandler(t,s.target,h);a=a||this.getScenePoint(t),u&&u.call(h,t,s,a.x,a.y)}this._setCursorFromEvent(t,r),this._handleEvent(t,"up"),this._groupSelector=null,this._currentTransform=null,r&&(r.__corner=void 0),c?this.requestRenderAll():n||(e=this._activeObject)!==null&&e!==void 0&&e.isEditing||this.renderTop()}_basicEventHandler(t,e){const{target:s,subTargets:n=[]}=e;this.fire(t,e),s&&s.fire(t,e);for(let r=0;r<n.length;r++)n[r]!==s&&n[r].fire(t,e);return e}_handleEvent(t,e){const s=this._target,n=this.targets||[],r=w(w({e:t,target:s,subTargets:n},Ei(this,t)),{},{transform:this._currentTransform},e==="up:before"||e==="up"?{isClick:this._isClick,currentTarget:this.findTarget(t),currentSubTargets:this.targets}:{});this.fire("mouse:".concat(e),r),s&&s.fire("mouse".concat(e),r);for(let o=0;o<n.length;o++)n[o]!==s&&n[o].fire("mouse".concat(e),r)}_onMouseDownInDrawingMode(t){this._isCurrentlyDrawing=!0,this.getActiveObject()&&(this.discardActiveObject(t),this.requestRenderAll());const e=this.getScenePoint(t);this.freeDrawingBrush&&this.freeDrawingBrush.onMouseDown(e,{e:t,pointer:e}),this._handleEvent(t,"down")}_onMouseMoveInDrawingMode(t){if(this._isCurrentlyDrawing){const e=this.getScenePoint(t);this.freeDrawingBrush&&this.freeDrawingBrush.onMouseMove(e,{e:t,pointer:e})}this.setCursor(this.freeDrawingCursor),this._handleEvent(t,"move")}_onMouseUpInDrawingMode(t){const e=this.getScenePoint(t);this.freeDrawingBrush?this._isCurrentlyDrawing=!!this.freeDrawingBrush.onMouseUp({e:t,pointer:e}):this._isCurrentlyDrawing=!1,this._handleEvent(t,"up")}__onMouseDown(t){this._isClick=!0,this._cacheTransformEventData(t),this._handleEvent(t,"down:before");let e=this._target;const{button:s}=t;if(s)return(this.fireMiddleClick&&s===1||this.fireRightClick&&s===2)&&this._handleEvent(t,"down"),void this._resetTransformEventData();if(this.isDrawingMode)return void this._onMouseDownInDrawingMode(t);if(!this._isMainEvent(t)||this._currentTransform)return;let n=this._shouldRender(e),r=!1;if(this.handleMultiSelection(t,e)?(e=this._activeObject,r=!0,n=!0):this._shouldClearSelection(t,e)&&this.discardActiveObject(t),this.selection&&(!e||!e.selectable&&!e.isEditing&&e!==this._activeObject)){const o=this.getScenePoint(t);this._groupSelector={x:o.x,y:o.y,deltaY:0,deltaX:0}}if(e){const o=e===this._activeObject;e.selectable&&e.activeOn==="down"&&this.setActiveObject(e,t);const a=e.findControl(this.getViewportPoint(t),wa(t));if(e===this._activeObject&&(a||!r)){this._setupCurrentTransform(t,e,o);const l=a?a.control:void 0,c=this.getScenePoint(t),h=l&&l.getMouseDownHandler(t,e,l);h&&h.call(l,t,this._currentTransform,c.x,c.y)}}n&&(this._objectsToRender=void 0),this._handleEvent(t,"down"),n&&this.requestRenderAll()}_resetTransformEventData(){this._target=this._pointer=this._absolutePointer=void 0}_cacheTransformEventData(t){this._resetTransformEventData(),this._pointer=this.getViewportPoint(t),this._absolutePointer=un(this._pointer,void 0,this.viewportTransform),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(t)}__onMouseMove(t){if(this._isClick=!1,this._cacheTransformEventData(t),this._handleEvent(t,"move:before"),this.isDrawingMode)return void this._onMouseMoveInDrawingMode(t);if(!this._isMainEvent(t))return;const e=this._groupSelector;if(e){const s=this.getScenePoint(t);e.deltaX=s.x-e.x,e.deltaY=s.y-e.y,this.renderTop()}else if(this._currentTransform)this._transformObject(t);else{const s=this.findTarget(t);this._setCursorFromEvent(t,s),this._fireOverOutEvents(t,s)}this.textEditingManager.onMouseMove(t),this._handleEvent(t,"move"),this._resetTransformEventData()}_fireOverOutEvents(t,e){const s=this._hoveredTarget,n=this._hoveredTargets,r=this.targets,o=Math.max(n.length,r.length);this.fireSyntheticInOutEvents("mouse",{e:t,target:e,oldTarget:s,fireCanvas:!0});for(let a=0;a<o;a++)this.fireSyntheticInOutEvents("mouse",{e:t,target:r[a],oldTarget:n[a]});this._hoveredTarget=e,this._hoveredTargets=this.targets.concat()}_fireEnterLeaveEvents(t,e){const s=this._draggedoverTarget,n=this._hoveredTargets,r=this.targets,o=Math.max(n.length,r.length);this.fireSyntheticInOutEvents("drag",w(w({},e),{},{target:t,oldTarget:s,fireCanvas:!0}));for(let a=0;a<o;a++)this.fireSyntheticInOutEvents("drag",w(w({},e),{},{target:r[a],oldTarget:n[a]}));this._draggedoverTarget=t}fireSyntheticInOutEvents(t,e){let{target:s,oldTarget:n,fireCanvas:r,e:o}=e,a=It(e,Mx);const{targetIn:l,targetOut:c,canvasIn:h,canvasOut:u}=Ex[t],f=n!==s;if(n&&f){const d=w(w({},a),{},{e:o,target:n,nextTarget:s},Ei(this,o));r&&this.fire(u,d),n.fire(c,d)}if(s&&f){const d=w(w({},a),{},{e:o,target:s,previousTarget:n},Ei(this,o));r&&this.fire(h,d),s.fire(l,d)}}__onMouseWheel(t){this._cacheTransformEventData(t),this._handleEvent(t,"wheel"),this._resetTransformEventData()}_transformObject(t){const e=this.getScenePoint(t),s=this._currentTransform,n=s.target,r=n.group?un(e,void 0,n.group.calcTransformMatrix()):e;s.shiftKey=t.shiftKey,s.altKey=!!this.centeredKey&&t[this.centeredKey],this._performTransformAction(t,s,r),s.actionPerformed&&this.requestRenderAll()}_performTransformAction(t,e,s){const{action:n,actionHandler:r,target:o}=e,a=!!r&&r(t,e,s.x,s.y);a&&o.setCoords(),n==="drag"&&a&&(e.target.isMoving=!0,this.setCursor(e.target.moveCursor||this.moveCursor)),e.actionPerformed=e.actionPerformed||a}_setCursorFromEvent(t,e){if(!e)return void this.setCursor(this.defaultCursor);let s=e.hoverCursor||this.hoverCursor;const n=si(this._activeObject)?this._activeObject:null,r=(!n||e.group!==n)&&e.findControl(this.getViewportPoint(t));if(r){const o=r.control;this.setCursor(o.cursorStyleHandler(t,o,e))}else e.subTargetCheck&&this.targets.concat().reverse().map(o=>{s=o.hoverCursor||s}),this.setCursor(s)}handleMultiSelection(t,e){const s=this._activeObject,n=si(s);if(s&&this._isSelectionKeyPressed(t)&&this.selection&&e&&e.selectable&&(s!==e||n)&&(n||!e.isDescendantOf(s)&&!s.isDescendantOf(e))&&!e.onSelect({e:t})&&!s.getActiveControl()){if(n){const r=s.getObjects();if(e===s){const o=this.getViewportPoint(t);if(!(e=this.searchPossibleTargets(r,o)||this.searchPossibleTargets(this._objects,o))||!e.selectable)return!1}e.group===s?(s.remove(e),this._hoveredTarget=e,this._hoveredTargets=[...this.targets],s.size()===1&&this._setActiveObject(s.item(0),t)):(s.multiSelectAdd(e),this._hoveredTarget=s,this._hoveredTargets=[...this.targets]),this._fireSelectionEvents(r,t)}else{s.isEditing&&s.exitEditing();const r=new(q.getClass("ActiveSelection"))([],{canvas:this});r.multiSelectAdd(s,e),this._hoveredTarget=r,this._setActiveObject(r,t),this._fireSelectionEvents([s],t)}return!0}return!1}handleSelection(t){if(!this.selection||!this._groupSelector)return!1;const{x:e,y:s,deltaX:n,deltaY:r}=this._groupSelector,o=new E(e,s),a=o.add(new E(n,r)),l=o.min(a),c=o.max(a).subtract(l),h=this.collectObjects({left:l.x,top:l.y,width:c.x,height:c.y},{includeIntersecting:!this.selectionFullyContained}),u=o.eq(a)?h[0]?[h[0]]:[]:h.length>1?h.filter(f=>!f.onSelect({e:t})).reverse():h;if(u.length===1)this.setActiveObject(u[0],t);else if(u.length>1){const f=q.getClass("ActiveSelection");this.setActiveObject(new f(u,{canvas:this}),t)}return this._groupSelector=null,!0}clear(){this.textEditingManager.clear(),super.clear()}destroy(){this.removeListeners(),this.textEditingManager.dispose(),super.destroy()}}const Kp={x1:0,y1:0,x2:0,y2:0},kx=w(w({},Kp),{},{r1:0,r2:0}),Di=(i,t)=>isNaN(i)&&typeof t=="number"?t:i,Px=/^(\d+\.\d+)%|(\d+)%$/;function Zp(i){return i&&Px.test(i)}function Jp(i,t){const e=typeof i=="number"?i:typeof i=="string"?parseFloat(i)/(Zp(i)?100:1):NaN;return yi(0,Di(e,t),1)}const Ax=/\s*;\s*/,Fx=/\s*:\s*/;function Dx(i,t){let e,s;const n=i.getAttribute("style");if(n){const o=n.split(Ax);o[o.length-1]===""&&o.pop();for(let a=o.length;a--;){const[l,c]=o[a].split(Fx).map(h=>h.trim());l==="stop-color"?e=c:l==="stop-opacity"&&(s=c)}}const r=new Mt(e||i.getAttribute("stop-color")||"rgb(0,0,0)");return{offset:Jp(i.getAttribute("offset"),0),color:r.toRgb(),opacity:Di(parseFloat(s||i.getAttribute("stop-opacity")||""),1)*r.getAlpha()*t}}function Rx(i,t){const e=[],s=i.getElementsByTagName("stop"),n=Jp(t,1);for(let r=s.length;r--;)e.push(Dx(s[r],n));return e}function Qp(i){return i.nodeName==="linearGradient"||i.nodeName==="LINEARGRADIENT"?"linear":"radial"}function tm(i){return i.getAttribute("gradientUnits")==="userSpaceOnUse"?"pixels":"percentage"}function _s(i,t){return i.getAttribute(t)}function Lx(i,t){return function(e,s){let n,{width:r,height:o,gradientUnits:a}=s;return Object.keys(e).reduce((l,c)=>{const h=e[c];return h==="Infinity"?n=1:h==="-Infinity"?n=0:(n=typeof h=="string"?parseFloat(h):h,typeof h=="string"&&Zp(h)&&(n*=.01,a==="pixels"&&(c!=="x1"&&c!=="x2"&&c!=="r2"||(n*=r),c!=="y1"&&c!=="y2"||(n*=o)))),l[c]=n,l},{})}(Qp(i)==="linear"?function(e){return{x1:_s(e,"x1")||0,y1:_s(e,"y1")||0,x2:_s(e,"x2")||"100%",y2:_s(e,"y2")||0}}(i):function(e){return{x1:_s(e,"fx")||_s(e,"cx")||"50%",y1:_s(e,"fy")||_s(e,"cy")||"50%",r1:0,x2:_s(e,"cx")||"50%",y2:_s(e,"cy")||"50%",r2:_s(e,"r")||"50%"}}(i),w(w({},t),{},{gradientUnits:tm(i)}))}class Mo{constructor(t){const{type:e="linear",gradientUnits:s="pixels",coords:n={},colorStops:r=[],offsetX:o=0,offsetY:a=0,gradientTransform:l,id:c}=t||{};Object.assign(this,{type:e,gradientUnits:s,coords:w(w({},e==="radial"?kx:Kp),n),colorStops:r,offsetX:o,offsetY:a,gradientTransform:l,id:c?"".concat(c,"_").concat(Bn()):Bn()})}addColorStop(t){for(const e in t){const s=new Mt(t[e]);this.colorStops.push({offset:parseFloat(e),color:s.toRgb(),opacity:s.getAlpha()})}return this}toObject(t){return w(w({},Ci(this,t)),{},{type:this.type,coords:w({},this.coords),colorStops:this.colorStops.map(e=>w({},e)),offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?[...this.gradientTransform]:void 0})}toSVG(t){let{additionalTransform:e}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=[],n=this.gradientTransform?this.gradientTransform.concat():ke.concat(),r=this.gradientUnits==="pixels"?"userSpaceOnUse":"objectBoundingBox",o=this.colorStops.map(u=>w({},u)).sort((u,f)=>u.offset-f.offset);let a=-this.offsetX,l=-this.offsetY;var c;r==="objectBoundingBox"?(a/=t.width,l/=t.height):(a+=t.width/2,l+=t.height/2),(c=t)&&typeof c._renderPathCommands=="function"&&this.gradientUnits!=="percentage"&&(a-=t.pathOffset.x,l-=t.pathOffset.y),n[4]-=a,n[5]-=l;const h=['id="SVGID_'.concat(this.id,'"'),'gradientUnits="'.concat(r,'"'),'gradientTransform="'.concat(e?e+" ":"").concat(so(n),'"'),""].join(" ");if(this.type==="linear"){const{x1:u,y1:f,x2:d,y2:p}=this.coords;s.push("<linearGradient ",h,' x1="',u,'" y1="',f,'" x2="',d,'" y2="',p,`">
`)}else if(this.type==="radial"){const{x1:u,y1:f,x2:d,y2:p,r1:g,r2:m}=this.coords,v=g>m;s.push("<radialGradient ",h,' cx="',v?u:d,'" cy="',v?f:p,'" r="',v?g:m,'" fx="',v?d:u,'" fy="',v?p:f,`">
`),v&&(o.reverse(),o.forEach(y=>{y.offset=1-y.offset}));const _=Math.min(g,m);if(_>0){const y=_/Math.max(g,m);o.forEach(b=>{b.offset+=y*(1-b.offset)})}}return o.forEach(u=>{let{color:f,offset:d,opacity:p}=u;s.push("<stop ",'offset="',100*d+"%",'" style="stop-color:',f,p!==void 0?";stop-opacity: "+p:";",`"/>
`)}),s.push(this.type==="linear"?"</linearGradient>":"</radialGradient>",`
`),s.join("")}toLive(t){const{x1:e,y1:s,x2:n,y2:r,r1:o,r2:a}=this.coords,l=this.type==="linear"?t.createLinearGradient(e,s,n,r):t.createRadialGradient(e,s,o,n,r,a);return this.colorStops.forEach(c=>{let{color:h,opacity:u,offset:f}=c;l.addColorStop(f,u!==void 0?new Mt(h).setAlpha(u).toRgba():h)}),l}static async fromObject(t){const{colorStops:e,gradientTransform:s}=t;return new this(w(w({},t),{},{colorStops:e?e.map(n=>w({},n)):void 0,gradientTransform:s?[...s]:void 0}))}static fromElement(t,e,s){const n=tm(t),r=e._findCenterFromElement();return new this(w({id:t.getAttribute("id")||void 0,type:Qp(t),coords:Lx(t,{width:s.viewBoxWidth||s.width,height:s.viewBoxHeight||s.height}),colorStops:Rx(t,s.opacity),gradientUnits:n,gradientTransform:Lc(t.getAttribute("gradientTransform")||"")},n==="pixels"?{offsetX:e.width/2-r.x,offsetY:e.height/2-r.y}:{offsetX:0,offsetY:0}))}}T(Mo,"type","Gradient"),q.setClass(Mo,"gradient"),q.setClass(Mo,"linear"),q.setClass(Mo,"radial");const jx=["type","source","patternTransform"];class Wl{get type(){return"pattern"}set type(t){jn("warn","Setting type has no effect",t)}constructor(t){T(this,"repeat","repeat"),T(this,"offsetX",0),T(this,"offsetY",0),T(this,"crossOrigin",""),this.id=Bn(),Object.assign(this,t)}isImageSource(){return!!this.source&&typeof this.source.src=="string"}isCanvasSource(){return!!this.source&&!!this.source.toDataURL}sourceToString(){return this.isImageSource()?this.source.src:this.isCanvasSource()?this.source.toDataURL():""}toLive(t){return this.source&&(!this.isImageSource()||this.source.complete&&this.source.naturalWidth!==0&&this.source.naturalHeight!==0)?t.createPattern(this.source,this.repeat):null}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const{repeat:e,crossOrigin:s}=this;return w(w({},Ci(this,t)),{},{type:"pattern",source:this.sourceToString(),repeat:e,crossOrigin:s,offsetX:jt(this.offsetX,_t.NUM_FRACTION_DIGITS),offsetY:jt(this.offsetY,_t.NUM_FRACTION_DIGITS),patternTransform:this.patternTransform?[...this.patternTransform]:null})}toSVG(t){let{width:e,height:s}=t;const{source:n,repeat:r,id:o}=this,a=Di(this.offsetX/e,0),l=Di(this.offsetY/s,0),c=r==="repeat-y"||r==="no-repeat"?1+Math.abs(a||0):Di(n.width/e,0),h=r==="repeat-x"||r==="no-repeat"?1+Math.abs(l||0):Di(n.height/s,0);return['<pattern id="SVGID_'.concat(o,'" x="').concat(a,'" y="').concat(l,'" width="').concat(c,'" height="').concat(h,'">'),'<image x="0" y="0" width="'.concat(n.width,'" height="').concat(n.height,'" xlink:href="').concat(this.sourceToString(),'"></image>'),"</pattern>",""].join(`
`)}static async fromObject(t,e){let{type:s,source:n,patternTransform:r}=t,o=It(t,jx);const a=await Hr(n,w(w({},e),{},{crossOrigin:o.crossOrigin}));return new this(w(w({},o),{},{patternTransform:r&&r.slice(0),source:a}))}}T(Wl,"type","Pattern"),q.setClass(Wl),q.setClass(Wl,"pattern");const Ix=["path","left","top"],Bx=["d"];class ni extends ne{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{path:s,left:n,top:r}=e,o=It(e,Ix);super(),Object.assign(this,ni.ownDefaults),this.setOptions(o),this._setPath(t||[],!0),typeof n=="number"&&this.set(wt,n),typeof r=="number"&&this.set(De,r)}_setPath(t,e){this.path=Vp(Array.isArray(t)?t:$p(t)),this.setBoundingBox(e)}_findCenterFromElement(){const t=this._calcBoundsFromPath();return new E(t.left+t.width/2,t.top+t.height/2)}_renderPathCommands(t){const e=-this.pathOffset.x,s=-this.pathOffset.y;t.beginPath();for(const n of this.path)switch(n[0]){case"L":t.lineTo(n[1]+e,n[2]+s);break;case"M":t.moveTo(n[1]+e,n[2]+s);break;case"C":t.bezierCurveTo(n[1]+e,n[2]+s,n[3]+e,n[4]+s,n[5]+e,n[6]+s);break;case"Q":t.quadraticCurveTo(n[1]+e,n[2]+s,n[3]+e,n[4]+s);break;case"Z":t.closePath()}}_render(t){this._renderPathCommands(t),this._renderPaintInOrder(t)}toString(){return"#<Path (".concat(this.complexity(),'): { "top": ').concat(this.top,', "left": ').concat(this.left," }>")}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return w(w({},super.toObject(t)),{},{path:this.path.map(e=>e.slice())})}toDatalessObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const e=this.toObject(t);return this.sourcePath&&(delete e.path,e.sourcePath=this.sourcePath),e}_toSVG(){const t=qp(this.path,_t.NUM_FRACTION_DIGITS);return["<path ","COMMON_PARTS",'d="'.concat(t,`" stroke-linecap="round" />
`)]}_getOffsetTransform(){const t=_t.NUM_FRACTION_DIGITS;return" translate(".concat(jt(-this.pathOffset.x,t),", ").concat(jt(-this.pathOffset.y,t),")")}toClipPathSVG(t){const e=this._getOffsetTransform();return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:t,additionalTransform:e})}toSVG(t){const e=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:t,additionalTransform:e})}complexity(){return this.path.length}setDimensions(){this.setBoundingBox()}setBoundingBox(t){const{width:e,height:s,pathOffset:n}=this._calcDimensions();this.set({width:e,height:s,pathOffset:n}),t&&this.setPositionByOrigin(n,gt,gt)}_calcBoundsFromPath(){const t=[];let e=0,s=0,n=0,r=0;for(const o of this.path)switch(o[0]){case"L":n=o[1],r=o[2],t.push({x:e,y:s},{x:n,y:r});break;case"M":n=o[1],r=o[2],e=n,s=r;break;case"C":t.push(...Bc(n,r,o[1],o[2],o[3],o[4],o[5],o[6])),n=o[5],r=o[6];break;case"Q":t.push(...Bc(n,r,o[1],o[2],o[1],o[2],o[3],o[4])),n=o[3],r=o[4];break;case"Z":n=e,r=s}return Ys(t)}_calcDimensions(){const t=this._calcBoundsFromPath();return w(w({},t),{},{pathOffset:new E(t.left+t.width/2,t.top+t.height/2)})}static fromObject(t){return this._fromObject(t,{extraParam:"path"})}static async fromElement(t,e,s){const n=_n(t,this.ATTRIBUTE_NAMES,s),{d:r}=n;return new this(r,w(w(w({},It(n,Bx)),e),{},{left:void 0,top:void 0}))}}T(ni,"type","Path"),T(ni,"cacheProperties",[...vn,"path","fillRule"]),T(ni,"ATTRIBUTE_NAMES",[...Un,"d"]),q.setClass(ni),q.setSVGClass(ni);const Nx=["left","top","radius"],em=["radius","startAngle","endAngle","counterClockwise"];class js extends ne{static getDefaults(){return w(w({},super.getDefaults()),js.ownDefaults)}constructor(t){super(),Object.assign(this,js.ownDefaults),this.setOptions(t)}_set(t,e){return super._set(t,e),t==="radius"&&this.setRadius(e),this}_render(t){t.beginPath(),t.arc(0,0,this.radius,Yt(this.startAngle),Yt(this.endAngle),this.counterClockwise),this._renderPaintInOrder(t)}getRadiusX(){return this.get("radius")*this.get(Pe)}getRadiusY(){return this.get("radius")*this.get(es)}setRadius(t){this.radius=t,this.set({width:2*t,height:2*t})}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return super.toObject([...em,...t])}_toSVG(){const t=(this.endAngle-this.startAngle)%360;if(t===0)return["<circle ","COMMON_PARTS",'cx="0" cy="0" ','r="',"".concat(this.radius),`" />
`];{const{radius:e}=this,s=Yt(this.startAngle),n=Yt(this.endAngle),r=Os(s)*e,o=Ms(s)*e,a=Os(n)*e,l=Ms(n)*e,c=t>180?1:0,h=this.counterClockwise?0:1;return['<path d="M '.concat(r," ").concat(o," A ").concat(e," ").concat(e," 0 ").concat(c," ").concat(h," ").concat(a," ").concat(l,'" '),"COMMON_PARTS",` />
`]}}static async fromElement(t,e,s){const n=_n(t,this.ATTRIBUTE_NAMES,s),{left:r=0,top:o=0,radius:a=0}=n;return new this(w(w({},It(n,Nx)),{},{radius:a,left:r-a,top:o-a}))}static fromObject(t){return super._fromObject(t)}}T(js,"type","Circle"),T(js,"cacheProperties",[...vn,...em]),T(js,"ownDefaults",{radius:0,startAngle:0,endAngle:360,counterClockwise:!1}),T(js,"ATTRIBUTE_NAMES",["cx","cy","r",...Un]),q.setClass(js),q.setSVGClass(js);const Hx=["x1","y1","x2","y2"],zx=["x1","y1","x2","y2"],Nc=["x1","x2","y1","y2"];class Tn extends ne{constructor(){let[t,e,s,n]=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,0,0],r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Object.assign(this,Tn.ownDefaults),this.setOptions(r),this.x1=t,this.x2=s,this.y1=e,this.y2=n,this._setWidthHeight();const{left:o,top:a}=r;typeof o=="number"&&this.set(wt,o),typeof a=="number"&&this.set(De,a)}_setWidthHeight(){const{x1:t,y1:e,x2:s,y2:n}=this;this.width=Math.abs(s-t),this.height=Math.abs(n-e);const{left:r,top:o,width:a,height:l}=Ys([{x:t,y:e},{x:s,y:n}]),c=new E(r+a/2,o+l/2);this.setPositionByOrigin(c,gt,gt)}_set(t,e){return super._set(t,e),Nc.includes(t)&&this._setWidthHeight(),this}_render(t){t.beginPath();const e=this.calcLinePoints();t.moveTo(e.x1,e.y1),t.lineTo(e.x2,e.y2),t.lineWidth=this.strokeWidth;const s=t.strokeStyle;var n;ls(this.stroke)?t.strokeStyle=this.stroke.toLive(t):t.strokeStyle=(n=this.stroke)!==null&&n!==void 0?n:t.fillStyle,this.stroke&&this._renderStroke(t),t.strokeStyle=s}_findCenterFromElement(){return new E((this.x1+this.x2)/2,(this.y1+this.y2)/2)}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return w(w({},super.toObject(t)),this.calcLinePoints())}_getNonTransformedDimensions(){const t=super._getNonTransformedDimensions();return this.strokeLineCap==="butt"&&(this.width===0&&(t.y-=this.strokeWidth),this.height===0&&(t.x-=this.strokeWidth)),t}calcLinePoints(){const{x1:t,x2:e,y1:s,y2:n,width:r,height:o}=this,a=t<=e?-1:1,l=s<=n?-1:1;return{x1:a*r/2,x2:a*-r/2,y1:l*o/2,y2:l*-o/2}}_toSVG(){const{x1:t,x2:e,y1:s,y2:n}=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="'.concat(t,'" y1="').concat(s,'" x2="').concat(e,'" y2="').concat(n,`" />
`)]}static async fromElement(t,e,s){const n=_n(t,this.ATTRIBUTE_NAMES,s),{x1:r=0,y1:o=0,x2:a=0,y2:l=0}=n;return new this([r,o,a,l],It(n,Hx))}static fromObject(t){let{x1:e,y1:s,x2:n,y2:r}=t,o=It(t,zx);return this._fromObject(w(w({},o),{},{points:[e,s,n,r]}),{extraParam:"points"})}}T(Tn,"type","Line"),T(Tn,"cacheProperties",[...vn,...Nc]),T(Tn,"ATTRIBUTE_NAMES",Un.concat(Nc)),q.setClass(Tn),q.setSVGClass(Tn);class On extends ne{static getDefaults(){return w(w({},super.getDefaults()),On.ownDefaults)}constructor(t){super(),Object.assign(this,On.ownDefaults),this.setOptions(t)}_render(t){const e=this.width/2,s=this.height/2;t.beginPath(),t.moveTo(-e,s),t.lineTo(0,-s),t.lineTo(e,s),t.closePath(),this._renderPaintInOrder(t)}_toSVG(){const t=this.width/2,e=this.height/2;return["<polygon ","COMMON_PARTS",'points="',"".concat(-t," ").concat(e,",0 ").concat(-e,",").concat(t," ").concat(e),'" />']}}T(On,"type","Triangle"),T(On,"ownDefaults",{width:100,height:100}),q.setClass(On),q.setSVGClass(On);const sm=["rx","ry"];class nn extends ne{static getDefaults(){return w(w({},super.getDefaults()),nn.ownDefaults)}constructor(t){super(),Object.assign(this,nn.ownDefaults),this.setOptions(t)}_set(t,e){switch(super._set(t,e),t){case"rx":this.rx=e,this.set("width",2*e);break;case"ry":this.ry=e,this.set("height",2*e)}return this}getRx(){return this.get("rx")*this.get(Pe)}getRy(){return this.get("ry")*this.get(es)}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return super.toObject([...sm,...t])}_toSVG(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" rx="'.concat(this.rx,'" ry="').concat(this.ry,`" />
`)]}_render(t){t.beginPath(),t.save(),t.transform(1,0,0,this.ry/this.rx,0,0),t.arc(0,0,this.rx,0,fn,!1),t.restore(),this._renderPaintInOrder(t)}static async fromElement(t,e,s){const n=_n(t,this.ATTRIBUTE_NAMES,s);return n.left=(n.left||0)-n.rx,n.top=(n.top||0)-n.ry,new this(n)}}function Vx(i){if(!i)return[];const t=i.replace(/,/g," ").trim().split(/\s+/),e=[];for(let s=0;s<t.length;s+=2)e.push({x:parseFloat(t[s]),y:parseFloat(t[s+1])});return e}T(nn,"type","Ellipse"),T(nn,"cacheProperties",[...vn,...sm]),T(nn,"ownDefaults",{rx:0,ry:0}),T(nn,"ATTRIBUTE_NAMES",[...Un,"cx","cy","rx","ry"]),q.setClass(nn),q.setSVGClass(nn);const Wx=["left","top"],nm={exactBoundingBox:!1};class os extends ne{static getDefaults(){return w(w({},super.getDefaults()),os.ownDefaults)}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),T(this,"strokeDiff",void 0),Object.assign(this,os.ownDefaults),this.setOptions(e),this.points=t;const{left:s,top:n}=e;this.initialized=!0,this.setBoundingBox(!0),typeof s=="number"&&this.set(wt,s),typeof n=="number"&&this.set(De,n)}isOpen(){return!0}_projectStrokeOnPoints(t){return Dp(this.points,t,this.isOpen())}_calcDimensions(t){t=w({scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:this.strokeMiterLimit,strokeUniform:this.strokeUniform,strokeWidth:this.strokeWidth},t||{});const e=this.exactBoundingBox?this._projectStrokeOnPoints(t).map(c=>c.projectedPoint):this.points;if(e.length===0)return{left:0,top:0,width:0,height:0,pathOffset:new E,strokeOffset:new E,strokeDiff:new E};const s=Ys(e),n=_o(w(w({},t),{},{scaleX:1,scaleY:1})),r=Ys(this.points.map(c=>ue(c,n,!0))),o=new E(this.scaleX,this.scaleY);let a=s.left+s.width/2,l=s.top+s.height/2;return this.exactBoundingBox&&(a-=l*Math.tan(Yt(this.skewX)),l-=a*Math.tan(Yt(this.skewY))),w(w({},s),{},{pathOffset:new E(a,l),strokeOffset:new E(r.left,r.top).subtract(new E(s.left,s.top)).multiply(o),strokeDiff:new E(s.width,s.height).subtract(new E(r.width,r.height)).multiply(o)})}_findCenterFromElement(){const t=Ys(this.points);return new E(t.left+t.width/2,t.top+t.height/2)}setDimensions(){this.setBoundingBox()}setBoundingBox(t){const{left:e,top:s,width:n,height:r,pathOffset:o,strokeOffset:a,strokeDiff:l}=this._calcDimensions();this.set({width:n,height:r,pathOffset:o,strokeOffset:a,strokeDiff:l}),t&&this.setPositionByOrigin(new E(e+n/2,s+r/2),gt,gt)}isStrokeAccountedForInDimensions(){return this.exactBoundingBox}_getNonTransformedDimensions(){return this.exactBoundingBox?new E(this.width,this.height):super._getNonTransformedDimensions()}_getTransformedDimensions(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this.exactBoundingBox){let o;if(Object.keys(t).some(a=>this.strokeUniform||this.constructor.layoutProperties.includes(a))){var e,s;const{width:a,height:l}=this._calcDimensions(t);o=new E((e=t.width)!==null&&e!==void 0?e:a,(s=t.height)!==null&&s!==void 0?s:l)}else{var n,r;o=new E((n=t.width)!==null&&n!==void 0?n:this.width,(r=t.height)!==null&&r!==void 0?r:this.height)}return o.multiply(new E(t.scaleX||this.scaleX,t.scaleY||this.scaleY))}return super._getTransformedDimensions(t)}_set(t,e){const s=this.initialized&&this[t]!==e,n=super._set(t,e);return this.exactBoundingBox&&s&&((t===Pe||t===es)&&this.strokeUniform&&this.constructor.layoutProperties.includes("strokeUniform")||this.constructor.layoutProperties.includes(t))&&this.setDimensions(),n}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return w(w({},super.toObject(t)),{},{points:this.points.map(e=>{let{x:s,y:n}=e;return{x:s,y:n}})})}_toSVG(){const t=[],e=this.pathOffset.x,s=this.pathOffset.y,n=_t.NUM_FRACTION_DIGITS;for(let r=0,o=this.points.length;r<o;r++)t.push(jt(this.points[r].x-e,n),",",jt(this.points[r].y-s,n)," ");return["<".concat(this.constructor.type.toLowerCase()," "),"COMMON_PARTS",'points="'.concat(t.join(""),`" />
`)]}_render(t){const e=this.points.length,s=this.pathOffset.x,n=this.pathOffset.y;if(e&&!isNaN(this.points[e-1].y)){t.beginPath(),t.moveTo(this.points[0].x-s,this.points[0].y-n);for(let r=0;r<e;r++){const o=this.points[r];t.lineTo(o.x-s,o.y-n)}!this.isOpen()&&t.closePath(),this._renderPaintInOrder(t)}}complexity(){return this.points.length}static async fromElement(t,e,s){return new this(Vx(t.getAttribute("points")),w(w({},It(_n(t,this.ATTRIBUTE_NAMES,s),Wx)),e))}static fromObject(t){return this._fromObject(t,{extraParam:"points"})}}T(os,"ownDefaults",nm),T(os,"type","Polyline"),T(os,"layoutProperties",[fr,dr,"strokeLineCap","strokeLineJoin","strokeMiterLimit","strokeWidth","strokeUniform","points"]),T(os,"cacheProperties",[...vn,"points"]),T(os,"ATTRIBUTE_NAMES",[...Un]),q.setClass(os),q.setSVGClass(os);class Eo extends os{isOpen(){return!1}}T(Eo,"ownDefaults",nm),T(Eo,"type","Polygon"),q.setClass(Eo),q.setSVGClass(Eo);const im=["fontSize","fontWeight","fontFamily","fontStyle"],rm=["underline","overline","linethrough"],om=[...im,"lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],am=[...om,...rm,"textBackgroundColor","direction"],Yx=[...im,...rm,Le,"strokeWidth",ee,"deltaY","textBackgroundColor"],Xx={_reNewline:Sh,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:wt,fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stroke:null,shadow:null,path:void 0,pathStartOffset:0,pathSide:wt,pathAlign:"baseline",_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,deltaY:0,direction:"ltr",CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2},Is="justify",Da="justify-left",zr="justify-right",Vr="justify-center";class lm extends ne{isEmptyStyles(t){if(!this.styles||t!==void 0&&!this.styles[t])return!0;const e=t===void 0?this.styles:{line:this.styles[t]};for(const s in e)for(const n in e[s])for(const r in e[s][n])return!1;return!0}styleHas(t,e){if(!this.styles||e!==void 0&&!this.styles[e])return!1;const s=e===void 0?this.styles:{0:this.styles[e]};for(const n in s)for(const r in s[n])if(s[n][r][t]!==void 0)return!0;return!1}cleanStyle(t){if(!this.styles)return!1;const e=this.styles;let s,n,r=0,o=!0,a=0;for(const l in e){s=0;for(const c in e[l]){const h=e[l][c]||{};r++,h[t]!==void 0?(n?h[t]!==n&&(o=!1):n=h[t],h[t]===this[t]&&delete h[t]):o=!1,Object.keys(h).length!==0?s++:delete e[l][c]}s===0&&delete e[l]}for(let l=0;l<this._textLines.length;l++)a+=this._textLines[l].length;o&&r===a&&(this[t]=n,this.removeStyle(t))}removeStyle(t){if(!this.styles)return;const e=this.styles;let s,n,r;for(n in e){for(r in s=e[n],s)delete s[r][t],Object.keys(s[r]).length===0&&delete s[r];Object.keys(s).length===0&&delete e[n]}}_extendStyles(t,e){const{lineIndex:s,charIndex:n}=this.get2DCursorLocation(t);this._getLineStyle(s)||this._setLineStyle(s);const r=Ph(w(w({},this._getStyleDeclaration(s,n)),e),o=>o!==void 0);this._setStyleDeclaration(s,n,r)}getSelectionStyles(t,e,s){const n=[];for(let r=t;r<(e||t);r++)n.push(this.getStyleAtPosition(r,s));return n}getStyleAtPosition(t,e){const{lineIndex:s,charIndex:n}=this.get2DCursorLocation(t);return e?this.getCompleteStyleDeclaration(s,n):this._getStyleDeclaration(s,n)}setSelectionStyles(t,e,s){for(let n=e;n<(s||e);n++)this._extendStyles(n,t);this._forceClearCache=!0}_getStyleDeclaration(t,e){var s;const n=this.styles&&this.styles[t];return n&&(s=n[e])!==null&&s!==void 0?s:{}}getCompleteStyleDeclaration(t,e){return w(w({},Ci(this,this.constructor._styleProperties)),this._getStyleDeclaration(t,e))}_setStyleDeclaration(t,e,s){this.styles[t][e]=s}_deleteStyleDeclaration(t,e){delete this.styles[t][e]}_getLineStyle(t){return!!this.styles[t]}_setLineStyle(t){this.styles[t]={}}_deleteLineStyle(t){delete this.styles[t]}}T(lm,"_styleProperties",Yx);const Ux=/  +/g,Gx=/"/g;function Yl(i,t,e,s,n){return"		".concat(function(r,o){let{left:a,top:l,width:c,height:h}=o,u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:_t.NUM_FRACTION_DIGITS;const f=no(ee,r,!1),[d,p,g,m]=[a,l,c,h].map(v=>jt(v,u));return"<rect ".concat(f,' x="').concat(d,'" y="').concat(p,'" width="').concat(g,'" height="').concat(m,'"></rect>')}(i,{left:t,top:e,width:s,height:n}),`
`)}const $x=["textAnchor","textDecoration","dx","dy","top","left","fontSize","strokeWidth"];let Xl;class he extends lm{static getDefaults(){return w(w({},super.getDefaults()),he.ownDefaults)}constructor(t,e){super(),T(this,"__charBounds",[]),Object.assign(this,he.ownDefaults),this.setOptions(e),this.styles||(this.styles={}),this.text=t,this.initialized=!0,this.path&&this.setPathInfo(),this.initDimensions(),this.setCoords()}setPathInfo(){const t=this.path;t&&(t.segmentsInfo=Wh(t.path))}_splitText(){const t=this._splitTextIntoLines(this.text);return this.textLines=t.lines,this._textLines=t.graphemeLines,this._unwrappedTextLines=t._unwrappedLines,this._text=t.graphemeText,t}initDimensions(){this._splitText(),this._clearCache(),this.dirty=!0,this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),this.textAlign.includes(Is)&&this.enlargeSpaces()}enlargeSpaces(){let t,e,s,n,r,o,a;for(let l=0,c=this._textLines.length;l<c;l++)if((this.textAlign===Is||l!==c-1&&!this.isEndOfWrapping(l))&&(n=0,r=this._textLines[l],e=this.getLineWidth(l),e<this.width&&(a=this.textLines[l].match(this._reSpacesAndTabs)))){s=a.length,t=(this.width-e)/s;for(let h=0;h<=r.length;h++)o=this.__charBounds[l][h],this._reSpaceAndTab.test(r[h])?(o.width+=t,o.kernedWidth+=t,o.left+=n,n+=t):o.left+=n}}isEndOfWrapping(t){return t===this._textLines.length-1}missingNewlineOffset(t){return 1}get2DCursorLocation(t,e){const s=e?this._unwrappedTextLines:this._textLines;let n;for(n=0;n<s.length;n++){if(t<=s[n].length)return{lineIndex:n,charIndex:t};t-=s[n].length+this.missingNewlineOffset(n,e)}return{lineIndex:n-1,charIndex:s[n-1].length<t?s[n-1].length:t}}toString(){return"#<Text (".concat(this.complexity(),'): { "text": "').concat(this.text,'", "fontFamily": "').concat(this.fontFamily,'" }>')}_getCacheCanvasDimensions(){const t=super._getCacheCanvasDimensions(),e=this.fontSize;return t.width+=e*t.zoomX,t.height+=e*t.zoomY,t}_render(t){const e=this.path;e&&!e.isNotVisible()&&e._render(t),this._setTextStyles(t),this._renderTextLinesBackground(t),this._renderTextDecoration(t,"underline"),this._renderText(t),this._renderTextDecoration(t,"overline"),this._renderTextDecoration(t,"linethrough")}_renderText(t){this.paintFirst===Le?(this._renderTextStroke(t),this._renderTextFill(t)):(this._renderTextFill(t),this._renderTextStroke(t))}_setTextStyles(t,e,s){if(t.textBaseline="alphabetic",this.path)switch(this.pathAlign){case gt:t.textBaseline="middle";break;case"ascender":t.textBaseline=De;break;case"descender":t.textBaseline=Oc}t.font=this._getFontDeclaration(e,s)}calcTextWidth(){let t=this.getLineWidth(0);for(let e=1,s=this._textLines.length;e<s;e++){const n=this.getLineWidth(e);n>t&&(t=n)}return t}_renderTextLine(t,e,s,n,r,o){this._renderChars(t,e,s,n,r,o)}_renderTextLinesBackground(t){if(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor"))return;const e=t.fillStyle,s=this._getLeftOffset();let n=this._getTopOffset();for(let r=0,o=this._textLines.length;r<o;r++){const a=this.getHeightOfLine(r);if(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor",r)){n+=a;continue}const l=this._textLines[r].length,c=this._getLineLeftOffset(r);let h,u,f=0,d=0,p=this.getValueOfPropertyAt(r,0,"textBackgroundColor");for(let g=0;g<l;g++){const m=this.__charBounds[r][g];u=this.getValueOfPropertyAt(r,g,"textBackgroundColor"),this.path?(t.save(),t.translate(m.renderLeft,m.renderTop),t.rotate(m.angle),t.fillStyle=u,u&&t.fillRect(-m.width/2,-a/this.lineHeight*(1-this._fontSizeFraction),m.width,a/this.lineHeight),t.restore()):u!==p?(h=s+c+d,this.direction==="rtl"&&(h=this.width-h-f),t.fillStyle=p,p&&t.fillRect(h,n,f,a/this.lineHeight),d=m.left,f=m.width,p=u):f+=m.kernedWidth}u&&!this.path&&(h=s+c+d,this.direction==="rtl"&&(h=this.width-h-f),t.fillStyle=u,t.fillRect(h,n,f,a/this.lineHeight)),n+=a}t.fillStyle=e,this._removeShadow(t)}_measureChar(t,e,s,n){const r=Br.getFontCache(e),o=this._getFontDeclaration(e),a=s+t,l=s&&o===this._getFontDeclaration(n),c=e.fontSize/this.CACHE_FONT_SIZE;let h,u,f,d;if(s&&r[s]!==void 0&&(f=r[s]),r[t]!==void 0&&(d=h=r[t]),l&&r[a]!==void 0&&(u=r[a],d=u-f),h===void 0||f===void 0||u===void 0){const p=function(){return Xl||(Xl=Es({width:0,height:0}).getContext("2d")),Xl}();this._setTextStyles(p,e,!0),h===void 0&&(d=h=p.measureText(t).width,r[t]=h),f===void 0&&l&&s&&(f=p.measureText(s).width,r[s]=f),l&&u===void 0&&(u=p.measureText(a).width,r[a]=u,d=u-f)}return{width:h*c,kernedWidth:d*c}}getHeightOfChar(t,e){return this.getValueOfPropertyAt(t,e,"fontSize")}measureLine(t){const e=this._measureLine(t);return this.charSpacing!==0&&(e.width-=this._getWidthOfCharSpacing()),e.width<0&&(e.width=0),e}_measureLine(t){let e,s,n=0;const r=this.pathSide===$t,o=this.path,a=this._textLines[t],l=a.length,c=new Array(l);this.__charBounds[t]=c;for(let h=0;h<l;h++){const u=a[h];s=this._getGraphemeBox(u,t,h,e),c[h]=s,n+=s.kernedWidth,e=u}if(c[l]={left:s?s.left+s.width:0,width:0,kernedWidth:0,height:this.fontSize,deltaY:0},o&&o.segmentsInfo){let h=0;const u=o.segmentsInfo[o.segmentsInfo.length-1].length;switch(this.textAlign){case wt:h=r?u-n:0;break;case gt:h=(u-n)/2;break;case $t:h=r?0:u-n}h+=this.pathStartOffset*(r?-1:1);for(let f=r?l-1:0;r?f>=0:f<l;r?f--:f++)s=c[f],h>u?h%=u:h<0&&(h+=u),this._setGraphemeOnPath(h,s),h+=s.kernedWidth}return{width:n,numOfSpaces:0}}_setGraphemeOnPath(t,e){const s=t+e.kernedWidth/2,n=this.path,r=Gp(n.path,s,n.segmentsInfo);e.renderLeft=r.x-n.pathOffset.x,e.renderTop=r.y-n.pathOffset.y,e.angle=r.angle+(this.pathSide===$t?Math.PI:0)}_getGraphemeBox(t,e,s,n,r){const o=this.getCompleteStyleDeclaration(e,s),a=n?this.getCompleteStyleDeclaration(e,s-1):{},l=this._measureChar(t,o,n,a);let c,h=l.kernedWidth,u=l.width;this.charSpacing!==0&&(c=this._getWidthOfCharSpacing(),u+=c,h+=c);const f={width:u,left:0,height:o.fontSize,kernedWidth:h,deltaY:o.deltaY};if(s>0&&!r){const d=this.__charBounds[e][s-1];f.left=d.left+d.width+l.kernedWidth-l.width}return f}getHeightOfLine(t){if(this.__lineHeights[t])return this.__lineHeights[t];let e=this.getHeightOfChar(t,0);for(let s=1,n=this._textLines[t].length;s<n;s++)e=Math.max(this.getHeightOfChar(t,s),e);return this.__lineHeights[t]=e*this.lineHeight*this._fontSizeMult}calcTextHeight(){let t,e=0;for(let s=0,n=this._textLines.length;s<n;s++)t=this.getHeightOfLine(s),e+=s===n-1?t/this.lineHeight:t;return e}_getLeftOffset(){return this.direction==="ltr"?-this.width/2:this.width/2}_getTopOffset(){return-this.height/2}_renderTextCommon(t,e){t.save();let s=0;const n=this._getLeftOffset(),r=this._getTopOffset();for(let o=0,a=this._textLines.length;o<a;o++){const l=this.getHeightOfLine(o),c=l/this.lineHeight,h=this._getLineLeftOffset(o);this._renderTextLine(e,t,this._textLines[o],n+h,r+s+c,o),s+=l}t.restore()}_renderTextFill(t){(this.fill||this.styleHas(ee))&&this._renderTextCommon(t,"fillText")}_renderTextStroke(t){(this.stroke&&this.strokeWidth!==0||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(t),t.save(),this._setLineDash(t,this.strokeDashArray),t.beginPath(),this._renderTextCommon(t,"strokeText"),t.closePath(),t.restore())}_renderChars(t,e,s,n,r,o){const a=this.getHeightOfLine(o),l=this.textAlign.includes(Is),c=this.path,h=!l&&this.charSpacing===0&&this.isEmptyStyles(o)&&!c,u=this.direction==="ltr",f=this.direction==="ltr"?1:-1,d=e.direction;let p,g,m,v,_,y="",b=0;if(e.save(),d!==this.direction&&(e.canvas.setAttribute("dir",u?"ltr":"rtl"),e.direction=u?"ltr":"rtl",e.textAlign=u?wt:$t),r-=a*this._fontSizeFraction/this.lineHeight,h)return this._renderChar(t,e,o,0,s.join(""),n,r),void e.restore();for(let S=0,P=s.length-1;S<=P;S++)v=S===P||this.charSpacing||c,y+=s[S],m=this.__charBounds[o][S],b===0?(n+=f*(m.kernedWidth-m.width),b+=m.width):b+=m.kernedWidth,l&&!v&&this._reSpaceAndTab.test(s[S])&&(v=!0),v||(p=p||this.getCompleteStyleDeclaration(o,S),g=this.getCompleteStyleDeclaration(o,S+1),v=vl(p,g,!1)),v&&(c?(e.save(),e.translate(m.renderLeft,m.renderTop),e.rotate(m.angle),this._renderChar(t,e,o,S,y,-b/2,0),e.restore()):(_=n,this._renderChar(t,e,o,S,y,_,r)),y="",p=g,n+=f*b,b=0);e.restore()}_applyPatternGradientTransformText(t){const e=this.width+this.strokeWidth,s=this.height+this.strokeWidth,n=Es({width:e,height:s}),r=n.getContext("2d");return n.width=e,n.height=s,r.beginPath(),r.moveTo(0,0),r.lineTo(e,0),r.lineTo(e,s),r.lineTo(0,s),r.closePath(),r.translate(e/2,s/2),r.fillStyle=t.toLive(r),this._applyPatternGradientTransform(r,t),r.fill(),r.createPattern(n,"no-repeat")}handleFiller(t,e,s){let n,r;return ls(s)?s.gradientUnits==="percentage"||s.gradientTransform||s.patternTransform?(n=-this.width/2,r=-this.height/2,t.translate(n,r),t[e]=this._applyPatternGradientTransformText(s),{offsetX:n,offsetY:r}):(t[e]=s.toLive(t),this._applyPatternGradientTransform(t,s)):(t[e]=s,{offsetX:0,offsetY:0})}_setStrokeStyles(t,e){let{stroke:s,strokeWidth:n}=e;return t.lineWidth=n,t.lineCap=this.strokeLineCap,t.lineDashOffset=this.strokeDashOffset,t.lineJoin=this.strokeLineJoin,t.miterLimit=this.strokeMiterLimit,this.handleFiller(t,"strokeStyle",s)}_setFillStyles(t,e){let{fill:s}=e;return this.handleFiller(t,"fillStyle",s)}_renderChar(t,e,s,n,r,o,a){const l=this._getStyleDeclaration(s,n),c=this.getCompleteStyleDeclaration(s,n),h=t==="fillText"&&c.fill,u=t==="strokeText"&&c.stroke&&c.strokeWidth;if(u||h){if(e.save(),e.font=this._getFontDeclaration(c),l.textBackgroundColor&&this._removeShadow(e),l.deltaY&&(a+=l.deltaY),h){const f=this._setFillStyles(e,c);e.fillText(r,o-f.offsetX,a-f.offsetY)}if(u){const f=this._setStrokeStyles(e,c);e.strokeText(r,o-f.offsetX,a-f.offsetY)}e.restore()}}setSuperscript(t,e){this._setScript(t,e,this.superscript)}setSubscript(t,e){this._setScript(t,e,this.subscript)}_setScript(t,e,s){const n=this.get2DCursorLocation(t,!0),r=this.getValueOfPropertyAt(n.lineIndex,n.charIndex,"fontSize"),o=this.getValueOfPropertyAt(n.lineIndex,n.charIndex,"deltaY"),a={fontSize:r*s.size,deltaY:o+r*s.baseline};this.setSelectionStyles(a,t,e)}_getLineLeftOffset(t){const e=this.getLineWidth(t),s=this.width-e,n=this.textAlign,r=this.direction,o=this.isEndOfWrapping(t);let a=0;return n===Is||n===Vr&&!o||n===zr&&!o||n===Da&&!o?0:(n===gt&&(a=s/2),n===$t&&(a=s),n===Vr&&(a=s/2),n===zr&&(a=s),r==="rtl"&&(n===$t||n===Is||n===zr?a=0:n===wt||n===Da?a=-s:n!==gt&&n!==Vr||(a=-s/2)),a)}_clearCache(){this._forceClearCache=!1,this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]}getLineWidth(t){if(this.__lineWidths[t]!==void 0)return this.__lineWidths[t];const{width:e}=this.measureLine(t);return this.__lineWidths[t]=e,e}_getWidthOfCharSpacing(){return this.charSpacing!==0?this.fontSize*this.charSpacing/1e3:0}getValueOfPropertyAt(t,e,s){var n;return(n=this._getStyleDeclaration(t,e)[s])!==null&&n!==void 0?n:this[s]}_renderTextDecoration(t,e){if(!this[e]&&!this.styleHas(e))return;let s=this._getTopOffset();const n=this._getLeftOffset(),r=this.path,o=this._getWidthOfCharSpacing(),a=this.offsets[e];for(let l=0,c=this._textLines.length;l<c;l++){const h=this.getHeightOfLine(l);if(!this[e]&&!this.styleHas(e,l)){s+=h;continue}const u=this._textLines[l],f=h/this.lineHeight,d=this._getLineLeftOffset(l);let p,g,m=0,v=0,_=this.getValueOfPropertyAt(l,0,e),y=this.getValueOfPropertyAt(l,0,ee);const b=s+f*(1-this._fontSizeFraction);let S=this.getHeightOfChar(l,0),P=this.getValueOfPropertyAt(l,0,"deltaY");for(let k=0,D=u.length;k<D;k++){const z=this.__charBounds[l][k];p=this.getValueOfPropertyAt(l,k,e),g=this.getValueOfPropertyAt(l,k,ee);const K=this.getHeightOfChar(l,k),st=this.getValueOfPropertyAt(l,k,"deltaY");if(r&&p&&g)t.save(),t.fillStyle=y,t.translate(z.renderLeft,z.renderTop),t.rotate(z.angle),t.fillRect(-z.kernedWidth/2,a*K+st,z.kernedWidth,this.fontSize/15),t.restore();else if((p!==_||g!==y||K!==S||st!==P)&&v>0){let G=n+d+m;this.direction==="rtl"&&(G=this.width-G-v),_&&y&&(t.fillStyle=y,t.fillRect(G,b+a*S+P,v,this.fontSize/15)),m=z.left,v=z.width,_=p,y=g,S=K,P=st}else v+=z.kernedWidth}let O=n+d+m;this.direction==="rtl"&&(O=this.width-O-v),t.fillStyle=g,p&&g&&t.fillRect(O,b+a*S+P,v-o,this.fontSize/15),s+=h}this._removeShadow(t)}_getFontDeclaration(){let{fontFamily:t=this.fontFamily,fontStyle:e=this.fontStyle,fontWeight:s=this.fontWeight,fontSize:n=this.fontSize}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1?arguments[1]:void 0;const o=t.includes("'")||t.includes('"')||t.includes(",")||he.genericFonts.includes(t.toLowerCase())?t:'"'.concat(t,'"');return[e,s,"".concat(r?this.CACHE_FONT_SIZE:n,"px"),o].join(" ")}render(t){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._forceClearCache&&this.initDimensions(),super.render(t)))}graphemeSplit(t){return ml(t)}_splitTextIntoLines(t){const e=t.split(this._reNewline),s=new Array(e.length),n=[`
`];let r=[];for(let o=0;o<e.length;o++)s[o]=this.graphemeSplit(e[o]),r=r.concat(s[o],n);return r.pop(),{_unwrappedLines:s,lines:e,graphemeText:r,graphemeLines:s}}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return w(w({},super.toObject([...am,...t])),{},{styles:Lp(this.styles,this.text)},this.path?{path:this.path.toObject()}:{})}set(t,e){const{textLayoutProperties:s}=this.constructor;super.set(t,e);let n=!1,r=!1;if(typeof t=="object")for(const o in t)o==="path"&&this.setPathInfo(),n=n||s.includes(o),r=r||o==="path";else n=s.includes(t),r=t==="path";return r&&this.setPathInfo(),n&&this.initialized&&(this.initDimensions(),this.setCoords()),this}complexity(){return 1}static async fromElement(t,e,s){const n=_n(t,he.ATTRIBUTE_NAMES,s),r=w(w({},e),n),{textAnchor:o=wt,textDecoration:a="",dx:l=0,dy:c=0,top:h=0,left:u=0,fontSize:f=Ch,strokeWidth:d=1}=r,p=It(r,$x),g=new this((t.textContent||"").replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," "),w({left:u+l,top:h+c,underline:a.includes("underline"),overline:a.includes("overline"),linethrough:a.includes("line-through"),strokeWidth:0,fontSize:f},p)),m=g.getScaledHeight()/g.height,v=((g.height+g.strokeWidth)*g.lineHeight-g.height)*m,_=g.getScaledHeight()+v;let y=0;return o===gt&&(y=g.getScaledWidth()/2),o===$t&&(y=g.getScaledWidth()),g.set({left:g.left-y,top:g.top-(_-g.fontSize*(.07+g._fontSizeFraction))/g.lineHeight,strokeWidth:d}),g}static fromObject(t){return this._fromObject(w(w({},t),{},{styles:jp(t.styles||{},t.text)}),{extraParam:"text"})}}T(he,"textLayoutProperties",om),T(he,"cacheProperties",[...vn,...am]),T(he,"ownDefaults",Xx),T(he,"type","Text"),T(he,"genericFonts",["serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","math","emoji","fangsong"]),T(he,"ATTRIBUTE_NAMES",Un.concat("x","y","dx","dy","font-family","font-style","font-weight","font-size","letter-spacing","text-decoration","text-anchor")),Pp(he,[class extends hp{_toSVG(){const i=this._getSVGLeftTopOffsets(),t=this._getSVGTextAndBg(i.textTop,i.textLeft);return this._wrapSVGTextAndBg(t)}toSVG(i){return this._createBaseSVGMarkup(this._toSVG(),{reviver:i,noStyle:!0,withShadow:!0})}_getSVGLeftTopOffsets(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}}_wrapSVGTextAndBg(i){let{textBgRects:t,textSpans:e}=i;const s=this.getSvgTextDecoration(this);return[t.join(""),'		<text xml:space="preserve" ',this.fontFamily?'font-family="'.concat(this.fontFamily.replace(Gx,"'"),'" '):"",this.fontSize?'font-size="'.concat(this.fontSize,'" '):"",this.fontStyle?'font-style="'.concat(this.fontStyle,'" '):"",this.fontWeight?'font-weight="'.concat(this.fontWeight,'" '):"",s?'text-decoration="'.concat(s,'" '):"",this.direction==="rtl"?'direction="'.concat(this.direction,'" '):"",'style="',this.getSvgStyles(!0),'"',this.addPaintOrder()," >",e.join(""),`</text>
`]}_getSVGTextAndBg(i,t){const e=[],s=[];let n,r=i;this.backgroundColor&&s.push(...Yl(this.backgroundColor,-this.width/2,-this.height/2,this.width,this.height));for(let o=0,a=this._textLines.length;o<a;o++)n=this._getLineLeftOffset(o),this.direction==="rtl"&&(n+=this.width),(this.textBackgroundColor||this.styleHas("textBackgroundColor",o))&&this._setSVGTextLineBg(s,o,t+n,r),this._setSVGTextLineText(e,o,t+n,r),r+=this.getHeightOfLine(o);return{textSpans:e,textBgRects:s}}_createTextCharSpan(i,t,e,s){const n=this.getSvgSpanStyles(t,i!==i.trim()||!!i.match(Ux)),r=n?'style="'.concat(n,'"'):"",o=t.deltaY,a=o?' dy="'.concat(jt(o,_t.NUM_FRACTION_DIGITS),'" '):"";return'<tspan x="'.concat(jt(e,_t.NUM_FRACTION_DIGITS),'" y="').concat(jt(s,_t.NUM_FRACTION_DIGITS),'" ').concat(a).concat(r,">").concat(Rp(i),"</tspan>")}_setSVGTextLineText(i,t,e,s){const n=this.getHeightOfLine(t),r=this.textAlign.includes(Is),o=this._textLines[t];let a,l,c,h,u,f="",d=0;s+=n*(1-this._fontSizeFraction)/this.lineHeight;for(let p=0,g=o.length-1;p<=g;p++)u=p===g||this.charSpacing,f+=o[p],c=this.__charBounds[t][p],d===0?(e+=c.kernedWidth-c.width,d+=c.width):d+=c.kernedWidth,r&&!u&&this._reSpaceAndTab.test(o[p])&&(u=!0),u||(a=a||this.getCompleteStyleDeclaration(t,p),l=this.getCompleteStyleDeclaration(t,p+1),u=vl(a,l,!0)),u&&(h=this._getStyleDeclaration(t,p),i.push(this._createTextCharSpan(f,h,e,s)),f="",a=l,this.direction==="rtl"?e-=d:e+=d,d=0)}_setSVGTextLineBg(i,t,e,s){const n=this._textLines[t],r=this.getHeightOfLine(t)/this.lineHeight;let o,a=0,l=0,c=this.getValueOfPropertyAt(t,0,"textBackgroundColor");for(let h=0;h<n.length;h++){const{left:u,width:f,kernedWidth:d}=this.__charBounds[t][h];o=this.getValueOfPropertyAt(t,h,"textBackgroundColor"),o!==c?(c&&i.push(...Yl(c,e+l,s,a,r)),l=u,a=f,c=o):a+=d}o&&i.push(...Yl(c,e+l,s,a,r))}_getSVGLineTopOffset(i){let t,e=0;for(t=0;t<i;t++)e+=this.getHeightOfLine(t);const s=this.getHeightOfLine(t);return{lineTop:e,offset:(this._fontSizeMult-this._fontSizeFraction)*s/(this.lineHeight*this._fontSizeMult)}}getSvgStyles(i){return"".concat(super.getSvgStyles(i)," white-space: pre;")}getSvgSpanStyles(i,t){const{fontFamily:e,strokeWidth:s,stroke:n,fill:r,fontSize:o,fontStyle:a,fontWeight:l,deltaY:c}=i,h=this.getSvgTextDecoration(i);return[n?no(Le,n):"",s?"stroke-width: ".concat(s,"; "):"",e?"font-family: ".concat(e.includes("'")||e.includes('"')?e:"'".concat(e,"'"),"; "):"",o?"font-size: ".concat(o,"px; "):"",a?"font-style: ".concat(a,"; "):"",l?"font-weight: ".concat(l,"; "):"",h&&"text-decoration: ".concat(h,"; "),r?no(ee,r):"",c?"baseline-shift: ".concat(-c,"; "):"",t?"white-space: pre; ":""].join("")}getSvgTextDecoration(i){return["overline","underline","line-through"].filter(t=>i[t.replace("-","")]).join(" ")}}]),q.setClass(he),q.setSVGClass(he);class qx{constructor(t){T(this,"target",void 0),T(this,"__mouseDownInPlace",!1),T(this,"__dragStartFired",!1),T(this,"__isDraggingOver",!1),T(this,"__dragStartSelection",void 0),T(this,"__dragImageDisposer",void 0),T(this,"_dispose",void 0),this.target=t;const e=[this.target.on("dragenter",this.dragEnterHandler.bind(this)),this.target.on("dragover",this.dragOverHandler.bind(this)),this.target.on("dragleave",this.dragLeaveHandler.bind(this)),this.target.on("dragend",this.dragEndHandler.bind(this)),this.target.on("drop",this.dropHandler.bind(this))];this._dispose=()=>{e.forEach(s=>s()),this._dispose=void 0}}isPointerOverSelection(t){const e=this.target,s=e.getSelectionStartFromPointer(t);return e.isEditing&&s>=e.selectionStart&&s<=e.selectionEnd&&e.selectionStart<e.selectionEnd}start(t){return this.__mouseDownInPlace=this.isPointerOverSelection(t)}isActive(){return this.__mouseDownInPlace}end(t){const e=this.isActive();return e&&!this.__dragStartFired&&(this.target.setCursorByClick(t),this.target.initDelayedCursor(!0)),this.__mouseDownInPlace=!1,this.__dragStartFired=!1,this.__isDraggingOver=!1,e}getDragStartSelection(){return this.__dragStartSelection}setDragImage(t,e){var s;let{selectionStart:n,selectionEnd:r}=e;const o=this.target,a=o.canvas,l=new E(o.flipX?-1:1,o.flipY?-1:1),c=o._getCursorBoundaries(n),h=new E(c.left+c.leftOffset,c.top+c.topOffset).multiply(l).transform(o.calcTransformMatrix()),u=a.getScenePoint(t).subtract(h),f=o.getCanvasRetinaScaling(),d=o.getBoundingRect(),p=h.subtract(new E(d.left,d.top)),g=a.viewportTransform,m=p.add(u).transform(g,!0),v=o.backgroundColor,_=Hh(o.styles);o.backgroundColor="";const y={stroke:"transparent",fill:"transparent",textBackgroundColor:"transparent"};o.setSelectionStyles(y,0,n),o.setSelectionStyles(y,r,o.text.length),o.dirty=!0;const b=o.toCanvasElement({enableRetinaScaling:a.enableRetinaScaling,viewportTransform:!0});o.backgroundColor=v,o.styles=_,o.dirty=!0,Fa(b,{position:"fixed",left:"".concat(-b.width,"px"),border:Re,width:"".concat(b.width/f,"px"),height:"".concat(b.height/f,"px")}),this.__dragImageDisposer&&this.__dragImageDisposer(),this.__dragImageDisposer=()=>{b.remove()},ys(t.target||this.target.hiddenTextarea).body.appendChild(b),(s=t.dataTransfer)===null||s===void 0||s.setDragImage(b,m.x,m.y)}onDragStart(t){this.__dragStartFired=!0;const e=this.target,s=this.isActive();if(s&&t.dataTransfer){const n=this.__dragStartSelection={selectionStart:e.selectionStart,selectionEnd:e.selectionEnd},r=e._text.slice(n.selectionStart,n.selectionEnd).join(""),o=w({text:e.text,value:r},n);t.dataTransfer.setData("text/plain",r),t.dataTransfer.setData("application/fabric",JSON.stringify({value:r,styles:e.getSelectionStyles(n.selectionStart,n.selectionEnd,!0)})),t.dataTransfer.effectAllowed="copyMove",this.setDragImage(t,o)}return e.abortCursorAnimation(),s}canDrop(t){if(this.target.editable&&!this.target.getActiveControl()&&!t.defaultPrevented){if(this.isActive()&&this.__dragStartSelection){const e=this.target.getSelectionStartFromPointer(t),s=this.__dragStartSelection;return e<s.selectionStart||e>s.selectionEnd}return!0}return!1}targetCanDrop(t){return this.target.canDrop(t)}dragEnterHandler(t){let{e}=t;const s=this.targetCanDrop(e);!this.__isDraggingOver&&s&&(this.__isDraggingOver=!0)}dragOverHandler(t){const{e}=t,s=this.targetCanDrop(e);!this.__isDraggingOver&&s?this.__isDraggingOver=!0:this.__isDraggingOver&&!s&&(this.__isDraggingOver=!1),this.__isDraggingOver&&(e.preventDefault(),t.canDrop=!0,t.dropTarget=this.target)}dragLeaveHandler(){(this.__isDraggingOver||this.isActive())&&(this.__isDraggingOver=!1)}dropHandler(t){var e;const{e:s}=t,n=s.defaultPrevented;this.__isDraggingOver=!1,s.preventDefault();let r=(e=s.dataTransfer)===null||e===void 0?void 0:e.getData("text/plain");if(r&&!n){const o=this.target,a=o.canvas;let l=o.getSelectionStartFromPointer(s);const{styles:c}=s.dataTransfer.types.includes("application/fabric")?JSON.parse(s.dataTransfer.getData("application/fabric")):{},h=r[Math.max(0,r.length-1)],u=0;if(this.__dragStartSelection){const f=this.__dragStartSelection.selectionStart,d=this.__dragStartSelection.selectionEnd;l>f&&l<=d?l=f:l>d&&(l-=d-f),o.removeChars(f,d),delete this.__dragStartSelection}o._reNewline.test(h)&&(o._reNewline.test(o._text[l])||l===o._text.length)&&(r=r.trimEnd()),t.didDrop=!0,t.dropTarget=o,o.insertChars(r,c,l),a.setActiveObject(o),o.enterEditing(s),o.selectionStart=Math.min(l+u,o._text.length),o.selectionEnd=Math.min(o.selectionStart+r.length,o._text.length),o.hiddenTextarea.value=o.text,o._updateTextarea(),o.hiddenTextarea.focus(),o.fire(xa,{index:l+u,action:"drop"}),a.fire("text:changed",{target:o}),a.contextTopDirty=!0,a.requestRenderAll()}}dragEndHandler(t){let{e}=t;if(this.isActive()&&this.__dragStartFired&&this.__dragStartSelection){var s;const n=this.target,r=this.target.canvas,{selectionStart:o,selectionEnd:a}=this.__dragStartSelection,l=((s=e.dataTransfer)===null||s===void 0?void 0:s.dropEffect)||Re;l===Re?(n.selectionStart=o,n.selectionEnd=a,n._updateTextarea(),n.hiddenTextarea.focus()):(n.clearContextTop(),l==="move"&&(n.removeChars(o,a),n.selectionStart=n.selectionEnd=o,n.hiddenTextarea&&(n.hiddenTextarea.value=n.text),n._updateTextarea(),n.fire(xa,{index:o,action:"dragend"}),r.fire("text:changed",{target:n}),r.requestRenderAll()),n.exitEditing())}this.__dragImageDisposer&&this.__dragImageDisposer(),delete this.__dragImageDisposer,delete this.__dragStartSelection,this.__isDraggingOver=!1}dispose(){this._dispose&&this._dispose()}}const Lf=/[ \n\.,;!\?\-]/;class Kx extends he{constructor(){super(...arguments),T(this,"_currentCursorOpacity",1)}initBehavior(){this._tick=this._tick.bind(this),this._onTickComplete=this._onTickComplete.bind(this),this.updateSelectionOnMouseMove=this.updateSelectionOnMouseMove.bind(this)}onDeselect(t){return this.isEditing&&this.exitEditing(),this.selected=!1,super.onDeselect(t)}_animateCursor(t){let{toValue:e,duration:s,delay:n,onComplete:r}=t;return Ih({startValue:this._currentCursorOpacity,endValue:e,duration:s,delay:n,onComplete:r,abort:()=>!this.canvas||this.selectionStart!==this.selectionEnd,onChange:o=>{this._currentCursorOpacity=o,this.renderCursorOrSelection()}})}_tick(t){this._currentTickState=this._animateCursor({toValue:0,duration:this.cursorDuration/2,delay:Math.max(t||0,100),onComplete:this._onTickComplete})}_onTickComplete(){var t;(t=this._currentTickCompleteState)===null||t===void 0||t.abort(),this._currentTickCompleteState=this._animateCursor({toValue:1,duration:this.cursorDuration,onComplete:this._tick})}initDelayedCursor(t){this.abortCursorAnimation(),this._tick(t?0:this.cursorDelay)}abortCursorAnimation(){let t=!1;[this._currentTickState,this._currentTickCompleteState].forEach(e=>{e&&!e.isDone()&&(t=!0,e.abort())}),this._currentCursorOpacity=1,t&&this.clearContextTop()}restartCursorIfNeeded(){[this._currentTickState,this._currentTickCompleteState].some(t=>!t||t.isDone())&&this.initDelayedCursor()}selectAll(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this}getSelectedText(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")}findWordBoundaryLeft(t){let e=0,s=t-1;if(this._reSpace.test(this._text[s]))for(;this._reSpace.test(this._text[s]);)e++,s--;for(;/\S/.test(this._text[s])&&s>-1;)e++,s--;return t-e}findWordBoundaryRight(t){let e=0,s=t;if(this._reSpace.test(this._text[s]))for(;this._reSpace.test(this._text[s]);)e++,s++;for(;/\S/.test(this._text[s])&&s<this._text.length;)e++,s++;return t+e}findLineBoundaryLeft(t){let e=0,s=t-1;for(;!/\n/.test(this._text[s])&&s>-1;)e++,s--;return t-e}findLineBoundaryRight(t){let e=0,s=t;for(;!/\n/.test(this._text[s])&&s<this._text.length;)e++,s++;return t+e}searchWordBoundary(t,e){const s=this._text;let n=t>0&&this._reSpace.test(s[t])&&(e===-1||!Sh.test(s[t-1]))?t-1:t,r=s[n];for(;n>0&&n<s.length&&!Lf.test(r);)n+=e,r=s[n];return e===-1&&Lf.test(r)&&n++,n}selectWord(t){t=t||this.selectionStart;const e=this.searchWordBoundary(t,-1),s=Math.max(e,this.searchWordBoundary(t,1));this.selectionStart=e,this.selectionEnd=s,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()}selectLine(t){t=t||this.selectionStart;const e=this.findLineBoundaryLeft(t),s=this.findLineBoundaryRight(t);return this.selectionStart=e,this.selectionEnd=s,this._fireSelectionChanged(),this._updateTextarea(),this}enterEditing(t){!this.isEditing&&this.editable&&(this.enterEditingImpl(),this.fire("editing:entered",t?{e:t}:void 0),this._fireSelectionChanged(),this.canvas&&(this.canvas.fire("text:editing:entered",{target:this,e:t}),this.canvas.requestRenderAll()))}enterEditingImpl(){this.canvas&&(this.canvas.calcOffset(),this.canvas.textEditingManager.exitTextEditing()),this.isEditing=!0,this.initHiddenTextarea(),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick()}updateSelectionOnMouseMove(t){if(this.getActiveControl())return;const e=this.hiddenTextarea;ys(e).activeElement!==e&&e.focus();const s=this.getSelectionStartFromPointer(t),n=this.selectionStart,r=this.selectionEnd;(s===this.__selectionStartOnMouseDown&&n!==r||n!==s&&r!==s)&&(s>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=s):(this.selectionStart=s,this.selectionEnd=this.__selectionStartOnMouseDown),this.selectionStart===n&&this.selectionEnd===r||(this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}_setEditingProps(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0}fromStringToGraphemeSelection(t,e,s){const n=s.slice(0,t),r=this.graphemeSplit(n).length;if(t===e)return{selectionStart:r,selectionEnd:r};const o=s.slice(t,e);return{selectionStart:r,selectionEnd:r+this.graphemeSplit(o).length}}fromGraphemeToStringSelection(t,e,s){const n=s.slice(0,t).join("").length;return t===e?{selectionStart:n,selectionEnd:n}:{selectionStart:n,selectionEnd:n+s.slice(t,e).join("").length}}_updateTextarea(){if(this.cursorOffsetCache={},this.hiddenTextarea){if(!this.inCompositionMode){const t=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=t.selectionStart,this.hiddenTextarea.selectionEnd=t.selectionEnd}this.updateTextareaPosition()}}updateFromTextArea(){if(!this.hiddenTextarea)return;this.cursorOffsetCache={};const t=this.hiddenTextarea;this.text=t.value,this.set("dirty",!0),this.initDimensions(),this.setCoords();const e=this.fromStringToGraphemeSelection(t.selectionStart,t.selectionEnd,t.value);this.selectionEnd=this.selectionStart=e.selectionEnd,this.inCompositionMode||(this.selectionStart=e.selectionStart),this.updateTextareaPosition()}updateTextareaPosition(){if(this.selectionStart===this.selectionEnd){const t=this._calcTextareaPosition();this.hiddenTextarea.style.left=t.left,this.hiddenTextarea.style.top=t.top}}_calcTextareaPosition(){if(!this.canvas)return{left:"1px",top:"1px"};const t=this.inCompositionMode?this.compositionStart:this.selectionStart,e=this._getCursorBoundaries(t),s=this.get2DCursorLocation(t),n=s.lineIndex,r=s.charIndex,o=this.getValueOfPropertyAt(n,r,"fontSize")*this.lineHeight,a=e.leftOffset,l=this.getCanvasRetinaScaling(),c=this.canvas.upperCanvasEl,h=c.width/l,u=c.height/l,f=h-o,d=u-o,p=new E(e.left+a,e.top+e.topOffset+o).transform(this.calcTransformMatrix()).transform(this.canvas.viewportTransform).multiply(new E(c.clientWidth/h,c.clientHeight/u));return p.x<0&&(p.x=0),p.x>f&&(p.x=f),p.y<0&&(p.y=0),p.y>d&&(p.y=d),p.x+=this.canvas._offset.left,p.y+=this.canvas._offset.top,{left:"".concat(p.x,"px"),top:"".concat(p.y,"px"),fontSize:"".concat(o,"px"),charHeight:o}}_saveEditingProps(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}}_restoreEditingProps(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor||this.canvas.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor||this.canvas.moveCursor),delete this._savedProps)}_exitEditing(){const t=this.hiddenTextarea;this.selected=!1,this.isEditing=!1,t&&(t.blur&&t.blur(),t.parentNode&&t.parentNode.removeChild(t)),this.hiddenTextarea=null,this.abortCursorAnimation(),this.selectionStart!==this.selectionEnd&&this.clearContextTop()}exitEditingImpl(){this._exitEditing(),this.selectionEnd=this.selectionStart,this._restoreEditingProps(),this._forceClearCache&&(this.initDimensions(),this.setCoords())}exitEditing(){const t=this._textBeforeEdit!==this.text;return this.exitEditingImpl(),this.fire("editing:exited"),t&&this.fire(Ca),this.canvas&&(this.canvas.fire("text:editing:exited",{target:this}),t&&this.canvas.fire("object:modified",{target:this})),this}_removeExtraneousStyles(){for(const t in this.styles)this._textLines[t]||delete this.styles[t]}removeStyleFromTo(t,e){const{lineIndex:s,charIndex:n}=this.get2DCursorLocation(t,!0),{lineIndex:r,charIndex:o}=this.get2DCursorLocation(e,!0);if(s!==r){if(this.styles[s])for(let a=n;a<this._unwrappedTextLines[s].length;a++)delete this.styles[s][a];if(this.styles[r])for(let a=o;a<this._unwrappedTextLines[r].length;a++){const l=this.styles[r][a];l&&(this.styles[s]||(this.styles[s]={}),this.styles[s][n+a-o]=l)}for(let a=s+1;a<=r;a++)delete this.styles[a];this.shiftLineStyles(r,s-r)}else if(this.styles[s]){const a=this.styles[s],l=o-n;for(let c=n;c<o;c++)delete a[c];for(const c in this.styles[s]){const h=parseInt(c,10);h>=o&&(a[h-l]=a[c],delete a[c])}}}shiftLineStyles(t,e){const s=Object.assign({},this.styles);for(const n in this.styles){const r=parseInt(n,10);r>t&&(this.styles[r+e]=s[r],s[r-e]||delete this.styles[r])}}insertNewlineStyleObject(t,e,s,n){const r={},o=this._unwrappedTextLines[t].length,a=o===e;let l=!1;s||(s=1),this.shiftLineStyles(t,s);const c=this.styles[t]?this.styles[t][e===0?e:e-1]:void 0;for(const u in this.styles[t]){const f=parseInt(u,10);f>=e&&(l=!0,r[f-e]=this.styles[t][u],a&&e===0||delete this.styles[t][u])}let h=!1;for(l&&!a&&(this.styles[t+s]=r,h=!0),(h||o>e)&&s--;s>0;)n&&n[s-1]?this.styles[t+s]={0:w({},n[s-1])}:c?this.styles[t+s]={0:w({},c)}:delete this.styles[t+s],s--;this._forceClearCache=!0}insertCharStyleObject(t,e,s,n){this.styles||(this.styles={});const r=this.styles[t],o=r?w({},r):{};s||(s=1);for(const l in o){const c=parseInt(l,10);c>=e&&(r[c+s]=o[c],o[c-s]||delete r[c])}if(this._forceClearCache=!0,n){for(;s--;)Object.keys(n[s]).length&&(this.styles[t]||(this.styles[t]={}),this.styles[t][e+s]=w({},n[s]));return}if(!r)return;const a=r[e?e-1:1];for(;a&&s--;)this.styles[t][e+s]=w({},a)}insertNewStyleBlock(t,e,s){const n=this.get2DCursorLocation(e,!0),r=[0];let o,a=0;for(let l=0;l<t.length;l++)t[l]===`
`?(a++,r[a]=0):r[a]++;for(r[0]>0&&(this.insertCharStyleObject(n.lineIndex,n.charIndex,r[0],s),s=s&&s.slice(r[0]+1)),a&&this.insertNewlineStyleObject(n.lineIndex,n.charIndex+r[0],a),o=1;o<a;o++)r[o]>0?this.insertCharStyleObject(n.lineIndex+o,0,r[o],s):s&&this.styles[n.lineIndex+o]&&s[0]&&(this.styles[n.lineIndex+o][0]=s[0]),s=s&&s.slice(r[o]+1);r[o]>0&&this.insertCharStyleObject(n.lineIndex+o,0,r[o],s)}removeChars(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t+1;this.removeStyleFromTo(t,e),this._text.splice(t,e-t),this.text=this._text.join(""),this.set("dirty",!0),this.initDimensions(),this.setCoords(),this._removeExtraneousStyles()}insertChars(t,e,s){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:s;n>s&&this.removeStyleFromTo(s,n);const r=this.graphemeSplit(t);this.insertNewStyleBlock(r,s,e),this._text=[...this._text.slice(0,s),...r,...this._text.slice(n)],this.text=this._text.join(""),this.set("dirty",!0),this.initDimensions(),this.setCoords(),this._removeExtraneousStyles()}setSelectionStartEndWithShift(t,e,s){s<=t?(e===t?this._selectionDirection=wt:this._selectionDirection===$t&&(this._selectionDirection=wt,this.selectionEnd=t),this.selectionStart=s):s>t&&s<e?this._selectionDirection===$t?this.selectionEnd=s:this.selectionStart=s:(e===t?this._selectionDirection=$t:this._selectionDirection===wt&&(this._selectionDirection=$t,this.selectionStart=e),this.selectionEnd=s)}}class Zx extends Kx{initHiddenTextarea(){const t=this.canvas&&ys(this.canvas.getElement())||ur(),e=t.createElement("textarea");Object.entries({autocapitalize:"off",autocorrect:"off",autocomplete:"off",spellcheck:"false","data-fabric":"textarea",wrap:"off"}).map(o=>{let[a,l]=o;return e.setAttribute(a,l)});const{top:s,left:n,fontSize:r}=this._calcTextareaPosition();e.style.cssText="position: absolute; top: ".concat(s,"; left: ").concat(n,"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding-top: ").concat(r,";"),(this.hiddenTextareaContainer||t.body).appendChild(e),Object.entries({blur:"blur",keydown:"onKeyDown",keyup:"onKeyUp",input:"onInput",copy:"copy",cut:"copy",paste:"paste",compositionstart:"onCompositionStart",compositionupdate:"onCompositionUpdate",compositionend:"onCompositionEnd"}).map(o=>{let[a,l]=o;return e.addEventListener(a,this[l].bind(this))}),this.hiddenTextarea=e}blur(){this.abortCursorAnimation()}onKeyDown(t){if(!this.isEditing)return;const e=this.direction==="rtl"?this.keysMapRtl:this.keysMap;if(t.keyCode in e)this[e[t.keyCode]](t);else{if(!(t.keyCode in this.ctrlKeysMapDown)||!t.ctrlKey&&!t.metaKey)return;this[this.ctrlKeysMapDown[t.keyCode]](t)}t.stopImmediatePropagation(),t.preventDefault(),t.keyCode>=33&&t.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}onKeyUp(t){!this.isEditing||this._copyDone||this.inCompositionMode?this._copyDone=!1:t.keyCode in this.ctrlKeysMapUp&&(t.ctrlKey||t.metaKey)&&(this[this.ctrlKeysMapUp[t.keyCode]](t),t.stopImmediatePropagation(),t.preventDefault(),this.canvas&&this.canvas.requestRenderAll())}onInput(t){const e=this.fromPaste;if(this.fromPaste=!1,t&&t.stopPropagation(),!this.isEditing)return;const s=()=>{this.updateFromTextArea(),this.fire(xa),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())};if(this.hiddenTextarea.value==="")return this.styles={},void s();const n=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,r=this._text.length,o=n.length,a=this.selectionStart,l=this.selectionEnd,c=a!==l;let h,u,f,d,p=o-r;const g=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),m=a>g.selectionStart;c?(u=this._text.slice(a,l),p+=l-a):o<r&&(u=m?this._text.slice(l+p,l):this._text.slice(a,a-p));const v=n.slice(g.selectionEnd-p,g.selectionEnd);if(u&&u.length&&(v.length&&(h=this.getSelectionStyles(a,a+1,!1),h=v.map(()=>h[0])),c?(f=a,d=l):m?(f=l-u.length,d=l):(f=l,d=l+u.length),this.removeStyleFromTo(f,d)),v.length){const{copyPasteData:_}=Ks();e&&v.join("")===_.copiedText&&!_t.disableStyleCopyPaste&&(h=_.copiedTextStyle),this.insertNewStyleBlock(v,a,h)}s()}onCompositionStart(){this.inCompositionMode=!0}onCompositionEnd(){this.inCompositionMode=!1}onCompositionUpdate(t){let{target:e}=t;const{selectionStart:s,selectionEnd:n}=e;this.compositionStart=s,this.compositionEnd=n,this.updateTextareaPosition()}copy(){if(this.selectionStart===this.selectionEnd)return;const{copyPasteData:t}=Ks();t.copiedText=this.getSelectedText(),_t.disableStyleCopyPaste?t.copiedTextStyle=void 0:t.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0}paste(){this.fromPaste=!0}_getWidthBeforeCursor(t,e){let s,n=this._getLineLeftOffset(t);return e>0&&(s=this.__charBounds[t][e-1],n+=s.left+s.width),n}getDownCursorOffset(t,e){const s=this._getSelectionForOffset(t,e),n=this.get2DCursorLocation(s),r=n.lineIndex;if(r===this._textLines.length-1||t.metaKey||t.keyCode===34)return this._text.length-s;const o=n.charIndex,a=this._getWidthBeforeCursor(r,o),l=this._getIndexOnLine(r+1,a);return this._textLines[r].slice(o).length+l+1+this.missingNewlineOffset(r)}_getSelectionForOffset(t,e){return t.shiftKey&&this.selectionStart!==this.selectionEnd&&e?this.selectionEnd:this.selectionStart}getUpCursorOffset(t,e){const s=this._getSelectionForOffset(t,e),n=this.get2DCursorLocation(s),r=n.lineIndex;if(r===0||t.metaKey||t.keyCode===33)return-s;const o=n.charIndex,a=this._getWidthBeforeCursor(r,o),l=this._getIndexOnLine(r-1,a),c=this._textLines[r].slice(0,o),h=this.missingNewlineOffset(r-1);return-this._textLines[r-1].length+l-c.length+(1-h)}_getIndexOnLine(t,e){const s=this._textLines[t];let n,r,o=this._getLineLeftOffset(t),a=0;for(let l=0,c=s.length;l<c;l++)if(n=this.__charBounds[t][l].width,o+=n,o>e){r=!0;const h=o-n,u=o,f=Math.abs(h-e);a=Math.abs(u-e)<f?l:l-1;break}return r||(a=s.length-1),a}moveCursorDown(t){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",t)}moveCursorUp(t){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorUpOrDown("Up",t)}_moveCursorUpOrDown(t,e){const s=this["get".concat(t,"CursorOffset")](e,this._selectionDirection===$t);if(e.shiftKey?this.moveCursorWithShift(s):this.moveCursorWithoutShift(s),s!==0){const n=this.text.length;this.selectionStart=yi(0,this.selectionStart,n),this.selectionEnd=yi(0,this.selectionEnd,n),this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea()}}moveCursorWithShift(t){const e=this._selectionDirection===wt?this.selectionStart+t:this.selectionEnd+t;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,e),t!==0}moveCursorWithoutShift(t){return t<0?(this.selectionStart+=t,this.selectionEnd=this.selectionStart):(this.selectionEnd+=t,this.selectionStart=this.selectionEnd),t!==0}moveCursorLeft(t){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorLeftOrRight("Left",t)}_move(t,e,s){let n;if(t.altKey)n=this["findWordBoundary".concat(s)](this[e]);else{if(!t.metaKey&&t.keyCode!==35&&t.keyCode!==36)return this[e]+=s==="Left"?-1:1,!0;n=this["findLineBoundary".concat(s)](this[e])}return n!==void 0&&this[e]!==n&&(this[e]=n,!0)}_moveLeft(t,e){return this._move(t,e,"Left")}_moveRight(t,e){return this._move(t,e,"Right")}moveCursorLeftWithoutShift(t){let e=!0;return this._selectionDirection=wt,this.selectionEnd===this.selectionStart&&this.selectionStart!==0&&(e=this._moveLeft(t,"selectionStart")),this.selectionEnd=this.selectionStart,e}moveCursorLeftWithShift(t){return this._selectionDirection===$t&&this.selectionStart!==this.selectionEnd?this._moveLeft(t,"selectionEnd"):this.selectionStart!==0?(this._selectionDirection=wt,this._moveLeft(t,"selectionStart")):void 0}moveCursorRight(t){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",t)}_moveCursorLeftOrRight(t,e){const s="moveCursor".concat(t).concat(e.shiftKey?"WithShift":"WithoutShift");this._currentCursorOpacity=1,this[s](e)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())}moveCursorRightWithShift(t){return this._selectionDirection===wt&&this.selectionStart!==this.selectionEnd?this._moveRight(t,"selectionStart"):this.selectionEnd!==this._text.length?(this._selectionDirection=$t,this._moveRight(t,"selectionEnd")):void 0}moveCursorRightWithoutShift(t){let e=!0;return this._selectionDirection=$t,this.selectionStart===this.selectionEnd?(e=this._moveRight(t,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,e}}const Ul=i=>!!i.button;class Jx extends Zx{constructor(){super(...arguments),T(this,"draggableTextDelegate",void 0)}initBehavior(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore),this.on("mouseup",this.mouseUpHandler),this.on("mousedblclick",this.doubleClickHandler),this.on("tripleclick",this.tripleClickHandler),this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown),this.draggableTextDelegate=new qx(this),super.initBehavior()}shouldStartDragging(){return this.draggableTextDelegate.isActive()}onDragStart(t){return this.draggableTextDelegate.onDragStart(t)}canDrop(t){return this.draggableTextDelegate.canDrop(t)}onMouseDown(t){if(!this.canvas)return;this.__newClickTime=+new Date;const e=t.pointer;this.isTripleClick(e)&&(this.fire("tripleclick",t),Ec(t.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=e,this.__lastSelected=this.selected&&!this.getActiveControl()}isTripleClick(t){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===t.x&&this.__lastPointer.y===t.y}doubleClickHandler(t){this.isEditing&&this.selectWord(this.getSelectionStartFromPointer(t.e))}tripleClickHandler(t){this.isEditing&&this.selectLine(this.getSelectionStartFromPointer(t.e))}_mouseDownHandler(t){let{e}=t;this.canvas&&this.editable&&!Ul(e)&&!this.getActiveControl()&&(this.draggableTextDelegate.start(e)||(this.canvas.textEditingManager.register(this),this.selected&&(this.inCompositionMode=!1,this.setCursorByClick(e)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection())))}_mouseDownHandlerBefore(t){let{e}=t;this.canvas&&this.editable&&!Ul(e)&&(this.selected=this===this.canvas._activeObject)}mouseUpHandler(t){let{e,transform:s}=t;const n=this.draggableTextDelegate.end(e);if(this.canvas){this.canvas.textEditingManager.unregister(this);const r=this.canvas._activeObject;if(r&&r!==this)return}!this.editable||this.group&&!this.group.interactive||s&&s.actionPerformed||Ul(e)||n||(this.__lastSelected&&!this.getActiveControl()?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0)}setCursorByClick(t){const e=this.getSelectionStartFromPointer(t),s=this.selectionStart,n=this.selectionEnd;t.shiftKey?this.setSelectionStartEndWithShift(s,n,e):(this.selectionStart=e,this.selectionEnd=e),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())}getSelectionStartFromPointer(t){const e=this.canvas.getScenePoint(t).transform(Ke(this.calcTransformMatrix())).add(new E(-this._getLeftOffset(),-this._getTopOffset()));let s=0,n=0,r=0;for(let c=0;c<this._textLines.length&&s<=e.y;c++)s+=this.getHeightOfLine(c),r=c,c>0&&(n+=this._textLines[c-1].length+this.missingNewlineOffset(c-1));let o=Math.abs(this._getLineLeftOffset(r));const a=this._textLines[r].length,l=this.__charBounds[r];for(let c=0;c<a;c++){const h=o+l[c].kernedWidth;if(e.x<=h){Math.abs(e.x-h)<=Math.abs(e.x-o)&&n++;break}o=h,n++}return Math.min(this.flipX?a-n:n,this._text.length)}}const ko="moveCursorUp",Po="moveCursorDown",Ao="moveCursorLeft",Fo="moveCursorRight",Do="exitEditing",Qx=w({selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,keysMap:{9:Do,27:Do,33:ko,34:Po,35:Fo,36:Ao,37:Ao,38:ko,39:Fo,40:Po},keysMapRtl:{9:Do,27:Do,33:ko,34:Po,35:Ao,36:Fo,37:Fo,38:ko,39:Ao,40:Po},ctrlKeysMapDown:{65:"selectAll"},ctrlKeysMapUp:{67:"copy",88:"cut"}},{_selectionDirection:null,_reSpace:/\s|\r?\n/,inCompositionMode:!1});class bs extends Jx{static getDefaults(){return w(w({},super.getDefaults()),bs.ownDefaults)}get type(){const t=super.type;return t==="itext"?"i-text":t}constructor(t,e){super(t,w(w({},bs.ownDefaults),e)),this.initBehavior()}_set(t,e){return this.isEditing&&this._savedProps&&t in this._savedProps?(this._savedProps[t]=e,this):(t==="canvas"&&(this.canvas instanceof ro&&this.canvas.textEditingManager.remove(this),e instanceof ro&&e.textEditingManager.add(this)),super._set(t,e))}setSelectionStart(t){t=Math.max(t,0),this._updateAndFire("selectionStart",t)}setSelectionEnd(t){t=Math.min(t,this.text.length),this._updateAndFire("selectionEnd",t)}_updateAndFire(t,e){this[t]!==e&&(this._fireSelectionChanged(),this[t]=e),this._updateTextarea()}_fireSelectionChanged(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})}initDimensions(){this.isEditing&&this.initDelayedCursor(),super.initDimensions()}getSelectionStyles(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.selectionStart||0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.selectionEnd,s=arguments.length>2?arguments[2]:void 0;return super.getSelectionStyles(t,e,s)}setSelectionStyles(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.selectionStart||0,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.selectionEnd;return super.setSelectionStyles(t,e,s)}get2DCursorLocation(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.selectionStart,e=arguments.length>1?arguments[1]:void 0;return super.get2DCursorLocation(t,e)}render(t){super.render(t),this.cursorOffsetCache={},this.renderCursorOrSelection()}toCanvasElement(t){const e=this.isEditing;this.isEditing=!1;const s=super.toCanvasElement(t);return this.isEditing=e,s}renderCursorOrSelection(){if(!this.isEditing)return;const t=this.clearContextTop(!0);if(!t)return;const e=this._getCursorBoundaries();this.selectionStart!==this.selectionEnd||this.inCompositionMode?this.renderSelection(t,e):this.renderCursor(t,e),this.canvas.contextTopDirty=!0,t.restore()}_getCursorBoundaries(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.selectionStart,e=arguments.length>1?arguments[1]:void 0;const s=this._getLeftOffset(),n=this._getTopOffset(),r=this._getCursorBoundariesOffsets(t,e);return{left:s,top:n,leftOffset:r.left,topOffset:r.top}}_getCursorBoundariesOffsets(t,e){return e?this.__getCursorBoundariesOffsets(t):this.cursorOffsetCache&&"top"in this.cursorOffsetCache?this.cursorOffsetCache:this.cursorOffsetCache=this.__getCursorBoundariesOffsets(t)}__getCursorBoundariesOffsets(t){let e=0,s=0;const{charIndex:n,lineIndex:r}=this.get2DCursorLocation(t);for(let c=0;c<r;c++)e+=this.getHeightOfLine(c);const o=this._getLineLeftOffset(r),a=this.__charBounds[r][n];a&&(s=a.left),this.charSpacing!==0&&n===this._textLines[r].length&&(s-=this._getWidthOfCharSpacing());const l={top:e,left:o+(s>0?s:0)};return this.direction==="rtl"&&(this.textAlign===$t||this.textAlign===Is||this.textAlign===zr?l.left*=-1:this.textAlign===wt||this.textAlign===Da?l.left=o-(s>0?s:0):this.textAlign!==gt&&this.textAlign!==Vr||(l.left=o-(s>0?s:0))),l}renderCursorAt(t){this._renderCursor(this.canvas.contextTop,this._getCursorBoundaries(t,!0),t)}renderCursor(t,e){this._renderCursor(t,e,this.selectionStart)}getCursorRenderingData(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.selectionStart,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this._getCursorBoundaries(t);const s=this.get2DCursorLocation(t),n=s.lineIndex,r=s.charIndex>0?s.charIndex-1:0,o=this.getValueOfPropertyAt(n,r,"fontSize"),a=this.getObjectScaling().x*this.canvas.getZoom(),l=this.cursorWidth/a,c=this.getValueOfPropertyAt(n,r,"deltaY"),h=e.topOffset+(1-this._fontSizeFraction)*this.getHeightOfLine(n)/this.lineHeight-o*(1-this._fontSizeFraction);return{color:this.cursorColor||this.getValueOfPropertyAt(n,r,"fill"),opacity:this._currentCursorOpacity,left:e.left+e.leftOffset-l/2,top:h+e.top+c,width:l,height:o}}_renderCursor(t,e,s){const{color:n,opacity:r,left:o,top:a,width:l,height:c}=this.getCursorRenderingData(s,e);t.fillStyle=n,t.globalAlpha=r,t.fillRect(o,a,l,c)}renderSelection(t,e){const s={selectionStart:this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,selectionEnd:this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd};this._renderSelection(t,s,e)}renderDragSourceEffect(){const t=this.draggableTextDelegate.getDragStartSelection();this._renderSelection(this.canvas.contextTop,t,this._getCursorBoundaries(t.selectionStart,!0))}renderDropTargetEffect(t){const e=this.getSelectionStartFromPointer(t);this.renderCursorAt(e)}_renderSelection(t,e,s){const n=e.selectionStart,r=e.selectionEnd,o=this.textAlign.includes(Is),a=this.get2DCursorLocation(n),l=this.get2DCursorLocation(r),c=a.lineIndex,h=l.lineIndex,u=a.charIndex<0?0:a.charIndex,f=l.charIndex<0?0:l.charIndex;for(let d=c;d<=h;d++){const p=this._getLineLeftOffset(d)||0;let g=this.getHeightOfLine(d),m=0,v=0,_=0;if(d===c&&(v=this.__charBounds[c][u].left),d>=c&&d<h)_=o&&!this.isEndOfWrapping(d)?this.width:this.getLineWidth(d)||5;else if(d===h)if(f===0)_=this.__charBounds[h][f].left;else{const O=this._getWidthOfCharSpacing();_=this.__charBounds[h][f-1].left+this.__charBounds[h][f-1].width-O}m=g,(this.lineHeight<1||d===h&&this.lineHeight>1)&&(g/=this.lineHeight);let y=s.left+p+v,b=g,S=0;const P=_-v;this.inCompositionMode?(t.fillStyle=this.compositionColor||"black",b=1,S=g):t.fillStyle=this.selectionColor,this.direction==="rtl"&&(this.textAlign===$t||this.textAlign===Is||this.textAlign===zr?y=this.width-y-P:this.textAlign===wt||this.textAlign===Da?y=s.left+p-_:this.textAlign!==gt&&this.textAlign!==Vr||(y=s.left+p-_)),t.fillRect(y,s.top+s.topOffset+S,P,b),s.topOffset+=m}}getCurrentCharFontSize(){const t=this._getCurrentCharIndex();return this.getValueOfPropertyAt(t.l,t.c,"fontSize")}getCurrentCharColor(){const t=this._getCurrentCharIndex();return this.getValueOfPropertyAt(t.l,t.c,ee)}_getCurrentCharIndex(){const t=this.get2DCursorLocation(this.selectionStart,!0),e=t.charIndex>0?t.charIndex-1:0;return{l:t.lineIndex,c:e}}dispose(){this.exitEditingImpl(),this.draggableTextDelegate.dispose(),super.dispose()}}T(bs,"ownDefaults",Qx),T(bs,"type","IText"),q.setClass(bs),q.setClass(bs,"i-text");class Hs extends bs{static getDefaults(){return w(w({},super.getDefaults()),Hs.ownDefaults)}constructor(t,e){super(t,w(w({},Hs.ownDefaults),e))}static createControls(){return{controls:kp()}}initDimensions(){this.initialized&&(this.isEditing&&this.initDelayedCursor(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this.textAlign.includes(Is)&&this.enlargeSpaces(),this.height=this.calcTextHeight())}_generateStyleMap(t){let e=0,s=0,n=0;const r={};for(let o=0;o<t.graphemeLines.length;o++)t.graphemeText[n]===`
`&&o>0?(s=0,n++,e++):!this.splitByGrapheme&&this._reSpaceAndTab.test(t.graphemeText[n])&&o>0&&(s++,n++),r[o]={line:e,offset:s},n+=t.graphemeLines[o].length,s+=t.graphemeLines[o].length;return r}styleHas(t,e){if(this._styleMap&&!this.isWrapping){const s=this._styleMap[e];s&&(e=s.line)}return super.styleHas(t,e)}isEmptyStyles(t){if(!this.styles)return!0;let e,s=0,n=t+1,r=!1;const o=this._styleMap[t],a=this._styleMap[t+1];o&&(t=o.line,s=o.offset),a&&(n=a.line,r=n===t,e=a.offset);const l=t===void 0?this.styles:{line:this.styles[t]};for(const c in l)for(const h in l[c]){const u=parseInt(h,10);if(u>=s&&(!r||u<e))for(const f in l[c][h])return!1}return!0}_getStyleDeclaration(t,e){if(this._styleMap&&!this.isWrapping){const s=this._styleMap[t];if(!s)return{};t=s.line,e=s.offset+e}return super._getStyleDeclaration(t,e)}_setStyleDeclaration(t,e,s){const n=this._styleMap[t];super._setStyleDeclaration(n.line,n.offset+e,s)}_deleteStyleDeclaration(t,e){const s=this._styleMap[t];super._deleteStyleDeclaration(s.line,s.offset+e)}_getLineStyle(t){const e=this._styleMap[t];return!!this.styles[e.line]}_setLineStyle(t){const e=this._styleMap[t];super._setLineStyle(e.line)}_wrapText(t,e){this.isWrapping=!0;const s=this.getGraphemeDataForRender(t),n=[];for(let r=0;r<s.wordsData.length;r++)n.push(...this._wrapLine(r,e,s));return this.isWrapping=!1,n}getGraphemeDataForRender(t){const e=this.splitByGrapheme,s=e?"":" ";let n=0;return{wordsData:t.map((r,o)=>{let a=0;const l=e?this.graphemeSplit(r):this.wordSplit(r);return l.length===0?[{word:[],width:0}]:l.map(c=>{const h=e?[c]:this.graphemeSplit(c),u=this._measureWord(h,o,a);return n=Math.max(u,n),a+=h.length+s.length,{word:h,width:u}})}),largestWordWidth:n}}_measureWord(t,e){let s,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,r=0;for(let o=0,a=t.length;o<a;o++)r+=this._getGraphemeBox(t[o],e,o+n,s,!0).kernedWidth,s=t[o];return r}wordSplit(t){return t.split(this._wordJoiners)}_wrapLine(t,e,s){let{largestWordWidth:n,wordsData:r}=s,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;const a=this._getWidthOfCharSpacing(),l=this.splitByGrapheme,c=[],h=l?"":" ";let u=0,f=[],d=0,p=0,g=!0;e-=o;const m=Math.max(e,n,this.dynamicMinWidth),v=r[t];let _;for(d=0,_=0;_<v.length;_++){const{word:y,width:b}=v[_];d+=y.length,u+=p+b-a,u>m&&!g?(c.push(f),f=[],u=b,g=!0):u+=a,g||l||f.push(h),f=f.concat(y),p=l?0:this._measureWord([h],t,d),d++,g=!1}return _&&c.push(f),n+o>this.dynamicMinWidth&&(this.dynamicMinWidth=n-a+o),c}isEndOfWrapping(t){return!this._styleMap[t+1]||this._styleMap[t+1].line!==this._styleMap[t].line}missingNewlineOffset(t,e){return this.splitByGrapheme&&!e?this.isEndOfWrapping(t)?1:0:1}_splitTextIntoLines(t){const e=super._splitTextIntoLines(t),s=this._wrapText(e.lines,this.width),n=new Array(s.length);for(let r=0;r<s.length;r++)n[r]=s[r].join("");return e.lines=n,e.graphemeLines=s,e}getMinWidth(){return Math.max(this.minWidth,this.dynamicMinWidth)}_removeExtraneousStyles(){const t=new Map;for(const e in this._styleMap){const s=parseInt(e,10);if(this._textLines[s]){const n=this._styleMap[e].line;t.set("".concat(n),!0)}}for(const e in this.styles)t.has(e)||delete this.styles[e]}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return super.toObject(["minWidth","splitByGrapheme",...t])}}T(Hs,"type","Textbox"),T(Hs,"textLayoutProperties",[...bs.textLayoutProperties,"width"]),T(Hs,"ownDefaults",{minWidth:20,dynamicMinWidth:2,lockScalingFlip:!0,noScaleCache:!1,_wordJoiners:/[ \t\r]/,splitByGrapheme:!1}),q.setClass(Hs);class jf extends _l{shouldPerformLayout(t){return!!t.target.clipPath&&super.shouldPerformLayout(t)}shouldLayoutClipPath(){return!1}calcLayoutResult(t,e){const{target:s}=t,{clipPath:n,group:r}=s;if(!n||!this.shouldPerformLayout(t))return;const{width:o,height:a}=Ys(Bp(s,n)),l=new E(o,a);if(n.absolutePositioned)return{center:un(n.getRelativeCenterPoint(),void 0,r?r.calcTransformMatrix():void 0),size:l};{const c=n.getRelativeCenterPoint().transform(s.calcOwnMatrix(),!0);if(this.shouldPerformLayout(t)){const{center:h=new E,correction:u=new E}=this.calcBoundingBox(e,t)||{};return{center:h.add(c),correction:u.subtract(c),size:l}}return{center:s.getRelativeCenterPoint().add(c),size:l}}}}T(jf,"type","clip-path"),q.setClass(jf);class If extends _l{getInitialSize(t,e){let{target:s}=t,{size:n}=e;return new E(s.width||n.x,s.height||n.y)}}T(If,"type","fixed"),q.setClass(If);class tC extends io{subscribeTargets(t){const e=t.target;t.targets.reduce((s,n)=>(n.parent&&s.add(n.parent),s),new Set).forEach(s=>{s.layoutManager.subscribeTargets({target:s,targets:[e]})})}unsubscribeTargets(t){const e=t.target,s=e.getObjects();t.targets.reduce((n,r)=>(r.parent&&n.add(r.parent),n),new Set).forEach(n=>{!s.some(r=>r.parent===n)&&n.layoutManager.unsubscribeTargets({target:n,targets:[e]})})}}class Mn extends gs{static getDefaults(){return w(w({},super.getDefaults()),Mn.ownDefaults)}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Object.assign(this,Mn.ownDefaults),this.setOptions(e);const{left:s,top:n,layoutManager:r}=e;this.groupInit(t,{left:s,top:n,layoutManager:r??new tC})}_shouldSetNestedCoords(){return!0}__objectSelectionMonitor(){}multiSelectAdd(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];this.multiSelectionStacking==="selection-order"?this.add(...e):e.forEach(n=>{const r=this._objects.findIndex(a=>a.isInFrontOf(n)),o=r===-1?this.size():r;this.insertAt(o,n)})}canEnterGroup(t){return this.getObjects().some(e=>e.isDescendantOf(t)||t.isDescendantOf(e))?(jn("error","ActiveSelection: circular object trees are not supported, this call has no effect"),!1):super.canEnterGroup(t)}enterGroup(t,e){t.parent&&t.parent===t.group?t.parent._exitGroup(t):t.group&&t.parent!==t.group&&t.group.remove(t),this._enterGroup(t,e)}exitGroup(t,e){this._exitGroup(t,e),t.parent&&t.parent._enterGroup(t,!0)}_onAfterObjectsChange(t,e){super._onAfterObjectsChange(t,e);const s=new Set;e.forEach(n=>{const{parent:r}=n;r&&s.add(r)}),t===Vh?s.forEach(n=>{n._onAfterObjectsChange(ka,e)}):s.forEach(n=>{n._set("dirty",!0)})}onDeselect(){return this.removeAll(),!1}toString(){return"#<ActiveSelection: (".concat(this.complexity(),")>")}shouldCache(){return!1}isOnACache(){return!1}_renderControls(t,e,s){t.save(),t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;const n=w(w({hasControls:!1},s),{},{forActiveSelection:!0});for(let r=0;r<this._objects.length;r++)this._objects[r]._renderControls(t,n);super._renderControls(t,e),t.restore()}}T(Mn,"type","ActiveSelection"),T(Mn,"ownDefaults",{multiSelectionStacking:"canvas-stacking"}),q.setClass(Mn),q.setClass(Mn,"activeSelection");class eC{constructor(){T(this,"resources",{})}applyFilters(t,e,s,n,r){const o=r.getContext("2d");if(!o)return;o.drawImage(e,0,0,s,n);const a={sourceWidth:s,sourceHeight:n,imageData:o.getImageData(0,0,s,n),originalEl:e,originalImageData:o.getImageData(0,0,s,n),canvasEl:r,ctx:o,filterBackend:this};t.forEach(c=>{c.applyTo(a)});const{imageData:l}=a;return l.width===s&&l.height===n||(r.width=l.width,r.height=l.height),o.putImageData(l,0,0),a}}class cm{constructor(){let{tileSize:t=_t.textureSize}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};T(this,"aPosition",new Float32Array([0,0,0,1,1,0,1,1])),T(this,"resources",{}),this.tileSize=t,this.setupGLContext(t,t),this.captureGPUInfo()}setupGLContext(t,e){this.dispose(),this.createWebGLCanvas(t,e)}createWebGLCanvas(t,e){const s=Es({width:t,height:e}),n=s.getContext("webgl",{alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1});n&&(n.clearColor(0,0,0,0),this.canvas=s,this.gl=n)}applyFilters(t,e,s,n,r,o){const a=this.gl,l=r.getContext("2d");if(!a||!l)return;let c;o&&(c=this.getCachedTexture(o,e));const h={originalWidth:e.width||e.naturalWidth||0,originalHeight:e.height||e.naturalHeight||0,sourceWidth:s,sourceHeight:n,destinationWidth:s,destinationHeight:n,context:a,sourceTexture:this.createTexture(a,s,n,c?void 0:e),targetTexture:this.createTexture(a,s,n),originalTexture:c||this.createTexture(a,s,n,c?void 0:e),passes:t.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:r},u=a.createFramebuffer();return a.bindFramebuffer(a.FRAMEBUFFER,u),t.forEach(f=>{f&&f.applyTo(h)}),function(f){const d=f.targetCanvas,p=d.width,g=d.height,m=f.destinationWidth,v=f.destinationHeight;p===m&&g===v||(d.width=m,d.height=v)}(h),this.copyGLTo2D(a,h),a.bindTexture(a.TEXTURE_2D,null),a.deleteTexture(h.sourceTexture),a.deleteTexture(h.targetTexture),a.deleteFramebuffer(u),l.setTransform(1,0,0,1,0,0),h}dispose(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()}clearWebGLCaches(){this.programCache={},this.textureCache={}}createTexture(t,e,s,n,r){const{NEAREST:o,TEXTURE_2D:a,RGBA:l,UNSIGNED_BYTE:c,CLAMP_TO_EDGE:h,TEXTURE_MAG_FILTER:u,TEXTURE_MIN_FILTER:f,TEXTURE_WRAP_S:d,TEXTURE_WRAP_T:p}=t,g=t.createTexture();return t.bindTexture(a,g),t.texParameteri(a,u,r||o),t.texParameteri(a,f,r||o),t.texParameteri(a,d,h),t.texParameteri(a,p,h),n?t.texImage2D(a,0,l,l,c,n):t.texImage2D(a,0,l,e,s,0,l,c,null),g}getCachedTexture(t,e,s){const{textureCache:n}=this;if(n[t])return n[t];{const r=this.createTexture(this.gl,e.width,e.height,e,s);return r&&(n[t]=r),r}}evictCachesForKey(t){this.textureCache[t]&&(this.gl.deleteTexture(this.textureCache[t]),delete this.textureCache[t])}copyGLTo2D(t,e){const s=t.canvas,n=e.targetCanvas,r=n.getContext("2d");if(!r)return;r.translate(0,n.height),r.scale(1,-1);const o=s.height-n.height;r.drawImage(s,0,o,n.width,n.height,0,0,n.width,n.height)}copyGLTo2DPutImageData(t,e){const s=e.targetCanvas.getContext("2d"),n=e.destinationWidth,r=e.destinationHeight,o=n*r*4;if(!s)return;const a=new Uint8Array(this.imageBuffer,0,o),l=new Uint8ClampedArray(this.imageBuffer,0,o);t.readPixels(0,0,n,r,t.RGBA,t.UNSIGNED_BYTE,a);const c=new ImageData(l,n,r);s.putImageData(c,0,0)}captureGPUInfo(){if(this.gpuInfo)return this.gpuInfo;const t=this.gl,e={renderer:"",vendor:""};if(!t)return e;const s=t.getExtension("WEBGL_debug_renderer_info");if(s){const n=t.getParameter(s.UNMASKED_RENDERER_WEBGL),r=t.getParameter(s.UNMASKED_VENDOR_WEBGL);n&&(e.renderer=n.toLowerCase()),r&&(e.vendor=r.toLowerCase())}return this.gpuInfo=e,e}}let Gl;function sC(){const{WebGLProbe:i}=Ks();return i.queryWebGL(ms()),_t.enableGLFiltering&&i.isSupported(_t.textureSize)?new cm({tileSize:_t.textureSize}):new eC}function $l(){return!Gl&&(!(arguments.length>0&&arguments[0]!==void 0)||arguments[0])&&(Gl=sC()),Gl}const nC=["filters","resizeFilter","src","crossOrigin","type"],hm=["cropX","cropY"];class Se extends ne{static getDefaults(){return w(w({},super.getDefaults()),Se.ownDefaults)}constructor(t,e){super(),T(this,"_lastScaleX",1),T(this,"_lastScaleY",1),T(this,"_filterScalingX",1),T(this,"_filterScalingY",1),this.filters=[],Object.assign(this,Se.ownDefaults),this.setOptions(e),this.cacheKey="texture".concat(Bn()),this.setElement(typeof t=="string"?(this.canvas&&ys(this.canvas.getElement())||ur()).getElementById(t):t,e)}getElement(){return this._element}setElement(t){var e;let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.removeTexture(this.cacheKey),this.removeTexture("".concat(this.cacheKey,"_filtered")),this._element=t,this._originalElement=t,this._setWidthHeight(s),(e=t.classList)===null||e===void 0||e.add(Se.CSS_CANVAS),this.filters.length!==0&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters()}removeTexture(t){const e=$l(!1);e instanceof cm&&e.evictCachesForKey(t)}dispose(){super.dispose(),this.removeTexture(this.cacheKey),this.removeTexture("".concat(this.cacheKey,"_filtered")),this._cacheContext=null,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach(t=>{const e=this[t];e&&Ks().dispose(e),this[t]=void 0})}getCrossOrigin(){return this._originalElement&&(this._originalElement.crossOrigin||null)}getOriginalSize(){const t=this.getElement();return t?{width:t.naturalWidth||t.width,height:t.naturalHeight||t.height}:{width:0,height:0}}_stroke(t){if(!this.stroke||this.strokeWidth===0)return;const e=this.width/2,s=this.height/2;t.beginPath(),t.moveTo(-e,-s),t.lineTo(e,-s),t.lineTo(e,s),t.lineTo(-e,s),t.lineTo(-e,-s),t.closePath()}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const e=[];return this.filters.forEach(s=>{s&&e.push(s.toObject())}),w(w({},super.toObject([...hm,...t])),{},{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:e},this.resizeFilter?{resizeFilter:this.resizeFilter.toObject()}:{})}hasCrop(){return!!this.cropX||!!this.cropY||this.width<this._element.width||this.height<this._element.height}_toSVG(){const t=[],e=this._element,s=-this.width/2,n=-this.height/2;let r=[],o=[],a="",l="";if(!e)return[];if(this.hasCrop()){const c=Bn();r.push('<clipPath id="imageCrop_'+c+`">
`,'	<rect x="'+s+'" y="'+n+'" width="'+this.width+'" height="'+this.height+`" />
`,`</clipPath>
`),a=' clip-path="url(#imageCrop_'+c+')" '}if(this.imageSmoothing||(l=' image-rendering="optimizeSpeed"'),t.push("	<image ","COMMON_PARTS",'xlink:href="'.concat(this.getSvgSrc(!0),'" x="').concat(s-this.cropX,'" y="').concat(n-this.cropY,'" width="').concat(e.width||e.naturalWidth,'" height="').concat(e.height||e.naturalHeight,'"').concat(l).concat(a,`></image>
`)),this.stroke||this.strokeDashArray){const c=this.fill;this.fill=null,o=['	<rect x="'.concat(s,'" y="').concat(n,'" width="').concat(this.width,'" height="').concat(this.height,'" style="').concat(this.getSvgStyles(),`" />
`)],this.fill=c}return r=this.paintFirst!==ee?r.concat(o,t):r.concat(t,o),r}getSrc(t){const e=t?this._element:this._originalElement;return e?e.toDataURL?e.toDataURL():this.srcFromAttribute?e.getAttribute("src")||"":e.src:this.src||""}getSvgSrc(t){return this.getSrc(t)}setSrc(t){let{crossOrigin:e,signal:s}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Hr(t,{crossOrigin:e,signal:s}).then(n=>{e!==void 0&&this.set({crossOrigin:e}),this.setElement(n)})}toString(){return'#<Image: { src: "'.concat(this.getSrc(),'" }>')}applyResizeFilters(){const t=this.resizeFilter,e=this.minimumScaleTrigger,s=this.getTotalObjectScaling(),n=s.x,r=s.y,o=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!t||n>e&&r>e)return this._element=o,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=n,void(this._lastScaleY=r);const a=Es(o),{width:l,height:c}=o;this._element=a,this._lastScaleX=t.scaleX=n,this._lastScaleY=t.scaleY=r,$l().applyFilters([t],o,l,c,this._element),this._filterScalingX=a.width/this._originalElement.width,this._filterScalingY=a.height/this._originalElement.height}applyFilters(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.filters||[];if(t=t.filter(r=>r&&!r.isNeutralState()),this.set("dirty",!0),this.removeTexture("".concat(this.cacheKey,"_filtered")),t.length===0)return this._element=this._originalElement,this._filteredEl=void 0,this._filterScalingX=1,void(this._filterScalingY=1);const e=this._originalElement,s=e.naturalWidth||e.width,n=e.naturalHeight||e.height;if(this._element===this._originalElement){const r=Es({width:s,height:n});this._element=r,this._filteredEl=r}else this._filteredEl&&(this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,s,n),this._lastScaleX=1,this._lastScaleY=1);$l().applyFilters(t,this._originalElement,s,n,this._element,this.cacheKey),this._originalElement.width===this._element.width&&this._originalElement.height===this._element.height||(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height)}_render(t){t.imageSmoothingEnabled=this.imageSmoothing,this.isMoving!==!0&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(t),this._renderPaintInOrder(t)}drawCacheOnCanvas(t){t.imageSmoothingEnabled=this.imageSmoothing,super.drawCacheOnCanvas(t)}shouldCache(){return this.needsItsOwnCache()}_renderFill(t){const e=this._element;if(!e)return;const s=this._filterScalingX,n=this._filterScalingY,r=this.width,o=this.height,a=Math.max(this.cropX,0),l=Math.max(this.cropY,0),c=e.naturalWidth||e.width,h=e.naturalHeight||e.height,u=a*s,f=l*n,d=Math.min(r*s,c-u),p=Math.min(o*n,h-f),g=-r/2,m=-o/2,v=Math.min(r,c/s-a),_=Math.min(o,h/n-l);e&&t.drawImage(e,u,f,d,p,g,m,v,_)}_needsResize(){const t=this.getTotalObjectScaling();return t.x!==this._lastScaleX||t.y!==this._lastScaleY}_resetWidthHeight(){this.set(this.getOriginalSize())}_setWidthHeight(){let{width:t,height:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const s=this.getOriginalSize();this.width=t||s.width,this.height=e||s.height}parsePreserveAspectRatioAttribute(){const t=Jg(this.preserveAspectRatio||""),e=this.width,s=this.height,n={width:e,height:s};let r,o=this._element.width,a=this._element.height,l=1,c=1,h=0,u=0,f=0,d=0;return!t||t.alignX===Re&&t.alignY===Re?(l=e/o,c=s/a):(t.meetOrSlice==="meet"&&(l=c=Hp(this._element,n),r=(e-o*l)/2,t.alignX==="Min"&&(h=-r),t.alignX==="Max"&&(h=r),r=(s-a*c)/2,t.alignY==="Min"&&(u=-r),t.alignY==="Max"&&(u=r)),t.meetOrSlice==="slice"&&(l=c=zp(this._element,n),r=o-e/l,t.alignX==="Mid"&&(f=r/2),t.alignX==="Max"&&(f=r),r=a-s/c,t.alignY==="Mid"&&(d=r/2),t.alignY==="Max"&&(d=r),o=e/l,a=s/c)),{width:o,height:a,scaleX:l,scaleY:c,offsetLeft:h,offsetTop:u,cropX:f,cropY:d}}static fromObject(t,e){let{filters:s,resizeFilter:n,src:r,crossOrigin:o,type:a}=t,l=It(t,nC);return Promise.all([Hr(r,w(w({},e),{},{crossOrigin:o})),s&&er(s,e),n&&er([n],e),yo(l,e)]).then(c=>{let[h,u=[],[f]=[],d={}]=c;return new this(h,w(w({},l),{},{src:r,filters:u,resizeFilter:f},d))})}static fromURL(t){let{crossOrigin:e=null,signal:s}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return Hr(t,{crossOrigin:e,signal:s}).then(r=>new this(r,n))}static async fromElement(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=arguments.length>2?arguments[2]:void 0;const n=_n(t,this.ATTRIBUTE_NAMES,s);return this.fromURL(n["xlink:href"],e,n).catch(r=>(jn("log","Unable to parse Image",r),null))}}T(Se,"type","Image"),T(Se,"cacheProperties",[...vn,...hm]),T(Se,"ownDefaults",{strokeWidth:0,srcFromAttribute:!1,minimumScaleTrigger:.5,cropX:0,cropY:0,imageSmoothing:!0}),T(Se,"CSS_CANVAS","canvas-img"),T(Se,"ATTRIBUTE_NAMES",[...Un,"x","y","width","height","preserveAspectRatio","xlink:href","crossOrigin","image-rendering"]),q.setClass(Se),q.setSVGClass(Se);dl(["pattern","defs","symbol","metadata","clipPath","mask","desc"]);const um=Wg,Bf=i=>function(t,e,s){const{points:n,pathOffset:r}=s;return new E(n[i]).subtract(r).transform(Xt(s.getViewportTransform(),s.calcTransformMatrix()))},fm=(i,t,e,s)=>{const{target:n,pointIndex:r}=t,o=n,a=un(new E(e,s),void 0,o.calcOwnMatrix());return o.points[r]=a.add(o.pathOffset),o.setDimensions(),!0},dm=(i,t)=>function(e,s,n,r){const o=s.target,a=new E(o.points[(i>0?i:o.points.length)-1]),l=a.subtract(o.pathOffset).transform(o.calcOwnMatrix()),c=t(e,w(w({},s),{},{pointIndex:i}),n,r),h=a.subtract(o.pathOffset).transform(o.calcOwnMatrix()).subtract(l);return o.left-=h.x,o.top-=h.y,c},Nf=i=>Xn(um,dm(i,fm)),Hc=(i,t,e)=>{const{path:s,pathOffset:n}=i,r=s[t];return new E(r[e]-n.x,r[e+1]-n.y).transform(Xt(i.getViewportTransform(),i.calcTransformMatrix()))};function iC(i,t,e){const{commandIndex:s,pointIndex:n}=this;return Hc(e,s,n)}function rC(i,t,e,s){const{target:n}=t,{commandIndex:r,pointIndex:o}=this,a=((l,c,h,u,f)=>{const{path:d,pathOffset:p}=l,g=d[(u>0?u:d.length)-1],m=new E(g[f],g[f+1]),v=m.subtract(p).transform(l.calcOwnMatrix()),_=un(new E(c,h),void 0,l.calcOwnMatrix());d[u][f]=_.x+p.x,d[u][f+1]=_.y+p.y,l.setDimensions();const y=m.subtract(l.pathOffset).transform(l.calcOwnMatrix()).subtract(v);return l.left-=y.x,l.top-=y.y,l.set("dirty",!0),!0})(n,e,s,r,o);return Fh(this.actionName,w(w({},Dh(i,t,e,s)),{},{commandIndex:r,pointIndex:o})),a}class gm extends Ce{constructor(t){super(t)}render(t,e,s,n,r){const o=w(w({},n),{},{cornerColor:this.controlFill,cornerStrokeColor:this.controlStroke,transparentCorners:!this.controlFill});super.render(t,e,s,o,r)}}class oC extends gm{constructor(t){super(t)}render(t,e,s,n,r){const{path:o}=r,{commandIndex:a,pointIndex:l,connectToCommandIndex:c,connectToPointIndex:h}=this;t.save(),t.strokeStyle=this.controlStroke,this.connectionDashArray&&t.setLineDash(this.connectionDashArray);const[u]=o[a],f=Hc(r,c,h);if(u==="Q"){const d=Hc(r,a,l+2);t.moveTo(d.x,d.y),t.lineTo(e,s)}else t.moveTo(e,s);t.lineTo(f.x,f.y),t.stroke(),t.restore(),super.render(t,e,s,n,r)}}const Ro=(i,t,e,s,n,r)=>new(e?oC:gm)(w(w({commandIndex:i,pointIndex:t,actionName:"modifyPath",positionHandler:iC,actionHandler:rC,connectToCommandIndex:n,connectToPointIndex:r},s),e?s.controlPointStyle:s.pointStyle));var Xi=Object.freeze({__proto__:null,changeWidth:Fc,createObjectDefaultControls:Nh,createPathControls:function(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const e={};let s="M";return i.path.forEach((n,r)=>{const o=n[0];switch(o!=="Z"&&(e["c_".concat(r,"_").concat(o)]=Ro(r,n.length-2,!1,t)),o){case"C":e["c_".concat(r,"_C_CP_1")]=Ro(r,1,!0,t,r-1,(a=>a==="C"?5:a==="Q"?3:1)(s)),e["c_".concat(r,"_C_CP_2")]=Ro(r,3,!0,t,r,5);break;case"Q":e["c_".concat(r,"_Q_CP_1")]=Ro(r,1,!0,t,r,3)}s=o}),e},createPolyActionHandler:Nf,createPolyControls:function(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const e={};for(let s=0;s<(typeof i=="number"?i:i.points.length);s++)e["p".concat(s)]=new Ce(w({actionName:um,positionHandler:Bf(s),actionHandler:Nf(s)},t));return e},createPolyPositionHandler:Bf,createResizeControls:Ep,createTextboxDefaultControls:kp,dragHandler:cp,factoryPolyActionHandler:dm,getLocalPoint:fl,polyActionHandler:fm,renderCircleControl:mp,renderSquareControl:vp,rotationStyleHandler:_p,rotationWithSnapping:yp,scaleCursorStyleHandler:Fi,scaleOrSkewActionName:Or,scaleSkewCursorStyleHandler:ri,scalingEqually:Tr,scalingX:Cp,scalingXOrSkewingY:Dc,scalingY:Sp,scalingYOrSkewingX:Rc,skewCursorStyleHandler:wp,skewHandlerX:Op,skewHandlerY:Mp,wrapWithFireEvent:Xn,wrapWithFixedAnchor:Si});const bl=i=>i.webgl!==void 0,Yh="precision highp float",aC=`
    `.concat(Yh,`;
    varying vec2 vTexCoord;
    uniform sampler2D uTexture;
    void main() {
      gl_FragColor = texture2D(uTexture, vTexCoord);
    }`),lC=["type"],cC=["type"],hC=new RegExp(Yh,"g");class se{get type(){return this.constructor.type}constructor(){let t=It(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},lC);Object.assign(this,this.constructor.defaults,t)}getFragmentSource(){return aC}getVertexSource(){return`
    attribute vec2 aPosition;
    varying vec2 vTexCoord;
    void main() {
      vTexCoord = aPosition;
      gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
    }`}createProgram(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.getFragmentSource(),s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.getVertexSource();const{WebGLProbe:{GLPrecision:n="highp"}}=Ks();n!=="highp"&&(e=e.replace(hC,Yh.replace("highp",n)));const r=t.createShader(t.VERTEX_SHADER),o=t.createShader(t.FRAGMENT_SHADER),a=t.createProgram();if(!r||!o||!a)throw new Ns("Vertex, fragment shader or program creation error");if(t.shaderSource(r,s),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS))throw new Ns("Vertex shader compile error for ".concat(this.type,": ").concat(t.getShaderInfoLog(r)));if(t.shaderSource(o,e),t.compileShader(o),!t.getShaderParameter(o,t.COMPILE_STATUS))throw new Ns("Fragment shader compile error for ".concat(this.type,": ").concat(t.getShaderInfoLog(o)));if(t.attachShader(a,r),t.attachShader(a,o),t.linkProgram(a),!t.getProgramParameter(a,t.LINK_STATUS))throw new Ns('Shader link error for "'.concat(this.type,'" ').concat(t.getProgramInfoLog(a)));const l=this.getUniformLocations(t,a)||{};return l.uStepW=t.getUniformLocation(a,"uStepW"),l.uStepH=t.getUniformLocation(a,"uStepH"),{program:a,attributeLocations:this.getAttributeLocations(t,a),uniformLocations:l}}getAttributeLocations(t,e){return{aPosition:t.getAttribLocation(e,"aPosition")}}getUniformLocations(t,e){const s=this.constructor.uniformLocations,n={};for(let r=0;r<s.length;r++)n[s[r]]=t.getUniformLocation(e,s[r]);return n}sendAttributeData(t,e,s){const n=e.aPosition,r=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,r),t.enableVertexAttribArray(n),t.vertexAttribPointer(n,2,t.FLOAT,!1,0,0),t.bufferData(t.ARRAY_BUFFER,s,t.STATIC_DRAW)}_setupFrameBuffer(t){const e=t.context;if(t.passes>1){const s=t.destinationWidth,n=t.destinationHeight;t.sourceWidth===s&&t.sourceHeight===n||(e.deleteTexture(t.targetTexture),t.targetTexture=t.filterBackend.createTexture(e,s,n)),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t.targetTexture,0)}else e.bindFramebuffer(e.FRAMEBUFFER,null),e.finish()}_swapTextures(t){t.passes--,t.pass++;const e=t.targetTexture;t.targetTexture=t.sourceTexture,t.sourceTexture=e}isNeutralState(t){return!1}applyTo(t){bl(t)?(this._setupFrameBuffer(t),this.applyToWebGL(t),this._swapTextures(t)):this.applyTo2d(t)}applyTo2d(t){}getCacheKey(){return this.type}retrieveShader(t){const e=this.getCacheKey();return t.programCache[e]||(t.programCache[e]=this.createProgram(t.context)),t.programCache[e]}applyToWebGL(t){const e=t.context,s=this.retrieveShader(t);t.pass===0&&t.originalTexture?e.bindTexture(e.TEXTURE_2D,t.originalTexture):e.bindTexture(e.TEXTURE_2D,t.sourceTexture),e.useProgram(s.program),this.sendAttributeData(e,s.attributeLocations,t.aPosition),e.uniform1f(s.uniformLocations.uStepW,1/t.sourceWidth),e.uniform1f(s.uniformLocations.uStepH,1/t.sourceHeight),this.sendUniformData(e,s.uniformLocations),e.viewport(0,0,t.destinationWidth,t.destinationHeight),e.drawArrays(e.TRIANGLE_STRIP,0,4)}bindAdditionalTexture(t,e,s){t.activeTexture(s),t.bindTexture(t.TEXTURE_2D,e),t.activeTexture(t.TEXTURE0)}unbindAdditionalTexture(t,e){t.activeTexture(e),t.bindTexture(t.TEXTURE_2D,null),t.activeTexture(t.TEXTURE0)}sendUniformData(t,e){}createHelpLayer(t){if(!t.helpLayer){const{sourceWidth:e,sourceHeight:s}=t,n=Es({width:e,height:s});t.helpLayer=n}}toObject(){const t=Object.keys(this.constructor.defaults||{});return w({type:this.type},t.reduce((e,s)=>(e[s]=this[s],e),{}))}toJSON(){return this.toObject()}static async fromObject(t,e){return new this(It(t,cC))}}T(se,"type","BaseFilter"),T(se,"uniformLocations",[]);const uC={multiply:`gl_FragColor.rgb *= uColor.rgb;
`,screen:`gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);
`,add:`gl_FragColor.rgb += uColor.rgb;
`,difference:`gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);
`,subtract:`gl_FragColor.rgb -= uColor.rgb;
`,lighten:`gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);
`,darken:`gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);
`,exclusion:`gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);
`,overlay:`
    if (uColor.r < 0.5) {
      gl_FragColor.r *= 2.0 * uColor.r;
    } else {
      gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);
    }
    if (uColor.g < 0.5) {
      gl_FragColor.g *= 2.0 * uColor.g;
    } else {
      gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);
    }
    if (uColor.b < 0.5) {
      gl_FragColor.b *= 2.0 * uColor.b;
    } else {
      gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);
    }
    `,tint:`
    gl_FragColor.rgb *= (1.0 - uColor.a);
    gl_FragColor.rgb += uColor.rgb;
    `};class Lo extends se{getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return`
      precision highp float;
      uniform sampler2D uTexture;
      uniform vec4 uColor;
      varying vec2 vTexCoord;
      void main() {
        vec4 color = texture2D(uTexture, vTexCoord);
        gl_FragColor = color;
        if (color.a > 0.0) {
          `.concat(uC[this.mode],`
        }
      }
      `)}applyTo2d(t){let{imageData:{data:e}}=t;const s=new Mt(this.color).getSource(),n=this.alpha,r=s[0]*n,o=s[1]*n,a=s[2]*n,l=1-n;for(let c=0;c<e.length;c+=4){const h=e[c],u=e[c+1],f=e[c+2];let d,p,g;switch(this.mode){case"multiply":d=h*r/255,p=u*o/255,g=f*a/255;break;case"screen":d=255-(255-h)*(255-r)/255,p=255-(255-u)*(255-o)/255,g=255-(255-f)*(255-a)/255;break;case"add":d=h+r,p=u+o,g=f+a;break;case"difference":d=Math.abs(h-r),p=Math.abs(u-o),g=Math.abs(f-a);break;case"subtract":d=h-r,p=u-o,g=f-a;break;case"darken":d=Math.min(h,r),p=Math.min(u,o),g=Math.min(f,a);break;case"lighten":d=Math.max(h,r),p=Math.max(u,o),g=Math.max(f,a);break;case"overlay":d=r<128?2*h*r/255:255-2*(255-h)*(255-r)/255,p=o<128?2*u*o/255:255-2*(255-u)*(255-o)/255,g=a<128?2*f*a/255:255-2*(255-f)*(255-a)/255;break;case"exclusion":d=r+h-2*r*h/255,p=o+u-2*o*u/255,g=a+f-2*a*f/255;break;case"tint":d=r+h*l,p=o+u*l,g=a+f*l}e[c]=d,e[c+1]=p,e[c+2]=g}}sendUniformData(t,e){const s=new Mt(this.color).getSource();s[0]=this.alpha*s[0]/255,s[1]=this.alpha*s[1]/255,s[2]=this.alpha*s[2]/255,s[3]=this.alpha,t.uniform4fv(e.uColor,s)}}T(Lo,"defaults",{color:"#F95C63",mode:"multiply",alpha:1}),T(Lo,"type","BlendColor"),T(Lo,"uniformLocations",["uColor"]),q.setClass(Lo);const fC={multiply:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform sampler2D uImage;
    uniform vec4 uColor;
    varying vec2 vTexCoord;
    varying vec2 vTexCoord2;
    void main() {
      vec4 color = texture2D(uTexture, vTexCoord);
      vec4 color2 = texture2D(uImage, vTexCoord2);
      color.rgba *= color2.rgba;
      gl_FragColor = color;
    }
    `,mask:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform sampler2D uImage;
    uniform vec4 uColor;
    varying vec2 vTexCoord;
    varying vec2 vTexCoord2;
    void main() {
      vec4 color = texture2D(uTexture, vTexCoord);
      vec4 color2 = texture2D(uImage, vTexCoord2);
      color.a = color2.a;
      gl_FragColor = color;
    }
    `},dC=["type","image"];class jo extends se{getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return fC[this.mode]}getVertexSource(){return`
    attribute vec2 aPosition;
    varying vec2 vTexCoord;
    varying vec2 vTexCoord2;
    uniform mat3 uTransformMatrix;
    void main() {
      vTexCoord = aPosition;
      vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;
      gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
    }
    `}applyToWebGL(t){const e=t.context,s=this.createTexture(t.filterBackend,this.image);this.bindAdditionalTexture(e,s,e.TEXTURE1),super.applyToWebGL(t),this.unbindAdditionalTexture(e,e.TEXTURE1)}createTexture(t,e){return t.getCachedTexture(e.cacheKey,e.getElement())}calculateMatrix(){const t=this.image,{width:e,height:s}=t.getElement();return[1/t.scaleX,0,0,0,1/t.scaleY,0,-t.left/e,-t.top/s,1]}applyTo2d(t){let{imageData:{data:e,width:s,height:n},filterBackend:{resources:r}}=t;const o=this.image;r.blendImage||(r.blendImage=ms());const a=r.blendImage,l=a.getContext("2d");a.width!==s||a.height!==n?(a.width=s,a.height=n):l.clearRect(0,0,s,n),l.setTransform(o.scaleX,0,0,o.scaleY,o.left,o.top),l.drawImage(o.getElement(),0,0,s,n);const c=l.getImageData(0,0,s,n).data;for(let h=0;h<e.length;h+=4){const u=e[h],f=e[h+1],d=e[h+2],p=e[h+3],g=c[h],m=c[h+1],v=c[h+2],_=c[h+3];switch(this.mode){case"multiply":e[h]=u*g/255,e[h+1]=f*m/255,e[h+2]=d*v/255,e[h+3]=p*_/255;break;case"mask":e[h+3]=_}}}sendUniformData(t,e){const s=this.calculateMatrix();t.uniform1i(e.uImage,1),t.uniformMatrix3fv(e.uTransformMatrix,!1,s)}toObject(){return w(w({},super.toObject()),{},{image:this.image&&this.image.toObject()})}static async fromObject(t,e){let{type:s,image:n}=t,r=It(t,dC);return Se.fromObject(n,e).then(o=>new this(w(w({},r),{},{image:o})))}}T(jo,"type","BlendImage"),T(jo,"defaults",{mode:"multiply",alpha:1}),T(jo,"uniformLocations",["uTransformMatrix","uImage"]),q.setClass(jo);class Io extends se{getFragmentSource(){return`
    precision highp float;
    uniform sampler2D uTexture;
    uniform vec2 uDelta;
    varying vec2 vTexCoord;
    const float nSamples = 15.0;
    vec3 v3offset = vec3(12.9898, 78.233, 151.7182);
    float random(vec3 scale) {
      /* use the fragment position for a different seed per-pixel */
      return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);
    }
    void main() {
      vec4 color = vec4(0.0);
      float total = 0.0;
      float offset = random(v3offset);
      for (float t = -nSamples; t <= nSamples; t++) {
        float percent = (t + offset - 0.5) / nSamples;
        float weight = 1.0 - abs(percent);
        color += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;
        total += weight;
      }
      gl_FragColor = color / total;
    }
  `}applyTo(t){bl(t)?(this.aspectRatio=t.sourceWidth/t.sourceHeight,t.passes++,this._setupFrameBuffer(t),this.horizontal=!0,this.applyToWebGL(t),this._swapTextures(t),this._setupFrameBuffer(t),this.horizontal=!1,this.applyToWebGL(t),this._swapTextures(t)):this.applyTo2d(t)}applyTo2d(t){t.imageData=this.simpleBlur(t)}simpleBlur(t){let{ctx:e,imageData:s,filterBackend:{resources:n}}=t;const{width:r,height:o}=s;n.blurLayer1||(n.blurLayer1=ms(),n.blurLayer2=ms());const a=n.blurLayer1,l=n.blurLayer2;a.width===r&&a.height===o||(l.width=a.width=r,l.height=a.height=o);const c=a.getContext("2d"),h=l.getContext("2d"),u=15,f=.06*this.blur*.5;let d,p,g,m;for(c.putImageData(s,0,0),h.clearRect(0,0,r,o),m=-15;m<=u;m++)d=(Math.random()-.5)/4,p=m/u,g=f*p*r+d,h.globalAlpha=1-Math.abs(p),h.drawImage(a,g,d),c.drawImage(l,0,0),h.globalAlpha=1,h.clearRect(0,0,l.width,l.height);for(m=-15;m<=u;m++)d=(Math.random()-.5)/4,p=m/u,g=f*p*o+d,h.globalAlpha=1-Math.abs(p),h.drawImage(a,d,g),c.drawImage(l,0,0),h.globalAlpha=1,h.clearRect(0,0,l.width,l.height);e.drawImage(a,0,0);const v=e.getImageData(0,0,a.width,a.height);return c.globalAlpha=1,c.clearRect(0,0,a.width,a.height),v}sendUniformData(t,e){const s=this.chooseRightDelta();t.uniform2fv(e.uDelta,s)}isNeutralState(){return this.blur===0}chooseRightDelta(){let t=1;const e=[0,0];this.horizontal?this.aspectRatio>1&&(t=1/this.aspectRatio):this.aspectRatio<1&&(t=this.aspectRatio);const s=t*this.blur*.12;return this.horizontal?e[0]=s:e[1]=s,e}}T(Io,"type","Blur"),T(Io,"defaults",{blur:0}),T(Io,"uniformLocations",["uDelta"]),q.setClass(Io);class Bo extends se{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uBrightness;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    color.rgb += uBrightness;
    gl_FragColor = color;
  }
`}applyTo2d(t){let{imageData:{data:e}}=t;const s=Math.round(255*this.brightness);for(let n=0;n<e.length;n+=4)e[n]+=s,e[n+1]+=s,e[n+2]+=s}isNeutralState(){return this.brightness===0}sendUniformData(t,e){t.uniform1f(e.uBrightness,this.brightness)}}T(Bo,"type","Brightness"),T(Bo,"defaults",{brightness:0}),T(Bo,"uniformLocations",["uBrightness"]),q.setClass(Bo);const pm={matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],colorsOnly:!0};class Ri extends se{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  varying vec2 vTexCoord;
  uniform mat4 uColorMatrix;
  uniform vec4 uConstants;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    color *= uColorMatrix;
    color += uConstants;
    gl_FragColor = color;
  }`}applyTo2d(t){const e=t.imageData.data,s=this.matrix,n=this.colorsOnly;for(let r=0;r<e.length;r+=4){const o=e[r],a=e[r+1],l=e[r+2];if(e[r]=o*s[0]+a*s[1]+l*s[2]+255*s[4],e[r+1]=o*s[5]+a*s[6]+l*s[7]+255*s[9],e[r+2]=o*s[10]+a*s[11]+l*s[12]+255*s[14],!n){const c=e[r+3];e[r]+=c*s[3],e[r+1]+=c*s[8],e[r+2]+=c*s[13],e[r+3]=o*s[15]+a*s[16]+l*s[17]+c*s[18]+255*s[19]}}}sendUniformData(t,e){const s=this.matrix,n=[s[0],s[1],s[2],s[3],s[5],s[6],s[7],s[8],s[10],s[11],s[12],s[13],s[15],s[16],s[17],s[18]],r=[s[4],s[9],s[14],s[19]];t.uniformMatrix4fv(e.uColorMatrix,!1,n),t.uniform4fv(e.uConstants,r)}toObject(){return w(w({},super.toObject()),{},{matrix:[...this.matrix]})}}function wi(i,t){var e;const s=(T(e=class extends Ri{toObject(){return{type:this.type,colorsOnly:this.colorsOnly}}},"type",i),T(e,"defaults",{colorsOnly:!1,matrix:t}),e);return q.setClass(s,i),s}T(Ri,"type","ColorMatrix"),T(Ri,"defaults",pm),T(Ri,"uniformLocations",["uColorMatrix","uConstants"]),q.setClass(Ri);wi("Brownie",[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0]);wi("Vintage",[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0]);wi("Kodachrome",[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0]);wi("Technicolor",[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0]);wi("Polaroid",[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0]);wi("Sepia",[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0]);wi("BlackWhite",[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]);class Hf extends se{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(t),this.subFilters=t.subFilters||[]}applyTo(t){bl(t)&&(t.passes+=this.subFilters.length-1),this.subFilters.forEach(e=>{e.applyTo(t)})}toObject(){return{type:this.type,subFilters:this.subFilters.map(t=>t.toObject())}}isNeutralState(){return!this.subFilters.some(t=>!t.isNeutralState())}static fromObject(t,e){return Promise.all((t.subFilters||[]).map(s=>q.getClass(s.type).fromObject(s,e))).then(s=>new this({subFilters:s}))}}T(Hf,"type","Composed"),q.setClass(Hf);class No extends se{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uContrast;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));
    color.rgb = contrastF * (color.rgb - 0.5) + 0.5;
    gl_FragColor = color;
  }`}isNeutralState(){return this.contrast===0}applyTo2d(t){let{imageData:{data:e}}=t;const s=Math.floor(255*this.contrast),n=259*(s+255)/(255*(259-s));for(let r=0;r<e.length;r+=4)e[r]=n*(e[r]-128)+128,e[r+1]=n*(e[r+1]-128)+128,e[r+2]=n*(e[r+2]-128)+128}sendUniformData(t,e){t.uniform1f(e.uContrast,this.contrast)}}T(No,"type","Contrast"),T(No,"defaults",{contrast:0}),T(No,"uniformLocations",["uContrast"]),q.setClass(No);const gC={Convolute_3_1:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[9];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 0);
      for (float h = 0.0; h < 3.0; h+=1.0) {
        for (float w = 0.0; w < 3.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));
          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];
        }
      }
      gl_FragColor = color;
    }
    `,Convolute_3_0:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[9];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 1);
      for (float h = 0.0; h < 3.0; h+=1.0) {
        for (float w = 0.0; w < 3.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));
          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];
        }
      }
      float alpha = texture2D(uTexture, vTexCoord).a;
      gl_FragColor = color;
      gl_FragColor.a = alpha;
    }
    `,Convolute_5_1:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[25];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 0);
      for (float h = 0.0; h < 5.0; h+=1.0) {
        for (float w = 0.0; w < 5.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];
        }
      }
      gl_FragColor = color;
    }
    `,Convolute_5_0:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[25];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 1);
      for (float h = 0.0; h < 5.0; h+=1.0) {
        for (float w = 0.0; w < 5.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];
        }
      }
      float alpha = texture2D(uTexture, vTexCoord).a;
      gl_FragColor = color;
      gl_FragColor.a = alpha;
    }
    `,Convolute_7_1:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[49];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 0);
      for (float h = 0.0; h < 7.0; h+=1.0) {
        for (float w = 0.0; w < 7.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];
        }
      }
      gl_FragColor = color;
    }
    `,Convolute_7_0:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[49];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 1);
      for (float h = 0.0; h < 7.0; h+=1.0) {
        for (float w = 0.0; w < 7.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];
        }
      }
      float alpha = texture2D(uTexture, vTexCoord).a;
      gl_FragColor = color;
      gl_FragColor.a = alpha;
    }
    `,Convolute_9_1:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[81];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 0);
      for (float h = 0.0; h < 9.0; h+=1.0) {
        for (float w = 0.0; w < 9.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];
        }
      }
      gl_FragColor = color;
    }
    `,Convolute_9_0:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[81];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 1);
      for (float h = 0.0; h < 9.0; h+=1.0) {
        for (float w = 0.0; w < 9.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];
        }
      }
      float alpha = texture2D(uTexture, vTexCoord).a;
      gl_FragColor = color;
      gl_FragColor.a = alpha;
    }
    `};class Ho extends se{getCacheKey(){return"".concat(this.type,"_").concat(Math.sqrt(this.matrix.length),"_").concat(this.opaque?1:0)}getFragmentSource(){return gC[this.getCacheKey()]}applyTo2d(t){const e=t.imageData,s=e.data,n=this.matrix,r=Math.round(Math.sqrt(n.length)),o=Math.floor(r/2),a=e.width,l=e.height,c=t.ctx.createImageData(a,l),h=c.data,u=this.opaque?1:0;let f,d,p,g,m,v,_,y,b,S,P,O,k;for(P=0;P<l;P++)for(S=0;S<a;S++){for(m=4*(P*a+S),f=0,d=0,p=0,g=0,k=0;k<r;k++)for(O=0;O<r;O++)_=P+k-o,v=S+O-o,_<0||_>=l||v<0||v>=a||(y=4*(_*a+v),b=n[k*r+O],f+=s[y]*b,d+=s[y+1]*b,p+=s[y+2]*b,u||(g+=s[y+3]*b));h[m]=f,h[m+1]=d,h[m+2]=p,h[m+3]=u?s[m+3]:g}t.imageData=c}sendUniformData(t,e){t.uniform1fv(e.uMatrix,this.matrix)}toObject(){return w(w({},super.toObject()),{},{opaque:this.opaque,matrix:[...this.matrix]})}}T(Ho,"type","Convolute"),T(Ho,"defaults",{opaque:!1,matrix:[0,0,0,0,1,0,0,0,0]}),T(Ho,"uniformLocations",["uMatrix","uOpaque","uHalfSize","uSize"]),q.setClass(Ho);const mm="Gamma";class zo extends se{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform vec3 uGamma;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    vec3 correction = (1.0 / uGamma);
    color.r = pow(color.r, correction.r);
    color.g = pow(color.g, correction.g);
    color.b = pow(color.b, correction.b);
    gl_FragColor = color;
    gl_FragColor.rgb *= color.a;
  }
`}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(t),this.gamma=t.gamma||this.constructor.defaults.gamma.concat()}applyTo2d(t){let{imageData:{data:e}}=t;const s=this.gamma,n=1/s[0],r=1/s[1],o=1/s[2];this.rgbValues||(this.rgbValues={r:new Uint8Array(256),g:new Uint8Array(256),b:new Uint8Array(256)});const a=this.rgbValues;for(let l=0;l<256;l++)a.r[l]=255*Math.pow(l/255,n),a.g[l]=255*Math.pow(l/255,r),a.b[l]=255*Math.pow(l/255,o);for(let l=0;l<e.length;l+=4)e[l]=a.r[e[l]],e[l+1]=a.g[e[l+1]],e[l+2]=a.b[e[l+2]]}sendUniformData(t,e){t.uniform3fv(e.uGamma,this.gamma)}isNeutralState(){const{gamma:t}=this;return t[0]===1&&t[1]===1&&t[2]===1}toObject(){return{type:mm,gamma:this.gamma.concat()}}}T(zo,"type",mm),T(zo,"defaults",{gamma:[1,1,1]}),T(zo,"uniformLocations",["uGamma"]),q.setClass(zo);const pC={average:`
    precision highp float;
    uniform sampler2D uTexture;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = texture2D(uTexture, vTexCoord);
      float average = (color.r + color.b + color.g) / 3.0;
      gl_FragColor = vec4(average, average, average, color.a);
    }
    `,lightness:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform int uMode;
    varying vec2 vTexCoord;
    void main() {
      vec4 col = texture2D(uTexture, vTexCoord);
      float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;
      gl_FragColor = vec4(average, average, average, col.a);
    }
    `,luminosity:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform int uMode;
    varying vec2 vTexCoord;
    void main() {
      vec4 col = texture2D(uTexture, vTexCoord);
      float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;
      gl_FragColor = vec4(average, average, average, col.a);
    }
    `};class Vo extends se{applyTo2d(t){let{imageData:{data:e}}=t;for(let s,n=0;n<e.length;n+=4){const r=e[n],o=e[n+1],a=e[n+2];switch(this.mode){case"average":s=(r+o+a)/3;break;case"lightness":s=(Math.min(r,o,a)+Math.max(r,o,a))/2;break;case"luminosity":s=.21*r+.72*o+.07*a}e[n+2]=e[n+1]=e[n]=s}}getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return pC[this.mode]}sendUniformData(t,e){t.uniform1i(e.uMode,1)}isNeutralState(){return!1}}T(Vo,"type","Grayscale"),T(Vo,"defaults",{mode:"average"}),T(Vo,"uniformLocations",["uMode"]),q.setClass(Vo);const mC=w(w({},pm),{},{rotation:0});class ql extends Ri{calculateMatrix(){const t=this.rotation*Math.PI,e=Os(t),s=Ms(t),n=1/3,r=Math.sqrt(n)*s,o=1-e;this.matrix=[e+o/3,n*o-r,n*o+r,0,0,n*o+r,e+n*o,n*o-r,0,0,n*o-r,n*o+r,e+n*o,0,0,0,0,0,1,0]}isNeutralState(){return this.rotation===0}applyTo(t){this.calculateMatrix(),super.applyTo(t)}toObject(){return{type:this.type,rotation:this.rotation}}}T(ql,"type","HueRotation"),T(ql,"defaults",mC),q.setClass(ql);class Wo extends se{applyTo2d(t){let{imageData:{data:e}}=t;for(let s=0;s<e.length;s+=4)e[s]=255-e[s],e[s+1]=255-e[s+1],e[s+2]=255-e[s+2],this.alpha&&(e[s+3]=255-e[s+3])}getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform int uInvert;
  uniform int uAlpha;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    if (uInvert == 1) {
      if (uAlpha == 1) {
        gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,1.0 -color.a);
      } else {
        gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);
      }
    } else {
      gl_FragColor = color;
    }
  }
`}isNeutralState(){return!this.invert}sendUniformData(t,e){t.uniform1i(e.uInvert,Number(this.invert)),t.uniform1i(e.uAlpha,Number(this.alpha))}}T(Wo,"type","Invert"),T(Wo,"defaults",{alpha:!1,invert:!0}),T(Wo,"uniformLocations",["uInvert","uAlpha"]),q.setClass(Wo);class Yo extends se{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uStepH;
  uniform float uNoise;
  uniform float uSeed;
  varying vec2 vTexCoord;
  float rand(vec2 co, float seed, float vScale) {
    return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);
  }
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;
    gl_FragColor = color;
  }
`}applyTo2d(t){let{imageData:{data:e}}=t;const s=this.noise;for(let n=0;n<e.length;n+=4){const r=(.5-Math.random())*s;e[n]+=r,e[n+1]+=r,e[n+2]+=r}}sendUniformData(t,e){t.uniform1f(e.uNoise,this.noise/255),t.uniform1f(e.uSeed,Math.random())}isNeutralState(){return this.noise===0}}T(Yo,"type","Noise"),T(Yo,"defaults",{noise:0}),T(Yo,"uniformLocations",["uNoise","uSeed"]),q.setClass(Yo);class Xo extends se{applyTo2d(t){let{imageData:{data:e,width:s,height:n}}=t;for(let r=0;r<n;r+=this.blocksize)for(let o=0;o<s;o+=this.blocksize){const a=4*r*s+4*o,l=e[a],c=e[a+1],h=e[a+2],u=e[a+3];for(let f=r;f<Math.min(r+this.blocksize,n);f++)for(let d=o;d<Math.min(o+this.blocksize,s);d++){const p=4*f*s+4*d;e[p]=l,e[p+1]=c,e[p+2]=h,e[p+3]=u}}}isNeutralState(){return this.blocksize===1}getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uBlocksize;
  uniform float uStepW;
  uniform float uStepH;
  varying vec2 vTexCoord;
  void main() {
    float blockW = uBlocksize * uStepW;
    float blockH = uBlocksize * uStepH;
    int posX = int(vTexCoord.x / blockW);
    int posY = int(vTexCoord.y / blockH);
    float fposX = float(posX);
    float fposY = float(posY);
    vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);
    vec4 color = texture2D(uTexture, squareCoords);
    gl_FragColor = color;
  }
`}sendUniformData(t,e){t.uniform1f(e.uBlocksize,this.blocksize)}}T(Xo,"type","Pixelate"),T(Xo,"defaults",{blocksize:4}),T(Xo,"uniformLocations",["uBlocksize"]),q.setClass(Xo);class Uo extends se{getFragmentSource(){return`
precision highp float;
uniform sampler2D uTexture;
uniform vec4 uLow;
uniform vec4 uHigh;
varying vec2 vTexCoord;
void main() {
  gl_FragColor = texture2D(uTexture, vTexCoord);
  if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {
    gl_FragColor.a = 0.0;
  }
}
`}applyTo2d(t){let{imageData:{data:e}}=t;const s=255*this.distance,n=new Mt(this.color).getSource(),r=[n[0]-s,n[1]-s,n[2]-s],o=[n[0]+s,n[1]+s,n[2]+s];for(let a=0;a<e.length;a+=4){const l=e[a],c=e[a+1],h=e[a+2];l>r[0]&&c>r[1]&&h>r[2]&&l<o[0]&&c<o[1]&&h<o[2]&&(e[a+3]=0)}}sendUniformData(t,e){const s=new Mt(this.color).getSource(),n=this.distance,r=[0+s[0]/255-n,0+s[1]/255-n,0+s[2]/255-n,1],o=[s[0]/255+n,s[1]/255+n,s[2]/255+n,1];t.uniform4fv(e.uLow,r),t.uniform4fv(e.uHigh,o)}}T(Uo,"type","RemoveColor"),T(Uo,"defaults",{color:"#FFFFFF",distance:.02,useAlpha:!1}),T(Uo,"uniformLocations",["uLow","uHigh"]),q.setClass(Uo);class Go extends se{sendUniformData(t,e){t.uniform2fv(e.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),t.uniform1fv(e.uTaps,this.taps)}getFilterWindow(){const t=this.tempScale;return Math.ceil(this.lanczosLobes/t)}getCacheKey(){const t=this.getFilterWindow();return"".concat(this.type,"_").concat(t)}getFragmentSource(){const t=this.getFilterWindow();return this.generateShader(t)}getTaps(){const t=this.lanczosCreate(this.lanczosLobes),e=this.tempScale,s=this.getFilterWindow(),n=new Array(s);for(let r=1;r<=s;r++)n[r-1]=t(r*e);return n}generateShader(t){const e=new Array(t);for(let s=1;s<=t;s++)e[s-1]="".concat(s,".0 * uDelta");return`
      precision highp float;
      uniform sampler2D uTexture;
      uniform vec2 uDelta;
      varying vec2 vTexCoord;
      uniform float uTaps[`.concat(t,`];
      void main() {
        vec4 color = texture2D(uTexture, vTexCoord);
        float sum = 1.0;
        `).concat(e.map((s,n)=>`
              color += texture2D(uTexture, vTexCoord + `.concat(s,") * uTaps[").concat(n,"] + texture2D(uTexture, vTexCoord - ").concat(s,") * uTaps[").concat(n,`];
              sum += 2.0 * uTaps[`).concat(n,`];
            `)).join(`
`),`
        gl_FragColor = color / sum;
      }
    `)}applyToForWebgl(t){t.passes++,this.width=t.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=t.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),t.destinationWidth=this.dW,super.applyTo(t),t.sourceWidth=t.destinationWidth,this.height=t.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),t.destinationHeight=this.dH,super.applyTo(t),t.sourceHeight=t.destinationHeight}applyTo(t){bl(t)?this.applyToForWebgl(t):this.applyTo2d(t)}isNeutralState(){return this.scaleX===1&&this.scaleY===1}lanczosCreate(t){return e=>{if(e>=t||e<=-t)return 0;if(e<11920929e-14&&e>-11920929e-14)return 1;const s=(e*=Math.PI)/t;return Math.sin(e)/e*Math.sin(s)/s}}applyTo2d(t){const e=t.imageData,s=this.scaleX,n=this.scaleY;this.rcpScaleX=1/s,this.rcpScaleY=1/n;const r=e.width,o=e.height,a=Math.round(r*s),l=Math.round(o*n);let c;c=this.resizeType==="sliceHack"?this.sliceByTwo(t,r,o,a,l):this.resizeType==="hermite"?this.hermiteFastResize(t,r,o,a,l):this.resizeType==="bilinear"?this.bilinearFiltering(t,r,o,a,l):this.resizeType==="lanczos"?this.lanczosResize(t,r,o,a,l):new ImageData(a,l),t.imageData=c}sliceByTwo(t,e,s,n,r){const o=t.imageData,a=.5;let l=!1,c=!1,h=e*a,u=s*a;const f=t.filterBackend.resources;let d=0,p=0;const g=e;let m=0;f.sliceByTwo||(f.sliceByTwo=ms());const v=f.sliceByTwo;(v.width<1.5*e||v.height<s)&&(v.width=1.5*e,v.height=s);const _=v.getContext("2d");for(_.clearRect(0,0,1.5*e,s),_.putImageData(o,0,0),n=Math.floor(n),r=Math.floor(r);!l||!c;)e=h,s=u,n<Math.floor(h*a)?h=Math.floor(h*a):(h=n,l=!0),r<Math.floor(u*a)?u=Math.floor(u*a):(u=r,c=!0),_.drawImage(v,d,p,e,s,g,m,h,u),d=g,p=m,m+=u;return _.getImageData(d,p,n,r)}lanczosResize(t,e,s,n,r){const o=t.imageData.data,a=t.ctx.createImageData(n,r),l=a.data,c=this.lanczosCreate(this.lanczosLobes),h=this.rcpScaleX,u=this.rcpScaleY,f=2/this.rcpScaleX,d=2/this.rcpScaleY,p=Math.ceil(h*this.lanczosLobes/2),g=Math.ceil(u*this.lanczosLobes/2),m={},v={x:0,y:0},_={x:0,y:0};return function y(b){let S,P,O,k,D,z,K,st,G,it,ct;for(v.x=(b+.5)*h,_.x=Math.floor(v.x),S=0;S<r;S++){for(v.y=(S+.5)*u,_.y=Math.floor(v.y),D=0,z=0,K=0,st=0,G=0,P=_.x-p;P<=_.x+p;P++)if(!(P<0||P>=e)){it=Math.floor(1e3*Math.abs(P-v.x)),m[it]||(m[it]={});for(let et=_.y-g;et<=_.y+g;et++)et<0||et>=s||(ct=Math.floor(1e3*Math.abs(et-v.y)),m[it][ct]||(m[it][ct]=c(Math.sqrt(Math.pow(it*f,2)+Math.pow(ct*d,2))/1e3)),O=m[it][ct],O>0&&(k=4*(et*e+P),D+=O,z+=O*o[k],K+=O*o[k+1],st+=O*o[k+2],G+=O*o[k+3]))}k=4*(S*n+b),l[k]=z/D,l[k+1]=K/D,l[k+2]=st/D,l[k+3]=G/D}return++b<n?y(b):a}(0)}bilinearFiltering(t,e,s,n,r){let o,a,l,c,h,u,f,d,p,g,m,v,_,y=0;const b=this.rcpScaleX,S=this.rcpScaleY,P=4*(e-1),O=t.imageData.data,k=t.ctx.createImageData(n,r),D=k.data;for(f=0;f<r;f++)for(d=0;d<n;d++)for(h=Math.floor(b*d),u=Math.floor(S*f),p=b*d-h,g=S*f-u,_=4*(u*e+h),m=0;m<4;m++)o=O[_+m],a=O[_+4+m],l=O[_+P+m],c=O[_+P+4+m],v=o*(1-p)*(1-g)+a*p*(1-g)+l*g*(1-p)+c*p*g,D[y++]=v;return k}hermiteFastResize(t,e,s,n,r){const o=this.rcpScaleX,a=this.rcpScaleY,l=Math.ceil(o/2),c=Math.ceil(a/2),h=t.imageData.data,u=t.ctx.createImageData(n,r),f=u.data;for(let d=0;d<r;d++)for(let p=0;p<n;p++){const g=4*(p+d*n);let m=0,v=0,_=0,y=0,b=0,S=0,P=0;const O=(d+.5)*a;for(let k=Math.floor(d*a);k<(d+1)*a;k++){const D=Math.abs(O-(k+.5))/c,z=(p+.5)*o,K=D*D;for(let st=Math.floor(p*o);st<(p+1)*o;st++){let G=Math.abs(z-(st+.5))/l;const it=Math.sqrt(K+G*G);it>1&&it<-1||(m=2*it*it*it-3*it*it+1,m>0&&(G=4*(st+k*e),P+=m*h[G+3],_+=m,h[G+3]<255&&(m=m*h[G+3]/250),y+=m*h[G],b+=m*h[G+1],S+=m*h[G+2],v+=m))}}f[g]=y/v,f[g+1]=b/v,f[g+2]=S/v,f[g+3]=P/_}return u}}T(Go,"type","Resize"),T(Go,"defaults",{resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3}),T(Go,"uniformLocations",["uDelta","uTaps"]),q.setClass(Go);class $o extends se{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uSaturation;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    float rgMax = max(color.r, color.g);
    float rgbMax = max(rgMax, color.b);
    color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;
    color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;
    color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;
    gl_FragColor = color;
  }
`}applyTo2d(t){let{imageData:{data:e}}=t;const s=-this.saturation;for(let n=0;n<e.length;n+=4){const r=e[n],o=e[n+1],a=e[n+2],l=Math.max(r,o,a);e[n]+=l!==r?(l-r)*s:0,e[n+1]+=l!==o?(l-o)*s:0,e[n+2]+=l!==a?(l-a)*s:0}}sendUniformData(t,e){t.uniform1f(e.uSaturation,-this.saturation)}isNeutralState(){return this.saturation===0}}T($o,"type","Saturation"),T($o,"defaults",{saturation:0}),T($o,"uniformLocations",["uSaturation"]),q.setClass($o);class qo extends se{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uVibrance;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    float max = max(color.r, max(color.g, color.b));
    float avg = (color.r + color.g + color.b) / 3.0;
    float amt = (abs(max - avg) * 2.0) * uVibrance;
    color.r += max != color.r ? (max - color.r) * amt : 0.00;
    color.g += max != color.g ? (max - color.g) * amt : 0.00;
    color.b += max != color.b ? (max - color.b) * amt : 0.00;
    gl_FragColor = color;
  }
`}applyTo2d(t){let{imageData:{data:e}}=t;const s=-this.vibrance;for(let n=0;n<e.length;n+=4){const r=e[n],o=e[n+1],a=e[n+2],l=Math.max(r,o,a),c=(r+o+a)/3,h=2*Math.abs(l-c)/255*s;e[n]+=l!==r?(l-r)*h:0,e[n+1]+=l!==o?(l-o)*h:0,e[n+2]+=l!==a?(l-a)*h:0}}sendUniformData(t,e){t.uniform1f(e.uVibrance,-this.vibrance)}isNeutralState(){return this.vibrance===0}}T(qo,"type","Vibrance"),T(qo,"defaults",{vibrance:0}),T(qo,"uniformLocations",["uVibrance"]),q.setClass(qo);const Ko={FRAME:{WIDTH:579,HEIGHT:326},PAGE_FRAME:{WIDTH:1280,HEIGHT:720}},Ee={PRIMARY:"#3564FF",TRANSPARENT:"transparent",TEXT:"#333333",BORDER:{DEFAULT:"transparent",HOVER:"#3564FF",SELECTED:"#3564FF",UNSELECTED:"#747C87"},BACKGROUND:{DEFAULT:"#ffffff",HOVER:"#f0f0f0"}},zs={PADDING_0:0,CORNER_SIZE:8,STROKE_WIDTH:1,BORDER_LINE_WIDTH_TEXT:1.5,BORDER_SCALE_FACTOR:1,MIN_ZOOM:.1,MAX_ZOOM:100},En={CORNER:{STYLE:"circle",COLOR:Ee.PRIMARY,SIZE:zs.CORNER_SIZE,TRANSPARENT:!1}},xe=class xe{static getRandomColor(t=xe.FRAME_COLORS){return t[Math.floor(Math.random()*t.length)]}static generateRandomColor(t=1){const e=Math.floor(Math.random()*256),s=Math.floor(Math.random()*256),n=Math.floor(Math.random()*256);return t===1?`#${e.toString(16).padStart(2,"0")}${s.toString(16).padStart(2,"0")}${n.toString(16).padStart(2,"0")}`:`rgba(${e}, ${s}, ${n}, ${t})`}static generateSoftRandomColor(){const t=Math.floor(Math.random()*360),e=Math.floor(Math.random()*30)+70,s=Math.floor(Math.random()*15)+80;return`hsl(${t}, ${e}%, ${s}%)`}static getColorByIndex(t,e=xe.FRAME_COLORS){return e[t%e.length]}static setColorOpacity(t,e){if(t.startsWith("#")){const s=parseInt(t.slice(1,3),16),n=parseInt(t.slice(3,5),16),r=parseInt(t.slice(5,7),16);return`rgba(${s}, ${n}, ${r}, ${e})`}if(t.startsWith("rgb(")){const s=t.match(/\d+/g);if(s&&s.length>=3)return`rgba(${s[0]}, ${s[1]}, ${s[2]}, ${e})`}return t}static rgbToHex(t,e,s){return`#${t.toString(16).padStart(2,"0")}${e.toString(16).padStart(2,"0")}${s.toString(16).padStart(2,"0")}`}static hexToRgb(t){const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}static shadeColor(t,e){const s=xe.hexToRgb(t);if(!s)return t;const{r:n,g:r,b:o}=s,a=Math.max(0,Math.min(255,n+e)),l=Math.max(0,Math.min(255,r+e)),c=Math.max(0,Math.min(255,o+e));return xe.rgbToHex(a,l,c)}static getColorPickerHtml(t,e="#1890ff"){return`
      <div class="color-picker-container" style="margin: 10px 0;">
        <label for="${t}" style="display: block; margin-bottom: 5px;">选择颜色:</label>
        <input type="color" id="${t}" value="${e}" style="width: 50px; height: 30px;">
        <input type="text" id="${t}-text" value="${e}" style="margin-left: 10px; width: 80px;">
        <div class="color-presets" style="margin-top: 5px; display: flex; flex-wrap: wrap;">
          ${xe.THEME_COLORS.map(s=>`<div class="color-preset" data-color="${s}" style="width: 20px; height: 20px; background-color: ${s}; margin: 2px; cursor: pointer; border-radius: 2px;"></div>`).join("")}
        </div>
      </div>
    `}static initColorPicker(t,e){if(typeof document>"u")return;const s=document.getElementById(t),n=document.getElementById(`${t}-text`),r=document.querySelectorAll(`#${t}-container .color-preset`);s&&n&&(s.addEventListener("input",()=>{n.value=s.value,e==null||e(s.value)}),n.addEventListener("input",()=>{/^#[0-9A-F]{6}$/i.test(n.value)&&(s.value=n.value,e==null||e(n.value))}),r.forEach(o=>{o.addEventListener("click",a=>{const l=a.currentTarget.getAttribute("data-color")||"#1890ff";s.value=l,n.value=l,e==null||e(l)})}))}};F(xe,"FRAME_COLORS",["#FFE5E5","#E5FFE5","#E5E5FF","#FFFFE5","#FFE5FF","#E5FFFF","#F5E6D3","#E6E6FA","#F0FFF0","#F5F5DC"]),F(xe,"THEME_COLORS",["#1890ff","#52c41a","#faad14","#f5222d","#722ed1","#eb2f96","#fa8c16","#13c2c2"]),F(xe,"FLAT_UI_COLORS",["#1abc9c","#2ecc71","#3498db","#9b59b6","#34495e","#16a085","#27ae60","#2980b9","#8e44ad","#2c3e50"]),F(xe,"MATERIAL_COLORS",["#f44336","#e91e63","#9c27b0","#673ab7","#3f51b5","#2196f3","#03a9f4","#00bcd4","#009688","#4caf50"]),F(xe,"GRADIENT_COLORS",["#a18cd1","#fbc2eb","#84fab0","#8fd3f4","#d4fc79","#96e6a1","#fda085","#f6d365","#fad0c4","#ffecd2"]),F(xe,"NORDIC_COLORS",["#f9f9f9","#e8e8e8","#d9e2ec","#b3c2cf","#4a5568","#2d3748","#e2e8f0","#edf2f7","#f7fafc","#cbd5e0"]),F(xe,"TECH_COLORS",["#00b8d4","#00bfa5","#00c853","#2979ff","#3d5afe","#651fff","#d500f9","#f50057","#ff3d00","#1a237e"]),F(xe,"TRADITIONAL_CHINESE_COLORS",["#e4c6d0","#789262","#493131","#a98175","#1c1c1c","#9d2933","#d4f2e7","#f2be45","#61649f","#8d4bbb","#d71345","#45b97c","#4b5cc4","#f05654","#8e453f","#ffb3a7","#e0eee8","#96c37d","#9b4400","#f35336"]);let Wr=xe;const vC={fill:"rgba(255, 255, 255, 0)",customBorderColor:"rgba(0, 0, 0, 0.4)",rx:3,ry:3,shadow:new Xs({color:"rgba(0, 0, 0, 0.1)",blur:15,offsetX:0,offsetY:0}),opacity:.8,backgroundColor:"rgba(255, 255, 255, 0)"},re=[];for(let i=0;i<256;++i)re.push((i+256).toString(16).slice(1));function _C(i,t=0){return(re[i[t+0]]+re[i[t+1]]+re[i[t+2]]+re[i[t+3]]+"-"+re[i[t+4]]+re[i[t+5]]+"-"+re[i[t+6]]+re[i[t+7]]+"-"+re[i[t+8]]+re[i[t+9]]+"-"+re[i[t+10]]+re[i[t+11]]+re[i[t+12]]+re[i[t+13]]+re[i[t+14]]+re[i[t+15]]).toLowerCase()}let Kl;const yC=new Uint8Array(16);function bC(){if(!Kl){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Kl=crypto.getRandomValues.bind(crypto)}return Kl(yC)}const xC=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),zf={randomUUID:xC};function CC(i,t,e){var n;if(zf.randomUUID&&!i)return zf.randomUUID();i=i||{};const s=i.random??((n=i.rng)==null?void 0:n.call(i))??bC();if(s.length<16)throw new Error("Random bytes length must be >= 16");return s[6]=s[6]&15|64,s[8]=s[8]&63|128,_C(s)}let vm=null;function SC(i){vm=i}function _m(){return vm}function Vf(i,t){const e=new he("加载中...",{left:i.getWidth()/2,top:i.getHeight()/2,originX:"center",originY:"center",fill:"#666",fontSize:20,selectable:!1,evented:!1});i.add(e),i.requestRenderAll(),Se.fromURL(t,{crossOrigin:"anonymous"}).then(s=>{const n=i.getWidth(),r=i.getHeight(),o=Math.max(n/s.width,r/s.height);s.scale(o),s.set({left:n/2,top:r/2,originX:"center",originY:"center",selectable:!1,evented:!1}),i.backgroundImage=s,i.remove(e),i.requestRenderAll(),yt.emit(ut.CANVAS.BACKGROUND_IMAGE_CHANGE,{canvas:i,image:s})})}function wC(i,t){i.backgroundColor=t,i.requestRenderAll(),yt.emit(ut.CANVAS.CANVAS_UPDATE,{type:"change",target:i}),yt.emit(ut.CANVAS.BACKGROUND_COLOR_CHANGE,{canvas:i,color:t})}function TC(i,t){const e=i.getObjects(),s=[],n=i.viewportTransform,r=i.getZoom(),o=Dn.transformPoint(new E(t.x,t.y),Dn.invertTransform(n)),a={left:-n[4]/r,top:-n[5]/r,width:i.width/r,height:i.height/r};for(let l=e.length-1;l>=0;l--){const c=e[l];if(!c.visible)continue;const h=c.getBoundingRect();h.left>a.left+a.width||h.left+h.width<a.left||h.top>a.top+a.height||h.top+h.height<a.top||o.x<h.left||o.x>h.left+h.width||o.y<h.top||o.y>h.top+h.height||c.containsPoint(o)&&s.push(c)}return s}function OC(i,t,e=1){const s=t.left+t.width,n=t.top+t.height,r=t.left+e,o=t.top+e,a=s-e,l=n-e,c=i.x>=t.left&&i.x<=s&&i.y>=t.top&&i.y<=n,h=i.x>=r&&i.x<=a&&i.y>=o&&i.y<=l;return c&&!h}function Zl(i,t){const e=TC(i,t),s=e.find(r=>r instanceof Qt&&OC(t,r,10));let n=null;return s||(n=e.find(r=>r.type!==Qt.type&&!(r instanceof Qt))),{target:n||s,targets:e}}let Jl=!1;const ra=[];async function MC(i,t,e){const s=async()=>{var a;if(!i)return;const n={waitForRender:!0};if(!i)return;const r=((a=i.viewportTransform)==null?void 0:a.slice())||[1,0,0,1,0,0],o=i.getZoom();try{const l=ii(i,e),c=t.getContext("2d");if(!c)return;i.setViewportTransform(l.transform),await new Promise(f=>{n.waitForRender&&requestAnimationFrame(()=>{i.renderAll(),requestAnimationFrame(()=>{setTimeout(f,500)})})});const h=i.getWidth(),u=i.getHeight();t.width=h,t.height=u,c.clearRect(0,0,t.width,t.height),c.drawImage(i.lowerCanvasEl,0,0,h,u,0,0,t.width,t.height)}catch(l){console.error("生成可靠缩略图失败:",l);return}finally{i.setViewportTransform(r),i.setZoom(o)}};return new Promise((n,r)=>{ra.push(async()=>{try{await s(),n()}catch(o){r(o)}}),ym()})}async function ym(){if(!(Jl||ra.length===0)){Jl=!0;try{const i=ra.shift();i&&await i()}finally{Jl=!1,ra.length>0&&ym()}}}function ii(i,t,e=0,s=0,n=!1){const r=i.viewportTransform;i.setViewportTransform([1,0,0,1,0,0]);const o=t.getCenterPoint(),a=o.x,l=o.y;let c=i.getWidth(),h=i.getHeight();n?(c=window.screen.width*window.devicePixelRatio,c=window.screen.height*window.devicePixelRatio):(c=i.getWidth()||window.innerWidth-e,h=(i.getHeight()||window.innerHeight)-s);const u=t.getBoundingRect(),f=u.width,d=u.height,p=c*.99/f,g=h*.99/d,m=Math.min(p,g),v=c/2-a*m,_=h/2-l*m,y=u.left*m+v,b=u.top*m+_,S=f*m,P=d*m;return{transform:[m,0,0,m,v,_],scale:m,centerX:a,centerY:l,width:f,height:d,left:u.left,top:u.top,right:u.left+f,bottom:u.top+d,scaledLeft:y,scaledTop:b,scaledWidth:S,scaledHeight:P,currentTransform:r}}const Va=class Va extends as{constructor(e){e={...vC,...e,strokeUniform:!0};super(e);F(this,"thumbnail",async e=>{if(!e.getContext("2d"))return null;const n=_m();await MC(n.getPresentationCanvas(),e,this)});this.id=e.id||CC(),this.initializeControls(),this.initEventHandlers(),this.customBorderColor=e.customBorderColor,this.customControls=e.customControls||[],this.controlsVisibilityMap=e.controlsVisibilityMap||{},this.objectCaching=!0,this.noScaleCache=!1,this.set("willReadFrequently",!1),this.set("cacheProperties",["fill","stroke","strokeWidth"]),this.strokeUniform=!0}initializeControls(){this.cornerSize=En.CORNER.SIZE,this.cornerColor=En.CORNER.COLOR,this.cornerStyle=En.CORNER.STYLE,this.transparentCorners=En.CORNER.TRANSPARENT,this.setControlsVisibility({mtr:!1}),this.lockRotation=!0}containsPoint(e){const n=this.getBoundingRect();return e.x>=n.left&&e.x<=n.left+10||e.x<=n.left+n.width&&e.x>=n.left+n.width-10||e.y>=n.top&&e.y<=n.top+10||e.y<=n.top+n.height&&e.y>=n.top+n.height-10}initEventHandlers(){}requestRender(){this.canvas&&requestAnimationFrame(()=>{this.canvas.requestRenderAll()})}setCu1stomBorderColor(e){this.customBorderColor=e,this.requestRender()}setControlVisibility(e,s){const n={[e]:s};super.setControlsVisibility(n),this.controlsVisibilityMap[e]=s,s?this.customControls.includes(e)||this.customControls.push(e):this.customControls=this.customControls.filter(r=>r!==e),this.requestRender()}setControlsVisibilityBatch(e){Object.entries(e).forEach(([s,n])=>{this.setControlVisibility(s,n)})}render(e){super.render(e),this.drawCustomBorder(e),this.canvas&&this.canvas.getActiveObject()===this?this.drawCustomControls(e):this.shouldRenderCustomControlsWhenInactive()&&this.renderCustomControlsWhenInactive(e)}shouldRenderCustomControlsWhenInactive(){return!1}renderCustomControlsWhenInactive(e){e.save();const s=this.getViewportTransform(),n=Dn.multiplyTransformMatrices(s,this.calcTransformMatrix()),r=Dn.qrDecompose(n),{tl:o}=this.oCoords||{};o?e.translate(o.x,o.y):e.translate(r.translateX,r.translateY),e.rotate(Dn.degreesToRadians(r.angle)),this.drawCustomControls(e),e.restore()}getCustomControlsToShow(){return this.customControls.filter(e=>this.controlsVisibilityMap[e]!==!1)}drawCustomControls(e,s={}){e.save();const n=this.getCanvasRetinaScaling(),{cornerStrokeColor:r,cornerDashArray:o,cornerColor:a}=this,l={cornerStrokeColor:r,cornerDashArray:o,cornerColor:a,...s};e.setTransform(n,0,0,n,0,0),e.strokeStyle=e.fillStyle=l.cornerColor,this.transparentCorners||(e.strokeStyle=l.cornerStrokeColor),this._setLineDash(e,l.cornerDashArray);const c=this.getCustomControlsToShow();this.forEachControl((h,u)=>{if(c.includes(u)&&h.getVisibility(this,u)&&this.controls[u].visible!==!1){const d=this.oCoords[u];h.render(e,d.x,d.y,l,this)}}),e.restore()}drawCustomBorder(e){if(!this.canvas)return;e.save();const s=this.canvas.getZoom();e.lineWidth=1/s,e.strokeStyle=this.customBorderColor;const n=this.calcTransformMatrix();e.transform(n[0],n[1],n[2],n[3],n[4],n[5]);const r=this.width,o=this.height,a=this.rx?Math.min(this.rx,r/2):0,l=this.ry?Math.min(this.ry,o/2):0;e.beginPath(),e.moveTo(-r/2+a,-o/2),e.lineTo(r/2-a,-o/2),e.quadraticCurveTo(r/2,-o/2,r/2,-o/2+l),e.lineTo(r/2,o/2-l),e.quadraticCurveTo(r/2,o/2,r/2-a,o/2),e.lineTo(-r/2+a,o/2),e.quadraticCurveTo(-r/2,o/2,-r/2,o/2-l),e.lineTo(-r/2,-o/2+l),e.quadraticCurveTo(-r/2,-o/2,-r/2+a,-o/2),e.stroke(),e.restore()}toJSON(){return{...super.toJSON(),type:Va.type,id:this.id,customBorderColor:this.customBorderColor,customControls:this.customControls,controlsVisibilityMap:this.controlsVisibilityMap}}toObject(e=[]){return super.toObject([...e,"type","id","customBorderColor","customControls","controlsVisibilityMap"])}};F(Va,"type","slides");let Qt=Va;q.setClass(Qt,Qt.type);q.setSVGClass(Qt,Qt.type);class zt extends Qt{constructor(e){console.log("Frame options",e);const s={...e};super(s);F(this,"renderCustomCorner",(e,s,n,r,o)=>{this.canvas&&this.canvas.getZoom();const a=18;e.save(),e.translate(s,n),e.rotate(Dn.degreesToRadians(o.angle)),e.beginPath(),e.arc(0,0,a/2,0,2*Math.PI),e.fillStyle=this.isCurrentSelected?Ee.BORDER.HOVER:Ee.BORDER.UNSELECTED,e.fill(),e.fillStyle="white",e.font="14px Arial",e.textAlign="center",e.textBaseline="middle",e.fillText(this.order.toString(),0,0),e.restore()});this.parentPage=e.parentPage,this.contents=new Set,this._originalLeft=e.left,this._originalTop=e.top,this.order=e.order||0,console.log("初始化Frame当前Frame Order:",this.order),this.initFrameNumberControl()}initFrameNumberControl(){const e=this.controls.tl;this.controls.frameNumberCorner=new Ce({x:-.5,y:-.5,offsetX:3,offsetY:3,cursorStyle:"nwse-resize",render:this.renderCustomCorner,mouseDownHandler:function(s,n,r,o){var a;return n.originX="right",n.originY="bottom",n.corner="tl",(a=e.mouseDownHandler)==null?void 0:a.call(e,s,n,r,o)},actionHandler:function(s,n,r,o){return Xi.scalingEqually(s,n,r,o)}})}setNumberControlVisibility(e){this.setControlVisibility("frameNumberCorner",e)}shouldRenderCustomControlsWhenInactive(){return!0}getCustomControlsToShow(){return["frameNumberCorner"]}updateContents(){if(this.contents.size>0){console.log("updateContents",this.contents);const{scaleX:e,scaleY:s,left:n,top:r,angle:o}=this;this.contents.forEach(a=>{if(a&&a.set){a.objectCaching||(a.objectCaching=!0,a.statefull=!1,a.noScaleCache=!1,a.set("willReadFrequently",!1),a.set("cacheProperties",["fill","stroke","strokeWidth"]));const l=a.left-n,c=a.top-r;a._originalLeft=l,a._originalTop=c,a.set({left:a.left+(this.left-a._prevFrameLeft||0),top:a.top+(this.top-a._prevFrameTop||0),angle:o+(a.angle||0)},{statefull:!1,skipRender:!0}),a._prevFrameLeft=this.left,a._prevFrameTop=this.top,a.setCoords()}}),this.canvas&&requestAnimationFrame(()=>{this.canvas.requestRenderAll()})}}addContent(e){console.log("Frame addContent",e),e._originalLeft=e.left-this.left,e._originalTop=e.top-this.top,e._originalAngle=e.angle||0,e.objectCaching=!0,e.statefull=!1,e.noScaleCache=!1,e.set("willReadFrequently",!1),e.set("cacheProperties",["fill","stroke","strokeWidth"]),this.contents.add(e)}removeContent(e){this.contents.delete(e)}clearContents(){this.canvas&&this.contents.forEach(e=>{this.canvas.remove(e)}),this.contents.clear()}toggleContentSelectable(e){this.contents.forEach(s=>{s&&s.set&&s.set({selectable:e,evented:e})})}toJSON(){return{...super.toJSON(),id:this.id,parentPage:this.parentPage,contents:Array.from(this.contents),order:this.order}}toObject(e=[]){return super.toObject([...e,"parentPage","contents","order","isCurrentSelected"])}}F(zt,"type","frame");q.setClass(zt,zt.type);q.setSVGClass(zt,zt.type);class ce extends Qt{constructor(e){const s={...e};super(s);F(this,"initialLeft");F(this,"initialTop");this.initialLeft=e.left,this.initialTop=e.top}initializeControls(){super.initializeControls(),this.setControlsVisibility({mtr:!1,bl:!0,br:!0,tl:!0,tr:!0,mb:!1,ml:!1,mr:!1,mt:!1})}toJSON(){return{...super.toJSON(),initialLeft:this.initialLeft,initialTop:this.initialTop}}}F(ce,"type","pageframe");q.setClass(ce,ce.type);q.setSVGClass(ce,ce.type);class EC{constructor(t,e){F(this,"canvas");F(this,"frameManager");this.canvas=t,this.frameManager=e}setupFrameEvents(t){t.off("moving"),t.off("rotating"),t.off("scaling"),t.on("moving",()=>this.handleFrameMoving(t)),t.on("rotating",()=>this.handleFrameRotating(t)),t.on("scaling",()=>this.handleFrameScaling(t)),this.frameManager&&(t.on("moving",()=>this.updateFrameNumberPosition(t)),t.on("rotating",()=>this.updateFrameNumberPosition(t)),t.on("scaling",()=>this.updateFrameNumberPosition(t)))}handleFrameMoving(t){t.updateContents()}handleFrameRotating(t){t.updateContents()}handleFrameScaling(t){t.updateContents()}updateFrameNumberPosition(t){this.frameManager&&this.frameManager.updateNumberPositionForFrame(t)}bringFrameToFront(t){const e=this.canvas.getObjects();e.indexOf(t)!==e.length-1&&(this.canvas.bringObjectToFront(t),t.contents.forEach(n=>{this.canvas.bringObjectToFront(n)}),this.canvas.requestRenderAll())}}class kC{constructor(t){F(this,"frames",new Map);F(this,"canvas");F(this,"frameEventHandler");F(this,"currentFrame",null);this.canvas=t,this.frameEventHandler=new EC(t,this)}createFrame(t){const e=this.frames.size+1;console.log("Creating frame with order:",e);const s=new zt({...t,order:e});return this.frameEventHandler.setupFrameEvents(s),this.frames.set(s.id,s),this.canvas.add(s),this.canvas.requestRenderAll(),yt.emit(ut.FRAME.FRAME_ADDED,{frameId:s.id,frame:s,framesCount:this.frames.size,frames:this.getAllFrames()}),s}updateNumberPositionForFrame(t){}deleteFrame(t){const e=this.frames.get(t);e&&(e.clearContents(),this.canvas.remove(e),this.frames.delete(t),yt.emit(ut.FRAME.FRAME_REMOVED,{frameId:t,framesCount:this.frames.size,frames:this.getAllFrames()})),this.updateFrameOrder()}getFrame(t){return this.frames.get(t)}getAllFrames(){return Array.from(this.frames.values()).sort((t,e)=>t.order-e.order)}setCurrentFrame(t){this.currentFrame=t,t&&yt.emit(ut.FRAME.FRAME_UPDATED,{frameId:t.id,frame:t,isCurrent:!0})}getCurrentFrame(){return this.currentFrame}updateFrameOrder(){const t=Array.from(this.frames.values());t.sort((e,s)=>e.order-s.order),t.forEach((e,s)=>{const n=s+1;e.order=n}),yt.emit(ut.FRAME.FRAMES_REORDERED,{frames:this.getAllFrames()})}updateReferences(){const s=this.canvas.getObjects().filter(n=>n.type===zt.type);this.frames.clear(),s.forEach(n=>{this.frames.set(n.id,n),yt.emit(ut.CANVAS.CANVAS_UPDATE,{type:ut.CANVAS.CANVAS_UPDATE,target:n})}),!this.currentFrame&&s.length>0&&(this.currentFrame=s[0])}moveFrameUp(t){const e=this.frames.get(t);if(e&&e.order>1){const s=this.findFrameByOrder(e.order-1);if(s){const n=e.order;e.order=s.order,s.order=n,this.canvas.requestRenderAll(),this.updateFrameOrder()}}}moveFrameDown(t){const e=this.frames.get(t);if(e&&e.order<this.frames.size){const s=this.findFrameByOrder(e.order+1);if(s){const n=e.order;e.order=s.order,s.order=n,this.canvas.requestRenderAll(),this.updateFrameOrder()}}}findFrameByOrder(t){return Array.from(this.frames.values()).find(e=>e.order===t)}findParentFrame(t){return this.canvas.getObjects().filter(e=>e instanceof zt).find(e=>e.contents.has(t))||null}clear(){this.frames.forEach(t=>{this.canvas.remove(t)}),this.frames.clear(),this.currentFrame=null,yt.emit(ut.FRAME.FRAMES_CLEARED,{framesCount:0})}}class PC{constructor(t,e){F(this,"canvas");F(this,"pageFrameManager");this.canvas=t,this.pageFrameManager=e}setupPageFrameEvents(t){t.off("moving"),t.off("scaling"),t.on("moving",e=>this.handlePageFrameMoving(t,e)),t.on("scaling",e=>this.handlePageFrameScaling(t,e))}handlePageFrameMoving(t,e){if(!e||!e.target)return;const s=e.target;s.left-s.initialLeft,s.top-s.initialTop,s.initialLeft=s.left,s.initialTop=s.top,this.canvas.requestRenderAll()}handlePageFrameScaling(t,e){}}class AC{constructor(t){F(this,"canvas");F(this,"pageFrame");F(this,"frameManager");F(this,"pageFrameEventHandler");this.canvas=t,this.frameManager=new kC(t),this.pageFrameEventHandler=new PC(t,this),this.initializeCanvas()}initializeCanvas(){this.createDefaultPage()}createDefaultPage(){const{width:t,height:e}=this.calculatePageDimensions(),s=this.calculatePagePosition(t,e);return this.pageFrame=new ce({...s,width:t,height:e}),this.pageFrameEventHandler.setupPageFrameEvents(this.pageFrame),this.pageFrame}calculatePageDimensions(){const t=this.canvas.getZoom();return{width:Ko.PAGE_FRAME.WIDTH/t,height:Ko.PAGE_FRAME.HEIGHT/t}}calculatePagePosition(t,e){const s=this.canvas.getVpCenter();return{left:s.x-t/2,top:s.y-e/2}}addNewFrame(){if(!this.pageFrame)return console.error("No active page"),null;const t=this.createFrame();return t?(this.arrangeFrameInCanvas(t),t):null}createFrame(){const{width:t,height:e}=this.calculateFrameDimensions(),s=this.calculateFramePosition(t,e);return this.frameManager.createFrame({...s,width:t,height:e,parentPage:this.pageFrame})}calculateFrameDimensions(){const t=this.canvas.getZoom();return{width:Ko.FRAME.WIDTH/t,height:Ko.FRAME.HEIGHT/t}}calculateFramePosition(t,e){const s=this.canvas.getVpCenter();return{left:s.x-t/2,top:s.y-e/2}}arrangeFrameInCanvas(t){if(!this.pageFrame)return;this.canvas.sendObjectToBack(this.pageFrame),this.canvas.getObjects().filter(s=>s instanceof zt).forEach(s=>{s!==t&&this.canvas.bringObjectToFront(s)}),this.canvas.bringObjectToFront(t),this.canvas.setActiveObject(t)}updateReferences(){const s=this.canvas.getObjects().find(n=>n.type===ce);s&&(this.pageFrame=s),this.frameManager.updateReferences()}getPageFrame(){return this.pageFrame}deleteFrame(t){const e=this.frameManager.getFrame(t);e&&this.pageFrame&&(this.pageFrame.removeFrame(e),this.frameManager.deleteFrame(t))}getCurrentFrame(){return this.frameManager.getCurrentFrame()}getFrameManager(){return this.frameManager}setPageSize(t,e){this.pageFrame&&(this.pageFrame.set({width:t,height:e}),this.canvas.requestRenderAll())}clear(){this.pageFrame&&this.canvas.remove(this.pageFrame),this.frameManager.clear(),this.canvas.requestRenderAll()}destroy(){this.clear()}}const Wa=class Wa extends bs{constructor(e,s){const n={fill:"#333333",cornerSize:zs.CORNER_SIZE,cornerColor:Ee.PRIMARY,cornerStyle:"circle",transparentCorners:!1,lockRotation:!0,hasRotatingPoint:!1,splitByGrapheme:!0,editable:!0,padding:8,textAlign:"left",lockScalingFlip:!0,...s};super(e,n);F(this,"_showBorder",!1);F(this,"_hoverBorderColor",Ee.BORDER.HOVER);F(this,"lineWidth",1);F(this,"preventDistortion",!0);F(this,"_originalWidth",0);F(this,"_originalHeight",0);F(this,"_skipDimension",!1);F(this,"_minFontSize",1);F(this,"_originalFontSize",this.fontSize);F(this,"_isMoving",!1);F(this,"handleEditingKeyDown",e=>{this.isEditing&&(e.ctrlKey&&e.code==="KeyC"&&this.handleCopy(e),e.ctrlKey&&e.code==="KeyV"&&this.handlePaste(e),(e.code==="Enter"||e.code==="NumpadEnter"||e.key==="Enter"||e.keyCode===13)&&this.handleEnterKey(e))});this._hoverBorderColor=s.hoverBorderColor||Ee.BORDER.HOVER,this.lineWidth=s.lineWidth||1,Object.defineProperty(this,"type",{value:Wa.type,configurable:!1,writable:!1}),this.setControlsVisibility({mtr:!1}),this._originalWidth=this.width,this._originalHeight=this.height,this._originalFontSize=this.fontSize||40,this._minFontSize=this._minFontSize,this.on("scaling",this.handleScaling.bind(this)),this.on("editing:entered",this.handleEditingEntered.bind(this)),this.on("editing:exited",this.handleEditingExited.bind(this)),this.on("moving",this.handleMoving.bind(this)),this.on("mouseup",this.handleMoveEnd.bind(this)),this.on("deselected",this.handleMoveEnd.bind(this))}handleEditingEntered(){document.addEventListener("keydown",this.handleEditingKeyDown)}handleEditingExited(){document.removeEventListener("keydown",this.handleEditingKeyDown)}_render(e){if(this.backgroundColor){e.save(),e.fillStyle=this.backgroundColor;const r=this.width+this.padding*2,o=this.height+this.padding*2;e.fillRect(-r/2,-o/2,r,o),e.restore()}if(super._render(e),this.selected)return;e.save(),this._showBorder?e.strokeStyle=this._hoverBorderColor:e.strokeStyle=Ee.BORDER.DEFAULT,e.lineWidth=this.lineWidth,e.setLineDash([]);const s=this.width+this.padding*2,n=this.height+this.padding*2;e.strokeRect(-s/2,-n/2,s,n),e.restore()}_renderText(e){super._renderText(e)}initDimensions(){if(this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),!this._skipDimension){if(this._splitText(),this._clearCache(),this.path)this.width=this.path.width,this.height=this.path.height;else{const e=this.width,s=this.calcTextWidth();s>e?this.width=s:this.width=e,this.height=this.height||this.calcTextHeight();const n=this.calcTextHeight();this.isEditing&&n>this.height&&(this.height=n)}this.textAlign&&this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.dirty=!0,this.canvas&&this.canvas.requestRenderAll()}}handlePaste(e){e.preventDefault(),navigator.clipboard.readText().then(s=>{if(!s){console.error("剪贴板中没有文本内容");return}this.insertTextAtCursor(s),this.styles={},this.updateTextDimensions()}).catch(s=>{console.error("读取剪贴板失败:",s)})}handleCopy(e){const s=this.getSelectedText();s&&navigator.clipboard.writeText(s).then(()=>{console.log("文本已成功复制到剪贴板:",s)}).catch(n=>{console.error("复制到剪贴板失败:",n)})}handleEnterKey(e){e.preventDefault(),this.insertTextAtCursor(`
`),this.updateTextDimensions()}insertTextAtCursor(e){const s=this.selectionStart||0,n=this.selectionEnd||0,r=this.text.slice(0,s)+e+this.text.slice(n);this.text=r,this.selectionStart=s+e.length,this.selectionEnd=s+e.length}updateTextDimensions(){var e;this._skipDimension=!1,this.initDimensions(),this.setCoords(),this.dirty=!0,(e=this.canvas)==null||e.requestRenderAll()}showBorder(e){var s;this._showBorder!==e&&(this._showBorder=e,this.dirty=!0,(s=this.canvas)==null||s.requestRenderAll())}increaseFontSize(e=.5){const s=Math.min((this.fontSize||16)+e,720);this.setFontSize(s,!0)}decreaseFontSize(e=.5){const s=Math.max((this.fontSize||16)-e,this._minFontSize);this.setFontSize(s,!0)}setFontSize(e,s=!1){var l;const n=Math.max(Math.min(e,720),this._minFontSize),r=this.width;this.height,this.set("fontSize",n),s&&(this._originalFontSize=n),this._skipDimension=!1;const o=this.calcTextWidth(),a=this.calcTextHeight();(o>r||n>this.fontSize)&&this.set("width",o),this.set("height",a),this.initDimensions(),this.setCoords(),this.dirty=!0,(l=this.canvas)==null||l.requestRenderAll()}setHoverBorderColor(e){this._hoverBorderColor=e,this._showBorder&&this.showBorder(!0)}adjustTextSize(e,s,n){if(!this.canvas)return;const r=this.calcTextWidth(),o=this.calcTextHeight(),a=this.width,l=this.height,c=a/r,h=l/o;if(console.log("容器宽度比例:",c,"容器高度比例:",h),c<1||h<1){const u=Math.min(c,h),f=Math.max(Number((this.fontSize*u).toFixed(3)),this._minFontSize);console.log("文本超出容器，缩小字体到:",f),this.set("fontSize",f)}else if(e&&s&&n){const u=e.width?e.width/s:1,f=e.height?e.height/n:1,d=Math.max(u,f);if(console.log("缩放因子:",d,"当前字号:",this.fontSize),d>1){const p=Math.min(Number((this.fontSize*d).toFixed(3)),this._originalFontSize);console.log("放大字体到:",p),this.set("fontSize",p)}else if(d<1&&(c<1||h<1)){const p=Math.max(Number((this.fontSize*d).toFixed(3)),this._minFontSize);console.log("缩小字体到:",p),this.set("fontSize",p)}}}handleScaling(){if(!this.preventDistortion||!this.canvas)return;let e=!1;const s={},n=this.width,r=this.height;if(this.scaleX!==1&&(s.scaleX=1,s.width=this.width*this.scaleX,e=!0),this.scaleY!==1){s.scaleY=1;const o=this.calcTextHeight()*(this._minFontSize/this.fontSize);s.height=Math.max(this.height*this.scaleY,o),e=!0}e&&(this.set(s),this.setCoords(),this.adjustTextSize(s,n,r))}handleMoving(){this._isMoving=!0,yt.emit(ut.CONTROL_PANEL.HIDE_TEXT_SETTING_TOOLBAR)}handleMoveEnd(){this._isMoving=!1,yt.emit(ut.CONTROL_PANEL.SHOW_TEXT_SETTING_TOOLBAR,{target:this,canvas:this.canvas,canvasManager:_m()})}isObjMoving(){return this._isMoving}};F(Wa,"type","text");let nr=Wa;const Gr=class Gr extends Se{static async create(t,e){return new Promise((s,n)=>{const r={originX:"center",originY:"center",padding:0,...e};Gr.fromURL(t,{crossOrigin:"anonymous"},r).then(o=>{s(o)}).catch(o=>{n(o)})})}constructor(t,e){const s={cornerSize:zs.CORNER_SIZE,cornerColor:Ee.PRIMARY,cornerStyle:"circle",transparentCorners:!1,hasRotatingPoint:!1,padding:0,borderColor:Ee.PRIMARY,lockRotation:!0,lockScalingX:!1,lockScalingY:!1,lockUniScaling:!1,...e};super(t,s),this.setControlsVisibility({mtr:!1}),Object.defineProperty(this,"type",{value:Gr.type,configurable:!1,writable:!1})}};F(Gr,"type","image");let ir=Gr;const Ya=class Ya extends ne{static create(t,e){let s;const n={cornerSize:8,cornerColor:"#1890ff",cornerStyle:"circle",transparentCorners:!1,lockRotation:!0,hasRotatingPoint:!1,padding:0,borderColor:"#1890ff",...e};switch(t){case"square":case"rect":s=new as(n),s.type="rect";break;case"circle":s=new js(n),s.type="circle";break;case"triangle":s=new On(n),s.type="triangle";break;case"line":s=new Tn([0,0,n.width,0],{...n,stroke:n.stroke||"#333",strokeWidth:n.strokeWidth||2}),s.type="line";break;case"arrow":const r=n.width||100,o=20,a=[{x:0,y:0},{x:r-o,y:0},{x:r-o,y:-10},{x:r,y:0},{x:r-o,y:10},{x:r-o,y:0}];s=new os(a,{...n,fill:"transparent",stroke:n.stroke||"#333",strokeWidth:n.strokeWidth||2,strokeLineJoin:"round",strokeLineCap:"round"}),s.type="arrow";break}return s&&(Object.defineProperty(s,"type",{value:Ya.type,configurable:!1,writable:!1}),s.setControlsVisibility({mtr:!1})),s}};F(Ya,"type","shape");let oo=Ya;class FC{constructor(t,e){F(this,"canvas");F(this,"canvasManager");this.canvas=t,this.canvasManager=e,this.initPageFrame()}initPageFrame(){console.warn("initPageFrame",this.canvasManager.getPageFrameManager())}getTargetFrame(){const t=this.canvas.getVpCenter(),e={x:t.x,y:t.y};return this.getFrameContainingPoint(e)}getFrameContainingPoint(t){const e=this.canvasManager.getAllFrames();for(const n of e){const r=n.getBoundingRect();if(t.x>=r.left&&t.x<=r.left+r.width&&t.y>=r.top&&t.y<=r.top+r.height)return n}return this.canvasManager.getPageFrame()}getVisibleCenter(){const t=this.canvas.getVpCenter();return{x:t.x,y:t.y}}async addControl(t,e={}){const s=this.getTargetFrame();if(!s)return console.warn("No active frame and no page frame found"),null;console.log("addControl targetFrame:",s);try{const n=await t(e);return console.log("addControl control:",n),n.set("_originalLeft",n.left-s.left),n.set("_originalTop",n.top-s.top),n.set("_originalAngle",n.angle||0),s instanceof zt&&s.addContent(n),this.canvas.add(Ld(n)),this.canvas.setActiveObject(n),n}catch(n){return console.error("Failed to add control:",n),null}}addText(t={}){const e=this.getVisibleCenter(),s=40,n=this.canvas.getZoom(),r=o=>new nr("双击编辑文本",{left:o.left!==void 0?o.left:e.x,top:o.top!==void 0?o.top:e.y,borderWidth:1/n,lineWidth:zs.BORDER_LINE_WIDTH_TEXT/n,fontSize:Math.round(s/n),...o});return this.addControl(r,t)}addImage(t,e={}){const s=this.getVisibleCenter(),n=this.canvas.getZoom(),r=async o=>await ir.create(t,{left:o.left!==void 0?o.left:s.x,top:o.top!==void 0?o.top:s.y,scaleX:.5/n,scaleY:.5/n,...o});return this.addControl(r,e)}addShape(t,e={}){const s=this.getVisibleCenter();this.canvas.getZoom();const n=r=>{const o={left:r.left!==void 0?r.left:s.x,top:r.top!==void 0?r.top:s.y,...r};console.warn("addShape active frame",oo);const a=oo.create(t,o);if(!a)throw new Error(`Failed to create shape of type: ${t}`);return a};return this.addControl(n,e)}async addClonedObject(t,e={}){const s=this.getVisibleCenter(),n=t.type;if(t instanceof ir){const o=t.getElement().src;return this.addImage(o,{left:e.left!==void 0?e.left:s.x,top:e.top!==void 0?e.top:s.y,scaleX:t.scaleX,scaleY:t.scaleY,angle:t.angle,flipX:t.flipX,flipY:t.flipY,opacity:t.opacity,...e})}else if(n==="text"||t instanceof nr){const r=t;return this.addText({left:e.left!==void 0?e.left:s.x,top:e.top!==void 0?e.top:s.y,text:r.text,fontSize:r.fontSize,fontFamily:r.fontFamily,fontWeight:r.fontWeight,fontStyle:r.fontStyle,textAlign:r.textAlign,fill:r.fill,...e})}else{if(["rect","circle","triangle"].includes(n))return this.addShape(n,{left:e.left!==void 0?e.left:s.x,top:e.top!==void 0?e.top:s.y,width:t.width,height:t.height,fill:t.fill,stroke:t.stroke,strokeWidth:t.strokeWidth,rx:t.rx,ry:t.ry,...e});{console.warn(`未知对象类型: ${n}，使用通用克隆方法`);const r=async o=>{try{const a=await t.clone();return a.set({left:o.left!==void 0?o.left:s.x,top:o.top!==void 0?o.top:s.y,...o}),a}catch(a){throw console.error("克隆对象失败:",a),a}};return this.addControl(r,e)}}}}class Ui extends ro{constructor(e,s){super(e,{...s,...{enableRetinaScaling:!0,renderOnAddRemove:!0,webgl:!0,webglPrecision:"highp"}});F(this,"pageFrameIndex",-1);this.isDraggingObject=!1,this.contextContainer instanceof WebGLRenderingContext?console.log("WebGL 已成功启用"):console.log("使用 Canvas 2D 渲染")}add(...e){let s=0;for(const n of e)n instanceof ce&&(super.insertAt(0,n),this.pageFrameIndex=0,s++),n instanceof zt&&(this.pageFrameIndex>=0?(super.insertAt(this.pageFrameIndex+1,n),s++):(super.add(n),s++)),n instanceof Qt||(this.pageFrameIndex>=0?(super.insertAt(this.pageFrameIndex,n),s++):(super.add(n),s++));return console.log("[CustomCanvas] add 元素",this._objects),this.updatePageFrameIndex(),s}updatePageFrameIndex(){const e=this.getObjects();this.pageFrameIndex=e.findIndex(s=>s instanceof ce),console.log("[CustomCanvas] updatePageFrameIndex",this.pageFrameIndex)}remove(...e){return super.remove(...e)}bringObjectToFront(e){return e instanceof Qt?!1:(this.pageFrameIndex>0&&super.moveObjectTo(e,this.pageFrameIndex-1),console.log("[CustomCanvas] bringObjectToFront 元素",this._objects),!0)}sendObjectToBack(e){return e instanceof Qt?!1:(super.sendObjectToBack(e),console.log("[CustomCanvas] sendObjectToBack 元素",this._objects),!0)}bringObjectForward(e,s){if(e instanceof Qt)return console.warn("Slides元素不支持移动！"),!1;const n=this._objects.indexOf(e);return this.item(n+1)instanceof Qt?(console.warn("上一层已经是Slides元素不能再移动！"),!1):(console.log("[CustomCanvas] bringObjectForward 元素",this._objects),super.bringObjectForward(e,!1))}sendObjectBackwards(e,s){return e instanceof Qt?(console.warn("Slides元素不支持移动！"),!1):(console.log("[CustomCanvas] sendObjectBackwards 元素",this._objects),super.sendObjectBackwards(e,s))}}F(Ui,"type","CustomCanvas");class DC{static getPageFrameMenuItems(t){return[{label:"插入一页",action:t.insertFrame},{label:"更换背景",action:t.changeBackground},{label:"更换配色",action:t.changeColorScheme},{label:"插入文本",action:t.insertText},{label:"插入图片",action:t.insertImage}]}static getCanvasMenuItems(t){return[{label:"插入一页",action:t.insertFrame},{label:"粘贴",action:t.paste},{label:"更换背景",action:t.changeBackground},{label:"更换配色",action:t.changeColorScheme},{label:"插入文本",action:t.insertText},{label:"插入图片",action:t.insertImage},{separator:!0,label:"",action:()=>{}},{label:"开始演示",action:t.startPresentation}]}static getFrameMenuItems(t){return[{label:"向上一层",action:()=>t.moveLayer("up")},{label:"向下一层",action:()=>t.moveLayer("down")},{label:"置于顶层",action:()=>t.moveLayer("top")},{label:"置于底层",action:()=>t.moveLayer("bottom")},{separator:!0,label:"",action:()=>{}},{label:"插入文本",action:t.insertText},{label:"插入图片",action:t.insertImage},{label:"插入形状",action:t.insertShape},{separator:!0,label:"",action:()=>{}},{label:"复制",action:t.copyObject},{label:"剪切",action:t.cutObject},{label:"删除",action:t.deleteObject}]}static getContentMenuItems(t){return[{label:"向上一层",action:()=>t.moveLayer("up")},{label:"向下一层",action:()=>t.moveLayer("down")},{label:"置于顶层",action:()=>t.moveLayer("top")},{label:"置于底层",action:()=>t.moveLayer("bottom")},{separator:!0,label:"",action:()=>{}},{label:"复制",action:t.copyObject},{label:"剪切",action:t.cutObject},{label:"删除",action:t.deleteObject}]}static getAllMenuItems(t){const e=new Map;return e.set(ce.type,this.getPageFrameMenuItems(t)),e.set(Ui.type,this.getCanvasMenuItems(t)),e.set(zt.type,this.getFrameMenuItems(t)),e.set(nr.type,this.getContentMenuItems(t)),e.set(ir.type,this.getContentMenuItems(t)),e.set(oo.type,this.getContentMenuItems(t)),e}}class RC{constructor(t){F(this,"context");this.context=t}handleInsertFrame(t){t.position}handleDeleteFrame(t){if(!t.target)return;const e=t.target;this.context.canvasManager.getFrameManager().deleteFrame(e.id)}}class LC{constructor(t){F(this,"context");this.context=t}handleChangeBackground(t){yt.emit(ut.CONTROL_PANEL.OPEN,{type:ut.PANEL_TYPE.BACKGROUND_IMAGE,canvas:this.context.canvas,target:t.target,position:t.position})}handleChangeColorScheme(t){console.log("更换配色方案",t),yt.emit(ut.CONTROL_PANEL.OPEN,{type:ut.PANEL_TYPE.BACKGROUND_COLOR,canvas:this.context.canvas,target:t.target,position:t.position})}}class jC{constructor(t){F(this,"context");this.context=t}handleInsertText(t){var e,s;t.position&&((s=(e=this.context.canvasManager)==null?void 0:e.getControlsManager())==null||s.addText({left:t.position.x,top:t.position.y}))}handleInsertImage(t){yt.emit(ut.CONTROL_PANEL.OPEN,{type:ut.PANEL_TYPE.INSERT_IMAGE,canvas:this.context.canvas,canvasManager:this.context.canvasManager,target:t.target,position:t.position})}handleCopyObject(t){if(!t.target)return;const e=new KeyboardEvent("keydown",{key:"c",code:"KeyC",ctrlKey:!0,bubbles:!0});document.dispatchEvent(e)}handleCutObject(t){t.target}handlePaste(t){if(!t.position)return;console.log("鼠标右键 粘贴事件触发");const e=new KeyboardEvent("keydown",{key:"v",code:"KeyV",ctrlKey:!0,bubbles:!0});document.dispatchEvent(e)}handleDeleteObject(t){t.target&&this.context.canvasManager.removeObject(t.target)}handleInsertShape(t){}}class IC{constructor(t){F(this,"context");this.context=t}handleMoveLayer(t,e){t.target&&this.moveActiveObject(e,t.target)}moveActiveObject(t,e){const s=e;if(s)switch(t){case"up":this.context.canvas.bringObjectForward(s,!1);break;case"down":this.context.canvas.sendObjectBackwards(s,!1);break;case"top":this.context.canvas.bringObjectToFront(s);break;case"bottom":this.context.canvas.sendObjectToBack(s);break}}}class BC{constructor(t){F(this,"context");this.context=t}handleStartPresentation(t){}}class NC{constructor(t){F(this,"frame");F(this,"background");F(this,"content");F(this,"layer");F(this,"presentation");this.frame=new RC(t),this.background=new LC(t),this.content=new jC(t),this.layer=new IC(t),this.presentation=new BC(t)}}class HC{constructor(t,e){F(this,"canvas");F(this,"menuElement");F(this,"menuItems");F(this,"handlerManager");F(this,"canvasManager");F(this,"lastEvent",null);F(this,"handleMouseDown",t=>{if(t.button===2){this.lastEvent=t,t.preventDefault();let e=this.canvas.findTarget(t);e||(e=this.canvas),e?(e instanceof Ui||this.canvas.setActiveObject(e),this.showContextMenu(t,e)):this.showCanvasContextMenu(t)}});this.canvas=t,this.canvasManager=e,this.menuElement=this.createMenuElement(),this.menuItems=this.initializeMenuItems(),this.handlerManager=new NC({canvas:t,canvasManager:e,contextMenuManager:this}),this.initializeEventListeners()}createMenuElement(){const t=document.createElement("div");return t.style.position="fixed",t.style.display="none",t.style.backgroundColor="#ffffff",t.style.boxShadow="0 2px 8px rgba(0,0,0,0.15)",t.style.borderRadius="4px",t.style.padding="4px 0",t.style.zIndex="1000",document.body.appendChild(t),t}initializeMenuItems(){const t={insertFrame:()=>this.insertFrame(),changeBackground:()=>this.changeBackground(),changeColorScheme:()=>this.changeColorScheme(),insertText:()=>this.insertText(),insertImage:()=>this.insertImage(),paste:()=>this.paste(),copyObject:()=>this.copyObject(),cutObject:()=>this.cutObject(),deleteObject:()=>this.deleteObject(),moveLayer:e=>this.moveActiveObject(e),startPresentation:()=>this.startPresentation(),insertShape:()=>this.insertShape()};return DC.getAllMenuItems(t)}createMenuItem(t){if(t.separator){const s=document.createElement("div");return s.style.height="1px",s.style.backgroundColor="#e8e8e8",s.style.margin="4px 0",s}const e=document.createElement("div");if(e.textContent=t.label,e.style.padding="8px 16px",e.style.cursor=t.disabled?"not-allowed":"pointer",e.style.fontSize="14px",e.style.userSelect="none",e.style.color=t.disabled?"#bfbfbf":"#000000",e.style.display="flex",e.style.alignItems="center",t.icon){const s=document.createElement("span");s.innerHTML=t.icon,s.style.marginRight="8px",e.prepend(s)}return t.disabled||(e.addEventListener("mouseover",()=>{e.style.backgroundColor="#f5f5f5"}),e.addEventListener("mouseout",()=>{e.style.backgroundColor="transparent"}),e.addEventListener("click",t.action)),e}initializeEventListeners(){const t=this.canvas.upperCanvasEl;t.addEventListener("contextmenu",e=>(e.preventDefault(),!1),!1),t.addEventListener("mousedown",this.handleMouseDown),document.addEventListener("click",()=>{this.hideContextMenu()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&this.hideContextMenu()})}showCanvasContextMenu(t){const e=this.menuItems.get("canvas")||[];this.renderContextMenu(t,e)}showContextMenu(t,e){let s;e instanceof ce?s=ce.type:e instanceof zt?s=zt.type:e instanceof Ui?s=Ui.type:s=nr.type;const n=this.menuItems.get(s)||[];this.renderContextMenu(t,n)}renderContextMenu(t,e){this.menuElement.innerHTML="",e.forEach(l=>{this.menuElement.appendChild(this.createMenuItem(l))});const s=t.clientX,n=t.clientY;this.menuElement.style.left=`${s}px`,this.menuElement.style.top=`${n}px`,this.menuElement.style.display="block";const r=this.menuElement.getBoundingClientRect(),o=window.innerWidth,a=window.innerHeight;r.right>o&&(this.menuElement.style.left=`${s-r.width}px`),r.bottom>a&&(this.menuElement.style.top=`${n-r.height}px`)}hideContextMenu(){this.menuElement.style.display="none"}getCurrentPosition(){if(this.lastEvent)return this.canvas.getPointer(this.lastEvent)}moveActiveObject(t){const e=this.canvas.getActiveObject();if(!e)return;const s=this.getCurrentPosition(),n={canvas:this.canvas,target:e,position:s};this.handlerManager.layer.handleMoveLayer(n,t),this.hideContextMenu()}insertFrame(){const t=this.getCurrentPosition();if(!t)return;const e={canvas:this.canvas,position:t,target:this.canvas.getActiveObject()};this.handlerManager.frame.handleInsertFrame(e),this.hideContextMenu()}changeBackground(){const t={canvas:this.canvas,target:this.canvas.getActiveObject(),position:this.getCurrentPosition()};this.handlerManager.background.handleChangeBackground(t),this.hideContextMenu()}changeColorScheme(){const t={canvas:this.canvas,target:this.canvas.getActiveObject(),position:this.getCurrentPosition()};this.handlerManager.background.handleChangeColorScheme(t),this.hideContextMenu()}insertText(){const t=this.getCurrentPosition();if(!t)return;const e={canvas:this.canvas,target:this.canvas.getActiveObject(),position:t};this.handlerManager.content.handleInsertText(e),this.hideContextMenu()}insertImage(){const t={canvas:this.canvas,target:this.canvas.getActiveObject(),position:this.getCurrentPosition()};this.handlerManager.content.handleInsertImage(t),this.hideContextMenu()}insertShape(){const t={canvas:this.canvas,target:this.canvas.getActiveObject(),position:this.getCurrentPosition()};this.handlerManager.content.handleInsertShape(t),this.hideContextMenu()}paste(){const t=this.getCurrentPosition();if(!t)return;const e={canvas:this.canvas,target:this.canvas.getActiveObject(),position:t};this.handlerManager.content.handlePaste(e),this.hideContextMenu()}copyObject(){const t=this.canvas.getActiveObject();if(!t)return;const e={canvas:this.canvas,target:t,position:this.getCurrentPosition()};this.handlerManager.content.handleCopyObject(e),this.hideContextMenu()}cutObject(){const t=this.canvas.getActiveObject();if(!t)return;const e={canvas:this.canvas,target:t,position:this.getCurrentPosition()};this.handlerManager.content.handleCutObject(e),this.hideContextMenu()}deleteObject(){const t=this.canvas.getActiveObject();if(!t)return;const e={canvas:this.canvas,target:t,position:this.getCurrentPosition()};t instanceof zt?this.handlerManager.frame.handleDeleteFrame(e):this.handlerManager.content.handleDeleteObject(e),this.hideContextMenu()}startPresentation(){const t={canvas:this.canvas,target:this.canvas.getActiveObject(),position:this.getCurrentPosition()};this.handlerManager.presentation.handleStartPresentation(t),this.hideContextMenu()}destroy(){const t=this.canvas.upperCanvasEl;t.removeEventListener("contextmenu",e=>e.preventDefault()),t.removeEventListener("mousedown",this.handleMouseDown),document.removeEventListener("click",this.hideContextMenu),this.menuElement&&this.menuElement.parentNode&&this.menuElement.parentNode.removeChild(this.menuElement)}}const mr={margin:4,width:1,color:"rgb(255,0,0,0.9)"};function bm(i,t){return Math.abs(i-t)}function zC(i,t,e){const s=i.translateToCenterPoint(t,"center","center"),n=i.translateToOriginPoint(s,i.originX,i.originY);e=="x"?i.setX(n.x):i.setY(n.y)}const VC=["left","center","right"],WC=["top","center","bottom"];function YC(i){var y;const t=mr.margin,{activeObject:e,isScale:s,index:n,point:r,list:o}=i,{dis:a,arr:l}=xm(r,o,"x"),c=t/(((y=e.canvas)==null?void 0:y.getZoom())??1);if(a>c)return[];let h=l[l.length-1].x-r.x;const u=n==0||n==3?-1:1;h*=u;const{width:f,scaleX:d,left:p}=e,g=e._getTransformedDimensions(),m=(h+g.x)/g.x;s?e.set("scaleX",d*m):e.set("width",f*m);const v=[0,h/2*u,h*u];u<0&&v.reverse();const _=v[VC.indexOf(e.originX)];return e.set("left",p+_),e.setCoords(),l.map(b=>({x:b.x,y1:b.y,y2:r.y}))}function XC(i){var y;const t=mr.margin,{activeObject:e,isScale:s,index:n,point:r,list:o}=i,{dis:a,arr:l}=xm(r,o,"y"),c=t/(((y=e.canvas)==null?void 0:y.getZoom())??1);if(a>c)return[];let h=l[l.length-1].y-r.y;const u=n<2?-1:1;h*=u;const{height:f,scaleY:d,top:p}=e,g=e._getTransformedDimensions(),m=(h+g.y)/g.y;s?e.set("scaleY",d*m):e.set("height",f*m);const v=[0,h/2*u,h*u];u<0&&v.reverse();const _=v[WC.indexOf(e.originY)];return e.set("top",p+_),e.setCoords(),l.map(b=>({y:b.y,x1:b.x,x2:r.x}))}function xm(i,t,e){let s=1/0,n=[];for(const r of t){const o=bm(i[e],r[e]);s>o&&(n=[],s=o),s==o&&n.push(r)}return{dis:s,arr:n}}function Cm(i,t,e){const{width:s,color:n}=mr,r=i.getSelectionContext(),o=i.viewportTransform,a=i.getZoom();r.save(),r.transform(...o),r.lineWidth=s/a,r.strokeStyle=n,r.beginPath(),r.moveTo(t.x,t.y),r.lineTo(e.x,e.y),r.stroke(),zc(r,a,t),zc(r,a,e),r.restore()}const UC=2.4;function zc(i,t,e){const s=UC/t;i.save(),i.translate(e.x,e.y),i.beginPath(),i.moveTo(-s,-s),i.lineTo(s,s),i.moveTo(s,-s),i.lineTo(-s,s),i.stroke(),i.restore()}function GC(i,t){const{width:e,color:s}=mr,n=i.getSelectionContext(),r=i.viewportTransform,o=i.getZoom();n.save(),n.transform(...r),n.lineWidth=e/o,n.strokeStyle=s;for(const a of t)zc(n,o,a);n.restore()}function $C(i,t){const e=t.map(s=>{const n="y2"in s,r=n?s.x:s.x1,o=n?s.y1:s.y;return new E(r,o)});GC(i,e)}function qC(i,t){const e=t.x,s=new E(e,t.y1),n=new E(e,t.y2);Cm(i,s,n)}function KC(i,t){const e=t.y,s=new E(t.x1,e),n=new E(t.x2,e);Cm(i,s,n)}function Wf(i){const t=new Set,e=i.canvas;if(!e)return t;const s=i instanceof Mn?i.getObjects():[i];return e.forEachObject(n=>{if(n.isOnScreen()&&n.visible){if(n.constructor==gs){wm(t,n);return}t.add(n)}}),Sm(t,s),t}function Sm(i,t){for(const e of t)e.constructor==gs?Sm(i,e.getObjects()):i.delete(e)}function wm(i,t){const e=t.getObjects();for(const s of e)if(s.visible){if(s.constructor==gs){wm(i,s);continue}i.add(s)}}function ZC(i){var u;const t=mr.margin,{activeObject:e,activeObjectRect:s,objectRect:n}=i,r=Yf(n),o=Yf(s),a=t/(((u=e.canvas)==null?void 0:u.getZoom())??1),l={target:e,list:r,aList:o,margin:a},c=JC(l),h=QC(l);return{vLines:c,hLines:h}}function JC(i){const{target:t,list:e,aList:s,margin:n}=i,r=s.map(u=>Tm(u,e,"x")),o=Math.min(...r.map(u=>u.dis));if(o>n)return[];const a=[],l=s[0].x2-s[0].x,c=s[0].y2-s[0].y;let h=!1;for(let u=0;u<r.length;u++){const f=r[u];if(o==f.dis){const d=e[f.index],p=s[f.index],g=d.x,m=p.y,v=Math.min(d.y,d.y2,m,p.y2),_=Math.max(d.y,d.y2,m,p.y2);if(a.push({x:g,y1:v,y2:_}),h)continue;h=!0,Om({target:t,x:g,y:m,centerX:u-1,centerY:f.index-1,width:l,height:c,dir:"x"});const y=o*f.dir;s.forEach(b=>b.x-=y)}}return a}function QC(i){const{target:t,list:e,aList:s,margin:n}=i,r=s.map(u=>Tm(u,e,"y")),o=Math.min(...r.map(u=>u.dis));if(o>n)return[];const a=[],l=s[0].x2-s[0].x,c=s[0].y2-s[0].y;let h=!1;for(let u=0;u<r.length;u++){const f=r[u];if(o==f.dis){const d=e[f.index],p=s[f.index],g=d.y,m=p.x,v=Math.min(d.x,d.x2,m,p.x2),_=Math.max(d.x,d.x2,m,p.x2);if(a.push({y:g,x1:v,x2:_}),h)continue;h=!0,Om({target:t,x:m,y:g,centerX:f.index-1,centerY:u-1,width:l,height:c,dir:"y"});const y=o*f.dir;s.forEach(b=>b.y-=y)}}return a}function Tm(i,t,e){let s=1/0,n=-1,r=1;for(let o=0;o<t.length;o++){const a=bm(i[e],t[o][e]);s>a&&(n=o,s=a,r=i[e]>t[o][e]?1:-1)}return{dis:s,index:n,dir:r}}function Yf(i){const{left:t,top:e,width:s,height:n}=i,r={x:t,y:e,x2:t+s,y2:e+n},o=t+s/2,a=e+n/2,l={x:o,y:a,x2:o,y2:a},c={x:t+s,x2:t,y:e+n,y2:e};return[r,l,c]}function Om(i){const{target:t,centerX:e,centerY:s,width:n,height:r,dir:o}=i;let{x:a,y:l}=i;a-=e*n/2,l-=s*r/2,zC(t,new E(a,l),o),t.setCoords()}function tS(i,t={}){Object.assign(mr,t);const e=new Set,s=new Set;let n=!1;const r=new Map,o=f=>{const d=[f.calcTransformMatrix().toString(),f.width,f.height].join(),p=r.get(d);if(p)return p;const g=f.getCoords(),v=[Dn.makeBoundingBoxFromPoints(g),g];return r.set(d,v),v};function a(f){const d=f.target;d.setCoords(),n=!1,s.clear(),e.clear();const p=Wf(d),g=d.getBoundingRect();for(const m of p){const v=o(m)[0],{vLines:_,hLines:y}=ZC({activeObject:d,activeObjectRect:g,objectRect:v});_.forEach(b=>{s.add(JSON.stringify(b))}),y.forEach(b=>{e.add(JSON.stringify(b))})}}function l(f){const d=f.target;d.setCoords();const p=String(f.transform.action).startsWith("scale");s.clear(),e.clear();const g=Wf(d);let m=f.transform.corner;d.flipX&&(m=m.replace("l","r").replace("r","l")),d.flipY&&(m=m.replace("t","b").replace("b","t"));let v=["tl","tr","br","bl","mt","mr","mb","ml"].indexOf(m);if(v==-1)return;if(n=v>3,n){if(d.getTotalAngle()%90!=0)return;v-=4}let _=d.getCoords()[v];for(const y of g){const[b,S]=o(y),P=new E(b.left+b.width/2,b.top+b.height/2),O=[...S,P],k={activeObject:d,point:_,list:O,isScale:p,index:v},D=YC(k),z=XC(k);D.forEach(K=>{s.add(JSON.stringify(K))}),z.forEach(K=>{e.add(JSON.stringify(K))}),(D.length||z.length)&&(_=d.getCoords()[v])}}function c(){i.clearContext(i.contextTop)}function h(){if(n){const f=[];for(const d of s)f.push(JSON.parse(d));for(const d of e)f.push(JSON.parse(d));$C(i,f)}else{for(const f of s)qC(i,JSON.parse(f));for(const f of e)KC(i,JSON.parse(f))}}function u(){s.clear(),e.clear(),r.clear(),i.requestRenderAll()}return i.on("object:resizing",l),i.on("object:scaling",l),i.on("object:moving",a),i.on("before:render",c),i.on("after:render",h),i.on("mouse:up",u),()=>{i.off("object:resizing",l),i.off("object:scaling",l),i.off("object:moving",a),i.off("before:render",c),i.off("after:render",h),i.off("mouse:up",u)}}function sn(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function Mm(i,t){i.prototype=Object.create(t.prototype),i.prototype.constructor=i,i.__proto__=t}/*!
 * GSAP 3.12.7
 * https://gsap.com
 *
 * @license Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license or for
 * Club GSAP members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var Qe={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},rr={duration:.5,overwrite:!1,delay:0},Xh,le,Lt,Us=1e8,me=1/Us,Vc=Math.PI*2,eS=Vc/4,sS=0,Em=Math.sqrt,nS=Math.cos,iS=Math.sin,ie=function(t){return typeof t=="string"},Ut=function(t){return typeof t=="function"},dn=function(t){return typeof t=="number"},Uh=function(t){return typeof t>"u"},Zs=function(t){return typeof t=="object"},je=function(t){return t!==!1},Gh=function(){return typeof window<"u"},Zo=function(t){return Ut(t)||ie(t)},km=typeof ArrayBuffer=="function"&&ArrayBuffer.isView||function(){},_e=Array.isArray,Wc=/(?:-?\.?\d|\.)+/gi,Pm=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,Li=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,Ql=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,Am=/[+-]=-?[.\d]+/,Fm=/[^,'"\[\]\s]+/gi,rS=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,Nt,Rs,Yc,$h,ss={},Ra={},Dm,Rm=function(t){return(Ra=or(t,ss))&&He},qh=function(t,e){return console.warn("Invalid property",t,"set to",e,"Missing plugin? gsap.registerPlugin()")},ao=function(t,e){return!e&&console.warn(t)},Lm=function(t,e){return t&&(ss[t]=e)&&Ra&&(Ra[t]=e)||ss},lo=function(){return 0},oS={suppressEvents:!0,isStart:!0,kill:!1},oa={suppressEvents:!0,kill:!1},aS={suppressEvents:!0},Kh={},Rn=[],Xc={},jm,Ge={},tc={},Xf=30,aa=[],Zh="",Jh=function(t){var e=t[0],s,n;if(Zs(e)||Ut(e)||(t=[t]),!(s=(e._gsap||{}).harness)){for(n=aa.length;n--&&!aa[n].targetTest(e););s=aa[n]}for(n=t.length;n--;)t[n]&&(t[n]._gsap||(t[n]._gsap=new ov(t[n],s)))||t.splice(n,1);return t},hi=function(t){return t._gsap||Jh(hs(t))[0]._gsap},Im=function(t,e,s){return(s=t[e])&&Ut(s)?t[e]():Uh(s)&&t.getAttribute&&t.getAttribute(e)||s},Ie=function(t,e){return(t=t.split(",")).forEach(e)||t},Gt=function(t){return Math.round(t*1e5)/1e5||0},Zt=function(t){return Math.round(t*1e7)/1e7||0},Gi=function(t,e){var s=e.charAt(0),n=parseFloat(e.substr(2));return t=parseFloat(t),s==="+"?t+n:s==="-"?t-n:s==="*"?t*n:t/n},lS=function(t,e){for(var s=e.length,n=0;t.indexOf(e[n])<0&&++n<s;);return n<s},La=function(){var t=Rn.length,e=Rn.slice(0),s,n;for(Xc={},Rn.length=0,s=0;s<t;s++)n=e[s],n&&n._lazy&&(n.render(n._lazy[0],n._lazy[1],!0)._lazy=0)},Bm=function(t,e,s,n){Rn.length&&!le&&La(),t.render(e,s,le&&e<0&&(t._initted||t._startAt)),Rn.length&&!le&&La()},Nm=function(t){var e=parseFloat(t);return(e||e===0)&&(t+"").match(Fm).length<2?e:ie(t)?t.trim():t},Hm=function(t){return t},ns=function(t,e){for(var s in e)s in t||(t[s]=e[s]);return t},cS=function(t){return function(e,s){for(var n in s)n in e||n==="duration"&&t||n==="ease"||(e[n]=s[n])}},or=function(t,e){for(var s in e)t[s]=e[s];return t},Uf=function i(t,e){for(var s in e)s!=="__proto__"&&s!=="constructor"&&s!=="prototype"&&(t[s]=Zs(e[s])?i(t[s]||(t[s]={}),e[s]):e[s]);return t},ja=function(t,e){var s={},n;for(n in t)n in e||(s[n]=t[n]);return s},Yr=function(t){var e=t.parent||Nt,s=t.keyframes?cS(_e(t.keyframes)):ns;if(je(t.inherit))for(;e;)s(t,e.vars.defaults),e=e.parent||e._dp;return t},hS=function(t,e){for(var s=t.length,n=s===e.length;n&&s--&&t[s]===e[s];);return s<0},zm=function(t,e,s,n,r){var o=t[n],a;if(r)for(a=e[r];o&&o[r]>a;)o=o._prev;return o?(e._next=o._next,o._next=e):(e._next=t[s],t[s]=e),e._next?e._next._prev=e:t[n]=e,e._prev=o,e.parent=e._dp=t,e},xl=function(t,e,s,n){s===void 0&&(s="_first"),n===void 0&&(n="_last");var r=e._prev,o=e._next;r?r._next=o:t[s]===e&&(t[s]=o),o?o._prev=r:t[n]===e&&(t[n]=r),e._next=e._prev=e.parent=null},Hn=function(t,e){t.parent&&(!e||t.parent.autoRemoveChildren)&&t.parent.remove&&t.parent.remove(t),t._act=0},ui=function(t,e){if(t&&(!e||e._end>t._dur||e._start<0))for(var s=t;s;)s._dirty=1,s=s.parent;return t},uS=function(t){for(var e=t.parent;e&&e.parent;)e._dirty=1,e.totalDuration(),e=e.parent;return t},Uc=function(t,e,s,n){return t._startAt&&(le?t._startAt.revert(oa):t.vars.immediateRender&&!t.vars.autoRevert||t._startAt.render(e,!0,n))},fS=function i(t){return!t||t._ts&&i(t.parent)},Gf=function(t){return t._repeat?ar(t._tTime,t=t.duration()+t._rDelay)*t:0},ar=function(t,e){var s=Math.floor(t=Zt(t/e));return t&&s===t?s-1:s},Ia=function(t,e){return(t-e._start)*e._ts+(e._ts>=0?0:e._dirty?e.totalDuration():e._tDur)},Cl=function(t){return t._end=Zt(t._start+(t._tDur/Math.abs(t._ts||t._rts||me)||0))},Sl=function(t,e){var s=t._dp;return s&&s.smoothChildTiming&&t._ts&&(t._start=Zt(s._time-(t._ts>0?e/t._ts:((t._dirty?t.totalDuration():t._tDur)-e)/-t._ts)),Cl(t),s._dirty||ui(s,t)),t},Vm=function(t,e){var s;if((e._time||!e._dur&&e._initted||e._start<t._time&&(e._dur||!e.add))&&(s=Ia(t.rawTime(),e),(!e._dur||Co(0,e.totalDuration(),s)-e._tTime>me)&&e.render(s,!0)),ui(t,e)._dp&&t._initted&&t._time>=t._dur&&t._ts){if(t._dur<t.duration())for(s=t;s._dp;)s.rawTime()>=0&&s.totalTime(s._tTime),s=s._dp;t._zTime=-1e-8}},Bs=function(t,e,s,n){return e.parent&&Hn(e),e._start=Zt((dn(s)?s:s||t!==Nt?rs(t,s,e):t._time)+e._delay),e._end=Zt(e._start+(e.totalDuration()/Math.abs(e.timeScale())||0)),zm(t,e,"_first","_last",t._sort?"_start":0),Gc(e)||(t._recent=e),n||Vm(t,e),t._ts<0&&Sl(t,t._tTime),t},Wm=function(t,e){return(ss.ScrollTrigger||qh("scrollTrigger",e))&&ss.ScrollTrigger.create(e,t)},Ym=function(t,e,s,n,r){if(tu(t,e,r),!t._initted)return 1;if(!s&&t._pt&&!le&&(t._dur&&t.vars.lazy!==!1||!t._dur&&t.vars.lazy)&&jm!==qe.frame)return Rn.push(t),t._lazy=[r,n],1},dS=function i(t){var e=t.parent;return e&&e._ts&&e._initted&&!e._lock&&(e.rawTime()<0||i(e))},Gc=function(t){var e=t.data;return e==="isFromStart"||e==="isStart"},gS=function(t,e,s,n){var r=t.ratio,o=e<0||!e&&(!t._start&&dS(t)&&!(!t._initted&&Gc(t))||(t._ts<0||t._dp._ts<0)&&!Gc(t))?0:1,a=t._rDelay,l=0,c,h,u;if(a&&t._repeat&&(l=Co(0,t._tDur,e),h=ar(l,a),t._yoyo&&h&1&&(o=1-o),h!==ar(t._tTime,a)&&(r=1-o,t.vars.repeatRefresh&&t._initted&&t.invalidate())),o!==r||le||n||t._zTime===me||!e&&t._zTime){if(!t._initted&&Ym(t,e,n,s,l))return;for(u=t._zTime,t._zTime=e||(s?me:0),s||(s=e&&!u),t.ratio=o,t._from&&(o=1-o),t._time=0,t._tTime=l,c=t._pt;c;)c.r(o,c.d),c=c._next;e<0&&Uc(t,e,s,!0),t._onUpdate&&!s&&Ze(t,"onUpdate"),l&&t._repeat&&!s&&t.parent&&Ze(t,"onRepeat"),(e>=t._tDur||e<0)&&t.ratio===o&&(o&&Hn(t,1),!s&&!le&&(Ze(t,o?"onComplete":"onReverseComplete",!0),t._prom&&t._prom()))}else t._zTime||(t._zTime=e)},pS=function(t,e,s){var n;if(s>e)for(n=t._first;n&&n._start<=s;){if(n.data==="isPause"&&n._start>e)return n;n=n._next}else for(n=t._last;n&&n._start>=s;){if(n.data==="isPause"&&n._start<e)return n;n=n._prev}},lr=function(t,e,s,n){var r=t._repeat,o=Zt(e)||0,a=t._tTime/t._tDur;return a&&!n&&(t._time*=o/t._dur),t._dur=o,t._tDur=r?r<0?1e10:Zt(o*(r+1)+t._rDelay*r):o,a>0&&!n&&Sl(t,t._tTime=t._tDur*a),t.parent&&Cl(t),s||ui(t.parent,t),t},$f=function(t){return t instanceof Oe?ui(t):lr(t,t._dur)},mS={_start:0,endTime:lo,totalDuration:lo},rs=function i(t,e,s){var n=t.labels,r=t._recent||mS,o=t.duration()>=Us?r.endTime(!1):t._dur,a,l,c;return ie(e)&&(isNaN(e)||e in n)?(l=e.charAt(0),c=e.substr(-1)==="%",a=e.indexOf("="),l==="<"||l===">"?(a>=0&&(e=e.replace(/=/,"")),(l==="<"?r._start:r.endTime(r._repeat>=0))+(parseFloat(e.substr(1))||0)*(c?(a<0?r:s).totalDuration()/100:1)):a<0?(e in n||(n[e]=o),n[e]):(l=parseFloat(e.charAt(a-1)+e.substr(a+1)),c&&s&&(l=l/100*(_e(s)?s[0]:s).totalDuration()),a>1?i(t,e.substr(0,a-1),s)+l:o+l)):e==null?o:+e},Xr=function(t,e,s){var n=dn(e[1]),r=(n?2:1)+(t<2?0:1),o=e[r],a,l;if(n&&(o.duration=e[1]),o.parent=s,t){for(a=o,l=s;l&&!("immediateRender"in a);)a=l.vars.defaults||{},l=je(l.vars.inherit)&&l.parent;o.immediateRender=je(a.immediateRender),t<2?o.runBackwards=1:o.startAt=e[r-1]}return new Kt(e[0],o,e[r+1])},Gn=function(t,e){return t||t===0?e(t):e},Co=function(t,e,s){return s<t?t:s>e?e:s},ge=function(t,e){return!ie(t)||!(e=rS.exec(t))?"":e[1]},vS=function(t,e,s){return Gn(s,function(n){return Co(t,e,n)})},$c=[].slice,Xm=function(t,e){return t&&Zs(t)&&"length"in t&&(!e&&!t.length||t.length-1 in t&&Zs(t[0]))&&!t.nodeType&&t!==Rs},_S=function(t,e,s){return s===void 0&&(s=[]),t.forEach(function(n){var r;return ie(n)&&!e||Xm(n,1)?(r=s).push.apply(r,hs(n)):s.push(n)})||s},hs=function(t,e,s){return Lt&&!e&&Lt.selector?Lt.selector(t):ie(t)&&!s&&(Yc||!cr())?$c.call((e||$h).querySelectorAll(t),0):_e(t)?_S(t,s):Xm(t)?$c.call(t,0):t?[t]:[]},qc=function(t){return t=hs(t)[0]||ao("Invalid scope")||{},function(e){var s=t.current||t.nativeElement||t;return hs(e,s.querySelectorAll?s:s===t?ao("Invalid scope")||$h.createElement("div"):t)}},Um=function(t){return t.sort(function(){return .5-Math.random()})},Gm=function(t){if(Ut(t))return t;var e=Zs(t)?t:{each:t},s=fi(e.ease),n=e.from||0,r=parseFloat(e.base)||0,o={},a=n>0&&n<1,l=isNaN(n)||a,c=e.axis,h=n,u=n;return ie(n)?h=u={center:.5,edges:.5,end:1}[n]||0:!a&&l&&(h=n[0],u=n[1]),function(f,d,p){var g=(p||e).length,m=o[g],v,_,y,b,S,P,O,k,D;if(!m){if(D=e.grid==="auto"?0:(e.grid||[1,Us])[1],!D){for(O=-1e8;O<(O=p[D++].getBoundingClientRect().left)&&D<g;);D<g&&D--}for(m=o[g]=[],v=l?Math.min(D,g)*h-.5:n%D,_=D===Us?0:l?g*u/D-.5:n/D|0,O=0,k=Us,P=0;P<g;P++)y=P%D-v,b=_-(P/D|0),m[P]=S=c?Math.abs(c==="y"?b:y):Em(y*y+b*b),S>O&&(O=S),S<k&&(k=S);n==="random"&&Um(m),m.max=O-k,m.min=k,m.v=g=(parseFloat(e.amount)||parseFloat(e.each)*(D>g?g-1:c?c==="y"?g/D:D:Math.max(D,g/D))||0)*(n==="edges"?-1:1),m.b=g<0?r-g:r,m.u=ge(e.amount||e.each)||0,s=s&&g<0?nv(s):s}return g=(m[f]-m.min)/m.max||0,Zt(m.b+(s?s(g):g)*m.v)+m.u}},Kc=function(t){var e=Math.pow(10,((t+"").split(".")[1]||"").length);return function(s){var n=Zt(Math.round(parseFloat(s)/t)*t*e);return(n-n%1)/e+(dn(s)?0:ge(s))}},$m=function(t,e){var s=_e(t),n,r;return!s&&Zs(t)&&(n=s=t.radius||Us,t.values?(t=hs(t.values),(r=!dn(t[0]))&&(n*=n)):t=Kc(t.increment)),Gn(e,s?Ut(t)?function(o){return r=t(o),Math.abs(r-o)<=n?r:o}:function(o){for(var a=parseFloat(r?o.x:o),l=parseFloat(r?o.y:0),c=Us,h=0,u=t.length,f,d;u--;)r?(f=t[u].x-a,d=t[u].y-l,f=f*f+d*d):f=Math.abs(t[u]-a),f<c&&(c=f,h=u);return h=!n||c<=n?t[h]:o,r||h===o||dn(o)?h:h+ge(o)}:Kc(t))},qm=function(t,e,s,n){return Gn(_e(t)?!e:s===!0?!!(s=0):!n,function(){return _e(t)?t[~~(Math.random()*t.length)]:(s=s||1e-5)&&(n=s<1?Math.pow(10,(s+"").length-2):1)&&Math.floor(Math.round((t-s/2+Math.random()*(e-t+s*.99))/s)*s*n)/n})},yS=function(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];return function(n){return e.reduce(function(r,o){return o(r)},n)}},bS=function(t,e){return function(s){return t(parseFloat(s))+(e||ge(s))}},xS=function(t,e,s){return Zm(t,e,0,1,s)},Km=function(t,e,s){return Gn(s,function(n){return t[~~e(n)]})},CS=function i(t,e,s){var n=e-t;return _e(t)?Km(t,i(0,t.length),e):Gn(s,function(r){return(n+(r-t)%n)%n+t})},SS=function i(t,e,s){var n=e-t,r=n*2;return _e(t)?Km(t,i(0,t.length-1),e):Gn(s,function(o){return o=(r+(o-t)%r)%r||0,t+(o>n?r-o:o)})},co=function(t){for(var e=0,s="",n,r,o,a;~(n=t.indexOf("random(",e));)o=t.indexOf(")",n),a=t.charAt(n+7)==="[",r=t.substr(n+7,o-n-7).match(a?Fm:Wc),s+=t.substr(e,n-e)+qm(a?r:+r[0],a?0:+r[1],+r[2]||1e-5),e=o+1;return s+t.substr(e,t.length-e)},Zm=function(t,e,s,n,r){var o=e-t,a=n-s;return Gn(r,function(l){return s+((l-t)/o*a||0)})},wS=function i(t,e,s,n){var r=isNaN(t+e)?0:function(d){return(1-d)*t+d*e};if(!r){var o=ie(t),a={},l,c,h,u,f;if(s===!0&&(n=1)&&(s=null),o)t={p:t},e={p:e};else if(_e(t)&&!_e(e)){for(h=[],u=t.length,f=u-2,c=1;c<u;c++)h.push(i(t[c-1],t[c]));u--,r=function(p){p*=u;var g=Math.min(f,~~p);return h[g](p-g)},s=e}else n||(t=or(_e(t)?[]:{},t));if(!h){for(l in e)Qh.call(a,t,l,"get",e[l]);r=function(p){return nu(p,a)||(o?t.p:t)}}}return Gn(s,r)},qf=function(t,e,s){var n=t.labels,r=Us,o,a,l;for(o in n)a=n[o]-e,a<0==!!s&&a&&r>(a=Math.abs(a))&&(l=o,r=a);return l},Ze=function(t,e,s){var n=t.vars,r=n[e],o=Lt,a=t._ctx,l,c,h;if(r)return l=n[e+"Params"],c=n.callbackScope||t,s&&Rn.length&&La(),a&&(Lt=a),h=l?r.apply(c,l):r.call(c),Lt=o,h},Mr=function(t){return Hn(t),t.scrollTrigger&&t.scrollTrigger.kill(!!le),t.progress()<1&&Ze(t,"onInterrupt"),t},ji,Jm=[],Qm=function(t){if(t)if(t=!t.name&&t.default||t,Gh()||t.headless){var e=t.name,s=Ut(t),n=e&&!s&&t.init?function(){this._props=[]}:t,r={init:lo,render:nu,add:Qh,kill:HS,modifier:NS,rawVars:0},o={targetTest:0,get:0,getSetter:su,aliases:{},register:0};if(cr(),t!==n){if(Ge[e])return;ns(n,ns(ja(t,r),o)),or(n.prototype,or(r,ja(t,o))),Ge[n.prop=e]=n,t.targetTest&&(aa.push(n),Kh[e]=1),e=(e==="css"?"CSS":e.charAt(0).toUpperCase()+e.substr(1))+"Plugin"}Lm(e,n),t.register&&t.register(He,n,Be)}else Jm.push(t)},Et=255,Er={aqua:[0,Et,Et],lime:[0,Et,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,Et],navy:[0,0,128],white:[Et,Et,Et],olive:[128,128,0],yellow:[Et,Et,0],orange:[Et,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[Et,0,0],pink:[Et,192,203],cyan:[0,Et,Et],transparent:[Et,Et,Et,0]},ec=function(t,e,s){return t+=t<0?1:t>1?-1:0,(t*6<1?e+(s-e)*t*6:t<.5?s:t*3<2?e+(s-e)*(2/3-t)*6:e)*Et+.5|0},tv=function(t,e,s){var n=t?dn(t)?[t>>16,t>>8&Et,t&Et]:0:Er.black,r,o,a,l,c,h,u,f,d,p;if(!n){if(t.substr(-1)===","&&(t=t.substr(0,t.length-1)),Er[t])n=Er[t];else if(t.charAt(0)==="#"){if(t.length<6&&(r=t.charAt(1),o=t.charAt(2),a=t.charAt(3),t="#"+r+r+o+o+a+a+(t.length===5?t.charAt(4)+t.charAt(4):"")),t.length===9)return n=parseInt(t.substr(1,6),16),[n>>16,n>>8&Et,n&Et,parseInt(t.substr(7),16)/255];t=parseInt(t.substr(1),16),n=[t>>16,t>>8&Et,t&Et]}else if(t.substr(0,3)==="hsl"){if(n=p=t.match(Wc),!e)l=+n[0]%360/360,c=+n[1]/100,h=+n[2]/100,o=h<=.5?h*(c+1):h+c-h*c,r=h*2-o,n.length>3&&(n[3]*=1),n[0]=ec(l+1/3,r,o),n[1]=ec(l,r,o),n[2]=ec(l-1/3,r,o);else if(~t.indexOf("="))return n=t.match(Pm),s&&n.length<4&&(n[3]=1),n}else n=t.match(Wc)||Er.transparent;n=n.map(Number)}return e&&!p&&(r=n[0]/Et,o=n[1]/Et,a=n[2]/Et,u=Math.max(r,o,a),f=Math.min(r,o,a),h=(u+f)/2,u===f?l=c=0:(d=u-f,c=h>.5?d/(2-u-f):d/(u+f),l=u===r?(o-a)/d+(o<a?6:0):u===o?(a-r)/d+2:(r-o)/d+4,l*=60),n[0]=~~(l+.5),n[1]=~~(c*100+.5),n[2]=~~(h*100+.5)),s&&n.length<4&&(n[3]=1),n},ev=function(t){var e=[],s=[],n=-1;return t.split(Ln).forEach(function(r){var o=r.match(Li)||[];e.push.apply(e,o),s.push(n+=o.length+1)}),e.c=s,e},Kf=function(t,e,s){var n="",r=(t+n).match(Ln),o=e?"hsla(":"rgba(",a=0,l,c,h,u;if(!r)return t;if(r=r.map(function(f){return(f=tv(f,e,1))&&o+(e?f[0]+","+f[1]+"%,"+f[2]+"%,"+f[3]:f.join(","))+")"}),s&&(h=ev(t),l=s.c,l.join(n)!==h.c.join(n)))for(c=t.replace(Ln,"1").split(Li),u=c.length-1;a<u;a++)n+=c[a]+(~l.indexOf(a)?r.shift()||o+"0,0,0,0)":(h.length?h:r.length?r:s).shift());if(!c)for(c=t.split(Ln),u=c.length-1;a<u;a++)n+=c[a]+r[a];return n+c[u]},Ln=function(){var i="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b",t;for(t in Er)i+="|"+t+"\\b";return new RegExp(i+")","gi")}(),TS=/hsl[a]?\(/,sv=function(t){var e=t.join(" "),s;if(Ln.lastIndex=0,Ln.test(e))return s=TS.test(e),t[1]=Kf(t[1],s),t[0]=Kf(t[0],s,ev(t[1])),!0},ho,qe=function(){var i=Date.now,t=500,e=33,s=i(),n=s,r=1e3/240,o=r,a=[],l,c,h,u,f,d,p=function g(m){var v=i()-n,_=m===!0,y,b,S,P;if((v>t||v<0)&&(s+=v-e),n+=v,S=n-s,y=S-o,(y>0||_)&&(P=++u.frame,f=S-u.time*1e3,u.time=S=S/1e3,o+=y+(y>=r?4:r-y),b=1),_||(l=c(g)),b)for(d=0;d<a.length;d++)a[d](S,f,P,m)};return u={time:0,frame:0,tick:function(){p(!0)},deltaRatio:function(m){return f/(1e3/(m||60))},wake:function(){Dm&&(!Yc&&Gh()&&(Rs=Yc=window,$h=Rs.document||{},ss.gsap=He,(Rs.gsapVersions||(Rs.gsapVersions=[])).push(He.version),Rm(Ra||Rs.GreenSockGlobals||!Rs.gsap&&Rs||{}),Jm.forEach(Qm)),h=typeof requestAnimationFrame<"u"&&requestAnimationFrame,l&&u.sleep(),c=h||function(m){return setTimeout(m,o-u.time*1e3+1|0)},ho=1,p(2))},sleep:function(){(h?cancelAnimationFrame:clearTimeout)(l),ho=0,c=lo},lagSmoothing:function(m,v){t=m||1/0,e=Math.min(v||33,t)},fps:function(m){r=1e3/(m||240),o=u.time*1e3+r},add:function(m,v,_){var y=v?function(b,S,P,O){m(b,S,P,O),u.remove(y)}:m;return u.remove(m),a[_?"unshift":"push"](y),cr(),y},remove:function(m,v){~(v=a.indexOf(m))&&a.splice(v,1)&&d>=v&&d--},_listeners:a},u}(),cr=function(){return!ho&&qe.wake()},mt={},OS=/^[\d.\-M][\d.\-,\s]/,MS=/["']/g,ES=function(t){for(var e={},s=t.substr(1,t.length-3).split(":"),n=s[0],r=1,o=s.length,a,l,c;r<o;r++)l=s[r],a=r!==o-1?l.lastIndexOf(","):l.length,c=l.substr(0,a),e[n]=isNaN(c)?c.replace(MS,"").trim():+c,n=l.substr(a+1).trim();return e},kS=function(t){var e=t.indexOf("(")+1,s=t.indexOf(")"),n=t.indexOf("(",e);return t.substring(e,~n&&n<s?t.indexOf(")",s+1):s)},PS=function(t){var e=(t+"").split("("),s=mt[e[0]];return s&&e.length>1&&s.config?s.config.apply(null,~t.indexOf("{")?[ES(e[1])]:kS(t).split(",").map(Nm)):mt._CE&&OS.test(t)?mt._CE("",t):s},nv=function(t){return function(e){return 1-t(1-e)}},iv=function i(t,e){for(var s=t._first,n;s;)s instanceof Oe?i(s,e):s.vars.yoyoEase&&(!s._yoyo||!s._repeat)&&s._yoyo!==e&&(s.timeline?i(s.timeline,e):(n=s._ease,s._ease=s._yEase,s._yEase=n,s._yoyo=e)),s=s._next},fi=function(t,e){return t&&(Ut(t)?t:mt[t]||PS(t))||e},Ti=function(t,e,s,n){s===void 0&&(s=function(l){return 1-e(1-l)}),n===void 0&&(n=function(l){return l<.5?e(l*2)/2:1-e((1-l)*2)/2});var r={easeIn:e,easeOut:s,easeInOut:n},o;return Ie(t,function(a){mt[a]=ss[a]=r,mt[o=a.toLowerCase()]=s;for(var l in r)mt[o+(l==="easeIn"?".in":l==="easeOut"?".out":".inOut")]=mt[a+"."+l]=r[l]}),r},rv=function(t){return function(e){return e<.5?(1-t(1-e*2))/2:.5+t((e-.5)*2)/2}},sc=function i(t,e,s){var n=e>=1?e:1,r=(s||(t?.3:.45))/(e<1?e:1),o=r/Vc*(Math.asin(1/n)||0),a=function(h){return h===1?1:n*Math.pow(2,-10*h)*iS((h-o)*r)+1},l=t==="out"?a:t==="in"?function(c){return 1-a(1-c)}:rv(a);return r=Vc/r,l.config=function(c,h){return i(t,c,h)},l},nc=function i(t,e){e===void 0&&(e=1.70158);var s=function(o){return o?--o*o*((e+1)*o+e)+1:0},n=t==="out"?s:t==="in"?function(r){return 1-s(1-r)}:rv(s);return n.config=function(r){return i(t,r)},n};Ie("Linear,Quad,Cubic,Quart,Quint,Strong",function(i,t){var e=t<5?t+1:t;Ti(i+",Power"+(e-1),t?function(s){return Math.pow(s,e)}:function(s){return s},function(s){return 1-Math.pow(1-s,e)},function(s){return s<.5?Math.pow(s*2,e)/2:1-Math.pow((1-s)*2,e)/2})});mt.Linear.easeNone=mt.none=mt.Linear.easeIn;Ti("Elastic",sc("in"),sc("out"),sc());(function(i,t){var e=1/t,s=2*e,n=2.5*e,r=function(a){return a<e?i*a*a:a<s?i*Math.pow(a-1.5/t,2)+.75:a<n?i*(a-=2.25/t)*a+.9375:i*Math.pow(a-2.625/t,2)+.984375};Ti("Bounce",function(o){return 1-r(1-o)},r)})(7.5625,2.75);Ti("Expo",function(i){return Math.pow(2,10*(i-1))*i+i*i*i*i*i*i*(1-i)});Ti("Circ",function(i){return-(Em(1-i*i)-1)});Ti("Sine",function(i){return i===1?1:-nS(i*eS)+1});Ti("Back",nc("in"),nc("out"),nc());mt.SteppedEase=mt.steps=ss.SteppedEase={config:function(t,e){t===void 0&&(t=1);var s=1/t,n=t+(e?0:1),r=e?1:0,o=1-me;return function(a){return((n*Co(0,o,a)|0)+r)*s}}};rr.ease=mt["quad.out"];Ie("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function(i){return Zh+=i+","+i+"Params,"});var ov=function(t,e){this.id=sS++,t._gsap=this,this.target=t,this.harness=e,this.get=e?e.get:Im,this.set=e?e.getSetter:su},uo=function(){function i(e){this.vars=e,this._delay=+e.delay||0,(this._repeat=e.repeat===1/0?-2:e.repeat||0)&&(this._rDelay=e.repeatDelay||0,this._yoyo=!!e.yoyo||!!e.yoyoEase),this._ts=1,lr(this,+e.duration,1,1),this.data=e.data,Lt&&(this._ctx=Lt,Lt.data.push(this)),ho||qe.wake()}var t=i.prototype;return t.delay=function(s){return s||s===0?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+s-this._delay),this._delay=s,this):this._delay},t.duration=function(s){return arguments.length?this.totalDuration(this._repeat>0?s+(s+this._rDelay)*this._repeat:s):this.totalDuration()&&this._dur},t.totalDuration=function(s){return arguments.length?(this._dirty=0,lr(this,this._repeat<0?s:(s-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},t.totalTime=function(s,n){if(cr(),!arguments.length)return this._tTime;var r=this._dp;if(r&&r.smoothChildTiming&&this._ts){for(Sl(this,s),!r._dp||r.parent||Vm(r,this);r&&r.parent;)r.parent._time!==r._start+(r._ts>=0?r._tTime/r._ts:(r.totalDuration()-r._tTime)/-r._ts)&&r.totalTime(r._tTime,!0),r=r.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&s<this._tDur||this._ts<0&&s>0||!this._tDur&&!s)&&Bs(this._dp,this,this._start-this._delay)}return(this._tTime!==s||!this._dur&&!n||this._initted&&Math.abs(this._zTime)===me||!s&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=s),Bm(this,s,n)),this},t.time=function(s,n){return arguments.length?this.totalTime(Math.min(this.totalDuration(),s+Gf(this))%(this._dur+this._rDelay)||(s?this._dur:0),n):this._time},t.totalProgress=function(s,n){return arguments.length?this.totalTime(this.totalDuration()*s,n):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.rawTime()>=0&&this._initted?1:0},t.progress=function(s,n){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&!(this.iteration()&1)?1-s:s)+Gf(this),n):this.duration()?Math.min(1,this._time/this._dur):this.rawTime()>0?1:0},t.iteration=function(s,n){var r=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(s-1)*r,n):this._repeat?ar(this._tTime,r)+1:1},t.timeScale=function(s,n){if(!arguments.length)return this._rts===-1e-8?0:this._rts;if(this._rts===s)return this;var r=this.parent&&this._ts?Ia(this.parent._time,this):this._tTime;return this._rts=+s||0,this._ts=this._ps||s===-1e-8?0:this._rts,this.totalTime(Co(-Math.abs(this._delay),this._tDur,r),n!==!1),Cl(this),uS(this)},t.paused=function(s){return arguments.length?(this._ps!==s&&(this._ps=s,s?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(cr(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,this.progress()===1&&Math.abs(this._zTime)!==me&&(this._tTime-=me)))),this):this._ps},t.startTime=function(s){if(arguments.length){this._start=s;var n=this.parent||this._dp;return n&&(n._sort||!this.parent)&&Bs(n,this,s-this._delay),this}return this._start},t.endTime=function(s){return this._start+(je(s)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},t.rawTime=function(s){var n=this.parent||this._dp;return n?s&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?Ia(n.rawTime(s),this):this._tTime:this._tTime},t.revert=function(s){s===void 0&&(s=aS);var n=le;return le=s,(this._initted||this._startAt)&&(this.timeline&&this.timeline.revert(s),this.totalTime(-.01,s.suppressEvents)),this.data!=="nested"&&s.kill!==!1&&this.kill(),le=n,this},t.globalTime=function(s){for(var n=this,r=arguments.length?s:n.rawTime();n;)r=n._start+r/(Math.abs(n._ts)||1),n=n._dp;return!this.parent&&this._sat?this._sat.globalTime(s):r},t.repeat=function(s){return arguments.length?(this._repeat=s===1/0?-2:s,$f(this)):this._repeat===-2?1/0:this._repeat},t.repeatDelay=function(s){if(arguments.length){var n=this._time;return this._rDelay=s,$f(this),n?this.time(n):this}return this._rDelay},t.yoyo=function(s){return arguments.length?(this._yoyo=s,this):this._yoyo},t.seek=function(s,n){return this.totalTime(rs(this,s),je(n))},t.restart=function(s,n){return this.play().totalTime(s?-this._delay:0,je(n)),this._dur||(this._zTime=-1e-8),this},t.play=function(s,n){return s!=null&&this.seek(s,n),this.reversed(!1).paused(!1)},t.reverse=function(s,n){return s!=null&&this.seek(s||this.totalDuration(),n),this.reversed(!0).paused(!1)},t.pause=function(s,n){return s!=null&&this.seek(s,n),this.paused(!0)},t.resume=function(){return this.paused(!1)},t.reversed=function(s){return arguments.length?(!!s!==this.reversed()&&this.timeScale(-this._rts||(s?-1e-8:0)),this):this._rts<0},t.invalidate=function(){return this._initted=this._act=0,this._zTime=-1e-8,this},t.isActive=function(){var s=this.parent||this._dp,n=this._start,r;return!!(!s||this._ts&&this._initted&&s.isActive()&&(r=s.rawTime(!0))>=n&&r<this.endTime(!0)-me)},t.eventCallback=function(s,n,r){var o=this.vars;return arguments.length>1?(n?(o[s]=n,r&&(o[s+"Params"]=r),s==="onUpdate"&&(this._onUpdate=n)):delete o[s],this):o[s]},t.then=function(s){var n=this;return new Promise(function(r){var o=Ut(s)?s:Hm,a=function(){var c=n.then;n.then=null,Ut(o)&&(o=o(n))&&(o.then||o===n)&&(n.then=c),r(o),n.then=c};n._initted&&n.totalProgress()===1&&n._ts>=0||!n._tTime&&n._ts<0?a():n._prom=a})},t.kill=function(){Mr(this)},i}();ns(uo.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-1e-8,_prom:0,_ps:!1,_rts:1});var Oe=function(i){Mm(t,i);function t(s,n){var r;return s===void 0&&(s={}),r=i.call(this,s)||this,r.labels={},r.smoothChildTiming=!!s.smoothChildTiming,r.autoRemoveChildren=!!s.autoRemoveChildren,r._sort=je(s.sortChildren),Nt&&Bs(s.parent||Nt,sn(r),n),s.reversed&&r.reverse(),s.paused&&r.paused(!0),s.scrollTrigger&&Wm(sn(r),s.scrollTrigger),r}var e=t.prototype;return e.to=function(n,r,o){return Xr(0,arguments,this),this},e.from=function(n,r,o){return Xr(1,arguments,this),this},e.fromTo=function(n,r,o,a){return Xr(2,arguments,this),this},e.set=function(n,r,o){return r.duration=0,r.parent=this,Yr(r).repeatDelay||(r.repeat=0),r.immediateRender=!!r.immediateRender,new Kt(n,r,rs(this,o),1),this},e.call=function(n,r,o){return Bs(this,Kt.delayedCall(0,n,r),o)},e.staggerTo=function(n,r,o,a,l,c,h){return o.duration=r,o.stagger=o.stagger||a,o.onComplete=c,o.onCompleteParams=h,o.parent=this,new Kt(n,o,rs(this,l)),this},e.staggerFrom=function(n,r,o,a,l,c,h){return o.runBackwards=1,Yr(o).immediateRender=je(o.immediateRender),this.staggerTo(n,r,o,a,l,c,h)},e.staggerFromTo=function(n,r,o,a,l,c,h,u){return a.startAt=o,Yr(a).immediateRender=je(a.immediateRender),this.staggerTo(n,r,a,l,c,h,u)},e.render=function(n,r,o){var a=this._time,l=this._dirty?this.totalDuration():this._tDur,c=this._dur,h=n<=0?0:Zt(n),u=this._zTime<0!=n<0&&(this._initted||!c),f,d,p,g,m,v,_,y,b,S,P,O;if(this!==Nt&&h>l&&n>=0&&(h=l),h!==this._tTime||o||u){if(a!==this._time&&c&&(h+=this._time-a,n+=this._time-a),f=h,b=this._start,y=this._ts,v=!y,u&&(c||(a=this._zTime),(n||!r)&&(this._zTime=n)),this._repeat){if(P=this._yoyo,m=c+this._rDelay,this._repeat<-1&&n<0)return this.totalTime(m*100+n,r,o);if(f=Zt(h%m),h===l?(g=this._repeat,f=c):(S=Zt(h/m),g=~~S,g&&g===S&&(f=c,g--),f>c&&(f=c)),S=ar(this._tTime,m),!a&&this._tTime&&S!==g&&this._tTime-S*m-this._dur<=0&&(S=g),P&&g&1&&(f=c-f,O=1),g!==S&&!this._lock){var k=P&&S&1,D=k===(P&&g&1);if(g<S&&(k=!k),a=k?0:h%c?c:h,this._lock=1,this.render(a||(O?0:Zt(g*m)),r,!c)._lock=0,this._tTime=h,!r&&this.parent&&Ze(this,"onRepeat"),this.vars.repeatRefresh&&!O&&(this.invalidate()._lock=1),a&&a!==this._time||v!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(c=this._dur,l=this._tDur,D&&(this._lock=2,a=k?c:-1e-4,this.render(a,!0),this.vars.repeatRefresh&&!O&&this.invalidate()),this._lock=0,!this._ts&&!v)return this;iv(this,O)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(_=pS(this,Zt(a),Zt(f)),_&&(h-=f-(f=_._start))),this._tTime=h,this._time=f,this._act=!y,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=n,a=0),!a&&f&&!r&&!g&&(Ze(this,"onStart"),this._tTime!==h))return this;if(f>=a&&n>=0)for(d=this._first;d;){if(p=d._next,(d._act||f>=d._start)&&d._ts&&_!==d){if(d.parent!==this)return this.render(n,r,o);if(d.render(d._ts>0?(f-d._start)*d._ts:(d._dirty?d.totalDuration():d._tDur)+(f-d._start)*d._ts,r,o),f!==this._time||!this._ts&&!v){_=0,p&&(h+=this._zTime=-1e-8);break}}d=p}else{d=this._last;for(var z=n<0?n:f;d;){if(p=d._prev,(d._act||z<=d._end)&&d._ts&&_!==d){if(d.parent!==this)return this.render(n,r,o);if(d.render(d._ts>0?(z-d._start)*d._ts:(d._dirty?d.totalDuration():d._tDur)+(z-d._start)*d._ts,r,o||le&&(d._initted||d._startAt)),f!==this._time||!this._ts&&!v){_=0,p&&(h+=this._zTime=z?-1e-8:me);break}}d=p}}if(_&&!r&&(this.pause(),_.render(f>=a?0:-1e-8)._zTime=f>=a?1:-1,this._ts))return this._start=b,Cl(this),this.render(n,r,o);this._onUpdate&&!r&&Ze(this,"onUpdate",!0),(h===l&&this._tTime>=this.totalDuration()||!h&&a)&&(b===this._start||Math.abs(y)!==Math.abs(this._ts))&&(this._lock||((n||!c)&&(h===l&&this._ts>0||!h&&this._ts<0)&&Hn(this,1),!r&&!(n<0&&!a)&&(h||a||!l)&&(Ze(this,h===l&&n>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(h<l&&this.timeScale()>0)&&this._prom())))}return this},e.add=function(n,r){var o=this;if(dn(r)||(r=rs(this,r,n)),!(n instanceof uo)){if(_e(n))return n.forEach(function(a){return o.add(a,r)}),this;if(ie(n))return this.addLabel(n,r);if(Ut(n))n=Kt.delayedCall(0,n);else return this}return this!==n?Bs(this,n,r):this},e.getChildren=function(n,r,o,a){n===void 0&&(n=!0),r===void 0&&(r=!0),o===void 0&&(o=!0),a===void 0&&(a=-1e8);for(var l=[],c=this._first;c;)c._start>=a&&(c instanceof Kt?r&&l.push(c):(o&&l.push(c),n&&l.push.apply(l,c.getChildren(!0,r,o)))),c=c._next;return l},e.getById=function(n){for(var r=this.getChildren(1,1,1),o=r.length;o--;)if(r[o].vars.id===n)return r[o]},e.remove=function(n){return ie(n)?this.removeLabel(n):Ut(n)?this.killTweensOf(n):(n.parent===this&&xl(this,n),n===this._recent&&(this._recent=this._last),ui(this))},e.totalTime=function(n,r){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=Zt(qe.time-(this._ts>0?n/this._ts:(this.totalDuration()-n)/-this._ts))),i.prototype.totalTime.call(this,n,r),this._forcing=0,this):this._tTime},e.addLabel=function(n,r){return this.labels[n]=rs(this,r),this},e.removeLabel=function(n){return delete this.labels[n],this},e.addPause=function(n,r,o){var a=Kt.delayedCall(0,r||lo,o);return a.data="isPause",this._hasPause=1,Bs(this,a,rs(this,n))},e.removePause=function(n){var r=this._first;for(n=rs(this,n);r;)r._start===n&&r.data==="isPause"&&Hn(r),r=r._next},e.killTweensOf=function(n,r,o){for(var a=this.getTweensOf(n,o),l=a.length;l--;)kn!==a[l]&&a[l].kill(n,r);return this},e.getTweensOf=function(n,r){for(var o=[],a=hs(n),l=this._first,c=dn(r),h;l;)l instanceof Kt?lS(l._targets,a)&&(c?(!kn||l._initted&&l._ts)&&l.globalTime(0)<=r&&l.globalTime(l.totalDuration())>r:!r||l.isActive())&&o.push(l):(h=l.getTweensOf(a,r)).length&&o.push.apply(o,h),l=l._next;return o},e.tweenTo=function(n,r){r=r||{};var o=this,a=rs(o,n),l=r,c=l.startAt,h=l.onStart,u=l.onStartParams,f=l.immediateRender,d,p=Kt.to(o,ns({ease:r.ease||"none",lazy:!1,immediateRender:!1,time:a,overwrite:"auto",duration:r.duration||Math.abs((a-(c&&"time"in c?c.time:o._time))/o.timeScale())||me,onStart:function(){if(o.pause(),!d){var m=r.duration||Math.abs((a-(c&&"time"in c?c.time:o._time))/o.timeScale());p._dur!==m&&lr(p,m,0,1).render(p._time,!0,!0),d=1}h&&h.apply(p,u||[])}},r));return f?p.render(0):p},e.tweenFromTo=function(n,r,o){return this.tweenTo(r,ns({startAt:{time:rs(this,n)}},o))},e.recent=function(){return this._recent},e.nextLabel=function(n){return n===void 0&&(n=this._time),qf(this,rs(this,n))},e.previousLabel=function(n){return n===void 0&&(n=this._time),qf(this,rs(this,n),1)},e.currentLabel=function(n){return arguments.length?this.seek(n,!0):this.previousLabel(this._time+me)},e.shiftChildren=function(n,r,o){o===void 0&&(o=0);for(var a=this._first,l=this.labels,c;a;)a._start>=o&&(a._start+=n,a._end+=n),a=a._next;if(r)for(c in l)l[c]>=o&&(l[c]+=n);return ui(this)},e.invalidate=function(n){var r=this._first;for(this._lock=0;r;)r.invalidate(n),r=r._next;return i.prototype.invalidate.call(this,n)},e.clear=function(n){n===void 0&&(n=!0);for(var r=this._first,o;r;)o=r._next,this.remove(r),r=o;return this._dp&&(this._time=this._tTime=this._pTime=0),n&&(this.labels={}),ui(this)},e.totalDuration=function(n){var r=0,o=this,a=o._last,l=Us,c,h,u;if(arguments.length)return o.timeScale((o._repeat<0?o.duration():o.totalDuration())/(o.reversed()?-n:n));if(o._dirty){for(u=o.parent;a;)c=a._prev,a._dirty&&a.totalDuration(),h=a._start,h>l&&o._sort&&a._ts&&!o._lock?(o._lock=1,Bs(o,a,h-a._delay,1)._lock=0):l=h,h<0&&a._ts&&(r-=h,(!u&&!o._dp||u&&u.smoothChildTiming)&&(o._start+=h/o._ts,o._time-=h,o._tTime-=h),o.shiftChildren(-h,!1,-1/0),l=0),a._end>r&&a._ts&&(r=a._end),a=c;lr(o,o===Nt&&o._time>r?o._time:r,1,1),o._dirty=0}return o._tDur},t.updateRoot=function(n){if(Nt._ts&&(Bm(Nt,Ia(n,Nt)),jm=qe.frame),qe.frame>=Xf){Xf+=Qe.autoSleep||120;var r=Nt._first;if((!r||!r._ts)&&Qe.autoSleep&&qe._listeners.length<2){for(;r&&!r._ts;)r=r._next;r||qe.sleep()}}},t}(uo);ns(Oe.prototype,{_lock:0,_hasPause:0,_forcing:0});var AS=function(t,e,s,n,r,o,a){var l=new Be(this._pt,t,e,0,1,fv,null,r),c=0,h=0,u,f,d,p,g,m,v,_;for(l.b=s,l.e=n,s+="",n+="",(v=~n.indexOf("random("))&&(n=co(n)),o&&(_=[s,n],o(_,t,e),s=_[0],n=_[1]),f=s.match(Ql)||[];u=Ql.exec(n);)p=u[0],g=n.substring(c,u.index),d?d=(d+1)%5:g.substr(-5)==="rgba("&&(d=1),p!==f[h++]&&(m=parseFloat(f[h-1])||0,l._pt={_next:l._pt,p:g||h===1?g:",",s:m,c:p.charAt(1)==="="?Gi(m,p)-m:parseFloat(p)-m,m:d&&d<4?Math.round:0},c=Ql.lastIndex);return l.c=c<n.length?n.substring(c,n.length):"",l.fp=a,(Am.test(n)||v)&&(l.e=0),this._pt=l,l},Qh=function(t,e,s,n,r,o,a,l,c,h){Ut(n)&&(n=n(r||0,t,o));var u=t[e],f=s!=="get"?s:Ut(u)?c?t[e.indexOf("set")||!Ut(t["get"+e.substr(3)])?e:"get"+e.substr(3)](c):t[e]():u,d=Ut(u)?c?jS:hv:eu,p;if(ie(n)&&(~n.indexOf("random(")&&(n=co(n)),n.charAt(1)==="="&&(p=Gi(f,n)+(ge(f)||0),(p||p===0)&&(n=p))),!h||f!==n||Zc)return!isNaN(f*n)&&n!==""?(p=new Be(this._pt,t,e,+f||0,n-(f||0),typeof u=="boolean"?BS:uv,0,d),c&&(p.fp=c),a&&p.modifier(a,this,t),this._pt=p):(!u&&!(e in t)&&qh(e,n),AS.call(this,t,e,f,n,d,l||Qe.stringFilter,c))},FS=function(t,e,s,n,r){if(Ut(t)&&(t=Ur(t,r,e,s,n)),!Zs(t)||t.style&&t.nodeType||_e(t)||km(t))return ie(t)?Ur(t,r,e,s,n):t;var o={},a;for(a in t)o[a]=Ur(t[a],r,e,s,n);return o},av=function(t,e,s,n,r,o){var a,l,c,h;if(Ge[t]&&(a=new Ge[t]).init(r,a.rawVars?e[t]:FS(e[t],n,r,o,s),s,n,o)!==!1&&(s._pt=l=new Be(s._pt,r,t,0,1,a.render,a,0,a.priority),s!==ji))for(c=s._ptLookup[s._targets.indexOf(r)],h=a._props.length;h--;)c[a._props[h]]=l;return a},kn,Zc,tu=function i(t,e,s){var n=t.vars,r=n.ease,o=n.startAt,a=n.immediateRender,l=n.lazy,c=n.onUpdate,h=n.runBackwards,u=n.yoyoEase,f=n.keyframes,d=n.autoRevert,p=t._dur,g=t._startAt,m=t._targets,v=t.parent,_=v&&v.data==="nested"?v.vars.targets:m,y=t._overwrite==="auto"&&!Xh,b=t.timeline,S,P,O,k,D,z,K,st,G,it,ct,et,Z;if(b&&(!f||!r)&&(r="none"),t._ease=fi(r,rr.ease),t._yEase=u?nv(fi(u===!0?r:u,rr.ease)):0,u&&t._yoyo&&!t._repeat&&(u=t._yEase,t._yEase=t._ease,t._ease=u),t._from=!b&&!!n.runBackwards,!b||f&&!n.stagger){if(st=m[0]?hi(m[0]).harness:0,et=st&&n[st.prop],S=ja(n,Kh),g&&(g._zTime<0&&g.progress(1),e<0&&h&&a&&!d?g.render(-1,!0):g.revert(h&&p?oa:oS),g._lazy=0),o){if(Hn(t._startAt=Kt.set(m,ns({data:"isStart",overwrite:!1,parent:v,immediateRender:!0,lazy:!g&&je(l),startAt:null,delay:0,onUpdate:c&&function(){return Ze(t,"onUpdate")},stagger:0},o))),t._startAt._dp=0,t._startAt._sat=t,e<0&&(le||!a&&!d)&&t._startAt.revert(oa),a&&p&&e<=0&&s<=0){e&&(t._zTime=e);return}}else if(h&&p&&!g){if(e&&(a=!1),O=ns({overwrite:!1,data:"isFromStart",lazy:a&&!g&&je(l),immediateRender:a,stagger:0,parent:v},S),et&&(O[st.prop]=et),Hn(t._startAt=Kt.set(m,O)),t._startAt._dp=0,t._startAt._sat=t,e<0&&(le?t._startAt.revert(oa):t._startAt.render(-1,!0)),t._zTime=e,!a)i(t._startAt,me,me);else if(!e)return}for(t._pt=t._ptCache=0,l=p&&je(l)||l&&!p,P=0;P<m.length;P++){if(D=m[P],K=D._gsap||Jh(m)[P]._gsap,t._ptLookup[P]=it={},Xc[K.id]&&Rn.length&&La(),ct=_===m?P:_.indexOf(D),st&&(G=new st).init(D,et||S,t,ct,_)!==!1&&(t._pt=k=new Be(t._pt,D,G.name,0,1,G.render,G,0,G.priority),G._props.forEach(function(Y){it[Y]=k}),G.priority&&(z=1)),!st||et)for(O in S)Ge[O]&&(G=av(O,S,t,ct,D,_))?G.priority&&(z=1):it[O]=k=Qh.call(t,D,O,"get",S[O],ct,_,0,n.stringFilter);t._op&&t._op[P]&&t.kill(D,t._op[P]),y&&t._pt&&(kn=t,Nt.killTweensOf(D,it,t.globalTime(e)),Z=!t.parent,kn=0),t._pt&&l&&(Xc[K.id]=1)}z&&dv(t),t._onInit&&t._onInit(t)}t._onUpdate=c,t._initted=(!t._op||t._pt)&&!Z,f&&e<=0&&b.render(Us,!0,!0)},DS=function(t,e,s,n,r,o,a,l){var c=(t._pt&&t._ptCache||(t._ptCache={}))[e],h,u,f,d;if(!c)for(c=t._ptCache[e]=[],f=t._ptLookup,d=t._targets.length;d--;){if(h=f[d][e],h&&h.d&&h.d._pt)for(h=h.d._pt;h&&h.p!==e&&h.fp!==e;)h=h._next;if(!h)return Zc=1,t.vars[e]="+=0",tu(t,a),Zc=0,l?ao(e+" not eligible for reset"):1;c.push(h)}for(d=c.length;d--;)u=c[d],h=u._pt||u,h.s=(n||n===0)&&!r?n:h.s+(n||0)+o*h.c,h.c=s-h.s,u.e&&(u.e=Gt(s)+ge(u.e)),u.b&&(u.b=h.s+ge(u.b))},RS=function(t,e){var s=t[0]?hi(t[0]).harness:0,n=s&&s.aliases,r,o,a,l;if(!n)return e;r=or({},e);for(o in n)if(o in r)for(l=n[o].split(","),a=l.length;a--;)r[l[a]]=r[o];return r},LS=function(t,e,s,n){var r=e.ease||n||"power1.inOut",o,a;if(_e(e))a=s[t]||(s[t]=[]),e.forEach(function(l,c){return a.push({t:c/(e.length-1)*100,v:l,e:r})});else for(o in e)a=s[o]||(s[o]=[]),o==="ease"||a.push({t:parseFloat(t),v:e[o],e:r})},Ur=function(t,e,s,n,r){return Ut(t)?t.call(e,s,n,r):ie(t)&&~t.indexOf("random(")?co(t):t},lv=Zh+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",cv={};Ie(lv+",id,stagger,delay,duration,paused,scrollTrigger",function(i){return cv[i]=1});var Kt=function(i){Mm(t,i);function t(s,n,r,o){var a;typeof n=="number"&&(r.duration=n,n=r,r=null),a=i.call(this,o?n:Yr(n))||this;var l=a.vars,c=l.duration,h=l.delay,u=l.immediateRender,f=l.stagger,d=l.overwrite,p=l.keyframes,g=l.defaults,m=l.scrollTrigger,v=l.yoyoEase,_=n.parent||Nt,y=(_e(s)||km(s)?dn(s[0]):"length"in n)?[s]:hs(s),b,S,P,O,k,D,z,K;if(a._targets=y.length?Jh(y):ao("GSAP target "+s+" not found. https://gsap.com",!Qe.nullTargetWarn)||[],a._ptLookup=[],a._overwrite=d,p||f||Zo(c)||Zo(h)){if(n=a.vars,b=a.timeline=new Oe({data:"nested",defaults:g||{},targets:_&&_.data==="nested"?_.vars.targets:y}),b.kill(),b.parent=b._dp=sn(a),b._start=0,f||Zo(c)||Zo(h)){if(O=y.length,z=f&&Gm(f),Zs(f))for(k in f)~lv.indexOf(k)&&(K||(K={}),K[k]=f[k]);for(S=0;S<O;S++)P=ja(n,cv),P.stagger=0,v&&(P.yoyoEase=v),K&&or(P,K),D=y[S],P.duration=+Ur(c,sn(a),S,D,y),P.delay=(+Ur(h,sn(a),S,D,y)||0)-a._delay,!f&&O===1&&P.delay&&(a._delay=h=P.delay,a._start+=h,P.delay=0),b.to(D,P,z?z(S,D,y):0),b._ease=mt.none;b.duration()?c=h=0:a.timeline=0}else if(p){Yr(ns(b.vars.defaults,{ease:"none"})),b._ease=fi(p.ease||n.ease||"none");var st=0,G,it,ct;if(_e(p))p.forEach(function(et){return b.to(y,et,">")}),b.duration();else{P={};for(k in p)k==="ease"||k==="easeEach"||LS(k,p[k],P,p.easeEach);for(k in P)for(G=P[k].sort(function(et,Z){return et.t-Z.t}),st=0,S=0;S<G.length;S++)it=G[S],ct={ease:it.e,duration:(it.t-(S?G[S-1].t:0))/100*c},ct[k]=it.v,b.to(y,ct,st),st+=ct.duration;b.duration()<c&&b.to({},{duration:c-b.duration()})}}c||a.duration(c=b.duration())}else a.timeline=0;return d===!0&&!Xh&&(kn=sn(a),Nt.killTweensOf(y),kn=0),Bs(_,sn(a),r),n.reversed&&a.reverse(),n.paused&&a.paused(!0),(u||!c&&!p&&a._start===Zt(_._time)&&je(u)&&fS(sn(a))&&_.data!=="nested")&&(a._tTime=-1e-8,a.render(Math.max(0,-h)||0)),m&&Wm(sn(a),m),a}var e=t.prototype;return e.render=function(n,r,o){var a=this._time,l=this._tDur,c=this._dur,h=n<0,u=n>l-me&&!h?l:n<me?0:n,f,d,p,g,m,v,_,y,b;if(!c)gS(this,n,r,o);else if(u!==this._tTime||!n||o||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==h||this._lazy){if(f=u,y=this.timeline,this._repeat){if(g=c+this._rDelay,this._repeat<-1&&h)return this.totalTime(g*100+n,r,o);if(f=Zt(u%g),u===l?(p=this._repeat,f=c):(m=Zt(u/g),p=~~m,p&&p===m?(f=c,p--):f>c&&(f=c)),v=this._yoyo&&p&1,v&&(b=this._yEase,f=c-f),m=ar(this._tTime,g),f===a&&!o&&this._initted&&p===m)return this._tTime=u,this;p!==m&&(y&&this._yEase&&iv(y,v),this.vars.repeatRefresh&&!v&&!this._lock&&f!==g&&this._initted&&(this._lock=o=1,this.render(Zt(g*p),!0).invalidate()._lock=0))}if(!this._initted){if(Ym(this,h?n:f,o,r,u))return this._tTime=0,this;if(a!==this._time&&!(o&&this.vars.repeatRefresh&&p!==m))return this;if(c!==this._dur)return this.render(n,r,o)}if(this._tTime=u,this._time=f,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=_=(b||this._ease)(f/c),this._from&&(this.ratio=_=1-_),f&&!a&&!r&&!p&&(Ze(this,"onStart"),this._tTime!==u))return this;for(d=this._pt;d;)d.r(_,d.d),d=d._next;y&&y.render(n<0?n:y._dur*y._ease(f/this._dur),r,o)||this._startAt&&(this._zTime=n),this._onUpdate&&!r&&(h&&Uc(this,n,r,o),Ze(this,"onUpdate")),this._repeat&&p!==m&&this.vars.onRepeat&&!r&&this.parent&&Ze(this,"onRepeat"),(u===this._tDur||!u)&&this._tTime===u&&(h&&!this._onUpdate&&Uc(this,n,!0,!0),(n||!c)&&(u===this._tDur&&this._ts>0||!u&&this._ts<0)&&Hn(this,1),!r&&!(h&&!a)&&(u||a||v)&&(Ze(this,u===l?"onComplete":"onReverseComplete",!0),this._prom&&!(u<l&&this.timeScale()>0)&&this._prom()))}return this},e.targets=function(){return this._targets},e.invalidate=function(n){return(!n||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(n),i.prototype.invalidate.call(this,n)},e.resetTo=function(n,r,o,a,l){ho||qe.wake(),this._ts||this.play();var c=Math.min(this._dur,(this._dp._time-this._start)*this._ts),h;return this._initted||tu(this,c),h=this._ease(c/this._dur),DS(this,n,r,o,a,h,c,l)?this.resetTo(n,r,o,a,1):(Sl(this,0),this.parent||zm(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},e.kill=function(n,r){if(r===void 0&&(r="all"),!n&&(!r||r==="all"))return this._lazy=this._pt=0,this.parent?Mr(this):this.scrollTrigger&&this.scrollTrigger.kill(!!le),this;if(this.timeline){var o=this.timeline.totalDuration();return this.timeline.killTweensOf(n,r,kn&&kn.vars.overwrite!==!0)._first||Mr(this),this.parent&&o!==this.timeline.totalDuration()&&lr(this,this._dur*this.timeline._tDur/o,0,1),this}var a=this._targets,l=n?hs(n):a,c=this._ptLookup,h=this._pt,u,f,d,p,g,m,v;if((!r||r==="all")&&hS(a,l))return r==="all"&&(this._pt=0),Mr(this);for(u=this._op=this._op||[],r!=="all"&&(ie(r)&&(g={},Ie(r,function(_){return g[_]=1}),r=g),r=RS(a,r)),v=a.length;v--;)if(~l.indexOf(a[v])){f=c[v],r==="all"?(u[v]=r,p=f,d={}):(d=u[v]=u[v]||{},p=r);for(g in p)m=f&&f[g],m&&((!("kill"in m.d)||m.d.kill(g)===!0)&&xl(this,m,"_pt"),delete f[g]),d!=="all"&&(d[g]=1)}return this._initted&&!this._pt&&h&&Mr(this),this},t.to=function(n,r){return new t(n,r,arguments[2])},t.from=function(n,r){return Xr(1,arguments)},t.delayedCall=function(n,r,o,a){return new t(r,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:n,onComplete:r,onReverseComplete:r,onCompleteParams:o,onReverseCompleteParams:o,callbackScope:a})},t.fromTo=function(n,r,o){return Xr(2,arguments)},t.set=function(n,r){return r.duration=0,r.repeatDelay||(r.repeat=0),new t(n,r)},t.killTweensOf=function(n,r,o){return Nt.killTweensOf(n,r,o)},t}(uo);ns(Kt.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0});Ie("staggerTo,staggerFrom,staggerFromTo",function(i){Kt[i]=function(){var t=new Oe,e=$c.call(arguments,0);return e.splice(i==="staggerFromTo"?5:4,0,0),t[i].apply(t,e)}});var eu=function(t,e,s){return t[e]=s},hv=function(t,e,s){return t[e](s)},jS=function(t,e,s,n){return t[e](n.fp,s)},IS=function(t,e,s){return t.setAttribute(e,s)},su=function(t,e){return Ut(t[e])?hv:Uh(t[e])&&t.setAttribute?IS:eu},uv=function(t,e){return e.set(e.t,e.p,Math.round((e.s+e.c*t)*1e6)/1e6,e)},BS=function(t,e){return e.set(e.t,e.p,!!(e.s+e.c*t),e)},fv=function(t,e){var s=e._pt,n="";if(!t&&e.b)n=e.b;else if(t===1&&e.e)n=e.e;else{for(;s;)n=s.p+(s.m?s.m(s.s+s.c*t):Math.round((s.s+s.c*t)*1e4)/1e4)+n,s=s._next;n+=e.c}e.set(e.t,e.p,n,e)},nu=function(t,e){for(var s=e._pt;s;)s.r(t,s.d),s=s._next},NS=function(t,e,s,n){for(var r=this._pt,o;r;)o=r._next,r.p===n&&r.modifier(t,e,s),r=o},HS=function(t){for(var e=this._pt,s,n;e;)n=e._next,e.p===t&&!e.op||e.op===t?xl(this,e,"_pt"):e.dep||(s=1),e=n;return!s},zS=function(t,e,s,n){n.mSet(t,e,n.m.call(n.tween,s,n.mt),n)},dv=function(t){for(var e=t._pt,s,n,r,o;e;){for(s=e._next,n=r;n&&n.pr>e.pr;)n=n._next;(e._prev=n?n._prev:o)?e._prev._next=e:r=e,(e._next=n)?n._prev=e:o=e,e=s}t._pt=r},Be=function(){function i(e,s,n,r,o,a,l,c,h){this.t=s,this.s=r,this.c=o,this.p=n,this.r=a||uv,this.d=l||this,this.set=c||eu,this.pr=h||0,this._next=e,e&&(e._prev=this)}var t=i.prototype;return t.modifier=function(s,n,r){this.mSet=this.mSet||this.set,this.set=zS,this.m=s,this.mt=r,this.tween=n},i}();Ie(Zh+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",function(i){return Kh[i]=1});ss.TweenMax=ss.TweenLite=Kt;ss.TimelineLite=ss.TimelineMax=Oe;Nt=new Oe({sortChildren:!1,defaults:rr,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0});Qe.stringFilter=sv;var di=[],la={},VS=[],Zf=0,WS=0,ic=function(t){return(la[t]||VS).map(function(e){return e()})},Jc=function(){var t=Date.now(),e=[];t-Zf>2&&(ic("matchMediaInit"),di.forEach(function(s){var n=s.queries,r=s.conditions,o,a,l,c;for(a in n)o=Rs.matchMedia(n[a]).matches,o&&(l=1),o!==r[a]&&(r[a]=o,c=1);c&&(s.revert(),l&&e.push(s))}),ic("matchMediaRevert"),e.forEach(function(s){return s.onMatch(s,function(n){return s.add(null,n)})}),Zf=t,ic("matchMedia"))},gv=function(){function i(e,s){this.selector=s&&qc(s),this.data=[],this._r=[],this.isReverted=!1,this.id=WS++,e&&this.add(e)}var t=i.prototype;return t.add=function(s,n,r){Ut(s)&&(r=n,n=s,s=Ut);var o=this,a=function(){var c=Lt,h=o.selector,u;return c&&c!==o&&c.data.push(o),r&&(o.selector=qc(r)),Lt=o,u=n.apply(o,arguments),Ut(u)&&o._r.push(u),Lt=c,o.selector=h,o.isReverted=!1,u};return o.last=a,s===Ut?a(o,function(l){return o.add(null,l)}):s?o[s]=a:a},t.ignore=function(s){var n=Lt;Lt=null,s(this),Lt=n},t.getTweens=function(){var s=[];return this.data.forEach(function(n){return n instanceof i?s.push.apply(s,n.getTweens()):n instanceof Kt&&!(n.parent&&n.parent.data==="nested")&&s.push(n)}),s},t.clear=function(){this._r.length=this.data.length=0},t.kill=function(s,n){var r=this;if(s?function(){for(var a=r.getTweens(),l=r.data.length,c;l--;)c=r.data[l],c.data==="isFlip"&&(c.revert(),c.getChildren(!0,!0,!1).forEach(function(h){return a.splice(a.indexOf(h),1)}));for(a.map(function(h){return{g:h._dur||h._delay||h._sat&&!h._sat.vars.immediateRender?h.globalTime(0):-1/0,t:h}}).sort(function(h,u){return u.g-h.g||-1/0}).forEach(function(h){return h.t.revert(s)}),l=r.data.length;l--;)c=r.data[l],c instanceof Oe?c.data!=="nested"&&(c.scrollTrigger&&c.scrollTrigger.revert(),c.kill()):!(c instanceof Kt)&&c.revert&&c.revert(s);r._r.forEach(function(h){return h(s,r)}),r.isReverted=!0}():this.data.forEach(function(a){return a.kill&&a.kill()}),this.clear(),n)for(var o=di.length;o--;)di[o].id===this.id&&di.splice(o,1)},t.revert=function(s){this.kill(s||{})},i}(),YS=function(){function i(e){this.contexts=[],this.scope=e,Lt&&Lt.data.push(this)}var t=i.prototype;return t.add=function(s,n,r){Zs(s)||(s={matches:s});var o=new gv(0,r||this.scope),a=o.conditions={},l,c,h;Lt&&!o.selector&&(o.selector=Lt.selector),this.contexts.push(o),n=o.add("onMatch",n),o.queries=s;for(c in s)c==="all"?h=1:(l=Rs.matchMedia(s[c]),l&&(di.indexOf(o)<0&&di.push(o),(a[c]=l.matches)&&(h=1),l.addListener?l.addListener(Jc):l.addEventListener("change",Jc)));return h&&n(o,function(u){return o.add(null,u)}),this},t.revert=function(s){this.kill(s||{})},t.kill=function(s){this.contexts.forEach(function(n){return n.kill(s,!0)})},i}(),Ba={registerPlugin:function(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];e.forEach(function(n){return Qm(n)})},timeline:function(t){return new Oe(t)},getTweensOf:function(t,e){return Nt.getTweensOf(t,e)},getProperty:function(t,e,s,n){ie(t)&&(t=hs(t)[0]);var r=hi(t||{}).get,o=s?Hm:Nm;return s==="native"&&(s=""),t&&(e?o((Ge[e]&&Ge[e].get||r)(t,e,s,n)):function(a,l,c){return o((Ge[a]&&Ge[a].get||r)(t,a,l,c))})},quickSetter:function(t,e,s){if(t=hs(t),t.length>1){var n=t.map(function(h){return He.quickSetter(h,e,s)}),r=n.length;return function(h){for(var u=r;u--;)n[u](h)}}t=t[0]||{};var o=Ge[e],a=hi(t),l=a.harness&&(a.harness.aliases||{})[e]||e,c=o?function(h){var u=new o;ji._pt=0,u.init(t,s?h+s:h,ji,0,[t]),u.render(1,u),ji._pt&&nu(1,ji)}:a.set(t,l);return o?c:function(h){return c(t,l,s?h+s:h,a,1)}},quickTo:function(t,e,s){var n,r=He.to(t,ns((n={},n[e]="+=0.1",n.paused=!0,n.stagger=0,n),s||{})),o=function(l,c,h){return r.resetTo(e,l,c,h)};return o.tween=r,o},isTweening:function(t){return Nt.getTweensOf(t,!0).length>0},defaults:function(t){return t&&t.ease&&(t.ease=fi(t.ease,rr.ease)),Uf(rr,t||{})},config:function(t){return Uf(Qe,t||{})},registerEffect:function(t){var e=t.name,s=t.effect,n=t.plugins,r=t.defaults,o=t.extendTimeline;(n||"").split(",").forEach(function(a){return a&&!Ge[a]&&!ss[a]&&ao(e+" effect requires "+a+" plugin.")}),tc[e]=function(a,l,c){return s(hs(a),ns(l||{},r),c)},o&&(Oe.prototype[e]=function(a,l,c){return this.add(tc[e](a,Zs(l)?l:(c=l)&&{},this),c)})},registerEase:function(t,e){mt[t]=fi(e)},parseEase:function(t,e){return arguments.length?fi(t,e):mt},getById:function(t){return Nt.getById(t)},exportRoot:function(t,e){t===void 0&&(t={});var s=new Oe(t),n,r;for(s.smoothChildTiming=je(t.smoothChildTiming),Nt.remove(s),s._dp=0,s._time=s._tTime=Nt._time,n=Nt._first;n;)r=n._next,(e||!(!n._dur&&n instanceof Kt&&n.vars.onComplete===n._targets[0]))&&Bs(s,n,n._start-n._delay),n=r;return Bs(Nt,s,0),s},context:function(t,e){return t?new gv(t,e):Lt},matchMedia:function(t){return new YS(t)},matchMediaRefresh:function(){return di.forEach(function(t){var e=t.conditions,s,n;for(n in e)e[n]&&(e[n]=!1,s=1);s&&t.revert()})||Jc()},addEventListener:function(t,e){var s=la[t]||(la[t]=[]);~s.indexOf(e)||s.push(e)},removeEventListener:function(t,e){var s=la[t],n=s&&s.indexOf(e);n>=0&&s.splice(n,1)},utils:{wrap:CS,wrapYoyo:SS,distribute:Gm,random:qm,snap:$m,normalize:xS,getUnit:ge,clamp:vS,splitColor:tv,toArray:hs,selector:qc,mapRange:Zm,pipe:yS,unitize:bS,interpolate:wS,shuffle:Um},install:Rm,effects:tc,ticker:qe,updateRoot:Oe.updateRoot,plugins:Ge,globalTimeline:Nt,core:{PropTween:Be,globals:Lm,Tween:Kt,Timeline:Oe,Animation:uo,getCache:hi,_removeLinkedListItem:xl,reverting:function(){return le},context:function(t){return t&&Lt&&(Lt.data.push(t),t._ctx=Lt),Lt},suppressOverwrites:function(t){return Xh=t}}};Ie("to,from,fromTo,delayedCall,set,killTweensOf",function(i){return Ba[i]=Kt[i]});qe.add(Oe.updateRoot);ji=Ba.to({},{duration:0});var XS=function(t,e){for(var s=t._pt;s&&s.p!==e&&s.op!==e&&s.fp!==e;)s=s._next;return s},US=function(t,e){var s=t._targets,n,r,o;for(n in e)for(r=s.length;r--;)o=t._ptLookup[r][n],o&&(o=o.d)&&(o._pt&&(o=XS(o,n)),o&&o.modifier&&o.modifier(e[n],t,s[r],n))},rc=function(t,e){return{name:t,rawVars:1,init:function(n,r,o){o._onInit=function(a){var l,c;if(ie(r)&&(l={},Ie(r,function(h){return l[h]=1}),r=l),e){l={};for(c in r)l[c]=e(r[c]);r=l}US(a,r)}}}},He=Ba.registerPlugin({name:"attr",init:function(t,e,s,n,r){var o,a,l;this.tween=s;for(o in e)l=t.getAttribute(o)||"",a=this.add(t,"setAttribute",(l||0)+"",e[o],n,r,0,0,o),a.op=o,a.b=l,this._props.push(o)},render:function(t,e){for(var s=e._pt;s;)le?s.set(s.t,s.p,s.b,s):s.r(t,s.d),s=s._next}},{name:"endArray",init:function(t,e){for(var s=e.length;s--;)this.add(t,s,t[s]||0,e[s],0,0,0,0,0,1)}},rc("roundProps",Kc),rc("modifiers"),rc("snap",$m))||Ba;Kt.version=Oe.version=He.version="3.12.7";Dm=1;Gh()&&cr();mt.Power0;mt.Power1;mt.Power2;mt.Power3;mt.Power4;mt.Linear;mt.Quad;mt.Cubic;mt.Quart;mt.Quint;mt.Strong;mt.Elastic;mt.Back;mt.SteppedEase;mt.Bounce;mt.Sine;mt.Expo;mt.Circ;/*!
 * CSSPlugin 3.12.7
 * https://gsap.com
 *
 * Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license or for
 * Club GSAP members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var Jf,Pn,$i,iu,oi,Qf,ru,GS=function(){return typeof window<"u"},gn={},Qn=180/Math.PI,qi=Math.PI/180,ki=Math.atan2,td=1e8,ou=/([A-Z])/g,$S=/(left|right|width|margin|padding|x)/i,qS=/[\s,\(]\S/,Vs={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},Qc=function(t,e){return e.set(e.t,e.p,Math.round((e.s+e.c*t)*1e4)/1e4+e.u,e)},KS=function(t,e){return e.set(e.t,e.p,t===1?e.e:Math.round((e.s+e.c*t)*1e4)/1e4+e.u,e)},ZS=function(t,e){return e.set(e.t,e.p,t?Math.round((e.s+e.c*t)*1e4)/1e4+e.u:e.b,e)},JS=function(t,e){var s=e.s+e.c*t;e.set(e.t,e.p,~~(s+(s<0?-.5:.5))+e.u,e)},pv=function(t,e){return e.set(e.t,e.p,t?e.e:e.b,e)},mv=function(t,e){return e.set(e.t,e.p,t!==1?e.b:e.e,e)},QS=function(t,e,s){return t.style[e]=s},tw=function(t,e,s){return t.style.setProperty(e,s)},ew=function(t,e,s){return t._gsap[e]=s},sw=function(t,e,s){return t._gsap.scaleX=t._gsap.scaleY=s},nw=function(t,e,s,n,r){var o=t._gsap;o.scaleX=o.scaleY=s,o.renderTransform(r,o)},iw=function(t,e,s,n,r){var o=t._gsap;o[e]=s,o.renderTransform(r,o)},Ht="transform",Ne=Ht+"Origin",rw=function i(t,e){var s=this,n=this.target,r=n.style,o=n._gsap;if(t in gn&&r){if(this.tfm=this.tfm||{},t!=="transform")t=Vs[t]||t,~t.indexOf(",")?t.split(",").forEach(function(a){return s.tfm[a]=rn(n,a)}):this.tfm[t]=o.x?o[t]:rn(n,t),t===Ne&&(this.tfm.zOrigin=o.zOrigin);else return Vs.transform.split(",").forEach(function(a){return i.call(s,a,e)});if(this.props.indexOf(Ht)>=0)return;o.svg&&(this.svgo=n.getAttribute("data-svg-origin"),this.props.push(Ne,e,"")),t=Ht}(r||e)&&this.props.push(t,e,r[t])},vv=function(t){t.translate&&(t.removeProperty("translate"),t.removeProperty("scale"),t.removeProperty("rotate"))},ow=function(){var t=this.props,e=this.target,s=e.style,n=e._gsap,r,o;for(r=0;r<t.length;r+=3)t[r+1]?t[r+1]===2?e[t[r]](t[r+2]):e[t[r]]=t[r+2]:t[r+2]?s[t[r]]=t[r+2]:s.removeProperty(t[r].substr(0,2)==="--"?t[r]:t[r].replace(ou,"-$1").toLowerCase());if(this.tfm){for(o in this.tfm)n[o]=this.tfm[o];n.svg&&(n.renderTransform(),e.setAttribute("data-svg-origin",this.svgo||"")),r=ru(),(!r||!r.isStart)&&!s[Ht]&&(vv(s),n.zOrigin&&s[Ne]&&(s[Ne]+=" "+n.zOrigin+"px",n.zOrigin=0,n.renderTransform()),n.uncache=1)}},_v=function(t,e){var s={target:t,props:[],revert:ow,save:rw};return t._gsap||He.core.getCache(t),e&&t.style&&t.nodeType&&e.split(",").forEach(function(n){return s.save(n)}),s},yv,th=function(t,e){var s=Pn.createElementNS?Pn.createElementNS((e||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),t):Pn.createElement(t);return s&&s.style?s:Pn.createElement(t)},Gs=function i(t,e,s){var n=getComputedStyle(t);return n[e]||n.getPropertyValue(e.replace(ou,"-$1").toLowerCase())||n.getPropertyValue(e)||!s&&i(t,hr(e)||e,1)||""},ed="O,Moz,ms,Ms,Webkit".split(","),hr=function(t,e,s){var n=e||oi,r=n.style,o=5;if(t in r&&!s)return t;for(t=t.charAt(0).toUpperCase()+t.substr(1);o--&&!(ed[o]+t in r););return o<0?null:(o===3?"ms":o>=0?ed[o]:"")+t},eh=function(){GS()&&window.document&&(Jf=window,Pn=Jf.document,$i=Pn.documentElement,oi=th("div")||{style:{}},th("div"),Ht=hr(Ht),Ne=Ht+"Origin",oi.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",yv=!!hr("perspective"),ru=He.core.reverting,iu=1)},sd=function(t){var e=t.ownerSVGElement,s=th("svg",e&&e.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),n=t.cloneNode(!0),r;n.style.display="block",s.appendChild(n),$i.appendChild(s);try{r=n.getBBox()}catch{}return s.removeChild(n),$i.removeChild(s),r},nd=function(t,e){for(var s=e.length;s--;)if(t.hasAttribute(e[s]))return t.getAttribute(e[s])},bv=function(t){var e,s;try{e=t.getBBox()}catch{e=sd(t),s=1}return e&&(e.width||e.height)||s||(e=sd(t)),e&&!e.width&&!e.x&&!e.y?{x:+nd(t,["x","cx","x1"])||0,y:+nd(t,["y","cy","y1"])||0,width:0,height:0}:e},xv=function(t){return!!(t.getCTM&&(!t.parentNode||t.ownerSVGElement)&&bv(t))},bi=function(t,e){if(e){var s=t.style,n;e in gn&&e!==Ne&&(e=Ht),s.removeProperty?(n=e.substr(0,2),(n==="ms"||e.substr(0,6)==="webkit")&&(e="-"+e),s.removeProperty(n==="--"?e:e.replace(ou,"-$1").toLowerCase())):s.removeAttribute(e)}},An=function(t,e,s,n,r,o){var a=new Be(t._pt,e,s,0,1,o?mv:pv);return t._pt=a,a.b=n,a.e=r,t._props.push(s),a},id={deg:1,rad:1,turn:1},aw={grid:1,flex:1},zn=function i(t,e,s,n){var r=parseFloat(s)||0,o=(s+"").trim().substr((r+"").length)||"px",a=oi.style,l=$S.test(e),c=t.tagName.toLowerCase()==="svg",h=(c?"client":"offset")+(l?"Width":"Height"),u=100,f=n==="px",d=n==="%",p,g,m,v;if(n===o||!r||id[n]||id[o])return r;if(o!=="px"&&!f&&(r=i(t,e,s,"px")),v=t.getCTM&&xv(t),(d||o==="%")&&(gn[e]||~e.indexOf("adius")))return p=v?t.getBBox()[l?"width":"height"]:t[h],Gt(d?r/p*u:r/100*p);if(a[l?"width":"height"]=u+(f?o:n),g=n!=="rem"&&~e.indexOf("adius")||n==="em"&&t.appendChild&&!c?t:t.parentNode,v&&(g=(t.ownerSVGElement||{}).parentNode),(!g||g===Pn||!g.appendChild)&&(g=Pn.body),m=g._gsap,m&&d&&m.width&&l&&m.time===qe.time&&!m.uncache)return Gt(r/m.width*u);if(d&&(e==="height"||e==="width")){var _=t.style[e];t.style[e]=u+n,p=t[h],_?t.style[e]=_:bi(t,e)}else(d||o==="%")&&!aw[Gs(g,"display")]&&(a.position=Gs(t,"position")),g===t&&(a.position="static"),g.appendChild(oi),p=oi[h],g.removeChild(oi),a.position="absolute";return l&&d&&(m=hi(g),m.time=qe.time,m.width=g[h]),Gt(f?p*r/u:p&&r?u/p*r:0)},rn=function(t,e,s,n){var r;return iu||eh(),e in Vs&&e!=="transform"&&(e=Vs[e],~e.indexOf(",")&&(e=e.split(",")[0])),gn[e]&&e!=="transform"?(r=go(t,n),r=e!=="transformOrigin"?r[e]:r.svg?r.origin:Ha(Gs(t,Ne))+" "+r.zOrigin+"px"):(r=t.style[e],(!r||r==="auto"||n||~(r+"").indexOf("calc("))&&(r=Na[e]&&Na[e](t,e,s)||Gs(t,e)||Im(t,e)||(e==="opacity"?1:0))),s&&!~(r+"").trim().indexOf(" ")?zn(t,e,r,s)+s:r},lw=function(t,e,s,n){if(!s||s==="none"){var r=hr(e,t,1),o=r&&Gs(t,r,1);o&&o!==s?(e=r,s=o):e==="borderColor"&&(s=Gs(t,"borderTopColor"))}var a=new Be(this._pt,t.style,e,0,1,fv),l=0,c=0,h,u,f,d,p,g,m,v,_,y,b,S;if(a.b=s,a.e=n,s+="",n+="",n==="auto"&&(g=t.style[e],t.style[e]=n,n=Gs(t,e)||n,g?t.style[e]=g:bi(t,e)),h=[s,n],sv(h),s=h[0],n=h[1],f=s.match(Li)||[],S=n.match(Li)||[],S.length){for(;u=Li.exec(n);)m=u[0],_=n.substring(l,u.index),p?p=(p+1)%5:(_.substr(-5)==="rgba("||_.substr(-5)==="hsla(")&&(p=1),m!==(g=f[c++]||"")&&(d=parseFloat(g)||0,b=g.substr((d+"").length),m.charAt(1)==="="&&(m=Gi(d,m)+b),v=parseFloat(m),y=m.substr((v+"").length),l=Li.lastIndex-y.length,y||(y=y||Qe.units[e]||b,l===n.length&&(n+=y,a.e+=y)),b!==y&&(d=zn(t,e,g,y)||0),a._pt={_next:a._pt,p:_||c===1?_:",",s:d,c:v-d,m:p&&p<4||e==="zIndex"?Math.round:0});a.c=l<n.length?n.substring(l,n.length):""}else a.r=e==="display"&&n==="none"?mv:pv;return Am.test(n)&&(a.e=0),this._pt=a,a},rd={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},cw=function(t){var e=t.split(" "),s=e[0],n=e[1]||"50%";return(s==="top"||s==="bottom"||n==="left"||n==="right")&&(t=s,s=n,n=t),e[0]=rd[s]||s,e[1]=rd[n]||n,e.join(" ")},hw=function(t,e){if(e.tween&&e.tween._time===e.tween._dur){var s=e.t,n=s.style,r=e.u,o=s._gsap,a,l,c;if(r==="all"||r===!0)n.cssText="",l=1;else for(r=r.split(","),c=r.length;--c>-1;)a=r[c],gn[a]&&(l=1,a=a==="transformOrigin"?Ne:Ht),bi(s,a);l&&(bi(s,Ht),o&&(o.svg&&s.removeAttribute("transform"),n.scale=n.rotate=n.translate="none",go(s,1),o.uncache=1,vv(n)))}},Na={clearProps:function(t,e,s,n,r){if(r.data!=="isFromStart"){var o=t._pt=new Be(t._pt,e,s,0,0,hw);return o.u=n,o.pr=-10,o.tween=r,t._props.push(s),1}}},fo=[1,0,0,1,0,0],Cv={},Sv=function(t){return t==="matrix(1, 0, 0, 1, 0, 0)"||t==="none"||!t},od=function(t){var e=Gs(t,Ht);return Sv(e)?fo:e.substr(7).match(Pm).map(Gt)},au=function(t,e){var s=t._gsap||hi(t),n=t.style,r=od(t),o,a,l,c;return s.svg&&t.getAttribute("transform")?(l=t.transform.baseVal.consolidate().matrix,r=[l.a,l.b,l.c,l.d,l.e,l.f],r.join(",")==="1,0,0,1,0,0"?fo:r):(r===fo&&!t.offsetParent&&t!==$i&&!s.svg&&(l=n.display,n.display="block",o=t.parentNode,(!o||!t.offsetParent&&!t.getBoundingClientRect().width)&&(c=1,a=t.nextElementSibling,$i.appendChild(t)),r=od(t),l?n.display=l:bi(t,"display"),c&&(a?o.insertBefore(t,a):o?o.appendChild(t):$i.removeChild(t))),e&&r.length>6?[r[0],r[1],r[4],r[5],r[12],r[13]]:r)},sh=function(t,e,s,n,r,o){var a=t._gsap,l=r||au(t,!0),c=a.xOrigin||0,h=a.yOrigin||0,u=a.xOffset||0,f=a.yOffset||0,d=l[0],p=l[1],g=l[2],m=l[3],v=l[4],_=l[5],y=e.split(" "),b=parseFloat(y[0])||0,S=parseFloat(y[1])||0,P,O,k,D;s?l!==fo&&(O=d*m-p*g)&&(k=b*(m/O)+S*(-g/O)+(g*_-m*v)/O,D=b*(-p/O)+S*(d/O)-(d*_-p*v)/O,b=k,S=D):(P=bv(t),b=P.x+(~y[0].indexOf("%")?b/100*P.width:b),S=P.y+(~(y[1]||y[0]).indexOf("%")?S/100*P.height:S)),n||n!==!1&&a.smooth?(v=b-c,_=S-h,a.xOffset=u+(v*d+_*g)-v,a.yOffset=f+(v*p+_*m)-_):a.xOffset=a.yOffset=0,a.xOrigin=b,a.yOrigin=S,a.smooth=!!n,a.origin=e,a.originIsAbsolute=!!s,t.style[Ne]="0px 0px",o&&(An(o,a,"xOrigin",c,b),An(o,a,"yOrigin",h,S),An(o,a,"xOffset",u,a.xOffset),An(o,a,"yOffset",f,a.yOffset)),t.setAttribute("data-svg-origin",b+" "+S)},go=function(t,e){var s=t._gsap||new ov(t);if("x"in s&&!e&&!s.uncache)return s;var n=t.style,r=s.scaleX<0,o="px",a="deg",l=getComputedStyle(t),c=Gs(t,Ne)||"0",h,u,f,d,p,g,m,v,_,y,b,S,P,O,k,D,z,K,st,G,it,ct,et,Z,Y,pt,Tt,Pt,B,N,X,Vt;return h=u=f=g=m=v=_=y=b=0,d=p=1,s.svg=!!(t.getCTM&&xv(t)),l.translate&&((l.translate!=="none"||l.scale!=="none"||l.rotate!=="none")&&(n[Ht]=(l.translate!=="none"?"translate3d("+(l.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+(l.rotate!=="none"?"rotate("+l.rotate+") ":"")+(l.scale!=="none"?"scale("+l.scale.split(" ").join(",")+") ":"")+(l[Ht]!=="none"?l[Ht]:"")),n.scale=n.rotate=n.translate="none"),O=au(t,s.svg),s.svg&&(s.uncache?(Y=t.getBBox(),c=s.xOrigin-Y.x+"px "+(s.yOrigin-Y.y)+"px",Z=""):Z=!e&&t.getAttribute("data-svg-origin"),sh(t,Z||c,!!Z||s.originIsAbsolute,s.smooth!==!1,O)),S=s.xOrigin||0,P=s.yOrigin||0,O!==fo&&(K=O[0],st=O[1],G=O[2],it=O[3],h=ct=O[4],u=et=O[5],O.length===6?(d=Math.sqrt(K*K+st*st),p=Math.sqrt(it*it+G*G),g=K||st?ki(st,K)*Qn:0,_=G||it?ki(G,it)*Qn+g:0,_&&(p*=Math.abs(Math.cos(_*qi))),s.svg&&(h-=S-(S*K+P*G),u-=P-(S*st+P*it))):(Vt=O[6],N=O[7],Tt=O[8],Pt=O[9],B=O[10],X=O[11],h=O[12],u=O[13],f=O[14],k=ki(Vt,B),m=k*Qn,k&&(D=Math.cos(-k),z=Math.sin(-k),Z=ct*D+Tt*z,Y=et*D+Pt*z,pt=Vt*D+B*z,Tt=ct*-z+Tt*D,Pt=et*-z+Pt*D,B=Vt*-z+B*D,X=N*-z+X*D,ct=Z,et=Y,Vt=pt),k=ki(-G,B),v=k*Qn,k&&(D=Math.cos(-k),z=Math.sin(-k),Z=K*D-Tt*z,Y=st*D-Pt*z,pt=G*D-B*z,X=it*z+X*D,K=Z,st=Y,G=pt),k=ki(st,K),g=k*Qn,k&&(D=Math.cos(k),z=Math.sin(k),Z=K*D+st*z,Y=ct*D+et*z,st=st*D-K*z,et=et*D-ct*z,K=Z,ct=Y),m&&Math.abs(m)+Math.abs(g)>359.9&&(m=g=0,v=180-v),d=Gt(Math.sqrt(K*K+st*st+G*G)),p=Gt(Math.sqrt(et*et+Vt*Vt)),k=ki(ct,et),_=Math.abs(k)>2e-4?k*Qn:0,b=X?1/(X<0?-X:X):0),s.svg&&(Z=t.getAttribute("transform"),s.forceCSS=t.setAttribute("transform","")||!Sv(Gs(t,Ht)),Z&&t.setAttribute("transform",Z))),Math.abs(_)>90&&Math.abs(_)<270&&(r?(d*=-1,_+=g<=0?180:-180,g+=g<=0?180:-180):(p*=-1,_+=_<=0?180:-180)),e=e||s.uncache,s.x=h-((s.xPercent=h&&(!e&&s.xPercent||(Math.round(t.offsetWidth/2)===Math.round(-h)?-50:0)))?t.offsetWidth*s.xPercent/100:0)+o,s.y=u-((s.yPercent=u&&(!e&&s.yPercent||(Math.round(t.offsetHeight/2)===Math.round(-u)?-50:0)))?t.offsetHeight*s.yPercent/100:0)+o,s.z=f+o,s.scaleX=Gt(d),s.scaleY=Gt(p),s.rotation=Gt(g)+a,s.rotationX=Gt(m)+a,s.rotationY=Gt(v)+a,s.skewX=_+a,s.skewY=y+a,s.transformPerspective=b+o,(s.zOrigin=parseFloat(c.split(" ")[2])||!e&&s.zOrigin||0)&&(n[Ne]=Ha(c)),s.xOffset=s.yOffset=0,s.force3D=Qe.force3D,s.renderTransform=s.svg?fw:yv?wv:uw,s.uncache=0,s},Ha=function(t){return(t=t.split(" "))[0]+" "+t[1]},oc=function(t,e,s){var n=ge(e);return Gt(parseFloat(e)+parseFloat(zn(t,"x",s+"px",n)))+n},uw=function(t,e){e.z="0px",e.rotationY=e.rotationX="0deg",e.force3D=0,wv(t,e)},Kn="0deg",Sr="0px",Zn=") ",wv=function(t,e){var s=e||this,n=s.xPercent,r=s.yPercent,o=s.x,a=s.y,l=s.z,c=s.rotation,h=s.rotationY,u=s.rotationX,f=s.skewX,d=s.skewY,p=s.scaleX,g=s.scaleY,m=s.transformPerspective,v=s.force3D,_=s.target,y=s.zOrigin,b="",S=v==="auto"&&t&&t!==1||v===!0;if(y&&(u!==Kn||h!==Kn)){var P=parseFloat(h)*qi,O=Math.sin(P),k=Math.cos(P),D;P=parseFloat(u)*qi,D=Math.cos(P),o=oc(_,o,O*D*-y),a=oc(_,a,-Math.sin(P)*-y),l=oc(_,l,k*D*-y+y)}m!==Sr&&(b+="perspective("+m+Zn),(n||r)&&(b+="translate("+n+"%, "+r+"%) "),(S||o!==Sr||a!==Sr||l!==Sr)&&(b+=l!==Sr||S?"translate3d("+o+", "+a+", "+l+") ":"translate("+o+", "+a+Zn),c!==Kn&&(b+="rotate("+c+Zn),h!==Kn&&(b+="rotateY("+h+Zn),u!==Kn&&(b+="rotateX("+u+Zn),(f!==Kn||d!==Kn)&&(b+="skew("+f+", "+d+Zn),(p!==1||g!==1)&&(b+="scale("+p+", "+g+Zn),_.style[Ht]=b||"translate(0, 0)"},fw=function(t,e){var s=e||this,n=s.xPercent,r=s.yPercent,o=s.x,a=s.y,l=s.rotation,c=s.skewX,h=s.skewY,u=s.scaleX,f=s.scaleY,d=s.target,p=s.xOrigin,g=s.yOrigin,m=s.xOffset,v=s.yOffset,_=s.forceCSS,y=parseFloat(o),b=parseFloat(a),S,P,O,k,D;l=parseFloat(l),c=parseFloat(c),h=parseFloat(h),h&&(h=parseFloat(h),c+=h,l+=h),l||c?(l*=qi,c*=qi,S=Math.cos(l)*u,P=Math.sin(l)*u,O=Math.sin(l-c)*-f,k=Math.cos(l-c)*f,c&&(h*=qi,D=Math.tan(c-h),D=Math.sqrt(1+D*D),O*=D,k*=D,h&&(D=Math.tan(h),D=Math.sqrt(1+D*D),S*=D,P*=D)),S=Gt(S),P=Gt(P),O=Gt(O),k=Gt(k)):(S=u,k=f,P=O=0),(y&&!~(o+"").indexOf("px")||b&&!~(a+"").indexOf("px"))&&(y=zn(d,"x",o,"px"),b=zn(d,"y",a,"px")),(p||g||m||v)&&(y=Gt(y+p-(p*S+g*O)+m),b=Gt(b+g-(p*P+g*k)+v)),(n||r)&&(D=d.getBBox(),y=Gt(y+n/100*D.width),b=Gt(b+r/100*D.height)),D="matrix("+S+","+P+","+O+","+k+","+y+","+b+")",d.setAttribute("transform",D),_&&(d.style[Ht]=D)},dw=function(t,e,s,n,r){var o=360,a=ie(r),l=parseFloat(r)*(a&&~r.indexOf("rad")?Qn:1),c=l-n,h=n+c+"deg",u,f;return a&&(u=r.split("_")[1],u==="short"&&(c%=o,c!==c%(o/2)&&(c+=c<0?o:-360)),u==="cw"&&c<0?c=(c+o*td)%o-~~(c/o)*o:u==="ccw"&&c>0&&(c=(c-o*td)%o-~~(c/o)*o)),t._pt=f=new Be(t._pt,e,s,n,c,KS),f.e=h,f.u="deg",t._props.push(s),f},ad=function(t,e){for(var s in e)t[s]=e[s];return t},gw=function(t,e,s){var n=ad({},s._gsap),r="perspective,force3D,transformOrigin,svgOrigin",o=s.style,a,l,c,h,u,f,d,p;n.svg?(c=s.getAttribute("transform"),s.setAttribute("transform",""),o[Ht]=e,a=go(s,1),bi(s,Ht),s.setAttribute("transform",c)):(c=getComputedStyle(s)[Ht],o[Ht]=e,a=go(s,1),o[Ht]=c);for(l in gn)c=n[l],h=a[l],c!==h&&r.indexOf(l)<0&&(d=ge(c),p=ge(h),u=d!==p?zn(s,l,c,p):parseFloat(c),f=parseFloat(h),t._pt=new Be(t._pt,a,l,u,f-u,Qc),t._pt.u=p||0,t._props.push(l));ad(a,n)};Ie("padding,margin,Width,Radius",function(i,t){var e="Top",s="Right",n="Bottom",r="Left",o=(t<3?[e,s,n,r]:[e+r,e+s,n+s,n+r]).map(function(a){return t<2?i+a:"border"+a+i});Na[t>1?"border"+i:i]=function(a,l,c,h,u){var f,d;if(arguments.length<4)return f=o.map(function(p){return rn(a,p,c)}),d=f.join(" "),d.split(f[0]).length===5?f[0]:d;f=(h+"").split(" "),d={},o.forEach(function(p,g){return d[p]=f[g]=f[g]||f[(g-1)/2|0]}),a.init(l,d,u)}});var Tv={name:"css",register:eh,targetTest:function(t){return t.style&&t.nodeType},init:function(t,e,s,n,r){var o=this._props,a=t.style,l=s.vars.startAt,c,h,u,f,d,p,g,m,v,_,y,b,S,P,O,k;iu||eh(),this.styles=this.styles||_v(t),k=this.styles.props,this.tween=s;for(g in e)if(g!=="autoRound"&&(h=e[g],!(Ge[g]&&av(g,e,s,n,t,r)))){if(d=typeof h,p=Na[g],d==="function"&&(h=h.call(s,n,t,r),d=typeof h),d==="string"&&~h.indexOf("random(")&&(h=co(h)),p)p(this,t,g,h,s)&&(O=1);else if(g.substr(0,2)==="--")c=(getComputedStyle(t).getPropertyValue(g)+"").trim(),h+="",Ln.lastIndex=0,Ln.test(c)||(m=ge(c),v=ge(h)),v?m!==v&&(c=zn(t,g,c,v)+v):m&&(h+=m),this.add(a,"setProperty",c,h,n,r,0,0,g),o.push(g),k.push(g,0,a[g]);else if(d!=="undefined"){if(l&&g in l?(c=typeof l[g]=="function"?l[g].call(s,n,t,r):l[g],ie(c)&&~c.indexOf("random(")&&(c=co(c)),ge(c+"")||c==="auto"||(c+=Qe.units[g]||ge(rn(t,g))||""),(c+"").charAt(1)==="="&&(c=rn(t,g))):c=rn(t,g),f=parseFloat(c),_=d==="string"&&h.charAt(1)==="="&&h.substr(0,2),_&&(h=h.substr(2)),u=parseFloat(h),g in Vs&&(g==="autoAlpha"&&(f===1&&rn(t,"visibility")==="hidden"&&u&&(f=0),k.push("visibility",0,a.visibility),An(this,a,"visibility",f?"inherit":"hidden",u?"inherit":"hidden",!u)),g!=="scale"&&g!=="transform"&&(g=Vs[g],~g.indexOf(",")&&(g=g.split(",")[0]))),y=g in gn,y){if(this.styles.save(g),b||(S=t._gsap,S.renderTransform&&!e.parseTransform||go(t,e.parseTransform),P=e.smoothOrigin!==!1&&S.smooth,b=this._pt=new Be(this._pt,a,Ht,0,1,S.renderTransform,S,0,-1),b.dep=1),g==="scale")this._pt=new Be(this._pt,S,"scaleY",S.scaleY,(_?Gi(S.scaleY,_+u):u)-S.scaleY||0,Qc),this._pt.u=0,o.push("scaleY",g),g+="X";else if(g==="transformOrigin"){k.push(Ne,0,a[Ne]),h=cw(h),S.svg?sh(t,h,0,P,0,this):(v=parseFloat(h.split(" ")[2])||0,v!==S.zOrigin&&An(this,S,"zOrigin",S.zOrigin,v),An(this,a,g,Ha(c),Ha(h)));continue}else if(g==="svgOrigin"){sh(t,h,1,P,0,this);continue}else if(g in Cv){dw(this,S,g,f,_?Gi(f,_+h):h);continue}else if(g==="smoothOrigin"){An(this,S,"smooth",S.smooth,h);continue}else if(g==="force3D"){S[g]=h;continue}else if(g==="transform"){gw(this,h,t);continue}}else g in a||(g=hr(g)||g);if(y||(u||u===0)&&(f||f===0)&&!qS.test(h)&&g in a)m=(c+"").substr((f+"").length),u||(u=0),v=ge(h)||(g in Qe.units?Qe.units[g]:m),m!==v&&(f=zn(t,g,c,v)),this._pt=new Be(this._pt,y?S:a,g,f,(_?Gi(f,_+u):u)-f,!y&&(v==="px"||g==="zIndex")&&e.autoRound!==!1?JS:Qc),this._pt.u=v||0,m!==v&&v!=="%"&&(this._pt.b=c,this._pt.r=ZS);else if(g in a)lw.call(this,t,g,c,_?_+h:h);else if(g in t)this.add(t,g,c||t[g],_?_+h:h,n,r);else if(g!=="parseTransform"){qh(g,h);continue}y||(g in a?k.push(g,0,a[g]):typeof t[g]=="function"?k.push(g,2,t[g]()):k.push(g,1,c||t[g])),o.push(g)}}O&&dv(this)},render:function(t,e){if(e.tween._time||!ru())for(var s=e._pt;s;)s.r(t,s.d),s=s._next;else e.styles.revert()},get:rn,aliases:Vs,getSetter:function(t,e,s){var n=Vs[e];return n&&n.indexOf(",")<0&&(e=n),e in gn&&e!==Ne&&(t._gsap.x||rn(t,"x"))?s&&Qf===s?e==="scale"?sw:ew:(Qf=s||{})&&(e==="scale"?nw:iw):t.style&&!Uh(t.style[e])?QS:~e.indexOf("-")?tw:su(t,e)},core:{_removeProperty:bi,_getMatrix:au}};He.utils.checkPrefix=hr;He.core.getStyleSaver=_v;(function(i,t,e,s){var n=Ie(i+","+t+","+e,function(r){gn[r]=1});Ie(t,function(r){Qe.units[r]="deg",Cv[r]=1}),Vs[n[13]]=i+","+t,Ie(s,function(r){var o=r.split(":");Vs[o[1]]=n[o[0]]})})("x,y,z,scale,scaleX,scaleY,xPercent,yPercent","rotation,rotationX,rotationY,skewX,skewY","transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective","0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY");Ie("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function(i){Qe.units[i]="px"});He.registerPlugin(Tv);var kr=He.registerPlugin(Tv)||He;kr.core.Tween;function pw(){return{zoomToFrame:(n,r={})=>{const{duration:o=2.5,viewportTransform:a,onComplete:l,ease:c="power3.inOut",exitEffect:h=!0,exitScale:u=.9,transitionType:f="zoom-pan"}=r;if(f==="initial"){n.setViewportTransform(a),n.requestRenderAll(),l&&l();return}const d=[...n.viewportTransform];console.log("动画开始 - 当前视口:",d),console.log("动画开始 - 目标视口:",a);const p=d[0],g=d[4],m=d[5],v=a[0],_=a[4],y=a[5],b={scale:p,translateX:g,translateY:m,progress:0,opacity:1},S=kr.timeline({onComplete:()=>{console.log("动画完成 - 最终视口:",n.viewportTransform),l&&l()}}),P=window.screen.width*window.devicePixelRatio,O=window.screen.height*window.devicePixelRatio,k=P/2,D=O/2,z=(k-g)/p,K=(D-m)/p,st=(k-_)/v,G=(D-y)/v;f==="zoom-in"?S.to(b,{duration:o,scale:v,translateX:_,translateY:y,ease:c,onUpdate:it}):f==="pan"?S.to(b,{duration:o,translateX:_,translateY:y,ease:c,onUpdate:it}):(h&&S.to(b,{duration:o*.3,scale:p*u,opacity:.95,ease:"power2.in",onUpdate:function(){const Z=this.progress(),Y=z+(st-z)*Z*.3,pt=K+(G-K)*Z*.3,Tt=k-Y*b.scale,Pt=D-pt*b.scale,B=[b.scale,0,0,b.scale,Tt,Pt];n.setViewportTransform(B),b.translateX=Tt,b.translateY=Pt,ct(n,b.opacity),n.requestRenderAll()}}),S.to(b,{duration:o*(h?.7:1),scale:v,translateX:_,translateY:y,progress:1,opacity:1,ease:c,onUpdate:it}));function it(){const Z=[b.scale,0,0,b.scale,b.translateX,b.translateY];n.setViewportTransform(Z),b.opacity<1?ct(n,b.opacity):et(n),n.requestRenderAll()}function ct(Z,Y){Z.getObjects().forEach(pt=>{pt._originalOpacity===void 0&&(pt._originalOpacity=pt.opacity),pt.set("opacity",pt._originalOpacity*Y)})}function et(Z){Z.getObjects().forEach(Y=>{Y._originalOpacity!==void 0&&(Y.set("opacity",Y._originalOpacity),delete Y._originalOpacity)})}return S},fadeIn:(n,r=.5)=>{const o=n.opacity||1,a=n.scaleX||1;return n.set({opacity:0,scaleX:a*.9,scaleY:a*.9}),kr.to(n,{duration:r,opacity:o,scaleX:a,scaleY:a,ease:"power2.out"})},fadeOut:(n,r=.5)=>kr.to(n,{duration:r,opacity:0,scaleX:n.scaleX*.9,scaleY:n.scaleY*.9,ease:"power2.in"}),rotateZoom:(n,r={})=>{const{duration:o=1.5,viewportTransform:a,rotation:l=0,onComplete:c,ease:h="power3.inOut"}=r,u=[...n.viewportTransform],f=u[0],d=u[4],p=u[5],g=a[0],m=a[4],v=a[5],_={scale:f,translateX:d,translateY:p,rotation:0};return kr.to(_,{duration:o,scale:g,translateX:m,translateY:v,rotation:l,ease:h,onUpdate:function(){const y=_.rotation*Math.PI/180,b=Math.cos(y),S=Math.sin(y),P=[_.scale*b,_.scale*S,-_.scale*S,_.scale*b,_.translateX,_.translateY];n.setViewportTransform(P),n.requestRenderAll()},onComplete:c})}}}class mw{constructor(t){F(this,"canvas");F(this,"actions",[]);F(this,"currentActionIndex",nt(-1));F(this,"animation",pw());this.canvas=t,this.initializeEventHandlers()}initializeEventHandlers(){window.addEventListener("keydown",this.handleKeyDown.bind(this))}play(t){console.log("PresentPlayManager play actions:",t),this.actions=t,this.currentActionIndex.value=0,this.showInitialView()}showInitialView(){if(this.actions.length===0)return;const t=this.actions[0];if(t.type!=="pageframe")return;const e=ii(this.canvas,t.target),{zoomToFrame:s}=this.animation;s(this.canvas,{viewportTransform:e.transform,duration:1})}handleKeyDown(t){switch(console.log("handleKeyDown:",t.key),t.key){case"ArrowDown":case"ArrowRight":case" ":this.nextFrame();break;case"ArrowUp":case"ArrowLeft":this.previousFrame();break}}determineTransitionType(t,e){if(!t)return"initial";const s=ii(this.canvas,t.target),n=ii(this.canvas,e.target),r=n.left>=s.left&&n.top>=s.top&&n.right<=s.right&&n.bottom<=s.bottom,o=Math.abs(n.width-s.width)/s.width<.02&&Math.abs(n.height-s.height)/s.height<.02;return r?"zoom-in":o?"pan":"zoom-pan"}navigateToFrame(t){const e=this.currentActionIndex.value,s=e>=0?this.actions[e]:null,n=ii(this.canvas,t.target),{zoomToFrame:r}=this.animation,o=this.determineTransitionType(s,t);console.log("过渡类型:",o);let a=2,l=.9;if(s){const h=ii(this.canvas,s.target);this.canvas.setViewportTransform(n.currentTransform);const u=this.canvas.viewportTransform,f=h.centerX*u[0]+u[4],d=h.centerY*u[3]+u[5],p=n.centerX,g=n.centerY,m=Math.sqrt(Math.pow(f-p,2)+Math.pow(d-g,2)),v=5e3,_=1;a=_+(3-_)*Math.min(m/v,1),console.log("页面中心点距离:",m,"计算的动画时长:",a),o==="zoom-pan"&&(l=.8-(.8-.4)*Math.min(m/v,1),console.log("计算的退出缩放比例:",l))}const c={viewportTransform:n.transform,duration:o==="initial"?0:a,exitEffect:o!=="pan",exitScale:l,ease:"power3.inOut",transitionType:o,onComplete:()=>{console.log("Frame切换完成")}};r(this.canvas,c)}nextFrame(){this.currentActionIndex.value>=this.actions.length-1||(this.currentActionIndex.value++,this.navigateToFrame(this.actions[this.currentActionIndex.value]))}previousFrame(){if(this.currentActionIndex.value<=0){this.currentActionIndex.value=0,this.showInitialView();return}this.currentActionIndex.value--,this.navigateToFrame(this.actions[this.currentActionIndex.value])}destroy(){window.removeEventListener("keydown",this.handleKeyDown.bind(this)),this.actions=[],this.currentActionIndex.value=-1}}class vw{constructor(t,e){F(this,"currentMode",nt("edit"));F(this,"canvas");F(this,"presentationCanvas");F(this,"presentPlayManager",null);F(this,"lastPosX",0);F(this,"lastPosY",0);F(this,"isDragging",!1);this.canvas=t,this.presentationCanvas=e,this.initPresentationMode(),this.initPresentationEvents(),document.addEventListener("fullscreenchange",this.handleFullscreenChange.bind(this)),window.addEventListener("keydown",this.handleKeyDown.bind(this)),window.addEventListener("resize",this.handleResize.bind(this))}initPresentationMode(){}handleFullscreenChange(){!document.fullscreenElement&&this.currentMode.value==="present"&&this.exitPresentMode()}initPresentationEvents(){this.presentationCanvas.on("mouse:down",t=>{this.isDragging=!0,this.lastPosX=t.e.clientX,this.lastPosY=t.e.clientY,this.presentationCanvas.defaultCursor="grabbing"}),this.presentationCanvas.on("mouse:move",t=>{if(this.isDragging){const e=t.e.clientX-this.lastPosX,s=t.e.clientY-this.lastPosY,n=this.presentationCanvas.viewportTransform;n[4]+=e,n[5]+=s,this.presentationCanvas.setViewportTransform(n),this.lastPosX=t.e.clientX,this.lastPosY=t.e.clientY}}),this.presentationCanvas.on("mouse:up",()=>{this.isDragging=!1,this.presentationCanvas.defaultCursor="default"}),this.presentationCanvas.on("mouse:wheel",t=>{const e=t.e.deltaY;let s=this.presentationCanvas.getZoom();s*=.999**e,s=Math.min(Math.max(.1,s),20);const n={x:t.e.offsetX,y:t.e.offsetY};this.presentationCanvas.zoomToPoint(new E(n.x,n.y),s),t.e.preventDefault(),t.e.stopPropagation()})}async enterPresentMode(){this.currentMode.value="present",this.showPresentationCanvas(),this.presentPlayManager=new mw(this.presentationCanvas);const t=[];this.presentationCanvas.forEachObject(n=>{n.selectable=!0,n.lockMovementX=!0,n.lockMovementY=!0,n.lockRotation=!0,n.lockScalingX=!0,n.lockScalingY=!0,n.hasControls=!1,n.hasBorders=!0}),console.log("enterPresentMode:",this.presentationCanvas.getObjects());const e=this.presentationCanvas.getObjects().find(n=>n.type===ce.type);e&&t.push({type:"pageframe",target:e});const s=this.presentationCanvas.getObjects().filter(n=>n.type===zt.type);s.sort((n,r)=>(n.order||0)-(r.order||0)),s.forEach(n=>{t.push({type:"frame",target:n})}),console.log("playActions:",t),this.presentPlayManager.play(t)}exitPresentMode(){this.currentMode.value="edit",this.presentPlayManager&&(this.presentPlayManager.destroy(),this.presentPlayManager=null),this.hidePresentationCanvas()}async cloneCanvasContent(){console.log("开始克隆内容到演示画布"),this.presentationCanvas.clear(),this.presentationCanvas.setViewportTransform([1,0,0,1,0,0]);const t=this.canvas.getObjects();for(const e of t){console.log(`正在克隆对象: ${e.type}, id: ${e.id}`);try{await e.clone("type","name").then(s=>{(e.type==="pageframe"||e.type==="frame")&&s.set({stroke:"transparent",shadow:null,strokeWidth:0}),s.set({left:e.left,top:e.top,scaleX:e.scaleX,scaleY:e.scaleY,angle:e.angle,selectable:!0,lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,hasControls:!0,hasBorders:!0}),console.log(`添加克隆对象到演示画布: ${e.type}, id: ${e.id}`),this.presentationCanvas.add(s)})}catch(s){console.error(`克隆对象失败: ${e.type}, id: ${e.id}`,s)}}console.log(`演示画布现在有 ${this.presentationCanvas.getObjects().length} 个对象`),this.presentationCanvas.requestRenderAll()}showPresentationCanvas(){if(this.canvas.wrapperEl&&(this.canvas.wrapperEl.style.display="none"),this.presentationCanvas.wrapperEl){const t=this.presentationCanvas.wrapperEl;Object.assign(t.style,{display:"block",position:"fixed",top:"0",left:"0",width:"100vw",height:"100vh",zIndex:"9999",backgroundColor:"#fff"}),this.ensureCanvasLayersVisible()}this.enterFullscreen(),this.adjustPresentationSize(),this.presentationCanvas.requestRenderAll()}ensureCanvasLayersVisible(){const t=this.presentationCanvas.lowerCanvasEl;t&&(t.style.display="block",t.style.visibility="visible");const e=this.presentationCanvas.upperCanvasEl;e&&(e.style.display="block",e.style.visibility="visible");const s=this.presentationCanvas.cacheCanvasEl;s&&(s.style.display="block",s.style.visibility="visible")}hidePresentationCanvas(){this.exitFullscreen(),this.presentationCanvas.wrapperEl&&(this.presentationCanvas.wrapperEl.style.display="none"),this.canvas.wrapperEl&&(this.canvas.wrapperEl.style.display="block")}handleKeyDown(t){if(this.currentMode.value==="present")switch(t.key){case"Escape":this.exitPresentMode();break}}handleResize(){this.currentMode.value==="present"&&this.adjustPresentationSize()}adjustPresentationSize(){const t=window.innerWidth,e=window.innerHeight;console.log(`调整演示画布尺寸: ${t}x${e}`),this.presentationCanvas.setDimensions({width:t,height:e}),this.presentationCanvas.requestRenderAll(),this.ensureCanvasLayersVisible(),console.log("演示画布状态:",{对象数量:this.presentationCanvas.getObjects().length,背景色:this.presentationCanvas.backgroundColor,尺寸:{width:this.presentationCanvas.width,height:this.presentationCanvas.height},视口变换:this.presentationCanvas.viewportTransform})}async enterFullscreen(){try{this.presentationCanvas.wrapperEl&&this.presentationCanvas.wrapperEl.requestFullscreen&&await this.presentationCanvas.wrapperEl.requestFullscreen()}catch(t){console.error("Failed to enter fullscreen:",t)}}async exitFullscreen(){try{document.fullscreenElement&&await document.exitFullscreen()}catch(t){console.error("Failed to exit fullscreen:",t)}}}class _w{constructor(t,e){F(this,"canvas");F(this,"canvasManager");F(this,"isSpaceDragging",!1);F(this,"clipboardObject",null);this.canvas=t,this.canvasManager=e,this.initSpaceDragMode(),this.initCopyPasteHandlers()}initSpaceDragMode(){window.addEventListener("keydown",this.handleKeyDown.bind(this)),window.addEventListener("keyup",this.handleKeyUp.bind(this))}initCopyPasteHandlers(){window.addEventListener("keydown",this.handleCopyPaste.bind(this))}handleKeyDown(t){t.code==="Space"&&!this.isSpaceDragging&&(this.isSpaceDragging=!0,this.canvas.defaultCursor="grab",this.canvas.selection=!1,this.canvas.forEachObject(e=>{e.selectable=!1,e.evented=!1}))}handleKeyUp(t){t.code==="Space"&&(this.isSpaceDragging=!1,this.canvas.defaultCursor="default",this.canvas.selection=!0,this.canvas.forEachObject(e=>{e.selectable=!0,e.evented=!0}))}pasteImageFromUrl(t){console.log("从URL粘贴图片到画布",t);let e=this.canvas.getVpCenter();const s=this.canvasManager.getControlsManager();if(!s){console.error("ControlsManager 不可用");return}s.addImage(t,{left:e.x,top:e.y,originX:"center",originY:"center"}).then(n=>{n&&console.log("已粘贴剪贴板图片",n)}).catch(n=>{console.error("粘贴剪贴板图片失败:",n),URL.revokeObjectURL(t)})}handleCopyPaste(t){if(t.ctrlKey){const e=this.canvas.getActiveObject();if(e&&"isEditing"in e&&e.isEditing)return;t.code==="KeyC"?(t.preventDefault(),t.stopPropagation(),this.handleCopy()):t.code==="KeyV"&&(t.preventDefault(),t.stopPropagation(),this.checkClipboardAndPaste())}}handleCopy(){const t=this.canvas.getActiveObject();t&&!(t instanceof Qt)&&t.clone().then(e=>{this.clipboardObject=e;const s=document.createElement("textarea");s.value="next-slide-object",s.style.position="fixed",s.style.left="-999999px",s.style.top="-999999px",document.body.appendChild(s),s.focus(),s.select();const n=document.execCommand("copy");document.body.removeChild(s),n?console.log("成功使用 execCommand 复制到剪贴板"):console.warn("execCommand 复制失败"),console.log("已复制对象",e)}).catch(e=>{console.error("复制对象失败:",e)})}async checkClipboardAndPaste(){try{const t=await navigator.clipboard.read();let e=!1;for(const s of t)if(s.types.includes("image/png")||s.types.includes("image/jpeg")||s.types.includes("image/gif")){const n=await s.getType(s.types.find(o=>o.startsWith("image/"))||"image/png"),r=URL.createObjectURL(n);this.pasteImageFromUrl(r),e=!0;break}!e&&this.clipboardObject&&this.handleInternalPaste()}catch(t){console.warn("无法读取系统剪贴板:",t),this.clipboardObject&&this.handleInternalPaste()}}async handleInternalPaste(){if(console.log("handleInternalPaste 粘贴事件触发"),!this.clipboardObject){console.log("剪贴板为空，没有可粘贴的对象");return}const t=this.canvas.getActiveObject();let e={x:this.canvas.width/2,y:this.canvas.height/2};if(t){const n=t.getCenterPoint();e={x:n.x,y:n.y}}const s=this.canvasManager.getControlsManager();if(!s){console.error("ControlsManager 不可用");return}try{const n=await s.addClonedObject(this.clipboardObject,{left:e.x,top:e.y,originX:"center",originY:"center"});n?(this.canvas.setActiveObject(n),this.canvas.requestRenderAll(),console.log("已粘贴对象",n)):console.error("粘贴对象失败: 无法创建克隆对象")}catch(n){console.error("粘贴对象失败:",n)}}isInSpaceDragMode(){return this.isSpaceDragging}destroy(){window.removeEventListener("keydown",this.handleKeyDown.bind(this)),window.removeEventListener("keyup",this.handleKeyUp.bind(this)),window.removeEventListener("keydown",this.handleCopyPaste.bind(this))}}class yw{constructor(t,e,s){F(this,"canvas");F(this,"canvasManager");F(this,"eventManager");F(this,"isDragging",!1);F(this,"lastPosX",0);F(this,"lastPosY",0);F(this,"currentHoverObject",null);this.canvas=t,this.canvasManager=e,this.eventManager=s,this.setupEventOverrides(),this.initMouseEvents()}initMouseEvents(){this.setupMouseDownEvents(),this.setupMouseMoveEvents(),this.setupMouseUpEvents(),this.setupMouseWheelEvents()}setupEventOverrides(){const t=this.canvas,e=this.canvas.findTarget;this.canvas.findTarget=function(s){const n=this.getPointer(s,!0),r=new E(n.x,n.y),{target:o}=Zl(t,r);return o||e.call(this,s)}}setupMouseDownEvents(){this.canvas.on("mouse:down",t=>{if(this.eventManager.getKeyboardHandler().isInSpaceDragMode())this.isDragging=!0,this.canvas.selection=!1,this.canvas.defaultCursor="grabbing";else{this.isDragging=!1,this.canvas.selection=!0;const e=this.canvas.getViewportPoint(t);console.log("[MouseEventHandler] mouse:down：",e);const s=new E(e.x,e.y),{target:n}=Zl(this.canvas,s);if(n){this.canvas.setActiveObject(n),this.canvas.requestRenderAll(),t.target=n;return}}this.lastPosX=t.e.clientX,this.lastPosY=t.e.clientY})}setupMouseMoveEvents(){let t=null;this.canvas.on("mouse:move",e=>{if(this.isDragging){if(t)return;t=requestAnimationFrame(()=>{const n=e.e.clientX-this.lastPosX,r=e.e.clientY-this.lastPosY,o=this.canvas.viewportTransform;o[4]+=n,o[5]+=r,this.canvas.setViewportTransform(o),this.lastPosX=e.e.clientX,this.lastPosY=e.e.clientY,t=null});return}const s=this.canvas.getViewportPoint(e);this.eventManager.getKeyboardHandler().isInSpaceDragMode()||this.canvas.isDraggingObject||this.handleObjectHover(s)})}handleObjectHover(t){this.canvas.defaultCursor="default";const e=new E(t.x,t.y),{target:s}=Zl(this.canvas,e);this.currentHoverObject!==s&&(this.currentHoverObject&&(this.canvas.getActiveObjects().includes(this.currentHoverObject)||this.handleHoverOut(this.currentHoverObject)),s&&(this.canvas.getActiveObjects().includes(s)||this.handleHoverIn(s)),this.currentHoverObject=s,this.canvas.requestRenderAll())}setupMouseUpEvents(){this.canvas.on("mouse:up",()=>{this.isDragging=!1,this.eventManager.getKeyboardHandler().isInSpaceDragMode()?this.canvas.defaultCursor="grab":this.canvas.selection=!0})}setupMouseWheelEvents(){this.canvas.on("mouse:wheel",t=>{const e=t.e.deltaY;let s=this.canvas.getZoom();s*=.999**e,s=Math.min(Math.max(zs.MIN_ZOOM,s),zs.MAX_ZOOM);const n={x:t.e.offsetX,y:t.e.offsetY};this.canvas.zoomToPoint(new E(n.x,n.y),s),t.e.preventDefault(),t.e.stopPropagation()})}handleHoverIn(t){if(t.type==="text"&&typeof t.showBorder=="function"){t.showBorder(!0);return}t._originalCustomBorderColor||this.saveOriginalState(t),t._originalHoverCursor||(t._originalHoverCursor=t.hoverCursor,t.hoverCursor="default");const e=this.canvas.getZoom(),s={borderColor:Ee.BORDER.HOVER,strokeWidth:zs.STROKE_WIDTH/e,borderScaleFactor:zs.BORDER_SCALE_FACTOR};t.type!=="text"&&t.type!=="textbox"&&(s.customBorderColor=Ee.BORDER.HOVER),t.set(s)}handleHoverOut(t){if(t.type==="text"&&typeof t.showBorder=="function"){t.showBorder(!1);return}t._originalHoverCursor!==void 0&&(t.hoverCursor=t._originalHoverCursor,delete t._originalHoverCursor),this.restoreOriginalState(t)}saveOriginalState(t){t._originalBorderColor=t.borderColor,t._originalStroke=t.stroke,t._originalCustomBorderColor=t.customBorderColor,t._originalStrokeWidth=t.strokeWidth,t._originalBorderScaleFactor=t.borderScaleFactor,t._originalHoverCursor=t.hoverCursor}restoreOriginalState(t){if(t._originalCustomBorderColor!==void 0){const e={borderColor:t._originalBorderColor,strokeWidth:t._originalStrokeWidth,borderScaleFactor:t._originalBorderScaleFactor};t.type!=="text"&&t.type!=="textbox"&&(e.customBorderColor=t._originalCustomBorderColor),t.set(e),delete t._originalBorderColor,delete t._originalStroke,delete t._originalStrokeWidth,delete t._originalBorderScaleFactor,delete t._originalCustomBorderColor,t._originalHoverCursor!==void 0&&(t.hoverCursor=t._originalHoverCursor,delete t._originalHoverCursor),this.canvas.requestRenderAll()}}destroy(){this.canvas.off("mouse:down"),this.canvas.off("mouse:move"),this.canvas.off("mouse:up"),this.canvas.off("mouse:wheel")}}class bw{constructor(t,e){F(this,"canvas");F(this,"canvasManager");this.canvas=t,this.canvasManager=e,this.setupObjectEvents()}setupObjectEvents(){this.canvas.on("object:added",t=>{const e=t.target;e&&yt.emit(ut.CANVAS.CANVAS_UPDATE,{type:ut.CANVAS.CANVAS_UPDATE,target:e})}),this.canvas.on("object:moving",t=>{t.target,this.canvas.isDraggingObject=!0}),this.canvas.on("object:scaling",t=>{t.target}),this.canvas.on("object:rotating",t=>{t.target}),this.canvas.on("object:modified",t=>{this.canvas.isDraggingObject=!1;const e=t.target;e&&yt.emit(ut.CANVAS.CANVAS_UPDATE,{type:ut.CANVAS.CANVAS_UPDATE,target:e})}),this.canvas.on("object:removed",t=>{console.log("object:removed",t);const e=t.target;e&&yt.emit(ut.CANVAS.CANVAS_UPDATE,{type:ut.CANVAS.CANVAS_UPDATE,target:e})})}destroy(){this.canvas.off("object:added"),this.canvas.off("object:modified"),this.canvas.off("object:removed"),this.canvas.off("object:moving"),this.canvas.off("object:scaling"),this.canvas.off("object:rotating")}}class xw{constructor(t,e){F(this,"canvas");F(this,"canvasManager");this.canvas=t,this.canvasManager=e,this.setupSelectionEvents()}setupSelectionEvents(){this.canvas.on("selection:created",this.handleSelection.bind(this)),this.canvas.on("selection:updated",this.handleSelection.bind(this)),this.canvas.on("selection:cleared",this.handleSelectionCleared.bind(this))}handleSelection(t){var s;const e=(s=t.selected)==null?void 0:s[0];e&&(this.handleSelectionEventBorderStatus(t),e.type==="text"||e.type==="textbox"?this.showTextSettingToolbar(e):this.hideTextSettingToolbar(),e.type===zt.type?this.canvasManager.getFrameManager().setCurrentFrame(e):e.type===ce.type&&this.canvasManager.getFrameManager().setCurrentFrame(null),this.toggleFrameNumberControls(e))}handleSelectionCleared(t){this.canvasManager.getFrameManager().setCurrentFrame(null),this.handleSelectionEventBorderStatus(t),this.toggleFrameNumberControls(null),this.hideTextSettingToolbar()}handleSelectionEventBorderStatus(t){const e=t.deselected;if((e==null?void 0:e.length)>0)e.forEach(s=>{if(s.type==="text"&&typeof s.showBorder=="function"){s.showBorder(!1);return}this.restoreOriginalState(s)});else{const s=t.selected;(s==null?void 0:s.length)>0&&s.forEach(n=>{if(n.type==="frame"){n._originalCustomBorderColor===void 0&&(n._originalBorderColor=n.borderColor,n._originalCustomBorderColor=n.customBorderColor,n._originalStrokeWidth=n.strokeWidth,n._originalBorderScaleFactor=n.borderScaleFactor,n.set({borderColor:Ee.BORDER.HOVER,customBorderColor:Ee.BORDER.HOVER,strokeWidth:zs.STROKE_WIDTH}),this.canvas.requestRenderAll());return}})}}restoreOriginalState(t){if(t._originalCustomBorderColor!==void 0){const e={borderColor:t._originalBorderColor};t.type!=="text"&&t.type!=="textbox"&&(e.customBorderColor=t._originalCustomBorderColor),t.set(e),delete t._originalBorderColor,delete t._originalStroke,delete t._originalStrokeWidth,delete t._originalBorderScaleFactor,delete t._originalCustomBorderColor,this.canvas.requestRenderAll()}}toggleFrameNumberControls(t){if(!t){console.log("隐藏所有Frame的控件"),this.hideAllFrameNumberControls();return}this.canvas.getActiveObjects().length>0&&this.hasFrameSelected()?this.showAllFrameNumberControls(t):this.hideAllFrameNumberControls()}hasFrameSelected(){return this.canvas.getActiveObjects().some(e=>e instanceof zt)}showAllFrameNumberControls(t){this.canvas.getObjects().forEach(s=>{s instanceof zt&&(s.setNumberControlVisibility(!0),s.isCurrentSelected=s===t)}),this.canvas.requestRenderAll()}hideAllFrameNumberControls(){this.canvas.getObjects().forEach(e=>{e instanceof zt&&(e.setNumberControlVisibility(!1),e.isCurrentSelected=!1)}),this.canvas.requestRenderAll()}showTextSettingToolbar(t){!t||t.type!=="text"&&t.type!=="textbox"||yt.emit(ut.CONTROL_PANEL.SHOW_TEXT_SETTING_TOOLBAR,{target:t,canvas:this.canvas,canvasManager:this.canvasManager})}hideTextSettingToolbar(){yt.emit(ut.CONTROL_PANEL.HIDE_TEXT_SETTING_TOOLBAR)}destroy(){this.canvas.off("selection:created"),this.canvas.off("selection:updated"),this.canvas.off("selection:cleared")}}class Cw{constructor(t,e){F(this,"keyboardHandler");F(this,"mouseHandler");F(this,"objectEventHandler");F(this,"selectionEventHandler");this.keyboardHandler=new _w(t,e),this.mouseHandler=new yw(t,e,this),this.objectEventHandler=new bw(t,e),this.selectionEventHandler=new xw(t,e)}getKeyboardHandler(){return this.keyboardHandler}getMouseHandler(){return this.mouseHandler}destroy(){this.keyboardHandler.destroy(),this.mouseHandler.destroy()}}class Sw{constructor(t,e){F(this,"syncEnabled",!0);F(this,"syncDebounceTimer",null);F(this,"syncInProgress",!1);F(this,"pendingSync",!1);F(this,"backgroundColorListener",null);F(this,"backgroundImageListener",null);this.sourceCanvas=t,this.targetCanvas=e,this.initCanvasSyncEvents()}initCanvasSyncEvents(){this.sourceCanvas.on("object:added",()=>this.debounceSyncCanvases()),this.sourceCanvas.on("object:removed",()=>this.debounceSyncCanvases()),this.sourceCanvas.on("object:modified",()=>this.debounceSyncCanvases()),this.sourceCanvas.on("after:render",()=>{this.pendingSync&&!this.syncInProgress&&this.syncCanvases()}),this.backgroundColorListener=t=>{console.log("背景颜色变化:",t,t.canvas,this.sourceCanvas,t.canvas===this.sourceCanvas),t&&(console.log("同步背景色:",this.sourceCanvas),this.debounceSyncCanvases())},yt.on(ut.CANVAS.BACKGROUND_COLOR_CHANGE,this.backgroundColorListener),this.backgroundImageListener=t=>{t&&this.debounceSyncCanvases()},yt.on(ut.CANVAS.BACKGROUND_IMAGE_CHANGE,this.backgroundImageListener)}debounceSyncCanvases(t=500){if(this.syncEnabled){if(this.syncInProgress){this.pendingSync=!0;return}this.syncDebounceTimer!==null&&window.clearTimeout(this.syncDebounceTimer),this.syncDebounceTimer=window.setTimeout(()=>{this.syncCanvases()},t)}}async syncCanvases(){if(!(!this.syncEnabled||this.syncInProgress)){this.syncInProgress=!0,this.pendingSync=!1;try{if(this.targetCanvas.clear(),this.sourceCanvas.backgroundColor&&(this.targetCanvas.backgroundColor=this.sourceCanvas.backgroundColor),this.sourceCanvas.backgroundImage)try{const n=this.sourceCanvas.backgroundImage;if(typeof n.getSrc=="function"){const r=n.getSrc();r&&Se.fromURL(r,{crossOrigin:"anonymous"}).then(o=>{o&&(o.scaleX=n.scaleX||1,o.scaleY=n.scaleY||1,o.left=n.left||0,o.top=n.top||0,o.originX=n.originX||"left",o.originY=n.originY||"top",o.width=n.width,o.height=n.height,this.targetCanvas.backgroundImage=o,this.targetCanvas.requestRenderAll())})}else try{const r=await n.clone();this.targetCanvas.backgroundImage=r,this.targetCanvas.requestRenderAll()}catch(r){console.error("背景图片克隆失败，尝试备选方法:",r);const o=n.toJSON(),a=await Dn.enlivenObjects([o]);a&&a[0]&&(this.targetCanvas.backgroundImage=a[0],this.targetCanvas.requestRenderAll())}}catch(n){console.error("背景图片同步失败:",n)}const e=this.sourceCanvas.getObjects().map(n=>new Promise(async r=>{try{const o=await n.clone();r(o)}catch(o){console.error(`克隆对象失败: ${n.type}`,o);const a=new ne;r(a)}}));(await Promise.all(e)).forEach(n=>{if(!n)return;n.hasOwnProperty("controls")&&(n.controls={});const r=n.type;(r===zt.type||r===ce.type||r===Qt.type)&&(n.customBorderColor="transparent",n.fill="transparent",n.backgroundColor="transparent",n.stroke="transparent",r===zt.type&&typeof n.setNumberControlVisibility=="function"&&n.setNumberControlVisibility(!1),n.selectable=!1,n.hoverCursor="default"),this.targetCanvas.add(n)}),this.targetCanvas.requestRenderAll(),this.syncInProgress=!1,this.pendingSync&&requestAnimationFrame(()=>this.syncCanvases())}catch(t){console.error("同步画布失败:",t),this.syncInProgress=!1}}}enableSync(t=!0){this.syncEnabled=t,t&&!this.syncInProgress&&this.syncCanvases()}forceSyncCanvases(){this.syncDebounceTimer!==null&&(window.clearTimeout(this.syncDebounceTimer),this.syncDebounceTimer=null),this.syncCanvases()}destroy(){this.syncDebounceTimer!==null&&(window.clearTimeout(this.syncDebounceTimer),this.syncDebounceTimer=null),this.sourceCanvas.off("object:added"),this.sourceCanvas.off("object:removed"),this.sourceCanvas.off("object:modified"),this.sourceCanvas.off("after:render"),this.backgroundColorListener&&(yt.off(ut.CANVAS.BACKGROUND_COLOR_CHANGE,this.backgroundColorListener),this.backgroundColorListener=null),this.backgroundImageListener&&(yt.off(ut.CANVAS.BACKGROUND_IMAGE_CHANGE,this.backgroundImageListener),this.backgroundImageListener=null)}}class ww{constructor(t,e,s,n={}){F(this,"controlsManager");F(this,"canvas");F(this,"presentationCanvas");F(this,"canvasSyncManager");F(this,"pageFrameManager");F(this,"frameManager");F(this,"modeManager");F(this,"eventManager");F(this,"isDragging",!1);F(this,"lastPosX",0);F(this,"lastPosY",0);F(this,"contextMenuManager");F(this,"isSpaceDragging",!1);const r={width:s.clientWidth,height:s.clientHeight,backgroundColor:"#00000000",selection:!0,preserveObjectStacking:!0,allowTouchScrolling:!1,stopContextMenu:!0,skipOffscreen:!0,fireRightClick:!1,fireMiddleClick:!1,enableRetinaScaling:!0,renderOnAddRemove:!0,stateful:!1,...n};this.canvas=new Ui(t,r),this.canvas.viewportTransform=[1,0,0,1,0,0],this.presentationCanvas=new ro(e,{...r,selection:!1}),this.presentationCanvas.viewportTransform=[1,0,0,1,0,0],this.canvasSyncManager=new Sw(this.canvas,this.presentationCanvas),this.canvas.wrapperEl.style.transform="translateZ(0)",this.canvas.wrapperEl.style.backfaceVisibility="hidden",this.canvas.wrapperEl.style.perspective="1000px",this.canvas.wrapperEl.style.willChange="transform",this.presentationCanvas.wrapperEl.style.transform="translateZ(0)",this.presentationCanvas.wrapperEl.style.backfaceVisibility="hidden",this.presentationCanvas.wrapperEl.style.perspective="1000px",this.presentationCanvas.wrapperEl.style.willChange="transform",this.canvas.selection=!0,this.canvas.skipTargetFind=!1,this.canvas.perPixelTargetFind=!1,this.canvas.targetFindTolerance=4,this.canvas.selection=!0,this.canvas.skipTargetFind=!1,this.canvas.perPixelTargetFind=!1,Fn.createControls=function(){const o=Xi.createObjectDefaultControls();return delete o.mtr,{controls:o}},Fn.ownDefaults={...Fn.ownDefaults,cornerColor:En.CORNER.COLOR,cornerStyle:En.CORNER.STYLE,padding:zs.PADDING_0,cornerSize:En.CORNER.SIZE,transparentCorners:En.CORNER.TRANSPARENT,lockRotation:!1},this.initAligningGuidelines(),this.pageFrameManager=new AC(this.canvas),this.frameManager=this.pageFrameManager.getFrameManager(),this.controlsManager=new FC(this.canvas,this),this.modeManager=new vw(this.canvas,this.presentationCanvas),this.eventManager=new Cw(this.canvas,this),this.contextMenuManager=new HC(this.canvas,this),this.initPageFramge(),this.initResizeListener(),SC(this)}initAligningGuidelines(){const t={margin:4,width:1,color:"rgb(255,0,0,0.9)"};tS(this.canvas,t)}initPageFramge(){const t=this.createPageFrame();this.canvas.add(t),this.canvas.centerObject(t),this.canvas.bringObjectToFront(t)}initResizeListener(){window.addEventListener("resize",()=>{var e;const t=(e=this.canvas.wrapperEl)==null?void 0:e.parentElement;t&&(this.canvas.setDimensions({width:t.clientWidth,height:t.clientHeight}),this.canvas.requestRenderAll())}),window.dispatchEvent(new Event("resize"))}getControlsManager(){return this.controlsManager}getModeManager(){return this.modeManager}createPageFrame(){return this.pageFrameManager.createDefaultPage()}getPageFrame(){return this.pageFrameManager.getPageFrame()}addNewFrame(){return this.pageFrameManager.addNewFrame()}getCurrentFrame(){return this.frameManager.getCurrentFrame()}getAllFrames(){return this.frameManager.getAllFrames()}getAllSlides(){const t=this.getPageFrame(),e=this.frameManager.getAllFrames();return t?[t,...e]:e}deleteFrame(t){this.pageFrameManager.deleteFrame(t)}moveFrameUp(t){this.frameManager.moveFrameUp(t)}moveFrameDown(t){this.frameManager.moveFrameDown(t)}handleResize(t,e){this.canvas.setDimensions({width:t,height:e}),this.presentationCanvas.setDimensions({width:t,height:e})}destroy(){this.canvas.dispose(),this.presentationCanvas.dispose(),this.canvasSyncManager.destroy(),this.canvasSyncManager&&this.canvasSyncManager.destroy()}navigateToFrame(t){const e=this.getMainCanvas(),s=ii(e,t);e.setViewportTransform(s.transform)}setZoom(t){this.canvas.setZoom(t)}getZoom(){return this.canvas.getZoom()}setBackgroundColor(t){this.canvas.backgroundColor=t,this.canvas.requestRenderAll()}getPageFrameManager(){return this.pageFrameManager}getFrameManager(){return this.frameManager}getAllObjects(){return this.canvas.getObjects()}getMainCanvas(){return this.canvas}getPresentationCanvas(){return this.presentationCanvas}clear(){this.pageFrameManager.clear(),this.canvas.clear()}removeObject(t){const e=this.getFrameManager().findParentFrame(t);e&&e.removeContent(t),this.canvas.remove(t)}exportCanvasToJSON(){try{const t=this.canvas.toJSON(),e=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),s=URL.createObjectURL(e),n=document.createElement("a");n.href=s;const r=new Date,o=`NextSlide_Export_${r.getFullYear()}${(r.getMonth()+1).toString().padStart(2,"0")}${r.getDate().toString().padStart(2,"0")}_${r.getHours().toString().padStart(2,"0")}${r.getMinutes().toString().padStart(2,"0")}.json`;n.download=o,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(s),console.log("画布导出成功")}catch(t){console.error("导出画布失败:",t)}}importCanvasFromJSON(t){try{this.clear();const e=typeof t=="string"?JSON.parse(t):t;this.canvas.loadFromJSON(e).then(()=>{console.log("画布导入成功"),this.canvas.requestRenderAll(),this.pageFrameManager.updateReferences()})}catch(e){console.error("导入画布失败:",e)}}}class Tw{constructor(t,e,s,n,r){F(this,"thumbnailCanvases",new Map);F(this,"framesRef");F(this,"canvasManager");F(this,"updateFramesCallback");F(this,"updateTimer",null);F(this,"defaultWidth",224);F(this,"defaultHeight",126);F(this,"eventListenersSet",!1);this.onUpdateStart=s,this.onUpdateComplete=n,console.log("[缩略图管理器] 初始化",t,e),this.canvasManager=t,this.updateFramesCallback=r,this.framesRef=e,this.setupEventListeners(),this.checkCanvasManagerAndUpdate()}async checkCanvasManagerAndUpdate(){var t;for(let e=0;e<5;e++){if(this.canvasManager&&typeof this.canvasManager.getAllSlides=="function"){console.log("[缩略图管理器] canvasManager可用，执行更新帧列表回调"),(t=this.updateFramesCallback)==null||t.call(this);return}console.log(`[缩略图管理器] canvasManager尚未可用，等待重试 (${e+1}/5)`),await new Promise(s=>setTimeout(s,100))}console.warn("[缩略图管理器] canvasManager在多次尝试后仍不可用")}setCanvasManager(t){this.canvasManager=t}setUpdateFramesCallback(t){this.updateFramesCallback=t}getPageOverview(){var t;return(t=this.canvasManager)==null?void 0:t.getPageFrame()}initThumbnailCanvas(t,e,s,n=this.defaultWidth,r=this.defaultHeight){console.log(`[缩略图管理器] 初始化缩略图Canvas:type: ${t}  id: ${e}`,s);const o=document.createElement("canvas");return o.width=n,o.height=r,o.style.width="100%",o.style.height="100%",o.style.objectFit="contain",this.mountCanvasToContainer(s,o),this.thumbnailCanvases.set(e,{canvas:o,container:s}),t===ce.type&&this.updateFrameThumbnails(),o}mountCanvasToContainer(t,e){if(!t){console.warn("[缩略图管理器] 挂载Canvas失败：容器为空");return}if(!(t instanceof HTMLElement)||typeof t.appendChild!="function"){console.error("[缩略图管理器] 挂载Canvas失败：容器不是有效的DOM元素",t);return}console.log("[缩略图管理器] 挂载Canvas到容器",t),t.innerHTML="",t.appendChild(e)}hasThumbnailCanvas(t){return console.log(`[缩略图管理器] 检查是否存在缩略图Canvas: ${t}`,"全部画布缓存：",this.thumbnailCanvases),this.thumbnailCanvases.has(t)}getThumbnailCanvas(t){var e;return(e=this.thumbnailCanvases.get(t))==null?void 0:e.canvas}getPageOverviewCanvas(){return this.getThumbnailCanvas("overview")}getFrameThumbnailCanvas(t){return this.getThumbnailCanvas(t)}getAllThumbnailCanvases(){return this.thumbnailCanvases}setupEventListeners(){this.eventListenersSet||(yt.on(ut.CANVAS.CANVAS_UPDATE,t=>{console.log("[缩略图管理器] 接收到画布更新事件",t),this.updateFramesCallback&&this.updateFramesCallback(),this.updateAllThumbnails()}),this.eventListenersSet=!0,console.log("[缩略图管理器] 事件监听器已设置"))}removeEventListeners(){this.eventListenersSet&&(yt.off(ut.CANVAS.CANVAS_UPDATE),this.eventListenersSet=!1,console.log("[缩略图管理器] 事件监听器已移除"))}updateAllThumbnails(t=100){var e;(e=this.onUpdateStart)==null||e.call(this),console.log("[缩略图] 开始更新所有缩略图"),this.updateTimer&&clearTimeout(this.updateTimer),this.updateTimer=window.setTimeout(async()=>{var s;try{await this.updateFrameThumbnails(),(s=this.onUpdateComplete)==null||s.call(this),console.log("[缩略图] 所有缩略图更新完成")}catch(n){console.error("[缩略图] 更新缩略图时发生错误:",n)}},t)}async updatePageOverviewThumbnail(t){const e=this.thumbnailCanvases.get(t);if(!e){console.warn("[缩略图] 页面概览缩略图未初始化");return}const{canvas:s}=e,n=this.getPageOverview();if(!n){console.warn("[缩略图] 页面概览对象不存在");return}try{console.log("[缩略图] 开始更新页面概览缩略图");const r=await n.thumbnail(s,"PageOverview "+new Date().getTime());r?console.log("[缩略图] 页面概览缩略图更新成功，时间戳:",r.timestamp):console.warn("[缩略图] 页面概览缩略图获取结果为空")}catch(r){console.error("[缩略图] 更新页面概览缩略图失败:",r)}}async updateFrameThumbnails(){let t=[];this.framesRef instanceof Array?t=this.framesRef:t=this.framesRef.value;for(const e of t)try{if(!e.id){console.warn("[缩略图] Frame ID不存在，跳过更新");continue}console.log(`[缩略图] 开始更新Frame ${e.id} 的缩略图`);const s=this.thumbnailCanvases.get(e.id);if(!s){console.warn(`[缩略图] Frame ${e.id} 的缩略图Canvas未初始化，跳过更新`);continue}const{canvas:n}=s,r=await e.thumbnail(n);r?console.log(`[缩略图] Frame ${e.id} 缩略图更新成功，时间戳: ${r.timestamp}`):console.warn(`[缩略图] Frame ${e.id} 缩略图获取结果为空`)}catch(s){console.error("[缩略图] 更新Frame缩略图失败:",s)}}dispose(){this.removeEventListeners(),this.updateTimer&&(clearTimeout(this.updateTimer),this.updateTimer=null),this.thumbnailCanvases.clear()}}const Ow={class:"sidebar-content"},Mw={class:"sidebar-body"},Ew={class:"operation-group"},kw={class:"add-frame-container"},Pw={key:0,class:"dropdown-menu"},Aw={class:"frames-list-container"},Fw={class:"frames-list"},Dw={key:0,class:"frame-number"},Rw={class:"frame-thumbnail"},Lw=["data-frame-id"],jw={class:"frame-title"},Iw={class:"arrow"},Bw=ze({__name:"Sidebar",props:{collapsed:{type:Boolean},canvasManager:{}},emits:["update:collapsed"],setup(i,{emit:t}){w0(O=>({"71bd2c56":Je(Ee).PRIMARY}));const e=i,s=t,n=nt(!1),r=nt([]),o=nt(!1),a=nt(null),l=nt({}),c=nt(null),h=()=>{if(!e.canvasManager){r.value=[];return}const O=e.canvasManager.getAllSlides()||[];r.value=O},u=()=>{e.canvasManager&&(console.log("[Sidebar] 初始化缩略图管理器"),c.value=new Tw(e.canvasManager,r,()=>{},()=>{},()=>{console.log("[Sidebar] Frame列表已初始化完成，回调函数返回"),h()}))},f=()=>{s("update:collapsed",!e.collapsed)},d=te(()=>{var O;return(O=e.canvasManager)==null?void 0:O.getPageFrame()}),p=te(()=>d.value!=null),g=()=>{var O;(O=e.canvasManager)==null||O.addNewFrame(),o.value=!1},m=()=>{var O;(O=e.canvasManager)==null||O.addNewFrame(),o.value=!1},v=O=>{e.canvasManager&&e.canvasManager.navigateToFrame(O)},_=()=>{o.value=!1},y=(O,k)=>{var D;a.value=O,(D=c.value)!=null&&D.initThumbnailCanvas(ce.type,k,O)},b=(O,k)=>{var D;l.value[k]=O,(D=c.value)!=null&&D.initThumbnailCanvas(zt.type,k,O)},S=O=>{v(O)},P=O=>{v(O)};return ds(()=>e.canvasManager,O=>{console.log("[Sidebar] canvasManager 变化:",O),c.value?c.value.setCanvasManager(O):u()},{immediate:!0}),ts(()=>{h(),document.addEventListener("click",_)}),mn(()=>{var O;(O=c.value)!=null&&O.dispose(),document.removeEventListener("click",_)}),(O,k)=>{const D=qd("el-button");return ot(),dt("div",{class:$e(["sidebar",{"sidebar-collapsed":O.collapsed}]),onMouseenter:k[2]||(k[2]=z=>n.value=!0),onMouseleave:k[3]||(k[3]=z=>n.value=!1)},[A("div",Ow,[A("div",Mw,[A("div",Ew,[A("div",kw,[ae(D,{type:"primary",onClick:g,disabled:!p.value,style:cs({backgroundColor:Je(Ee).PRIMARY}),class:"add-frame-button"},{default:mh(()=>k[4]||(k[4]=[A("div",{class:"button-content"},[A("span",null,[A("svg",{class:"plus-icon",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[A("path",{d:"M12 4V20M4 12H20",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"})]),vc("Add frame")])],-1)])),_:1},8,["disabled","style"])]),o.value?(ot(),dt("div",Pw,[A("div",{class:"dropdown-item",onClick:m},k[5]||(k[5]=[A("svg",{class:"draw-icon",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[A("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM21.41 6.34l-3.75-3.75-2.53 2.54 3.75 3.75 2.53-2.54z",fill:"currentColor"})],-1),vc(" 绘制Frame ")]))])):pe("",!0)]),k[6]||(k[6]=A("div",{class:"divider"},null,-1)),A("div",Aw,[A("div",Fw,[(ot(!0),dt(Wt,null,fs(r.value,(z,K,st,G)=>{const it=[z.id];if(G&&G.key===z.id&&v0(G,it))return G;const ct=(ot(),dt("div",{key:z.id,class:$e(["frame-item",{overview:K===0}]),onClick:et=>K===0?S(z):P(z)},[K>0?(ot(),dt("div",Dw,Cs(K),1)):pe("",!0),A("div",Rw,[A("div",{ref_for:!0,ref:et=>K===0?y(et,z.id):b(et,z.id),class:"canvas-container","data-frame-id":z.id},null,8,Lw)]),A("div",jw,Cs(K===0?"概览":`页面 ${K}`),1)],10,["onClick"]));return ct.memo=it,ct},k,0),128))])])])]),A("div",{class:$e(["collapse-button",{show:n.value||O.collapsed}]),onClick:f},[A("span",Iw,Cs(O.collapsed?"›":"‹"),1)],2)],34)}}}),Nw=vs(Bw,[["__scopeId","data-v-e3521e96"]]),Hw={class:"canvas-container",ref:"containerRef"},zw=ze({__name:"BaseCanvas",emits:["canvas-ready"],setup(i,{expose:t,emit:e}){const s=e,n=nt(null),r=nt(null);let o=null;return ts(async()=>{await pi(),n.value&&r.value&&n.value.parentElement?(o=new ww(n.value,r.value,n.value.parentElement),await pi(),s("canvas-ready"),console.log("Canvas 已准备就绪，canvasManager 已初始化")):console.warn("Canvas 元素未完全挂载，无法初始化 canvasManager")}),mn(()=>{o==null||o.destroy(),o=null}),t({canvasManager:te(()=>o)}),(a,l)=>(ot(),dt("div",Hw,[A("canvas",{ref_key:"canvasRef",ref:n},null,512),A("canvas",{ref_key:"presentationCanvasRef",ref:r,class:"presentation-canvas"},null,512)],512))}}),Vw=vs(zw,[["__scopeId","data-v-090fcc12"]]),Ww={class:"background-image-selector"},Yw={class:"image-list-container"},Xw={class:"image-grid"},Uw=["onClick"],Gw=["src","alt"],$w={key:0,class:"load-more-container"},qw={key:1,class:"loading-indicator"},Kw=50,Zw=1200,Jw=2133,ld=300,Qw=ze({__name:"BackgroundImageSelector",props:{canvas:{},target:{},position:{}},emits:["select-image"],setup(i){const t=i,e=nt(null),s=nt([]),n=nt(1),r=nt(!1),o=()=>{e.value&&e.value.click()},a=u=>{const f=u.target;if(f.files&&f.files[0]){const d=f.files[0],p=URL.createObjectURL(d),g=t.canvas;if(!g){URL.revokeObjectURL(p);return}console.log("文件选择器选择的内容为：",p),Vf(g,p),f.value=""}},l=async()=>{if(!r.value){r.value=!0;try{const u=await fetch(`https://picsum.photos/v2/list?page=${n.value}&limit=${Kw}`);if(!u.ok)throw new Error(`HTTP error! status: ${u.status}`);const d=(await u.json()).map(p=>{const g=p.id,m=`https://picsum.photos/id/${g}/${Jw}/${Zw}`,v=`https://picsum.photos/id/${g}/${ld}/${ld}`;return{url:m,thumbnail:v,author:p.author||"未知作者"}});s.value=[...s.value,...d],n.value++}catch(u){console.error("加载图片失败:",u)}finally{r.value=!1}}},c=()=>{l()},h=u=>{t.canvas&&Vf(t.canvas,u)};return ts(()=>{l()}),(u,f)=>(ot(),dt("div",Ww,[f[2]||(f[2]=A("div",{class:"info-text"},[A("p",null,"请选择一张图片作为背景"),A("p",{class:"hint"},"支持 JPG、PNG、SVG 等常见图片格式")],-1)),A("button",{class:"select-button",onClick:o}," 选择图片 "),A("input",{type:"file",ref_key:"fileInput",ref:e,accept:"image/*",style:{display:"none"},onChange:a},null,544),A("div",Yw,[f[1]||(f[1]=A("h3",{class:"section-title"},"在线图片",-1)),A("div",Xw,[(ot(!0),dt(Wt,null,fs(s.value,(d,p)=>(ot(),dt("div",{key:p,class:"image-item",onClick:g=>h(d.url)},[A("img",{src:d.thumbnail,alt:`图片 ${p+1}`,class:"thumbnail"},null,8,Gw)],8,Uw))),128))]),r.value?pe("",!0):(ot(),dt("div",$w,[A("button",{class:"load-more-button",onClick:c},"加载更多")])),r.value?(ot(),dt("div",qw,f[0]||(f[0]=[A("span",null,"加载中...",-1)]))):pe("",!0)])]))}}),t1=vs(Qw,[["__scopeId","data-v-a8564d03"]]),e1={class:"background-color-selector"},s1={class:"color-picker"},n1={class:"color-input-wrapper"},i1={class:"color-presets"},r1={class:"preset-grid"},o1=["onClick"],a1=ze({__name:"BackgroundColorSelector",props:{canvas:{},target:{},position:{}},setup(i){const t=i,e=nt("#FFFFFF"),s=["#FFFFFF","#F5F5F5","#EEEEEE","#E0E0E0","#FFEBEE","#FCE4EC","#F3E5F5","#EDE7F6","#E8EAF6","#E3F2FD","#E1F5FE","#E0F7FA","#E0F2F1","#E8F5E9","#F1F8E9","#F9FBE7","#FFFDE7","#FFF8E1","#FFF3E0","#FBE9E7"],n=()=>{t.canvas&&wC(t.canvas,e.value)},r=o=>{e.value=o,n()};return(o,a)=>(ot(),dt("div",e1,[A("div",s1,[a[2]||(a[2]=A("label",{for:"color-input"},"选择背景颜色:",-1)),A("div",n1,[mi(A("input",{type:"color",id:"color-input","onUpdate:modelValue":a[0]||(a[0]=l=>e.value=l),onChange:n},null,544),[[xc,e.value]]),mi(A("input",{type:"text","onUpdate:modelValue":a[1]||(a[1]=l=>e.value=l),onChange:n,placeholder:"#FFFFFF"},null,544),[[xc,e.value]])])]),A("div",i1,[a[3]||(a[3]=A("h4",null,"预设颜色:",-1)),A("div",r1,[(ot(),dt(Wt,null,fs(s,l=>A("div",{key:l,class:"color-preset",style:cs({backgroundColor:l}),onClick:c=>r(l)},null,12,o1)),64))])])]))}}),l1=vs(a1,[["__scopeId","data-v-aab8b53b"]]),c1={class:"insert-image-selector"},h1={class:"image-list-container"},u1={class:"image-grid"},f1=["onClick"],d1=["src","alt"],g1={key:0,class:"load-more-container"},p1={key:1,class:"loading-indicator"},m1=50,cd=1200,hd=300,v1=ze({__name:"InsertImageSelector",props:{canvas:{},canvasManager:{},target:{},position:{}},setup(i){const t=i,e=nt(null),s=nt([]),n=nt(1),r=nt(!1),o=()=>{e.value&&e.value.click()},a=u=>{const f=u.target;if(f.files&&f.files[0]){const d=f.files[0],p=URL.createObjectURL(d);console.log("文件选择器选择的内容为：",t.canvasManager,p),t.canvasManager.getControlsManager().addImage(p),f.value=""}},l=async()=>{if(!r.value){r.value=!0;try{const u=await fetch(`https://picsum.photos/v2/list?page=${n.value}&limit=${m1}`);if(!u.ok)throw new Error(`HTTP error! status: ${u.status}`);const d=(await u.json()).map(p=>{const g=p.id,m=`https://picsum.photos/id/${g}/${cd}/${cd}`,v=`https://picsum.photos/id/${g}/${hd}/${hd}`;return{url:m,thumbnail:v,author:p.author||"未知作者"}});s.value=[...s.value,...d],n.value++}catch(u){console.error("加载图片失败:",u)}finally{r.value=!1}}},c=()=>{l()},h=u=>{t.canvasManager&&t.canvasManager.getControlsManager().addImage(u)};return ts(()=>{l()}),(u,f)=>(ot(),dt("div",c1,[f[2]||(f[2]=A("div",{class:"info-text"},[A("p",null,"请选择图片插入到画布中"),A("p",{class:"hint"},"支持 JPG、PNG、SVG 等常见图片格式")],-1)),A("button",{class:"select-button",onClick:o}," 选择本地图片 "),A("input",{type:"file",ref_key:"fileInput",ref:e,accept:"image/*",style:{display:"none"},onChange:a},null,544),A("div",h1,[f[1]||(f[1]=A("h3",{class:"section-title"},"在线图片",-1)),A("div",u1,[(ot(!0),dt(Wt,null,fs(s.value,(d,p)=>(ot(),dt("div",{key:p,class:"image-item",onClick:g=>h(d.url)},[A("img",{src:d.thumbnail,alt:`图片 ${p+1}`,class:"thumbnail"},null,8,d1)],8,f1))),128))]),r.value?pe("",!0):(ot(),dt("div",g1,[A("button",{class:"load-more-button",onClick:c},"加载更多")])),r.value?(ot(),dt("div",p1,f[0]||(f[0]=[A("span",null,"加载中...",-1)]))):pe("",!0)])]))}}),_1=vs(v1,[["__scopeId","data-v-726aea90"]]),y1={class:"panel-content"},b1={class:"panel-header"},x1={class:"panel-body"},C1=ze({__name:"ControlPanel",props:{collapsed:{type:Boolean},panelData:{}},emits:["update:collapsed"],setup(i,{emit:t}){const e=i,s=t,n=gh(null),r=nt(""),o=nt({canvas:null,target:null,position:null});ds(()=>e.panelData,c=>{c&&(r.value=c.type,o.value={canvas:c.canvas,target:c.target,position:c.position,canvasManager:c.canvasManager},c.type===ut.PANEL_TYPE.BACKGROUND_IMAGE?n.value=t1:c.type===ut.PANEL_TYPE.BACKGROUND_COLOR?n.value=l1:c.type===ut.PANEL_TYPE.INSERT_IMAGE&&(n.value=_1))},{immediate:!0});const a=()=>{s("update:collapsed",!0)},l=te(()=>{switch(r.value){case"background-image":return"更换背景图片";case"background-color":return"更换背景颜色";case"insert-image":return"插入图片";default:return"扩展面板"}});return(c,h)=>(ot(),dt("div",{class:$e(["control-panel",{"panel-collapsed":c.collapsed}])},[A("div",y1,[A("div",b1,[A("h3",null,Cs(l.value),1),A("button",{class:"close-button",onClick:a},h[0]||(h[0]=[A("span",{class:"close-icon"},"×",-1)]))]),A("div",x1,[n.value?(ot(),hn(Zd(n.value),{key:0,canvas:o.value.canvas,target:o.value.target,position:o.value.position,canvasManager:o.value.canvasManager},null,8,["canvas","target","position","canvasManager"])):pe("",!0)])])],2))}}),S1=vs(C1,[["__scopeId","data-v-197aff76"]]),w1={"Microsoft YaHei":"微软雅黑","Microsoft YaHei UI":"微软雅黑 UI",SimSun:"宋体",SimHei:"黑体",KaiTi:"楷体",FangSong:"仿宋",STXihei:"华文细黑",STKaiti:"华文楷体",STSong:"华文宋体",STFangsong:"华文仿宋",STZhongsong:"华文中宋",STHupo:"华文琥珀",STXinwei:"华文新魏",STLiti:"华文隶书",FZShuTi:"方正舒体",FZYaoti:"方正姚体",YouYuan:"幼圆",LiSu:"隶书",NSimSun:"新宋体","DFKai-SB":"标楷体","Source Han Sans CN":"思源黑体","Source Han Serif CN":"思源宋体","Noto Sans SC":"Noto Sans 简体中文","Noto Serif SC":"Noto Serif 简体中文","PingFang SC":"苹方-简","Hiragino Sans GB":"冬青黑体","WenQuanYi Micro Hei":"文泉驿微米黑","WenQuanYi Zen Hei":"文泉驿正黑",HYQiHei:"汉仪旗黑",HYKaiti:"汉仪楷体",HYZhuoKai:"汉仪卓楷",HYLeMiao:"汉仪乐喵体",HYXiaoMaiTi:"汉仪小麦体",HYCuYuan:"汉仪粗圆",HYDaSongJ:"汉仪大宋简",HYShangWeiShouShuW:"汉仪尚巍手书W",MingLiU:"细明体",PMingLiU:"新细明体","MingLiU-ExtB":"细明体-ExtB","PMingLiU-ExtB":"新细明体-ExtB",MingLiU_HKSCS:"细明体_HKSCS","MingLiU_HKSCS-ExtB":"细明体_HKSCS-ExtB","SimSun-ExtB":"宋体-ExtB",FangSong_GB2312:"仿宋_GB2312",KaiTi_GB2312:"楷体_GB2312",Dengxian:"等线","Dengxian Light":"等线 Light","Founder Type":"方正字体","Founder Clear Song":"方正清刻本悦宋简体","Founder Black Body":"方正黑体","Founder Thin":"方正细黑","Founder Compact":"方正综艺简体","Founder Cute":"方正卡通","Founder Handwriting":"方正行楷","Founder Elegant":"方正隶变简体","Founder Super":"方正超粗黑","Founder Shao":"方正少儿","Founder Simplified":"方正简体","Founder Imitation Song":"方正仿宋","Founder Regular Script":"方正楷体","Founder Small":"方正小标宋简体","Founder Xin":"方正新书宋简体","Founder Yan":"方正颜宋简体","Founder Fang":"方正仿宋简体","Founder Song":"方正书宋简体","Founder Old":"方正老宋简体",Arial:"Arial 标准","Arial Black":"Arial 黑体","Comic Sans MS":"Comic Sans 手写体","Courier New":"Courier New 等宽字体",Georgia:"Georgia 衬线体",Impact:"Impact 粗体","Times New Roman":"Times New Roman 衬线体","Trebuchet MS":"Trebuchet MS 无衬线体",Verdana:"Verdana 无衬线体",Webdings:"Webdings 符号",Wingdings:"Wingdings 符号",Calibri:"Calibri 无衬线体",Cambria:"Cambria 衬线体",Consolas:"Consolas 等宽字体","Segoe UI":"Segoe UI 界面字体",Tahoma:"Tahoma 无衬线体",Helvetica:"Helvetica 无衬线体","Helvetica Neue":"Helvetica Neue 现代无衬线体","Lucida Sans":"Lucida Sans 无衬线体","Lucida Console":"Lucida Console 等宽字体",Monaco:"Monaco 等宽字体","Palatino Linotype":"Palatino Linotype 衬线体","Book Antiqua":"Book Antiqua 古典衬线体",Garamond:"Garamond 优雅衬线体","Century Gothic":"Century Gothic 几何无衬线体","Franklin Gothic":"Franklin Gothic 无衬线体",Copperplate:"Copperplate 铜板体",Papyrus:"Papyrus 手写体","Brush Script MT":"Brush Script MT 笔刷体"};async function T1(){try{if("queryLocalFonts"in window){const t=(await window.queryLocalFonts()).map(n=>({label:w1[n.family]||n.family,value:n.family})),e=[],s=new Map;for(const n of t)s.has(n.value.toLowerCase())||(s.set(n.value.toLowerCase(),!0),e.push(n));return e}else return console.warn("浏览器不支持queryLocalFonts API"),[]}catch(i){return console.error("获取系统字体失败:",i),[]}}const O1=[{label:"微软雅黑",value:"Microsoft YaHei"},{label:"宋体",value:"SimSun"},{label:"黑体",value:"SimHei"},{label:"楷体",value:"KaiTi"},{label:"仿宋",value:"FangSong"},{label:"Arial 标准",value:"Arial"},{label:"Times New Roman 衬线体",value:"Times New Roman"},{label:"Courier New 等宽字体",value:"Courier New"}],M1={class:"color-picker-panel"},E1={class:"color-category"},k1={class:"color-options"},P1=["onClick"],A1={class:"color-category"},F1={class:"color-options"},D1=["onClick"],R1={class:"color-category"},L1={class:"color-options"},j1=["onClick"],I1={class:"color-category"},B1={class:"color-options"},N1={class:"color-category"},H1={class:"custom-color-picker"},z1={class:"color-input-group"},V1=["value"],W1=ze({__name:"ColorPicker",props:{color:{}},emits:["update:color","select"],setup(i,{emit:t}){const e=i,s=t,n=nt(e.color),r=nt(e.color==="transparent"?"":e.color),o=nt(null);ts(()=>{o.value&&n.value!=="transparent"&&(o.value.value=n.value)}),ds(()=>e.color,f=>{n.value=f,r.value=f==="transparent"?"":f});const a=f=>{n.value=f,r.value=f==="transparent"?"":f,s("update:color",f),s("select",f)},l=f=>{const d=f.target;r.value=d.value,n.value=d.value,s("update:color",d.value)},c=f=>{const d=f.target;/^#[0-9A-F]{6}$/i.test(d.value)&&o.value&&(o.value.value=d.value)},h=()=>{(!r.value||!/^#[0-9A-F]{6}$/i.test(r.value))&&(r.value=n.value==="transparent"?"#000000":n.value)},u=()=>{/^#[0-9A-F]{6}$/i.test(r.value)&&a(r.value)};return(f,d)=>(ot(),dt("div",M1,[A("div",E1,[d[4]||(d[4]=A("div",{class:"category-title"},"渐变柔和风",-1)),A("div",k1,[(ot(!0),dt(Wt,null,fs(Je(Wr).GRADIENT_COLORS,p=>(ot(),dt("div",{key:p,class:"color-option",style:cs({backgroundColor:p}),onClick:g=>a(p)},null,12,P1))),128))])]),A("div",A1,[d[5]||(d[5]=A("div",{class:"category-title"},"扁平UI色",-1)),A("div",F1,[(ot(!0),dt(Wt,null,fs(Je(Wr).FLAT_UI_COLORS.slice(0,10),p=>(ot(),dt("div",{key:p,class:"color-option",style:cs({backgroundColor:p}),onClick:g=>a(p)},null,12,D1))),128))])]),A("div",R1,[d[6]||(d[6]=A("div",{class:"category-title"},"中国传统色",-1)),A("div",L1,[(ot(!0),dt(Wt,null,fs(Je(Wr).TRADITIONAL_CHINESE_COLORS.slice(0,10),p=>(ot(),dt("div",{key:p,class:"color-option",style:cs({backgroundColor:p}),onClick:g=>a(p)},null,12,j1))),128))])]),A("div",I1,[d[7]||(d[7]=A("div",{class:"category-title"},"基础色",-1)),A("div",B1,[A("div",{class:"color-option",style:{"background-color":"#000000"},onClick:d[0]||(d[0]=p=>a("#000000"))}),A("div",{class:"color-option",style:{"background-color":"#FFFFFF"},onClick:d[1]||(d[1]=p=>a("#FFFFFF"))}),A("div",{class:"color-option transparent",onClick:d[2]||(d[2]=p=>a("transparent"))})])]),A("div",N1,[d[8]||(d[8]=A("div",{class:"category-title"},"自定义颜色",-1)),A("div",H1,[A("div",z1,[A("input",{type:"color",ref_key:"colorPickerInput",ref:o,value:n.value==="transparent"?"#000000":n.value,onInput:l,class:"color-input"},null,40,V1),mi(A("input",{type:"text","onUpdate:modelValue":d[3]||(d[3]=p=>r.value=p),onInput:c,onBlur:h,class:"color-text-input",placeholder:"#RRGGBB"},null,544),[[xc,r.value]])]),A("button",{class:"apply-color-btn",onClick:u},"应用")])])]))}}),ac=vs(W1,[["__scopeId","data-v-65a1d3cb"]]),Y1={class:"toolbar-buttons"},X1={class:"text-style-control"},U1=["value"],G1={class:"font-family-control"},$1=["value"],q1={class:"font-size-control"},K1={class:"color-selector"},Z1={class:"color-selector"},J1={class:"color-selector"},Q1=ze({__name:"TextSettingToolbar",props:{canvasManager:{},panelData:{}},setup(i){const t=i,e=nt(!1),s=nt(null),n=nt({top:0,left:0}),r=nt(!1),o=nt(!1),a=nt(!1),l=nt(!1),c=nt(!1),h=nt(!1),u=nt(16),f=nt("#000000"),d=nt("transparent"),p=nt("transparent"),g=nt("left"),m=nt("Arial"),v=nt("normal"),_=[{label:"普通",value:"normal"},{label:"标题1",value:"heading1"},{label:"标题2",value:"heading2"},{label:"标题3",value:"heading3"},{label:"标题4",value:"heading4"},{label:"引用",value:"quote"},{label:"代码",value:"code"}],y=nt([...O1]),b=async()=>{T1().then(B=>{y.value=B}).catch(B=>{console.error("获取系统字体失败:",B),alert("获取系统字体失败，可能是因为页面不可见或缺少用户交互。请尝试点击页面后再操作。")})},S=B=>{ct(B),r.value=!1},P=B=>{et(B),o.value=!1},O=B=>{Z(B),a.value=!1},k=te(()=>({top:`${n.value.top}px`,left:`${n.value.left}px`})),D=()=>{if(!s.value)return;const B=s.value;l.value=B.fontWeight==="bold",c.value=B.fontStyle==="italic",h.value=B.underline===!0,u.value=B.fontSize||16,f.value=B.fill||"#000000",d.value=B.textBackgroundColor||"transparent",p.value=B.backgroundColor||"transparent",g.value=B.textAlign||"left",m.value=B.fontFamily||"Arial",B.fontSize>=40?v.value="heading1":B.fontSize>=32?v.value="heading2":B.fontSize>=24?v.value="heading3":B.fontSize>=18?v.value="heading4":v.value="normal"},z=()=>{var X;if(!s.value)return;const B=s.value,N=B.fontWeight==="bold"?"normal":"bold";B.set("fontWeight",N),l.value=N==="bold",(X=t.canvasManager)==null||X.canvas.renderAll()},K=()=>{var X;if(!s.value)return;const B=s.value,N=B.fontStyle==="italic"?"normal":"italic";B.set("fontStyle",N),c.value=N==="italic",(X=t.canvasManager)==null||X.canvas.renderAll()},st=()=>{var X;if(!s.value)return;const B=s.value,N=!B.underline;B.set("underline",N),h.value=N,(X=t.canvasManager)==null||X.canvas.renderAll()},G=()=>{if(!s.value)return;const B=s.value,N=Math.min((B.fontSize||16)+1,1e3);B.setFontSize(N,!0),u.value=N},it=()=>{if(!s.value)return;const B=s.value,N=Math.min((B.fontSize||16)-1,1e3);B.setFontSize(N,!0),u.value=N},ct=B=>{var X;if(!s.value)return;s.value.set("fill",B),f.value=B,r.value=!1,(X=t.canvasManager)==null||X.canvas.renderAll()},et=B=>{var X;if(!s.value)return;s.value.set("textBackgroundColor",B),d.value=B,o.value=!1,(X=t.canvasManager)==null||X.canvas.renderAll()},Z=B=>{var X;if(!s.value)return;s.value.set("backgroundColor",B),p.value=B,a.value=!1,(X=t.canvasManager)==null||X.canvas.renderAll()},Y=B=>{var X;if(!s.value)return;s.value.set("textAlign",B),g.value=B,(X=t.canvasManager)==null||X.canvas.renderAll()},pt=()=>{var N;if(!s.value)return;s.value.set("fontFamily",m.value),(N=t.canvasManager)==null||N.canvas.renderAll()},Tt=()=>{var N;if(!s.value)return;const B=s.value;switch(v.value){case"heading1":B.applyTextStyle({fontSize:40,fontWeight:"bold"}),u.value=40,l.value=!0;break;case"heading2":B.applyTextStyle({fontSize:32,fontWeight:"bold"}),u.value=32,l.value=!0;break;case"heading3":B.applyTextStyle({fontSize:24,fontWeight:"bold"}),u.value=24,l.value=!0;break;case"heading4":B.applyTextStyle({fontSize:18,fontWeight:"bold"}),u.value=18,l.value=!0;break;case"quote":B.applyTextStyle({fontStyle:"italic",textBackgroundColor:"#f0f0f0"}),c.value=!0,d.value="#f0f0f0";break;case"code":B.applyTextStyle({fontFamily:"Courier New",textBackgroundColor:"#f5f5f5"}),m.value="Courier New",d.value="#f5f5f5";break;case"normal":default:B.applyTextStyle({fontSize:16,fontWeight:"normal",fontStyle:"normal",textBackgroundColor:"transparent"}),u.value=16,l.value=!1,c.value=!1,d.value="transparent";break}(N=t.canvasManager)==null||N.canvas.renderAll()},Pt=()=>{var I;if(!s.value||!((I=t.canvasManager)!=null&&I.canvas))return;const B=t.canvasManager.canvas,X=s.value.getBoundingRect(),Vt=B.getZoom(),Rt=B.viewportTransform;if(!Rt)return;const R=X.left*Vt+Rt[4],J=X.top*Vt+Rt[5];X.width*Vt,X.height*Vt;const V=document.querySelector(".text-format-toolbar"),Q=V?V.offsetWidth:300,bt=V?V.offsetHeight:50,x=window.innerWidth,C=window.innerHeight;let M=R-Q/2,L=J-bt-15;M=Math.max(10,Math.min(M,x-Q-10)),L=Math.max(10,Math.min(L,C-bt-10)),n.value={left:M,top:L}};return ts(()=>{b(),document.addEventListener("click",B=>{(r.value||o.value)&&!B.composedPath().some(N=>{var X;return(X=N.classList)==null?void 0:X.contains("color-selector")})&&(r.value=!1,o.value=!1,a.value=!1)})}),mn(()=>{document.removeEventListener("click",()=>{})}),ds(()=>t.panelData,B=>{B&&B.target&&(s.value=B.target,e.value=!0,D(),Pt())},{immediate:!0}),(B,N)=>e.value?(ot(),dt("div",{key:0,class:"text-format-toolbar",style:cs(k.value)},[A("div",Y1,[A("div",X1,[mi(A("select",{"onUpdate:modelValue":N[0]||(N[0]=X=>v.value=X),onChange:Tt},[(ot(),dt(Wt,null,fs(_,X=>A("option",{key:X.value,value:X.value},Cs(X.label),9,U1)),64))],544),[[Nu,v.value]])]),N[19]||(N[19]=A("div",{class:"divider"},null,-1)),A("button",{onClick:z,class:$e({active:l.value}),title:"粗体"},N[11]||(N[11]=[A("i",{class:"fas fa-bold"},null,-1)]),2),A("button",{onClick:K,class:$e({active:c.value}),title:"斜体"},N[12]||(N[12]=[A("i",{class:"fas fa-italic"},null,-1)]),2),A("button",{onClick:st,class:$e({active:h.value}),title:"下划线"},N[13]||(N[13]=[A("i",{class:"fas fa-underline"},null,-1)]),2),N[20]||(N[20]=A("div",{class:"divider"},null,-1)),A("div",G1,[mi(A("select",{"onUpdate:modelValue":N[1]||(N[1]=X=>m.value=X),onChange:pt},[(ot(!0),dt(Wt,null,fs(y.value,X=>(ot(),dt("option",{key:X.value,value:X.value},Cs(X.label),9,$1))),128))],544),[[Nu,m.value]])]),N[21]||(N[21]=A("div",{class:"divider"},null,-1)),A("div",q1,[A("button",{onClick:it,title:"减小字号"},N[14]||(N[14]=[A("i",{class:"fas fa-minus"},null,-1)])),A("span",null,Cs(u.value),1),A("button",{onClick:G,title:"增大字号"},N[15]||(N[15]=[A("i",{class:"fas fa-plus"},null,-1)]))]),N[22]||(N[22]=A("div",{class:"divider"},null,-1)),A("button",{onClick:N[2]||(N[2]=X=>Y("left")),class:$e({active:g.value==="left"}),title:"左对齐"},N[16]||(N[16]=[A("i",{class:"fas fa-align-left"},null,-1)]),2),A("button",{onClick:N[3]||(N[3]=X=>Y("center")),class:$e({active:g.value==="center"}),title:"居中对齐"},N[17]||(N[17]=[A("i",{class:"fas fa-align-center"},null,-1)]),2),A("button",{onClick:N[4]||(N[4]=X=>Y("right")),class:$e({active:g.value==="right"}),title:"右对齐"},N[18]||(N[18]=[A("i",{class:"fas fa-align-right"},null,-1)]),2),N[23]||(N[23]=A("div",{class:"divider"},null,-1)),A("div",K1,[A("button",{onClick:N[5]||(N[5]=X=>r.value=!r.value),title:"文本颜色"},[A("div",{class:"color-preview",style:cs({backgroundColor:f.value})},null,4)]),r.value?(ot(),hn(ac,{key:0,color:f.value,"onUpdate:color":N[6]||(N[6]=X=>f.value=X),onSelect:S},null,8,["color"])):pe("",!0)]),A("div",Z1,[A("button",{onClick:N[7]||(N[7]=X=>o.value=!o.value),title:"文本背景颜色"},[A("div",{class:"color-preview bg-color-preview",style:cs({backgroundColor:d.value})},null,4)]),o.value?(ot(),hn(ac,{key:0,color:d.value,"onUpdate:color":N[8]||(N[8]=X=>d.value=X),onSelect:P},null,8,["color"])):pe("",!0)]),A("div",J1,[A("button",{onClick:N[9]||(N[9]=X=>a.value=!a.value),title:"文本框背景颜色"},[A("div",{class:"color-preview box-bg-color-preview",style:cs({backgroundColor:p.value})},null,4)]),a.value?(ot(),hn(ac,{key:0,color:p.value,"onUpdate:color":N[10]||(N[10]=X=>p.value=X),onSelect:O},null,8,["color"])):pe("",!0)])])],4)):pe("",!0)}}),tT=vs(Q1,[["__scopeId","data-v-b9653055"]]);function eT(i){const t=nt(!1),e=nt(null),s=nt(null),n=o=>{console.log("useSettingToolsHandle 收到显示文本设置工具栏事件",o),e.value=o,t.value=!0,s.value&&(s.value.getTextSettingToolbarData().value=o,s.value.getTextSettingToolbarVisible().value=!0)},r=()=>{t.value=!1,e.value=null,s.value&&(s.value.getTextSettingToolbarVisible().value=!1,s.value.getTextSettingToolbarData().value=null)};return ts(()=>{yt.on(ut.CONTROL_PANEL.SHOW_TEXT_SETTING_TOOLBAR,n),yt.on(ut.CONTROL_PANEL.HIDE_TEXT_SETTING_TOOLBAR,r)}),mn(()=>{yt.off(ut.CONTROL_PANEL.SHOW_TEXT_SETTING_TOOLBAR,n),yt.off(ut.CONTROL_PANEL.HIDE_TEXT_SETTING_TOOLBAR,r),s.value&&(s.value.destroy(),s.value=null)}),{settingToolsHandle:s,textSettingToolbarVisible:t,textSettingToolbarData:e}}const sT={class:"editor"},nT={key:0,class:"editor-toolbar"},iT={class:"editor-main"},rT={class:"editor-workspace"},oT={key:0,class:"floating-panels"},aT=ze({__name:"NextEditorVue",emits:["update:controlPanelCollapsed"],setup(i,{emit:t}){const e=t,s=nt(!1),n=nt(null),r=nt(!1),o=nt(!1),a=nt(!1),l=nt(null),c=gh(null),h=te(()=>{var y;return(y=n.value)==null?void 0:y.selectedFrame}),u=te(()=>{var y;return(y=n.value)==null?void 0:y.selectedPage}),f=te(()=>{var y,b;return s.value?(c.value||(c.value=(y=n.value)==null?void 0:y.canvasManager,console.log("NextEditor computed canvasManager:",{manager:c.value,hasCanvas:((b=c.value)==null?void 0:b.canvas)!=null})),c.value):(console.log("Canvas 尚未准备就绪，canvasManager 不可用"),null)}),{textSettingToolbarVisible:d,textSettingToolbarData:p}=eT(),g=y=>{o.value=y,e("update:controlPanelCollapsed",y)};ds(f,y=>{console.log("NextEditor canvasManager 初始化完成！",y),y&&y.canvas&&pi(()=>{s.value=!0})},{immediate:!0});const m=async()=>{console.log("Canvas 已发出就绪事件"),await pi(),n.value&&n.value.canvasManager?(c.value=n.value.canvasManager,s.value=!0,console.log("Canvas 已准备就绪，canvasManager 已缓存")):(console.warn("Canvas 已发出就绪事件，但 canvasManager 尚未可用"),setTimeout(v,100))},v=()=>{n.value&&n.value.canvasManager?(c.value=n.value.canvasManager,s.value=!0,console.log("延迟检查：Canvas 已准备就绪，canvasManager 已缓存")):console.warn("延迟检查：canvasManager 仍未初始化")},_=y=>{l.value=y,a.value=!0,setTimeout(()=>{o.value=!1},0)};return ts(async()=>{console.log("NextEditor 组件已挂载，等待 Canvas 准备就绪")}),ts(()=>{yt.on(ut.CONTROL_PANEL.OPEN,_)}),mn(()=>{yt.off(ut.CONTROL_PANEL.OPEN,_)}),ds(o,y=>{y===!0&&setTimeout(()=>{a.value=!1},300)}),(y,b)=>(ot(),dt("div",sT,[s.value?(ot(),dt("div",nT,[ae(rb,{"canvas-manager":f.value},null,8,["canvas-manager"])])):pe("",!0),A("div",iT,[A("div",rT,[ae(Vw,{ref_key:"canvasRef",ref:n,onCanvasReady:m},null,512)]),s.value?(ot(),dt("div",oT,[ae(Nw,{collapsed:r.value,"onUpdate:collapsed":b[0]||(b[0]=S=>r.value=S),"canvas-manager":f.value,"selected-frame":h.value,"selected-page":u.value},null,8,["collapsed","canvas-manager","selected-frame","selected-page"]),a.value?(ot(),hn(S1,{key:0,collapsed:o.value,"onUpdate:collapsed":[b[1]||(b[1]=S=>o.value=S),g],"panel-data":l.value},null,8,["collapsed","panel-data"])):pe("",!0),Je(d)?(ot(),hn(tT,{key:1,"canvas-manager":f.value,"panel-data":Je(p)},null,8,["canvas-manager","panel-data"])):pe("",!0)])):pe("",!0)])]))}}),lT=vs(aT,[["__scopeId","data-v-b9c65be2"]]);class Ov extends bs{constructor(e,s){const n={...s,backgroundColor:"red",textBackgroundColor:"blue",padding:10,textAlign:"left",width:800,height:300,originY:"top",splitByGrapheme:!0,lockScalingFlip:!0,minHeight:100,fixedHeight:!0,maxWidth:800,fontSize:40};super(e,{...n});F(this,"preventDistortion",!0);F(this,"_originalWidth",0);F(this,"_originalHeight",0);F(this,"_skipDimension",!1);F(this,"_minFontSize",11);F(this,"_originalFontSize",40);F(this,"_isMoving",!1);this._originalWidth=this.width,this._originalHeight=this.height,this._originalFontSize=this.fontSize||40,this._minFontSize=n._minFontSize||11,this.on("scaling",this.handleScaling.bind(this)),this.on("moving",this.handleMoving.bind(this)),this.on("mouseup",this.handleMoveEnd.bind(this)),this.on("deselected",this.handleMoveEnd.bind(this))}handleMoving(){this._isMoving=!0,console.log("控件开始移动")}handleMoveEnd(){this._isMoving=!1,console.log("控件移动结束")}isObjMoving(){return this._isMoving}initDimensions(){if(console.log("initDimensions"),this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),!this._skipDimension){if(this._splitText(),this._clearCache(),console.log("initDimensions this.path",this.path,new Date().getTime()),this.path)this.width=this.path.width,this.height=this.path.height;else{const e=this.width,s=this.calcTextWidth();console.log("initDimensions originalWidth",e,"  fontWidth",s,new Date().getTime()),s>e?this.width=s:this.width=e,console.log("this.height",this.height,this.calcTextHeight());const n=this.calcTextHeight();this.isEditing&&n>this.height&&(this.height=n)}this.textAlign&&this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),console.log("--------------------------------------------------------------------"),this.dirty=!0,this.canvas&&this.canvas.requestRenderAll()}}adjustTextSize(e,s,n){if(!this.canvas)return;const r=this.calcTextWidth(),o=this.calcTextHeight(),a=this.width,l=this.height;console.log("字体宽度:"+r,"字体高度:"+o,"容器宽度："+a,"容器高度："+l,new Date().getTime());const c=a/r,h=l/o;if(console.log("容器宽度比例:",c,"容器高度比例:",h,new Date().getTime()),c<1||h<1){const u=Math.min(c,h),f=Math.max(Number((this.fontSize*u).toFixed(3)),this._minFontSize);console.log("文本超出容器，缩小字体到:",f),this.set("fontSize",f),this.syncTextStyles()}else if(e&&s&&n){const u=e.width?e.width/s:1,f=e.height?e.height/n:1,d=Math.max(u,f);if(console.log("缩放因子:",d,"当前字号:",this.fontSize),d>1&&c>1&&h>1){const p=Math.min(Number((this.fontSize*d).toFixed(3)),this._originalFontSize);console.log("放大字体到:",p),this.set("fontSize",p),this.syncTextStyles()}else if(d<1&&(c<1||h<1)){const p=Math.max(Number((this.fontSize*d).toFixed(3)),this._minFontSize);console.log("缩小字体到:",p),this.set("fontSize",p),this.syncTextStyles()}}}syncTextStyles(){if(!this.styles)return;const e=this.fontSize||40;for(const s in this.styles)for(const n in this.styles[s])this.styles[s][n]&&(this.styles[s][n].fontSize=e);console.log("已同步所有文本样式的字体大小:",e)}handleScaling(){if(!this.preventDistortion||!this.canvas)return;let e=!1;const s={},n=this.width,r=this.height;if(console.log("缩放事件 当前文本组件宽高:",this.width,this.height),console.log("缩放事件 X:",this.scaleX,s.scaleX,"缩放事件 Y:",this.scaleY,s.scaleY),this.scaleX!==1&&(s.scaleX=1,s.width=this.width*this.scaleX,e=!0),this.scaleY!==1){s.scaleY=1;const o=this.calcTextHeight()*(this._minFontSize/this.fontSize);s.height=Math.max(this.height*this.scaleY,o),e=!0}e&&(this.set(s),this.setCoords(),this.adjustTextSize(s,n,r))}}F(Ov,"type","preventDistortionTextbox");const ud={CENTER:"center"};function cT(i){return i.originX===ud.CENTER&&i.originY===ud.CENTER}function hT(i,t,e,s,n,r){const o=t.target,a=Xi.getLocalPoint(t,t.originX,t.originY,e,s),l=o.strokeWidth/(o.strokeUniform?o.scaleX:1),c=cT(t)?2:1,h=o.width,u=Math.abs(a.x*c/o.scaleX)-l,f=Math.abs(a.y*c/o.scaleY)-l;return o.set("width",Math.max(u,0)),o.set("height",Math.max(f,0)),h!==u}const $r=class $r extends Hs{constructor(e,s){super(e,{...{textAlign:"left",width:500,height:200,originY:"top",splitByGrapheme:!0,lockUniScaling:!0,lockScalingFlip:!0,minHeight:100,fixedHeight:!0},...s});F(this,"preventDistortion",!0);F(this,"lockFontScaling",!0);F(this,"originalWidth",0);F(this,"originalHeight",0);F(this,"_lastFontSize",0);F(this,"_originalFontSize",0);this.originalWidth=this.width,this.originalHeight=this.height,this._originalFontSize=this.fontSize||16,this._lastFontSize=this._originalFontSize,this.on("scaling",this.handleScaling.bind(this)),this.on("modified",this.adjustTextSize.bind(this))}static initialize(){const e=new $r(""),s=Xi.wrapWithFireEvent("resizing",Xi.wrapWithFixedAnchor(hT));e.controls.br=new Ce({x:.5,y:.5,cursorStyleHandler:Xi.scaleSkewCursorStyleHandler,actionHandler:s}),$r.prototype.controls=e.controls;const n=Hs.prototype.calcTextHeight;Hs.prototype.calcTextHeight=function(){const r=n.call(this);return Math.max(this.height||0,r)}}_renderText(e){if(this.isEmptyStyles(0)){e.save(),this._renderTextFill(e),this._renderTextStroke(e),e.restore();return}const s=e.getTransform();(this.scaleX!==1||this.scaleY!==1)&&e.scale(1/this.scaleX,1/this.scaleY),this._renderTextLinesBackground(e),this._renderTextDecoration(e,"underline"),this._renderTextFill(e),this._renderTextStroke(e),this._renderTextDecoration(e,"overline"),this._renderTextDecoration(e,"linethrough"),e.setTransform(s)}handleScaling(){if(!this.preventDistortion||!this.canvas)return;let e=!1;const s={};this.scaleX!==1&&(s.scaleX=1,s.width=this.width*this.scaleX,e=!0),this.scaleY!==1&&(s.scaleY=1,s.height=this.height*this.scaleY,e=!0),e&&(this.canvas.fire("object:modified"),this.set(s),this.setCoords(),this.adjustTextSize(),this.canvas.requestRenderAll())}adjustTextSize(){if(!this.canvas)return;const e=this.width,s=this.height,n=this.calcTextWidth(),r=this.calcTextHeight(),o=e/n,a=s/r,l=Math.min(o,a);if(l<1){const c=Math.max(Math.floor(this.fontSize*l),8);this.set("fontSize",c),this._lastFontSize=c,this.canvas.requestRenderAll()}else if(l>1&&this.fontSize<this._originalFontSize){const c=Math.min(Math.floor(this.fontSize*l),this._originalFontSize);this.set("fontSize",c),this._lastFontSize=c,this.canvas.requestRenderAll()}}};F($r,"type","preventDistortionTextbox");let za=$r;za.initialize();const uT={class:"test-page"},fT=ze({__name:"TestPage",setup(i){Ky();const t=nt(null);let e=null,s=null;const n=()=>{if(!t.value)return;e=new ro(t.value,{width:window.innerWidth,height:window.innerHeight,backgroundColor:"#f0f0f0"}),s=new Ov("在这里输入文本"),s.set("initialFontSize",s.fontSize),e.on("selection:created",function(c){console.log("selection:created 事件触发",c.target)}),e.on("selection:updated",function(c){var h,u;console.log("selection:updated 事件触发",((u=(h=c.selected)==null?void 0:h[0])==null?void 0:u.fontSize)||s.fontSize)}),e.add(s);const l=new za("Hello World",{left:10,top:10,fontFamily:"Roboto-Regular",angle:0,fontSize:37,splitByGrapheme:!0});e.add(l),ir.fromURL("https://fastly.picsum.photos/id/3/300/300.jpg?hmac=RT2JK6MzdIgNIWoIj61uPcz8aOSOi3lu2vhnwOxs7lY").then(c=>{c.set({left:100,top:100,width:100,height:100,selectable:!0,hasControls:!0,hasBorders:!0}),e==null||e.add(c),e==null||e.setActiveObject(c)}),e.setActiveObject(s),e.renderAll()},r=()=>{!e||!s||(e.setActiveObject(s),e.renderAll(),console.log("手动触发选择事件"))},o=()=>{e&&console.log("Canvas 事件列表:",e.__eventListeners)},a=()=>{e&&(e.setWidth(window.innerWidth),e.setHeight(window.innerHeight),e.renderAll())};return ts(()=>{n(),window.addEventListener("resize",a)}),mn(()=>{window.removeEventListener("resize",a),e&&(e.dispose(),e=null)}),(l,c)=>(ot(),dt("div",uT,[A("canvas",{ref_key:"canvasRef",ref:t,class:"full-canvas"},null,512),A("div",{class:"debug-panel"},[A("button",{onClick:r,class:"debug-btn"},"触发选择事件"),A("button",{onClick:o,class:"debug-btn"},"打印事件列表")])]))}}),dT=vs(fT,[["__scopeId","data-v-9a9e3292"]]),gT=[{path:"/",name:"Editor",component:lT},{path:"/test-page",name:"TestPage",component:dT}],pT=$y({history:Sy(),routes:gT}),Mv=H0(X0);Mv.use(pT);Mv.mount("#app");
